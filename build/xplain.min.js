/*

 Copyright (c) 2015, Syuuhei Kuno
 All rights reserved.

 Redistribution and use in source and binary forms, with or without modification,
 are permitted provided that the following conditions are met:

  1. Redistributions of source code must retain the above copyright notice, this
     list of conditions and the following disclaimer.

  2. Redistributions in binary form must reproduce the above copyright notice,
     this list of conditions and the following disclaimer in the documentation
     and/or other materials provided with the distribution.

  3. Neither the name of the copyright holder nor the names of its contributors
     may be used to endorse or promote products derived from this software
     without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp={scope:{},getGlobal:function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global?global:b}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return"jscomp_symbol_"+b+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();if(b[$jscomp.global.Symbol.iterator])return b[$jscomp.global.Symbol.iterator]();if(!(b instanceof Array||"string"==typeof b||b instanceof String))throw new TypeError(b+" is not iterable");var a=0;return{next:function(){return a==b.length?{done:!0}:{done:!1,value:b[a++]}}}};$jscomp.arrayFromIterator=function(b){for(var a,e=[];!(a=b.next()).done;)e.push(a.value);return e};
$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.arrayFromArguments=function(b){for(var a=[],e=0;e<b.length;e++)a.push(b[e]);return a};
$jscomp.inherits=function(b,a){function e(){}e.prototype=a.prototype;b.prototype=new e;b.prototype.constructor=b;for(var c in a)if($jscomp.global.Object.defineProperties){var d=$jscomp.global.Object.getOwnPropertyDescriptor(a,c);void 0!==d&&$jscomp.global.Object.defineProperty(b,c,d)}else b[c]=a[c]};var xpl;"object"==typeof module?(xpl=module.exports,xpl.running_type="Node.js"):"object"==typeof exports?(xpl=exports,xpl.running_type="CommonJS"):xpl={running_type:"direct link"};
(function(b){Object.defineProperties(b,{RUNTYPE_NODE_JS:{value:"Node.js"},RUNTYPE_COMMON_JS:{value:"CommonJS"},RUNTYPE_DIRECT_LINK:{value:"direct link"}});b.about={};Object.defineProperties(b.about,{NAME:{value:"xPlain for JavaScript"},CODE_NAME:{value:"DEUS"},VERSION_CODE:{value:1},VERSION_NAME:{value:"0.9.0"},AUTHOR:{value:"Syuuhei Kuno"},COPYRIGHT:{value:"Copyright (c) 2015, Syuuhei Kuno All rights reserved."},LICENSE:{value:"http://opensource.org/licenses/BSD-3-Clause"},REPOSITORY:{value:"git@github.com:redlily/xplain_for_js.git"}});
b.getAbout=function(){return b.about.name+"\nVersion code:  "+b.about.VERSION_CODE+"\nVersion name:  "+b.about.VERSION_NAME+"\nAuthor:        "+b.about.AUTHOR+"\nCopyright:     "+b.about.COPYRIGHT+"\nLicense:       "+b.about.LICENSE+"\nRepository:    "+b.about.REPOSITORY};b.putAboutToStdout=function(){console.log(b.getAbout)};var a=new ArrayBuffer(8);b.size_t=function(){return Number.parseInt.apply(null,arguments)};b.ptrdiff_t=function(){return Number.parseInt.apply(null,arguments)};b.enum_t=function(){return Number.parseInt.apply(null,
arguments)};b.int8_t=function(){return Number.parseInt.apply(null,arguments)<<24>>24};Object.defineProperties(b.int8_t,{MIN_VALUE:{value:-Math.pow(2,7)},MAX_VALUE:{value:Math.pow(2,7)-1}});b.int16_t=function(){return Number.parseInt.apply(null,arguments)<<16>>16};Object.defineProperties(b.int16_t,{MIN_VALUE:{value:-Math.pow(2,15)},MAX_VALUE:{value:Math.pow(2,15)-1}});b.int32_t=function(){return Number.parseInt.apply(null,arguments)<<0>>0};Object.defineProperties(b.int32_t,{MIN_VALUE:{value:-Math.pow(2,
31)},MAX_VALUE:{value:Math.pow(2,31)-1}});b.float32_t=function(){return Number.parseFloat.apply(null,arguments)};b.float32_t.hashCode=function(e){a.setFloat64(e);return a.getUnit32(0).toString(16)};b.float64_t=function(){return Number.parseFloat.apply(null,arguments)};b.float64_t.hashCode=function(e){a.setFloat64(e);return a.getUnit32(0).toString(16)+a.getUnit32(1).toString(16)}})(xpl);(function(b){b.SystemUtils=function(){};if("object"==typeof window){var a=null,e=null;"function"==typeof window.requestAnimationFrame?(a=window.requestAnimationFrame,e=window.cancelAnimationFrame):"function"==typeof window.mozRequestAnimationFrame?(a=window.mozRequestAnimationFrame,e=window.mozCancelAnimationFrame):"function"==typeof window.webkitRequestAnimationFrame?(a=function(a){var d=window.webkitRequestAnimationFrame(function(){d.__is_cancel||a()});return d},e=function(a){a.__is_cancel=!0}):
"Function"==typeof window.msRequestAnimationFrame?(a=function(a){var d=window.msRequestAnimationFrame(function(){d.__is_cancel||a()});return d},e=function(a){a.__is_cancel=!0}):(a=function(a){return setTimeout(a,2)},e=clearTimeout);b.SystemUtils.requestAnimationFrame=function(c){return a(c)};b.SystemUtils.cancelAnimationFrame=function(a){e(timer)}}"object"==typeof document&&(b.SystemUtils.isSupportedFullScreen=function(a){return null!=(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||
a.msRequestFullscreen)},b.SystemUtils.requestFullScreen=function(a){if("function"==typeof a.requestFullscreen)a.requestFullscreen();else if("function"==typeof a.mozRequestFullScreen)a.mozRequestFullScreen();else if("function"==typeof a.webkitRequestFullscreen)a.webkitRequestFullscreen();else if("function"==typeof a.msRequestFullscreen)a.msRequestFullscreen();else return!1;return!0},b.SystemUtils.isFullScreen=function(){return window.innerWidth==screen.width&&window.innerHeight==screen.height},b.SystemUtils.cancelFullScreen=
function(){"function"==typeof document.exitFullscreen?document.exitFullscreen():"function"==typeof document.mozCancelFullScreen?document.mozCancelFullScreen():"function"==typeof document.webkitExitFullscreen?document.webkitExitFullscreen():"function"==typeof document.msExitFullscreen&&document.msExitFullscreen()})})(xpl);(function(b){b.MathUtils=function(){throw Error("Unsupported operation");};b.MathUtils.min=function(a,e,c){return a<e?a<c?a:c:e<c?e:c};b.MathUtils.mid=function(a,e,c){return a<e?e<c?e:c<a?a:c:a<c?a:c<e?e:c};b.MathUtils.max=function(a,e,c){return a<e?e<c?c:e:a<c?c:a};b.MathUtils.log=function(a,e){return Math.log(e)/Math.log(a)};b.MathUtils.cqrt=function(a){return 0<=a?Math.pow(a,1/3):-Math.pow(-a,1/3)};b.MathUtils.floorPow2=function(a){a=Math.floor(a);a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a|=a>>
32;return a^a>>1};b.MathUtils.cailPow2=function(a){a=Math.floor(a);--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;return(a|a>>32)+1}})(xpl);(function(b){b.ArrayUtils=function(){throw Error("Unsupported operation");};b.ArrayUtils.copy=function(a,e,c,d,b){for(var f=0;f<b;++f)c[d+f]=a[e+f]};b.ArrayUtils.fill=function(a,e,c,d){for(;e<c;++e)a[e]=d};b.ArrayUtils.binarySearch=function(a,e,c,d,b){for(c--;e<=c;){var f=e+c>>1,h=a[f],h=null!=b?b(h,d):h-d;if(0>h)e=f+1;else if(0<h)c=f-1;else return f}return-(e+1)};b.ArrayUtils.convertToSet=function(a,e,c,d){var b=[];a:for(;e<c;++e){for(var f=a[e],h=0;h<b.length;++h)if(null!=d?b[h]==f||d(b[h],f):b[h]==
f)continue a;b.push(f)}return b};b.ArrayUtils.isContained=function(a,e,c,d,b,f,h){if(c-e<f-b)return!1;a:for(;b<f;++b){for(var m=d[b],k=e;k<c;++k)if(null!=h?a[k]==m||h(a[k],m):a[k]==m)continue a;return!1}return!0}})(xpl);(function(b){b.StringUtils=function(){};b.StringUtils.encodeUTF8=function(a){for(var e=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&c<a.length-1&&(d=(d&1023)<<10|(a.charCodeAt(++c)&1023)+65536);128>d?e.push(d):2048>d?e.push(d>>6&31|192,d>>0&63|128):65536>d?e.push(d>>12&15|224,d>>6&63|128,d>>0&63|128):2097152>d?e.push(d>>18&7|240,d>>12&63|128,d>>6&63|128,d>>0&63|128):67108864>d?e.push(d>>24&3|248,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|128):2147483648>d&&e.push(d>>30&1|252,
d>>24&63|128,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|128)}return e};b.StringUtils.decodeUTF8=function(a){for(var e="",c=0;c<a.length;){var d=255&a[c],b=0;128>d?b=0:223>d?(d=(31&d)<<6,b=1):239>d?(d=(15&d)<<12,b=2):247>d?(d=(7&d)<<18,b=3):251>d?(d=(3&d)<<24,b=4):253>d&&(d=(1&d)<<30,b=5);for(c++;0<b&&c<a.length;){var f=a[c];if(128>f)break;d|=(63&f)<<6*--b;c++}e=55295>d||57344<=d&&65535>=d?e+String.fromCharCode(d):e+String.fromCharCode(55296|d-65536>>10&1023,56320|d&1023)}return e}})(xpl);(function(b){b.Geometry=function(){throw Error("Unsupported operation");};Object.defineProperties(b.Geometry,{VX:{value:0},VY:{value:1},VZ:{value:2},VW:{value:3},SIZE_VECTOR_3:{value:3},CR:{value:0},CI:{value:1},CJ:{value:2},CK:{value:3},SIZE_QUATERNION:{value:4},M4X4_00:{value:0},M4X4_10:{value:1},M4X4_20:{value:2},M4X4_30:{value:3},M4X4_01:{value:4},M4X4_11:{value:5},M4X4_21:{value:6},M4X4_31:{value:7},M4X4_02:{value:8},M4X4_12:{value:9},M4X4_22:{value:10},M4X4_32:{value:11},M4X4_03:{value:12},
M4X4_13:{value:13},M4X4_23:{value:14},M4X4_33:{value:15},SIZE_MATRIX_4X4:{value:16}})})(xpl);(function(b){b.Matrix4x4=function(){throw Error("Unsupported operation");};b.Matrix4x4.load=function(a,e,c,d,b,f,h,m,k,l,n,p,q,r,u,x,v,y,w){null==w&&(w=!1);w?(a[e+0]=c,a[e+4]=h,a[e+8]=n,a[e+12]=u,a[e+1]=d,a[e+5]=m,a[e+9]=p,a[e+13]=x,a[e+2]=b,a[e+6]=k,a[e+10]=q,a[e+14]=v,a[e+3]=f,a[e+7]=l,a[e+11]=r):(a[e+0]=c,a[e+4]=d,a[e+8]=b,a[e+12]=f,a[e+1]=h,a[e+5]=m,a[e+9]=k,a[e+13]=l,a[e+2]=n,a[e+6]=p,a[e+10]=q,a[e+14]=r,a[e+3]=u,a[e+7]=x,a[e+11]=v);a[e+15]=y};b.Matrix4x4.loadv=function(a,e,c,d,g){b.Matrix4x4.load(a,
e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.loadZero=function(a,e){b.Matrix4x4.load(a,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!1)};b.Matrix4x4.loadIdentity=function(a,e){b.Matrix4x4.load(a,e,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,!1)};b.Matrix4x4.lrepv=function(a,e,c,d,g,f,h){var m=1-h;b.Matrix4x4.load(a,e,c[d+0]*m+g[f+0]*h,c[d+4]*m+g[f+4]*h,c[d+8]*m+g[f+8]*h,c[d+12]*m+g[f+12]*h,c[d+1]*m+g[f+1]*h,c[d+5]*m+g[f+5]*h,c[d+
9]*m+g[f+9]*h,c[d+13]*m+g[f+13]*h,c[d+2]*m+g[f+2]*h,c[d+6]*m+g[f+6]*h,c[d+10]*m+g[f+10]*h,c[d+14]*m+g[f+14]*h,c[d+3]*m+g[f+3]*h,c[d+7]*m+g[f+7]*h,c[d+11]*m+g[f+11]*h,c[d+15]*m+g[f+15]*h,!1)};b.Matrix4x4.transposev=function(a,e,c,d){var b=c[d+4],f=c[d+8],h=c[d+12],m=c[d+1],k=c[d+5],l=c[d+9],n=c[d+13],p=c[d+2],q=c[d+6],r=c[d+10],u=c[d+14],x=c[d+3],v=c[d+7],y=c[d+11],w=c[d+15];a[e+0]=c[d+0];a[e+4]=m;a[e+8]=p;a[e+12]=x;a[e+1]=b;a[e+5]=k;a[e+9]=q;a[e+13]=v;a[e+2]=f;a[e+6]=l;a[e+10]=r;a[e+14]=y;a[e+3]=
h;a[e+7]=n;a[e+11]=u;a[e+15]=w};b.Matrix4x4.determinant=function(a,e){var c=a[e+1],d=a[e+5],b=a[e+9],f=a[e+13],h=a[e+2],m=a[e+6],k=a[e+10],l=a[e+14],n=a[e+3],p=a[e+7],q=a[e+11],r=a[e+15];return a[e+0]*(d*(k*r-l*q)+b*(l*p-m*r)+f*(m*q-k*p))+a[e+4]*(c*(l*q-k*r)+b*(h*r-l*n)+f*(k*n-h*q))+a[e+8]*(c*(m*r-l*p)+d*(l*n-h*r)+f*(h*p-m*n))+a[e+12]*(c*(k*p-m*q)+d*(h*q-k*n)+b*(m*n-h*p))};b.Matrix4x4.inversev=function(a,e,c,d){var g=c[d+0],f=c[d+4],h=c[d+8],m=c[d+12],k=c[d+1],l=c[d+5],n=c[d+9],p=c[d+13],q=c[d+2],
r=c[d+6],u=c[d+10],x=c[d+14],v=c[d+3],y=c[d+7],w=c[d+11],z=c[d+15];c=k*r;d=k*u;var A=k*x,E=k*y,G=k*w,B=k*z,D=l*q,H=l*u,F=l*x,K=l*v,C=l*w,L=l*z,P=n*q,M=n*r,N=n*x,I=n*v,T=n*y,X=n*z,R=p*q,Y=p*r,J=p*u,V=p*v,O=p*y,W=p*w,S=q*y,Q=q*w,q=q*z,U=r*v,Z=r*w,r=r*z,aa=u*v,ba=u*y,u=u*z,v=x*v,y=x*y,x=x*w,w=l*(u-x)+n*(y-r)+p*(Z-ba),z=k*(x-u)+n*(q-v)+p*(aa-Q),p=k*(r-y)+l*(v-q)+p*(S-U),k=k*(ba-Z)+l*(Q-aa)+n*(U-S),l=g*w+f*z+h*p+m*k;b.Matrix4x4.load(a,e,w/l,(f*(x-u)+h*(r-y)+m*(ba-Z))/l,(f*(X-W)+h*(O-L)+m*(C-T))/l,(f*(J-
N)+h*(F-Y)+m*(M-H))/l,z/l,(g*(u-x)+h*(v-q)+m*(Q-aa))/l,(g*(W-X)+h*(B-V)+m*(I-G))/l,(g*(N-J)+h*(R-A)+m*(d-P))/l,p/l,(g*(y-r)+f*(q-v)+m*(U-S))/l,(g*(L-O)+f*(V-B)+m*(E-K))/l,(g*(Y-F)+f*(A-R)+m*(D-c))/l,k/l,(g*(Z-ba)+f*(aa-Q)+h*(S-U))/l,(g*(T-C)+f*(G-I)+h*(K-E))/l,(g*(H-M)+f*(P-d)+h*(c-D))/l,!1)};b.Matrix4x4.add=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z,A,E,G,B,D,H,F,K,C,L,P,M,N,I){b.Matrix4x4.load(a,e,c+w,d+z,g+A,f+E,h+G,m+B,k+D,l+H,n+F,p+K,q+C,r+L,u+P,x+M,v+N,y+I,!1)};b.Matrix4x4.addv=function(a,
e,c,d,g,f){b.Matrix4x4.add(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.sub=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z,A,E,G,B,D,H,F,K,C,L,P,M,N,I){b.Matrix4x4.load(a,e,c-w,d-z,g-A,f-E,h-G,m-B,k-D,l-H,n-F,p-K,q-C,r-L,u-P,x-M,v-N,y-I,!1)};b.Matrix4x4.subv=function(a,e,c,d,g,f){b.Matrix4x4.sub(a,
e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.mul=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z,A,E,G,B,D,H,F,K,C,L,P,M,N,I){b.Matrix4x4.load(a,e,c*w+d*G+g*F+f*P,c*z+d*B+g*K+f*M,c*A+d*D+g*C+f*N,c*E+d*H+g*L+f*I,h*w+m*G+k*F+l*P,h*z+m*B+k*K+l*M,h*A+m*D+k*C+l*N,h*E+m*H+k*L+l*I,n*w+p*G+q*F+r*P,n*
z+p*B+q*K+r*M,n*A+p*D+q*C+r*N,n*E+p*H+q*L+r*I,u*w+x*G+v*F+y*P,u*z+x*B+v*K+y*M,u*A+x*D+v*C+y*N,u*E+x*H+v*L+y*I,!1)};b.Matrix4x4.mulv=function(a,e,c,d,g,f){b.Matrix4x4.mul(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.mulScalar=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w){b.Matrix4x4.load(a,
e,c*w,d*w,g*w,f*w,h*w,m*w,k*w,l*w,n*w,p*w,q*w,r*w,u*w,x*w,v*w,y*w,!1)};b.Matrix4x4.mulScalarv=function(a,e,c,d,g){b.Matrix4x4.mulScalar(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.div=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z,A,E,G,B,D,H,F,K,C,L,P,M,N,I){var T=G*K,X=G*C,R=G*L,Y=G*M,J=G*N,V=G*I,O=B*F,W=B*C,S=B*L,Q=B*P,U=B*N,Z=B*I,aa=D*F,ba=D*K,ia=D*L,ja=D*P,ka=D*M,la=D*I,ma=H*F,na=H*K,oa=H*C,pa=H*P,
qa=H*M,ra=H*N,ca=F*M,da=F*N;F*=I;var ea=K*P,fa=K*N;K*=I;var ga=C*P,ha=C*M;C*=I;P*=L;M*=L;L*=N;N=B*(C-L)+D*(M-K)+H*(fa-ha);I=G*(L-C)+D*(F-P)+H*(ga-da);H=G*(K-M)+B*(P-F)+H*(ca-ea);G=G*(ha-fa)+B*(da-ga)+D*(ea-ca);B=w*N+z*I+A*H+E*G;b.Matrix4x4.mul(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,N/B,(z*(L-C)+A*(K-M)+E*(ha-fa))/B,(z*(la-ra)+A*(qa-Z)+E*(U-ka))/B,(z*(oa-ia)+A*(S-na)+E*(ba-W))/B,I/B,(w*(C-L)+A*(P-F)+E*(da-ga))/B,(w*(ra-la)+A*(V-pa)+E*(ja-J))/B,(w*(ia-oa)+A*(ma-R)+E*(X-aa))/B,H/B,(w*(M-K)+z*(F-P)+E*(ea-
ca))/B,(w*(Z-qa)+z*(pa-V)+E*(Y-Q))/B,(w*(na-S)+z*(R-ma)+E*(O-T))/B,G/B,(w*(fa-ha)+z*(ga-da)+A*(ca-ea))/B,(w*(ka-U)+z*(J-ja)+A*(Q-Y))/B,(w*(W-ba)+z*(aa-X)+A*(T-O))/B)};b.Matrix4x4.divv=function(a,e,c,d,g,f){b.Matrix4x4.div(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.divScalar=function(a,e,c,
d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w){b.Matrix4x4.load(a,e,c/w,d/w,g/w,f/w,h/w,m/w,k/w,l/w,n/w,p/w,q/w,r/w,u/w,x/w,v/w,y/w,!1)};b.Matrix4x4.divScalarv=function(a,e,c,d,g){b.Matrix4x4.divScalar(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.convertToString=function(a,e){return"Matrix4x4("+a[e+0]+", "+a[e+4]+", "+a[e+8]+", "+a[e+12]+",\n          "+a[e+1]+", "+a[e+5]+", "+a[e+9]+", "+a[e+13]+",\n          "+a[e+2]+
", "+a[e+6]+", "+a[e+10]+", "+a[e+14]+",\n          "+a[e+3]+", "+a[e+7]+", "+a[e+11]+", "+a[e+15]+")"}})(xpl);(function(b){b.Matrix4x4&&(b.Matrix4x4.loadScale=function(a,e,c,d,g){b.Matrix4x4.load(a,e,c,0,0,0,0,d,0,0,0,0,g,0,0,0,0,1,!1)},b.Matrix4x4.loadTranslate=function(a,e,c,d,g,f){null==f&&(f=!0);b.Matrix4x4.load(a,e,1,0,0,c,0,1,0,d,0,0,1,g,0,0,0,1,!f)},b.Matrix4x4.loadRotateXAxis=function(a,e,c,d){null==d&&(d=!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,e,1,0,0,0,0,g,-c,0,0,c,g,0,0,0,0,1,!d)},b.Matrix4x4.loadRotateYAxis=function(a,e,c,d){null==d&&(d=!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,
e,g,0,c,0,0,1,0,0,-c,0,g,0,0,0,0,1,!d)},b.Matrix4x4.loadRotateZAxis=function(a,e,c,d){null==d&&(d=!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,e,g,-c,0,0,c,g,0,0,0,0,1,0,0,0,0,1,!d)},b.Matrix4x4.loadRotate=function(a,e,c,d,g,f,h,m){null==h&&(h=!0);null==m&&(m=!0);var k=Math.cos(f);f=Math.sin(f);h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));h=1-k;var l=c*h,n=d*h,p=d*l,q=g*l,r=g*n,u=c*f,x=d*f;f*=g;b.Matrix4x4.load(a,e,k+c*l,p-f,q+x,0,p+f,k+d*n,r-u,0,q-x,r+u,k+g*g*h,0,0,0,0,1,!m)},
b.Matrix4x4.loadLookAt=function(a,e,c,d,g,f,h,m,k,l,n,p){null==p&&(p=!0);f-=c;h-=d;m-=g;var q=f*f+h*h+m*m;0<q&&(q=Math.sqrt(q),f/=q,h/=q,m/=q);q=h*n-m*l;n=m*k-f*n;k=f*l-h*k;l=q*q+n*n+k*k;0<l&&(l=Math.sqrt(l),q/=l,n/=l,k/=l);l=h*k-m*n;var r=m*q-f*k,u=f*n-h*q;b.Matrix4x4.load(a,e,q,n,k,-(q*c+n*d+k*g),l,r,u,-(l*c+r*d+u*g),f,h,m,-(f*c+h*d+m*g),0,0,0,1,!p)},b.Matrix4x4.loadPerspective=function(a,e,c,d,g,f,h,m,k,l,n){null==n&&(n=!0);var p=f-g;f*=l-k;b.Matrix4x4.load(a,e,g*h/c,0,0,0,0,g*m/d,0,0,0,0,f/p+
k,g*f/-p,0,0,1,0,!n)},b.Matrix4x4.loadAxisv=function(a,e,c,d,g){b.Matrix4x4.load(a,e,c[d+0],c[d+4],c[d+8],0,c[d+1],c[d+5],c[d+9],0,c[d+2],c[d+6],c[d+10],0,0,0,0,1,g)},b.Matrix4x4.mulScale=function(a,e,c,d,b){a[e+0]*=c;a[e+4]*=d;a[e+8]*=b;a[e+1]*=c;a[e+5]*=d;a[e+9]*=b;a[e+2]*=c;a[e+6]*=d;a[e+10]*=b;a[e+3]*=c;a[e+7]*=d;a[e+11]*=b},b.Matrix4x4.mulTranslate=function(a,e,c,d,b,f){null==f&&(f=!0);if(f)a[e+12]+=a[e+0]*c+a[e+4]*d+a[e+8]*b,a[e+13]+=a[e+1]*c+a[e+5]*d+a[e+9]*b,a[e+14]+=a[e+2]*c+a[e+6]*d+a[e+
10]*b,a[e+15]+=a[e+3]*c+a[e+7]*d+a[e+11]*b;else{f=a[e+12];var h=a[e+13],m=a[e+14],k=a[e+15];a[e+0]+=f*c;a[e+4]+=f*d;a[e+8]+=f*b;a[e+1]+=h*c;a[e+5]+=h*d;a[e+9]+=h*b;a[e+2]+=m*c;a[e+6]+=m*d;a[e+10]+=m*b;a[e+3]+=k*c;a[e+7]+=k*d;a[e+11]+=k*b}},b.Matrix4x4.mulRotateXAxis=function(a,e,c,d){null==d&&(d=!0);d?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var b=a[e+4],f=a[e+8],h=a[e+5],m=a[e+9],k=a[e+6],l=a[e+10],n=a[e+7],p=a[e+11];a[e+4]=b*d+f*c;a[e+8]=b*-c+f*d;a[e+5]=h*d+m*c;a[e+9]=h*-c+m*
d;a[e+6]=k*d+l*c;a[e+10]=k*-c+l*d;a[e+7]=n*d+p*c;a[e+11]=n*-c+p*d},b.Matrix4x4.mulRotateYAxis=function(a,e,c,d){null==d&&(d=!0);d?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var b=a[e+0],f=a[e+8],h=a[e+1],m=a[e+9],k=a[e+2],l=a[e+10],n=a[e+3],p=a[e+11];a[e+0]=b*d+f*-c;a[e+8]=b*c+f*d;a[e+1]=h*d+m*-c;a[e+9]=h*c+m*d;a[e+2]=k*d+l*-c;a[e+10]=k*c+l*d;a[e+3]=n*d+p*-c;a[e+11]=n*c+p*d},b.Matrix4x4.mulRotateZAxis=function(a,e,c,d){null==d&&(d=!0);d?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),
c=-Math.sin(c));var b=a[e+0],f=a[e+4],h=a[e+1],m=a[e+5],k=a[e+2],l=a[e+6],n=a[e+3],p=a[e+7];a[e+0]=b*d+f*c;a[e+4]=b*-c+f*d;a[e+1]=h*d+m*c;a[e+5]=h*-c+m*d;a[e+2]=k*d+l*c;a[e+6]=k*-c+l*d;a[e+3]=n*d+p*c;a[e+7]=n*-c+p*d},b.Matrix4x4.mulRotate=function(a,e,c,d,b,f,h,m){1==h&&(h=!0);null==m&&(m=!0);m?(m=Math.cos(f),f=Math.sin(f)):(m=Math.cos(f),f=-Math.sin(f));h&&(h=c*c+d*d+b*b,0<h&&(h=Math.sqrt(h),c/=h,d/=h,b/=h));h=1-m;var k=c*h,l=d*h,n=d*k,p=b*k,q=b*l,r=c*f,u=d*f,x=b*f;f=a[e+0];var v=a[e+4],y=a[e+8],
w=a[e+1],z=a[e+5],A=a[e+9],E=a[e+2],G=a[e+6],B=a[e+10],D=a[e+3],H=a[e+7],F=a[e+11];c=m+c*k;var k=n-x,K=p+u,n=n+x;d=m+d*l;l=q-r;p-=u;q+=r;b=m+b*b*h;a[e+0]=f*c+v*n+y*p;a[e+4]=f*k+v*d+y*q;a[e+8]=f*K+v*l+y*b;a[e+1]=w*c+z*n+A*p;a[e+5]=w*k+z*d+A*q;a[e+9]=w*K+z*l+A*b;a[e+2]=E*c+G*n+B*p;a[e+6]=E*k+G*d+B*q;a[e+10]=E*K+G*l+B*b;a[e+3]=D*c+H*n+F*p;a[e+7]=D*k+H*d+F*q;a[e+11]=D*K+H*l+F*b},b.Matrix4x4.mulLookAt=function(a,b,c,d,g,f,h,m,k,l,n,p){null==p&&(p=!0);f-=c;h-=d;m-=g;var q=f*f+h*h+m*m;0<q&&(q=Math.sqrt(q),
f/=q,h/=q,m/=q);q=h*n-m*l;n=m*k-f*n;k=f*l-h*k;l=q*q+n*n+k*k;0<l&&(l=Math.sqrt(l),q/=l,n/=l,k/=l);l=h*k-m*n;var r=m*q-f*k,u=f*n-h*q,x=-(q*c+n*d+k*g),v=-(l*c+r*d+u*g);c=-(f*c+h*d+m*g);d=a[b+0];g=a[b+4];var y=a[b+8],w=a[b+1],z=a[b+5],A=a[b+9],E=a[b+2],G=a[b+6],B=a[b+10],D=a[b+3],H=a[b+7],F=a[b+11];if(p)a[b+0]=d*q+g*l+y*f,a[b+4]=d*n+g*r+y*h,a[b+8]=d*k+g*u+y*m,a[b+12]+=d*x+g*v+y*c,a[b+1]=w*q+z*l+A*f,a[b+5]=w*n+z*r+A*h,a[b+9]=w*k+z*u+A*m,a[b+13]+=w*x+z*v+A*c,a[b+2]=E*q+G*l+B*f,a[b+6]=E*n+G*r+B*h,a[b+10]=
E*k+G*u+B*m,a[b+14]+=E*x+G*v+B*c,a[b+3]=D*q+H*l+F*f,a[b+7]=D*n+H*r+F*h,a[b+11]=D*k+H*u+F*m,a[b+15]+=D*x+H*v+F*c;else{p=a[b+12];var K=a[b+13],C=a[b+14],L=a[b+15];a[b+0]=d*q+g*n+y*k+p*x;a[b+4]=d*l+g*r+y*u+p*v;a[b+8]=d*f+g*h+y*m+p*c;a[b+1]=w*q+z*n+A*k+K*x;a[b+5]=w*l+z*r+A*u+K*v;a[b+9]=w*f+z*h+A*m+K*c;a[b+2]=E*q+G*n+B*k+C*x;a[b+6]=E*l+G*r+B*u+C*v;a[b+10]=E*f+G*h+B*m+C*c;a[b+3]=D*q+H*n+F*k+L*x;a[b+7]=D*l+H*r+F*u+L*v;a[b+11]=D*f+H*h+F*m+L*c}},b.Matrix4x4.mulPerspective=function(a,b,c,d,g,f,h,m,k,l,n){null==
n&&(n=!0);var p=f-g,q=f*(l-k);f=a[b+8];l=a[b+9];var r=a[b+10],u=a[b+11];c=g*h/c;d=g*m/d;k=q/p+k;n?(g=g*q/-p,a[b+0]*=c,a[b+4]*=d,a[b+8]=f*k+a[b+12],a[b+12]=f*g,a[b+1]*=c,a[b+5]*=d,a[b+9]=l*k+a[b+13],a[b+13]=l*g,a[b+2]*=c,a[b+6]*=d,a[b+10]=r*k+a[b+14],a[b+14]=r*g,a[b+3]*=c,a[b+7]*=d,a[b+11]=u*k+a[b+15],a[b+15]=u*g):(g=g*q/-p,a[b+0]*=c,a[b+4]*=d,a[b+8]=f*k+a[b+12]*g,a[b+12]=f,a[b+1]*=c,a[b+5]*=d,a[b+9]=l*k+a[b+13]*g,a[b+13]=l,a[b+2]*=c,a[b+6]*=d,a[b+10]=r*k+a[b+14]*g,a[b+14]=r,a[b+3]*=c,a[b+7]*=d,a[b+
11]=u*k+a[b+15]*g,a[b+15]=u)},b.Matrix4x4.normalizeAxisv=function(a,b,c,d,g){null==g&&(g=!0);var f,h,m,k,l,n,p,q;f=c[d+0];l=c[d+5];q=c[d+10];g?(h=c[d+1],m=c[d+2],k=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]):(h=c[d+4],m=c[d+8],k=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]);d=f*f+h*h+m*m;0<d&&(d=Math.sqrt(d),f/=d,h/=d,m/=d);d=k*k+l*l+n*n;0<d&&(d=Math.sqrt(d),k/=d,l/=d,n/=d);d=p*p+c*c+q*q;0<d&&(d=Math.sqrt(d),p/=d,c/=d,q/=d);a[b+0]=f;a[b+5]=l;a[b+10]=q;g?(a[b+1]=h,a[b+2]=m,a[b+4]=k,a[b+6]=n,a[b+8]=p,a[b+9]=c):(a[b+4]=
h,a[b+8]=m,a[b+1]=k,a[b+9]=n,a[b+2]=p,a[b+6]=c)},b.Matrix4x4.slrepAxisAndLrepOtherv=function(a,e,c,d,g,f,h,m){null==m&&(m=!0);var k=1-h,l,n,p,q,r,u,x,v,y,w,z,A,E,G,B;l=c[d+0];r=c[d+5];y=c[d+10];B=c[d+15];m?(n=c[d+1],p=c[d+2],w=c[d+3],q=c[d+4],u=c[d+6],z=c[d+7],x=c[d+8],v=c[d+9],A=c[d+11],E=c[d+12],G=c[d+13],c=c[d+14]):(n=c[d+4],p=c[d+8],w=c[d+12],q=c[d+1],u=c[d+9],z=c[d+13],x=c[d+2],v=c[d+6],A=c[d+14],E=c[d+3],G=c[d+7],c=c[d+11]);var D,H,F,K,C,L,P,M,N,I,T,X,R,Y;D=g[f+0];C=g[f+5];I=g[f+10];Y=g[f+15];
m?(H=g[f+1],F=g[f+2],d=g[f+3],K=g[f+4],L=g[f+6],P=g[f+7],M=g[f+8],N=g[f+9],T=g[f+11],X=g[f+12],R=g[f+13],g=g[f+14]):(H=g[f+4],F=g[f+8],d=g[f+12],K=g[f+1],L=g[f+9],P=g[f+13],M=g[f+2],N=g[f+6],T=g[f+14],X=g[f+3],R=g[f+7],g=g[f+11]);var J=l*l+n*n+p*p;0<J&&(J=Math.sqrt(J),l/=J,n/=J,p/=J);var V=q*q+r*r+u*u;0<V&&(V=Math.sqrt(V),q/=V,r/=V,u/=V);f=x*x+v*v+y*y;0<f&&(f=Math.sqrt(f),x/=f,v/=f,y/=f);var O=D*D+H*H+F*F;0<O&&(O=Math.sqrt(O),D/=O,H/=O,F/=O);var W=K*K+C*C+L*L;0<W&&(W=Math.sqrt(W),K/=W,C/=W,L/=W);
var S=M*M+N*N+I*I;0<S&&(S=Math.sqrt(S),M/=S,N/=S,I/=S);var Q=l*D+n*H+p*F;if(1<=Q)J=J*k+O*h,l*=J,n*=J,p*=J;else if(-1>=Q)J=J*k-O*h,l*=J,n*=J,p*=J;else{var J=J*k+O*h,O=Math.acos(Q),U=Math.sin(O),Q=Math.sin(O*k)/U,O=Math.sin(O*h)/U;l=(l*Q+D*O)*J;n=(n*Q+H*O)*J;p=(p*Q+F*O)*J}Q=q*K+r*C+u*L;1<=Q?(J=V*k+W*h,q*=J,r*=J,u*=J):-1>=Q?(J=V*k-W*h,q*=J,r*=J,u*=J):(J=V*k+W*h,O=Math.acos(Q),U=Math.sin(O),Q=Math.sin(O*k)/U,O=Math.sin(O*h)/U,q=(q*Q+K*O)*J,r=(r*Q+C*O)*J,u=(u*Q+L*O)*J);L=x*M+v*N+y*I;1<=L?(J=f*k+S*h,x*=
J,v*=J,y*=J):-1>=L?(J=f*k-S*h,x*=J,v*=J,y*=J):(J=f*k+S*h,O=Math.acos(L),U=Math.sin(O),Q=Math.sin(O*k)/U,O=Math.sin(O*h)/U,x=(x*Q+M*O)*J,v=(v*Q+N*O)*J,y=(y*Q+I*O)*J);b.Matrix4x4.load(a,e,l,q,x,E*k+X*h,n,r,v,G*k+R*h,p,u,y,c*k+g*h,w*k+d*h,z*k+P*h,A*k+T*h,B*k+Y*h,!m)},b.Matrix4x4.toRotateAxisv=function(a,b,c,d,g){null==g&&(g=!0);var f=c[d+0],h=c[d+5],m=c[d+10],k,l,n,p;g?(g=c[d+4],k=c[d+8],l=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]):(g=c[d+1],k=c[d+2],l=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]);d=.5*(g+l);var q=.5*
(p+k),r=.5*(n+c),f=Math.min(f-(0!=r?Math.abs(d*q/r):0),h-(0!=q?Math.abs(d*r/q):0),m-(0!=d?Math.abs(q*r/d):0)),h=.5*(n-c);k=.5*(p-k);g=.5*(g-l);l=h*h+k*k+g*g;p=f*f+l;0<p&&(f/=Math.sqrt(p));if(1<=f)return a[b+0]=0,a[b+1]=0,a[b+2]=0;0<l?(l=Math.sqrt(l),a[b+0]=-h/l,a[b+1]=-k/l,a[b+2]=-g/l):(a[b+0]=0,a[b+1]=0,a[b+2]=0);return Math.acos(f)},b.Matrix4x4.fromQuaternionv=function(a,e,c,d,g){null==g&&(g=!0);var f=c[d+0],h=c[d+1],m=c[d+2],k=c[d+3];c=f*f;d=h*h;var l=m*m,n=k*k,p=h*m*2,q=h*k*2,r=m*k*2,h=f*h*2,
m=f*m*2,f=f*k*2;b.Matrix4x4.load(a,e,d+c-n-l,p-f,q+m,0,p+f,l+c-d-n,r-h,0,q-m,r+h,n+c-l-d,0,0,0,0,1,!g)},b.Matrix4x4.mulQuaternionv=function(a,b,c,d,g){null==g&&(g=!0);var f=c[d+0],h=c[d+1],m=c[d+2],k=c[d+3],l=f*f,n=h*h,p=m*m,q=k*k,r=h*m*2;d=h*k*2;c=m*k*2;var h=f*h*2,m=f*m*2,u=f*k*2,f=a[b+0],k=a[b+4],x=a[b+8],v=a[b+1],y=a[b+5],w=a[b+9],z=a[b+2],A=a[b+6],E=a[b+10],G=a[b+3],B=a[b+7],D=a[b+11],H=n+l-q-p,F=p+l-n-q,l=q+l-p-n;g?(g=r-u,n=d+m,r+=u,p=c-h,d-=m,c+=h):(g=r+u,n=d-m,r-=u,p=c+h,d+=m,c-=h);a[b+0]=
f*H+k*r+x*d;a[b+4]=f*g+k*F+x*c;a[b+8]=f*n+k*p+x*l;a[b+1]=v*H+y*r+w*d;a[b+5]=v*g+y*F+w*c;a[b+9]=v*n+y*p+w*l;a[b+2]=z*H+A*r+E*d;a[b+6]=z*g+A*F+E*c;a[b+10]=z*n+A*p+E*l;a[b+3]=G*H+B*r+D*d;a[b+7]=G*g+B*F+D*c;a[b+11]=G*n+B*p+D*l},b.Matrix4x4.mulQuaternionAxisv=function(a,b,c,d,g){null==g&&(g=!0);var f=c[d+0],h=c[d+1],m=c[d+2],k=c[d+3],l=f*f,n=h*h,p=m*m,q=k*k,r=h*m*2;d=h*k*2;c=m*k*2;var h=f*h*2,m=f*m*2,u=f*k*2,f=a[b+0],k=a[b+4],x=a[b+8],v=a[b+1],y=a[b+5],w=a[b+9],z=a[b+2],A=a[b+6],E=a[b+10],G=n+l-q-p,B=
p+l-n-q,l=q+l-p-n;g?(g=r-u,n=d+m,r+=u,p=c-h,d-=m,c+=h):(g=r+u,n=d-m,r-=u,p=c+h,d+=m,c-=h);a[b+0]=f*G+k*r+x*d;a[b+4]=f*g+k*B+x*c;a[b+8]=f*n+k*p+x*l;a[b+1]=v*G+y*r+w*d;a[b+5]=v*g+y*B+w*c;a[b+9]=v*n+y*p+w*l;a[b+2]=z*G+A*r+E*d;a[b+6]=z*g+A*B+E*c;a[b+10]=z*n+A*p+E*l},b.Matrix4x4.toQuaternionv=function(a,e,c,d,g,f){null==f&&(f=!0);var h=c[d+0],m=c[d+5],k=c[d+10],l,n,p,q,r;f?(f=c[d+4],l=c[d+8],n=c[d+1],p=c[d+9],q=c[d+2],r=c[d+6]):(f=c[d+1],l=c[d+2],n=c[d+4],p=c[d+6],q=c[d+8],r=c[d+9]);c=(n*r-q*m)*l+(q*f-
h*r)*p+(h*m-n*f)*k;d=0>c;0!=c&&(c=Math.pow(Math.abs(c),1/3),h/=c,n/=c,q/=c,f/=c,m/=c,r/=c,l/=c,p/=c,k/=c,c=Math.sqrt(c));p=.5*(r-p);l=.5*(l-q);f=.5*(n-f);q=p*p+l*l+f*f;0<q&&(q=Math.sqrt(q),d?(p/=-q,l/=-q,f/=-q):(p/=q,l/=q,f/=q));n=b.MathUtils.mid(.5*(h+m+k-1),1,-1);n=d?-b.MathUtils.mid(.5*(h+m+k+1),1,-1):b.MathUtils.mid(.5*(h+m+k-1),1,-1);h=.5*Math.acos(n);n=Math.cos(h);q=Math.sin(h);g?(a[e+0]=c*n,a[e+1]=c*q*p,a[e+2]=c*q*l,a[e+3]=c*q*f):(a[e+0]=c*-n,a[e+1]=c*-q*p,a[e+2]=c*-q*l,a[e+3]=c*-q*f)})})(xpl);(function(b){b.Quaternion=function(){throw Error("Unsupported operation");};b.Quaternion.load=function(a,b,c,d,g,f){a[b+0]=c;a[b+1]=d;a[b+2]=g;a[b+3]=f};b.Quaternion.loadv=function(a,e,c,d){b.Quaternion.load(a,e,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.loadZero=function(a,e){b.Quaternion.load(a,e,0,0,0,0)};b.Quaternion.loadIdentity=function(a,e){b.Quaternion.load(a,e,1,0,0,0)};b.Quaternion.absSq=function(a,b){var c=a[b+0],d=a[b+1],g=a[b+2],f=a[b+3];return c*c+d*d+g*g+f*f};b.Quaternion.abs=function(a,
e){return Math.sqrt(b.Quaternion.absSq(a,e))};b.Quaternion.normalizev=function(a,e,c,d){var g=c[d+0],f=c[d+1],h=c[d+2];c=c[d+3];d=g*g+f*f+h*h+c*c;0<d?(d=Math.sqrt(d),b.Quaternion.load(a,e,g/d,f/d,h/d,c/d)):b.Quaternion.loadZero(a,e)};b.Quaternion.exp=function(a,e,c,d,g,f){c=Math.exp(c);var h=Math.sqrt(d*d+g*g+f*f),m=c*Math.sin(h)/h;b.Quaternion.load(a,e,c*Math.cos(h),d*m,g*m,f*m)};b.Quaternion.expv=function(a,e,c,d){b.Quaternion.exp(a,e,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.cis=function(a,e,
c,d,g){var f=Math.sqrt(c*c+d*d+g*g),h=Math.sin(f)/f;b.Quaternion.load(a,e,Math.cos(f),c*h,d*h,g*h)};b.Quaternion.cisv=function(a,e,c,d){b.Quaternion.cis(a,e,c[d+VX],c[d+VY],c[d+VZ])};b.Quaternion.log=function(a,e,c,d,g,f){var h=Math.sqrt(c*c+d*d+g*g+f*f);c=Math.acos(c/h)/Math.sqrt(d*d+g*g+f*f);b.Quaternion.load(a,e,Math.log(h),d*c,g*c,f*c)};b.Quaternion.logv=function(a,e,c,d){b.Quaternion.log(a,e,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.lerp=function(a,e,c,d,g,f,h,m,k,l,n){var p=1-n;b.Quaternion.load(a,
e,c*p+h*n,d*p+m*n,g*p+k*n,f*p+l*n)};b.Quaternion.lerpv=function(a,e,c,d,g,f,h){b.Quaternion.lerp(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3],h)};b.Quaternion.slerp=function(a,e,c,d,g,f,h,m,k,l,n){var p=c*c+d*d+g*g+f*f;0<p&&(p=Math.sqrt(p),c/=p,d/=p,g/=p,f/=p);var q=h*h+m*m+k*k+l*l;0<q&&(q=Math.sqrt(q),h/=q,m/=q,k/=q,l/=q);var r=c*h+d*m+g*k+f*l;if(1<=r)p=p*(1-n)+q*n,b.Quaternion.load(a,e,c*p,d*p,g*p,f*p);else if(-1>=r)p=p*(1-n)-q*n,b.Quaternion.load(a,e,c*p,d*p,g*p,f*p);else{var p=
p*(1-n)+q*n,q=Math.acos(r),u=Math.sin(q),r=Math.sin(q*(1-n))/u;n=Math.sin(q*n)/u;b.Quaternion.load(a,e,(c*r+h*n)*p,(d*r+m*n)*p,(g*r+k*n)*p,(f*r+l*n)*p)}};b.Quaternion.slerpv=function(a,e,c,d,g,f,h){b.Quaternion.slerp(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3],h)};b.Quaternion.dot=function(a,b,c,d,g,f,h,m){return a*g+b*f+c*h+d*m};b.Quaternion.dotv=function(a,b,c,d){return a[b+0]*c[d+0]+a[b+1]*c[d+1]+a[b+2]*c[d+2]+a[b+3]*c[d+3]};b.Quaternion.conjugatev=function(a,e,c,d){b.Quaternion.load(a,
e,c[d+0],-c[d+1],-c[d+2],-c[d+3])};b.Quaternion.inversev=function(a,e,c,d){var g=c[d+0],f=c[d+1],h=c[d+2];c=c[d+3];d=g*g+f*f+h*h+c*c;0<d&&(d=Math.sqrt(d),g/=d,f/=-d,h/=-d,c/=-d);b.Quaternion.load(a,e,g,f,h,c)};b.Quaternion.add=function(a,e,c,d,g,f,h,m,k,l){b.Quaternion.load(a,e,c+h,d+m,g+k,f+l)};b.Quaternion.addv=function(a,e,c,d,g,f){b.Quaternion.add(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.sub=function(a,e,c,d,g,f,h,m,k,l){b.Quaternion.load(a,e,c-h,d-m,g-k,f-l)};
b.Quaternion.subv=function(a,e,c,d,g,f){b.Quaternion.sub(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.mul=function(a,e,c,d,g,f,h,m,k,l){b.Quaternion.load(a,e,c*h-(d*m+g*k+f*l),c*m+d*h+(g*l-f*k),c*k+g*h+(f*m-d*l),c*l+f*h+(d*k-g*m))};b.Quaternion.mulv=function(a,e,c,d,g,f){b.Quaternion.mul(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.mulScalar=function(a,e,c,d,g,f,h){b.Quaternion.load(a,e,c*h,d*h,g*h,f*h)};b.Quaternion.mulScalarv=function(a,
e,c,d,g){b.Quaternion.mulScalar(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g)};b.Quaternion.div=function(a,e,c,d,g,f,h,m,k,l){var n=h*h+m*m+k*k+l*l;b.Quaternion.load(a,e,(c*h+(d*m+g*k+f*l))/n,(-c*m+d*h-(g*l-f*k))/n,(-c*k+g*h-(f*m-d*l))/n,(-c*l+f*h-(d*k-g*m))/n)};b.Quaternion.divv=function(a,e,c,d,g,f){b.Quaternion.div(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.divScalar=function(a,e,c,d,g,f,h){b.Quaternion.load(a,e,c/h,d/h,g/h,f/h)};b.Quaternion.divScalarv=function(a,e,c,d,g){b.Quaternion.divScalar(a,
e,c[d+0],c[d+1],c[d+2],c[d+3],g)};b.Quaternion.convertToString=function(a,b){return"Quaternion("+a[b+0]+", "+a[b+1]+", "+a[b+2]+", "+a[b+3]+")"}})(xpl);(function(b){b.Quaternion&&(b.Quaternion.loadIAxisRotate=function(a,e,c){c*=.5;b.Quaternion.load(a,e,Math.cos(c),Math.sin(c),0,0)},b.Quaternion.loadJAxisRotate=function(a,e,c){c*=.5;b.Quaternion.load(a,e,Math.cos(c),0,Math.sin(c),0)},b.Quaternion.loadKAxisRotate=function(a,e,c){c*=.5;b.Quaternion.load(a,e,Math.cos(c),0,0,Math.sin(c))},b.Quaternion.loadRotate=function(a,e,c,d,g,f,h){null==h&&(h=!0);h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));f*=.5;h=Math.sin(f);b.Quaternion.load(a,e,Math.cos(f),
c*h,d*h,g*h)},b.Quaternion.loadRotateVector3=function(a,e,c,d,g,f,h,m,k,l,n){null==n&&(n=1);if(f)if(f=c*c+d*d+g*g,0<f)f=Math.sqrt(f),c/=f,d/=f,g/=f;else{b.Quaternion.loadIdentity(a,e);return}if(l)if(l=h*h+m*m+k*k,0<l)l=Math.sqrt(l),h/=l,m/=l,k/=l;else{b.Quaternion.loadIdentity(a,e);return}f=c*h+d*m+g*k;1<=f?b.Quaternion.loadIdentity(a,e):(l=d*k-g*m,g=g*h-c*k,c=c*m-d*h,d=l*l+g*g+c*c,0<d?(d=Math.sqrt(d),n*=.5*Math.acos(f),h=Math.sin(n),b.Quaternion.load(a,e,Math.cos(n),l/d*h,g/d*h,c/d*h)):b.Quaternion.loadIdentity(a,
e))},b.Quaternion.loadRotateVector3v=function(a,e,c,d,g,f,h,m){b.Quaternion.loadRotateVector3(a,e,c[d+0],c[d+1],c[d+2],g,f[h+0],f[h+1],f[h+2],m,t)},b.Quaternion.mulIAxisRotate=function(a,e,c){c*=.5;var d=Math.sin(c);c=Math.cos(c);var g=a[e+0],f=a[e+1],h=a[e+2],m=a[e+3];b.Quaternion.load(a,e,g*c-f*d,g*d+f*c,h*c+m*d,m*c-h*d)},b.Quaternion.mulJAxisRotate=function(a,e,c){c*=.5;var d=Math.sin(c);c=Math.cos(c);var g=a[e+0],f=a[e+1],h=a[e+2],m=a[e+3];b.Quaternion.load(a,e,g*c-h*d,f*c-m*d,g*d+h*c,m*c+f*d)},
b.Quaternion.mulKAxisRotate=function(a,e,c){c*=.5;var d=Math.sin(c);c=Math.cos(c);var g=a[e+0],f=a[e+1],h=a[e+2],m=a[e+3];b.Quaternion.load(a,e,g*c-m*d,f*c+h*d,h*c-f*d,g*d+m*c)},b.Quaternion.mulRotate=function(a,e,c,d,g,f,h){null==h&&(h=!0);h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));f*=.5;h=Math.sin(f);f=Math.cos(f);c*=h;d*=h;g*=h;h=a[e+0];var m=a[e+1],k=a[e+2],l=a[e+3];b.Quaternion.load(a,e,h*f-(m*c+k*d+l*g),h*c+m*f+(k*g-l*d),h*d+k*f+(l*c-m*g),h*g+l*f+(m*d-k*c))})})(xpl);(function(b){b.Vector3=function(){throw Error("Unsupported operation");};b.Vector3.load=function(a,b,c,d,g){a[b+0]=c;a[b+1]=d;a[b+2]=g};b.Vector3.loadv=function(a,e,c,d){b.Vector3.load(a,e,c[d+0],c[d+1],c[d+2])};b.Vector3.loadZero=function(a,e){b.Vector3.load(a,e,0,0,0)};b.Vector3.lenSq=function(a,b){var c=a[b+0],d=a[b+1],g=a[b+2];return c*c+d*d+g*g};b.Vector3.len=function(a,e){return Math.sqrt(b.Vector3.lenSq(a,e))};b.Vector3.normalizev=function(a,e,c,d){var g=c[d+0],f=c[d+1];c=c[d+2];d=g*g+f*f+
c*c;0<d?(d=Math.sqrt(d),b.Vector3.load(a,e,g/d,f/d,c/d)):b.Vector3.loadZero(a,e)};b.Vector3.lerp=function(a,e,c,d,g,f,h,m,k){var l=1-k;b.Vector3.load(a,e,c*l+f*k,d*l+h*k,g*l+m*k)};b.Vector3.lerpv=function(a,e,c,d,g,f,h){b.Vector3.lerp(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2],h)};b.Vector3.slerp=function(a,e,c,d,g,f,h,m,k){var l=c*c+d*d+g*g;0<l&&(l=Math.sqrt(l),c/=l,d/=l,g/=l);var n=f*f+h*h+m*m;0<n&&(n=Math.sqrt(n),f/=n,h/=n,m/=n);var p=c*f+d*h+g*m;if(1<=p)l=l*(1-k)+n*k,b.Vector3.load(a,e,c*l,
d*l,g*l);else if(-1>=p)l=l*(1-k)-n*k,b.Vector3.load(a,e,c*l,d*l,g*l);else{var l=l*(1-k)+n*k,n=Math.acos(p),q=Math.sin(n),p=Math.sin(n*(1-k))/q;k=Math.sin(n*k)/q;b.Vector3.load(a,e,(c*p+f*k)*l,(d*p+h*k)*l,(g*p+m*k)*l)}};b.Vector3.slerpv=function(a,e,c,d,g,f,h){b.Vector3.slerp(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2],h)};b.Vector3.dot=function(a,b,c,d,g,f){return a*d+b*g+c*f};b.Vector3.dotv=function(a,b,c,d){return a[b+0]*c[d+0]+a[b+1]*c[d+1]+a[b+2]*c[d+2]};b.Vector3.cross=function(a,e,c,d,g,f,
h,m){b.Vector3.load(a,e,d*m-g*h,g*f-c*m,c*h-d*f)};b.Vector3.crossv=function(a,e,c,d,g,f){b.Vector3.cross(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2])};b.Vector3.cos=function(a,b,c,d,g,f){var h=a*a+b*b+c*c;0<h&&(h=Math.sqrt(h),a/=h,b/=h,c/=h);h=d*d+g*g+f*f;0<h&&(h=Math.sqrt(h),d/=h,g/=h,f/=h);return a*d+b*g+c*f};b.Vector3.cosv=function(a,e,c,d){return b.Vector3.cos(a[e+0],a[e+1],a[e+2],c[d+0],c[d+1],c[d+2])};b.Vector3.reversev=function(a,e,c,d){b.Vector3.load(a,e,-c[d+0],-c[d+1],-c[d+2])};b.Vector3.add=
function(a,e,c,d,g,f,h,m){b.Vector3.load(a,e,c+f,d+h,g+m)};b.Vector3.addv=function(a,e,c,d,g,f){b.Vector3.add(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2])};b.Vector3.sub=function(a,e,c,d,g,f,h,m){b.Vector3.load(a,e,c-f,d-h,g-m)};b.Vector3.subv=function(a,e,c,d,g,f){b.Vector3.sub(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2])};b.Vector3.mul=function(a,e,c,d,g,f){b.Vector3.load(a,e,c*f,d*f,g*f)};b.Vector3.mulv=function(a,e,c,d,g){b.Vector3.mul(a,e,c[d+0],c[d+1],c[d+2],g)};b.Vector3.mulQuaternionv=
function(a,e,c,d,g,f){var h=c[d+0],m=c[d+1],k=c[d+2];c=c[d+3];d=g[f+0];var l=g[f+1],n=g[f+2];g=-(m*d+k*l+c*n);f=h*d+(k*n-c*l);var p=h*l+(c*d-m*n);d=h*n+(m*l-k*d);b.Vector3.load(a,e,-g*m+f*h-(p*c-d*k),-g*k+p*h-(d*m-f*c),-g*c+d*h-(f*k-p*m))};b.Vector3.mulMatrix4x4v=function(a,e,c,d,g,f,h){null==h&&(h=!0);if(h){h=g[f+0];var m=g[f+1],k=g[f+2],l=c[d+3]*h+c[d+7]*m+c[d+11]*k+c[d+15];b.Vector3.load(a,e,(c[d+0]*h+c[d+4]*m+c[d+8]*k+c[d+12])/l,(c[d+1]*h+c[d+5]*m+c[d+9]*k+c[d+13])/l,(c[d+2]*h+c[d+6]*m+c[d+10]*
k+c[d+14])/l)}else h=c[d+VX],m=c[d+VY],k=c[d+VZ],l=h*g[f+12]+m*g[f+13]+k*g[f+14]+g[f+15],b.Vector3.load(a,e,(h*g[f+0]+m*g[f+1]+k*g[f+2]+g[f+3])/l,(h*g[f+4]+m*g[f+5]+k*g[f+6]+g[f+7])/l,(h*g[f+8]+m*g[f+9]+k*g[f+10]+g[f+11])/l)};b.Vector3.mulMatrix4x4Axisv=function(a,e,c,d,g,f,h){null==h&&(h=!0);if(h){h=g[f+0];var m=g[f+1],k=g[f+2];b.Vector3.load(a,e,c[d+0]*h+c[d+4]*m+c[d+8]*k,c[d+1]*h+c[d+5]*m+c[d+9]*k,c[d+2]*h+c[d+6]*m+c[d+10]*k)}else h=c[d+VX],m=c[d+VY],k=c[d+VZ],b.Vector3.load(a,e,h*g[f+0]+m*g[f+
1]+k*g[f+2],h*g[f+4]+m*g[f+5]+k*g[f+6],h*g[f+8]+m*g[f+9]+k*g[f+10])};b.Vector3.div=function(a,e,c,d,g,f){b.Vector3.load(a,e,c*f,d*f,g*f)};b.Vector3.divv=function(a,e,c,d,g){b.Vector3.div(a,e,c[d+0],c[d+1],c[d+2],g)};b.Vector3.convertToString=function(a,b){return"Vector3("+a[b+0]+", "+a[b+1]+", "+a[b+2]+")"}})(xpl);(function(b){b.GLUtils=function(){};Object.defineProperties(b.GLUtils,{TYPE_VERTEX_SHADER:{value:"OpenGL Vertex Shader"},TYPE_FRAGMENT_SHADER:{value:"OpenGL Fragment Shader"},TYPE_PROGRAM:{value:"OpenGL Program"}});b.GLUtils.createBuffer=function(a,b,c,d){if(b==a.ARRAY_BUFFER||b==a.ELEMENT_ARRAY_BUFFER){var g=a.createBuffer();null!=g&&(a.bindBuffer(b,g),a.bufferData(b,c,d));return g}return null};b.GLUtils.createTexture2D=function(a,e,c,d,g,f,h,m,k){var l=a.createTexture();if(null!=l){a.bindTexture(a.TEXTURE_2D,
l);var n=b.MathUtils.cailPow2(d),p=b.MathUtils.cailPow2(g);d==n&&g==p?(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,e,n,p,0,e,c,f)):(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,e,texWidth,texHeight,0,e,c,null),null!=f&&a.texSubImage2D(a.TEXTURE_2D,0,0,0,d,g,e,c,f));h&&a.generateMipmap(a.TEXTURE_2D);null!=m&&(m[k+0]=n,m[k+1]=p)}return l};b.GLUtils.createTexture2DFromImage=function(a,b,c,d){var g=a.createTexture();null!=g&&(a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,
0,b,b,c,d));return g};b.GLUtils.createShader=function(a,e,c,d){if(e==a.VERTEX_SHADER||e==a.FRAGMENT_SHADER){var g=a.createShader(e);return null==g||(a.shaderSource(g,c),a.compileShader(g),a.getShaderParameter(g,a.COMPILE_STATUS))?g:(c=a.getShaderInfoLog(g),console.error("Shader compile error:\n"+c),null!=d&&(e==a.VERTEX_SHADER?d(b.GLUtils.TYPE_VERTEX_SHADER,c):e==a.FRAGMENT_SHADER&&d(b.GLUtils.TYPE_FRAGMENT_SHADER,+c)),a.deleteShader(g),null)}return null};b.GLUtils.createProgram=function(a,e,c,d,
g){if(null!=e&&null!=c){var f=a.createProgram();if(null!=f){a.attachShader(f,e);a.attachShader(f,c);if(null!=d)for(var h in d)a.bindAttribLocation(f,d[h],h);a.linkProgram(f);if(!a.getProgramParameter(f,a.LINK_STATUS))return e=a.getProgramInfoLog(f),console.error("Program linkage error:\n"+e),null!=g&&g(b.GLUtils.TYPE_PROGRAM,e),a.deleteProgram(f),null}return f}return null};b.GLUtils.createShaderProgram=function(a,e,c,d,g){e=b.GLUtils.createShader(a,a.VERTEX_SHADER,e,g);if(null==e)return null;c=b.GLUtils.createShader(a,
a.FRAGMENT_SHADER,c,g);if(null==c)return a.deleteShader(e),null;d=b.GLUtils.createProgram(a,e,c,d,g);a.deleteShader(e);a.deleteShader(c);return d}})(xpl);(function(b){var a=1;b.XModelStructure=function(b){this.structure_type=b;var c=a++;this.valueOf=function(){return c};this.hashCode=function(){return c}};b.XModelStructure.prototype.equals=function(a){return this==a};Object.defineProperties(b.XModelStructure,{TYPE_UNDEFINED:{value:-1},TYPE_NULL:{value:0},TYPE_AXIS_ROTATE:{value:1},TYPE_QUATERNION:{value:2},TYPE_SCALE:{value:3},TYPE_TRANSLATE:{value:4},TYPE_MATRIX:{value:5},TYPE_CONTAINER:{value:6},TYPE_TEXTURE:{value:7},TYPE_MATERIAL:{value:8},TYPE_MESH:{value:9},
TYPE_NODE:{value:10},TYPE_IK:{value:11},TYPE_ANIMATION:{value:12},TYPE_ANIMATION_KEY:{value:13},TYPE_ANIMATION_SET:{value:14},SIZE_RGBA:{value:4},SIZE_VECTOR_3:{value:3},SIZE_AXIS_ROTATE:{value:4},SIZE_QUATERNION:{value:4},SIZE_SCALE:{value:3},SIZE_TRANSLATE:{value:3},SIZE_MATRIX:{value:16},NUM_BLEND_SLOT:{value:2}})})(xpl);(function(b){b.XModelUserData=function(){this.data_size=0;this.data=null}})(xpl);
(function(b){b.XModelTransform=function(a){b.XModelStructure.call(this,a)};Object.setPrototypeOf(b.XModelTransform.prototype,b.XModelStructure.prototype)})(xpl);
(function(b){b.XModelAxisRotate=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_AXIS_ROTATE);this.initial=new Float32Array([0,0,0,1]);this.value=new Float32Array([0,0,0,1,0,0,0,1])};Object.setPrototypeOf(b.XModelAxisRotate.prototype,b.XModelTransform.prototype);Object.defineProperties(b.XModelStructure,{ANGLE:{value:0},X:{value:1},Y:{value:2},Z:{value:3}})})(xpl);
(function(b){b.XModelQuaternion=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_QUATERNION);this.initial=new Float32Array([1,0,0,0]);this.value=new Float32Array([1,0,0,0,1,0,0,0])};Object.setPrototypeOf(b.XModelQuaternion.prototype,b.XModelTransform.prototype)})(xpl);
(function(b){b.XModelScale=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_SCALE);this.initial=new Float32Array([1,1,1]);this.value=new Float32Array([1,1,1,1,1,1])};Object.setPrototypeOf(b.XModelScale.prototype,b.XModelTransform.prototype)})(xpl);(function(b){b.XModelTranslate=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_TRANSLATE);this.initial=new Float32Array([0,0,0]);this.value=new Float32Array([0,0,0,0,0,0])};Object.setPrototypeOf(b.XModelTranslate.prototype,b.XModelTransform.prototype)})(xpl);
(function(b){b.XModelMatrix=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_MATRIX);this.initial=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Object.setPrototypeOf(b.XModelMatrix.prototype,b.XModelTransform.prototype)})(xpl);
(function(b){b.XModelExtensible=function(a){b.XModelStructure.call(this,a);this.user_object=this.user_data=null};Object.setPrototypeOf(b.XModelExtensible.prototype,b.XModelStructure.prototype)})(xpl);
(function(b){b.XModelContainer=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_CONTAINER);this.name=null;this.num_textures=0;this.textures=null;this.num_materials=0;this.materials=null;this.num_meshes=0;this.meshes=null;this.num_nodes=0;this.nodes=null;this.time_rate=1;this.num_animation_sets=0;this.animation_sets=null};Object.setPrototypeOf(b.XModelContainer.prototype,b.XModelExtensible.prototype);b.XModelContainer.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelTexture=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_TEXTURE);this.ref=this.name=null;this.data_size=0;this.texture=this.data=null;this.z_size=this.y_size=this.x_size=0};Object.setPrototypeOf(b.XModelTexture.prototype,b.XModelExtensible.prototype);b.XModelTexture.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelMaterial=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_MATERIAL);this.name=null;this.emissive=[0,0,0,1];this.ambient=[.1,.1,.1,1];this.diffuse=[1,1,1,1];this.specular=[.4,.4,.4,1];this.shininess=5;this.bump=1;this.bump_map=this.shininess_map=this.specular_map=this.diffuse_map=this.ambient_map=this.emissive_map=null;this.draw_mode=b.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS};Object.setPrototypeOf(b.XModelMaterial.prototype,b.XModelExtensible.prototype);Object.defineProperties(b.XModelMaterial,
{DRAW_MODE_FACE_NONE_BITS:{value:0},DRAW_MODE_FACE_FRONT_BITS:{value:1},DRAW_MODE_FACE_BACK_BITS:{value:2},DRAW_MODE_FACE_FRONT_AND_BACK_BITS:{value:b.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS|b.XModelMaterial.DRAW_MODE_FACE_BACK_BITS}});b.XModelMaterial.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelMesh=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_MESH);this.name=null;this.position_size=this.num_positions=0;this.positions=null;this.normal_size=this.num_normals=0;this.normals=null;this.color_size=this.num_colors=0;this.colors=null;this.tex_coord_size=this.num_tex_coords=0;this.skin=this.tex_coords=null;this.num_vertices=0;this.vertices=null;this.num_materials=0;this.materials=null;this.num_elements=0;this.parent=this.elements=null;this.num_subsets=0;this.element_buffer=
this.vertex_buffer=this.subsets=null};Object.setPrototypeOf(b.XModelMesh.prototype,b.XModelExtensible.prototype);b.XModelMesh.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelMeshSubset=function(){this.num_bones=0;this.bones=null;this.num_vertices=0;this.vertices=null;this.num_elements=0;this.user_object=this.element_buffer=this.vertex_buffer=this.elements=null}})(xpl);
(function(b){b.XModelSkin=function(){this.weighted_index_stride=this.num_weighted_indices=0;this.weights=this.indices=this.weighted_index_sizes=null;this.num_nodes=0;this.offset_quaternions=this.offset_matrices=this.nodes=null}})(xpl);
(function(b){b.XModelVertex=function(){this.skinning=this.tex_coord=this.color=this.normal=this.position=-1};b.XModelVertex.prototype.hashCode=function(){return this.position^this.normal^this.color^this.tex_coord^this.skinning};b.XModelVertex.prototype.equals=function(a){return this===a?!0:null!=a&&a instanceof b.XModelVertex?this.position==a.position&&this.normal==a.normal&&this.color==a.color&&this.tex_coord==a.tex_coord&&this.skinning==a.skinning:!1}})(xpl);
(function(b){b.XModelElement=function(){this.material=-1;this.num_vertices=0;this.vertices=null};b.XModelElement.prototype.hashCode=function(){for(var a=0,b=0;b<this.num_vertices;++b)a^=this.vertices[b];return this.material^this.num_vertices^a};b.XModelElement.prototype.equals=function(a){if(this===a)return!0;if(a&&a instanceof b.XModelElement){for(var e=0;e<this.num_vertices&&e<a.num_vertices;++e)if(this.vertices[e]!=a.vertices[e])return!1;return this.material==a.material&&this.num_vertices==a.num_vertices}return!1}})(xpl);
(function(b){b.XModelNode=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_NODE);this.name=null;this.connected=!0;this.lock_axises=new Uint8Array([!1,!1,!1]);this.limit_angles=new Uint8Array([!1,!1,!1]);this.min_angles=new Float32Array([-Math.PI,-Math.PI,-Math.PI]);this.max_angles=new Float32Array([Math.PI,Math.PI,Math.PI]);this.bone_tail=new Float32Array([0,0,0]);this.transforms=[null,null,null,null];this.num_iks=0;this.iks=null;this.num_meshes=0;this.meshes=null;this.num_children=
0;this.parent=this.children=null;this.offset_matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.combined_matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Object.setPrototypeOf(b.XModelNode.prototype,b.XModelExtensible.prototype);Object.defineProperties(b.XModelNode,{TRANSFORM_MATRIX:{value:0},TRANSFORM_TRANSLATE:{value:1},TRANSFORM_SCALE:{value:2},TRANSFORM_ROTATE:{value:3},NUM_TRANSFORMS:{value:4}});b.XModelNode.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelIK=function(){b.XModelStructure.call(this,b.XModelStructure.TYPE_IK);this.target=null;this.max_iterations=500;this.influence=this.chain_length=1};Object.setPrototypeOf(b.XModelIK.prototype,b.XModelStructure.prototype);b.XModelIK.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelAnimation=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_ANIMATION);this.target=this.name=null;this.index=-1;this.num_keys=0;this.keys=null;this.num_children=0;this.children=null};Object.setPrototypeOf(b.XModelAnimation.prototype,b.XModelExtensible.prototype);b.XModelAnimation.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelAnimationKey=function(){b.XModelStructure.call(this,b.XModelStructure.TYPE_ANIMATION_KEY);this.interpolate=b.XModelAnimationKey.INTERPOLATE_UNKNOWN;this.value_size=this.after_time=this.before_time=this.time=0;this.after_value=this.before_value=this.value=null};Object.setPrototypeOf(b.XModelAnimationKey.prototype,b.XModelStructure.prototype);Object.defineProperties(b.XModelAnimationKey,{INTERPOLATE_UNKNOWN:{value:-1},INTERPOLATE_LINER:{value:0},INTERPOLATE_BEZIER:{value:1}})})(xpl);
(function(b){b.XModelAnimationSet=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_ANIMATION_SET);this.name=null;this.num_animations=0;this.animations=null};Object.setPrototypeOf(b.XModelAnimationSet.prototype,b.XModelExtensible.prototype);b.XModelAnimationSet.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelCodec=function(){};Object.defineProperties(b.XModelCodec,{CODE_NAME:{value:"EX-MACHINA"},MAGIC_NUMBER:{value:1633971576},END_OF_DATA:{value:1685614437},VERSION:{value:35},COMPATIBILITY_VERSION:{value:35},VERSION_NAME:{value:"0.9.90"},COMPATIBILITY_VERSION_NAME:{value:"0.9.90"}})})(xpl);(function(b){b.XModelDecoder=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};Object.setPrototypeOf(b.XModelDecoder.prototype,b.XModelCodec.prototype);b.XModelDecoder.prototype.decode=function(a){this.__data_view=new DataView(a);this.__data_offset=0;this.__inst_map={};this.__weak_inst_map={};if(this._getInt32()!=b.XModelCodec.MAGIC_NUMBER||this._getInt32()<b.XModelCodec.COMPATIBILITY_VERSION)return this._recycle(),null;a=this._getInt32();a=this._createStructureProcedure(a);
this._getStructureProcedure(a);this._getInt32()!=b.XModelCodec.END_OF_DATA&&console.error("Warning! This data doesn't has a terminator in the binary!");this._recycle();return a};b.XModelDecoder.prototype._recycle=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};b.XModelDecoder.prototype._getInt8=function(){var a=this.__data_view.getInt8(this.__data_offset);this.__data_offset+=1;return a};b.XModelDecoder.prototype._getUint8=function(){var a=this.__data_view.getUint8(this.__data_offset);
this.__data_offset+=1;return a};b.XModelDecoder.prototype._getInt16=function(){var a=this.__data_view.getInt16(this.__data_offset,!0);this.__data_offset+=2;return a};b.XModelDecoder.prototype._getInt32=function(){var a=this.__data_view.getInt32(this.__data_offset,!0);this.__data_offset+=4;return a};b.XModelDecoder.prototype._getFloat32=function(){var a=this.__data_view.getFloat32(this.__data_offset,!0);this.__data_offset+=4;return a};b.XModelDecoder.prototype._getFloat64=function(){var a=this.__data_view.getFloat64(this.__data_offset,
!0);this.__data_offset+=8;return a};b.XModelDecoder.prototype._getInt8Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt8()};b.XModelDecoder.prototype._getUint8Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getUint8()};b.XModelDecoder.prototype._getInt16Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt16()};b.XModelDecoder.prototype._getInt32Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt32()};b.XModelDecoder.prototype._getFloat32Array=function(a,b,c){for(var d=
0;d<c;++d)a[b+d]=this._getFloat32()};b.XModelDecoder.prototype._getFloat64Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getFloat64()};b.XModelDecoder.prototype._getBool=function(){return 0!=this._getInt8()};b.XModelDecoder.prototype._getBoolArray=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getBool()};b.XModelDecoder.prototype._getString=function(){var a=this._getInt16();if(0<a){var e=Array(a);this._getUint8Array(e,0,a);return b.StringUtils.decodeUTF8(e)}return null};b.XModelDecoder.prototype._getStringArray=
function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getString()};b.XModelDecoder.prototype._getStructure=function(){var a=this._getInt32();if(0==a)return null;var b=this._getInt32(),c=this.__inst_map[a];if(null!=c)return c;c=this.__weak_inst_map[a];null!=c?delete this.__weak_inst_map[a]:c=this._createStructureProcedure(b);this.__inst_map[a]=c;this._getStructureProcedure(c);return c};b.XModelDecoder.prototype._getStructureArray=function(a,b,c){for(var d=0;d<c;++d)a[b++]=this._getStructure()};b.XModelDecoder.prototype._getStructureRef=
function(){var a=this._getInt32();if(0==a)return null;var b=this._getInt32(),c=this.__inst_map[a]|this.__weak_inst_map[a];if(null!=c)return c;c=this._createStructureProcedure(b);this.__weak_inst_map[a]=c};b.XModelDecoder.prototype._getStructureRefArray=function(a,b,c){for(var d=0;d<c;++d)a[b++]=this._getStructRef()};b.XModelDecoder.prototype._createStructureProcedure=function(a){switch(a){case b.XModelStructure.TYPE_AXIS_ROTATE:return new b.XModelAxisRotate;case b.XModelStructure.TYPE_QUATERNION:return new b.XModelQuaternion;
case b.XModelStructure.TYPE_SCALE:return new b.XModelScale;case b.XModelStructure.TYPE_TRANSLATE:return new b.XModelTranslate;case b.XModelStructure.TYPE_MATRIX:return new b.XModelMatrix;case b.XModelStructure.TYPE_CONTAINER:return new b.XModelContainer;case b.XModelStructure.TYPE_TEXTURE:return new b.XModelTexture;case b.XModelStructure.TYPE_MATERIAL:return new b.XModelMaterial;case b.XModelStructure.TYPE_MESH:return new b.XModelMesh;case b.XModelStructure.TYPE_NODE:return new b.XModelNode;case b.XModelStructure.TYPE_IK:return new b.XModelIK;
case b.XModelStructure.TYPE_ANIMATION:return new b.XModelAnimation;case b.XModelStructure.TYPE_ANIMATION_KEY:return new b.XModelAnimationKey;case b.XModelStructure.TYPE_ANIMATION_SET:return new b.XModelAnimationSet}return null};b.XModelDecoder.prototype._getStructureProcedure=function(a){switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:return this._getAxisRotate(a),!0;case b.XModelStructure.TYPE_QUATERNION:return this._getQuaternion(a),!0;case b.XModelStructure.TYPE_SCALE:return this._getScale(a),
!0;case b.XModelStructure.TYPE_TRANSLATE:return this._getTranslate(a),!0;case b.XModelStructure.TYPE_MATRIX:return this._getMatrix(a),!0;case b.XModelStructure.TYPE_CONTAINER:return this._getContainer(a),!0;case b.XModelStructure.TYPE_TEXTURE:return this._getTexture(a),!0;case b.XModelStructure.TYPE_MATERIAL:return this._getMaterial(a),!0;case b.XModelStructure.TYPE_MESH:return this._getMesh(a),!0;case b.XModelStructure.TYPE_NODE:return this._getNode(a),!0;case b.XModelStructure.TYPE_IK:return this._getIK(a),
!0;case b.XModelStructure.TYPE_ANIMATION:return this._getAnimation(a),!0;case b.XModelStructure.TYPE_ANIMATION_KEY:return this._getAnimationKey(a),!0;case b.XModelStructure.TYPE_ANIMATION_SET:return this._getAnimationSet(a),!0}return!1};b.XModelDecoder.prototype._getUserData=function(){this._getInt32();return null};b.XModelDecoder.prototype._getAxisRotate=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_AXIS_ROTATE);ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_AXIS_ROTATE)};
b.XModelDecoder.prototype._getQuaternion=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_QUATERNION);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_QUATERNION)};b.XModelDecoder.prototype._getScale=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_SCALE);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_SCALE)};b.XModelDecoder.prototype._getTranslate=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_TRANSLATE);
b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_TRANSLATE)};b.XModelDecoder.prototype._getMatrix=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_MATRIX);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_MATRIX)};b.XModelDecoder.prototype._getContainer=function(a){a.name=this._getString();a.num_textures=this._getInt16();0<a.num_textures&&(a.textures=Array(a.num_textures),this._getStructureArray(a.textures,0,a.num_textures));a.num_materials=this._getInt16();
0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_meshes=this._getInt16();0<a.num_meshes&&(a.meshes=Array(a.num_meshes),this._getStructureArray(a.meshes,0,a.num_meshes));a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),this._getStructureArray(a.nodes,0,a.num_nodes));a.time_rate=this._getFloat64();a.num_animation_sets=this._getInt16();0<a.num_animation_sets&&(a.animation_sets=Array(a.num_animation_sets),this._getStructureArray(a.animation_sets,
0,a.num_animation_sets));a.userData=this._getUserData()};b.XModelDecoder.prototype._getTexture=function(a){a.name=this._getString();a.ref=this._getString();a.data_size=this._getInt32();0<a.data_size&&(a.data=new Int8Array(a.data_size),this._getInt8Array(a.data,0,a.data_size));a.user_data=this._getUserData()};b.XModelDecoder.prototype._getMaterial=function(a){a.name=this._getString();this._getFloat32Array(a.emissive,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.ambient,0,b.XModelStructure.SIZE_RGBA);
this._getFloat32Array(a.diffuse,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.specular,0,b.XModelStructure.SIZE_RGBA);a.shininess=this._getFloat32();a.bump=this._getFloat32();a.emissive_map=this._getStructure();a.ambient_map=this._getStructure();a.diffuse_map=this._getStructure();a.specular_map=this._getStructure();a.shininess_map=this._getStructure();a.bump_map=this._getStructure();a.draw_mode=this._getInt32();a.user_data=this._getUserData()};b.XModelDecoder.prototype._getMesh=function(a){a.name=
this._getString();a.num_positions=this._getInt32();if(0<a.num_positions){a.position_size=this._getInt8();var e=a.position_size*a.num_positions;a.positions=new Float32Array(e);this._getFloat32Array(a.positions,0,e)}a.num_normals=this._getInt32();0<a.num_normals&&(a.normal_size=this._getInt8(),e=a.normal_size*a.num_normals,a.normals=new Float32Array(e),this._getFloat32Array(a.normals,0,e));a.num_colors=this._getInt32();0<a.num_colors&&(a.color_size=this._getInt8(),e=a.color_size*a.num_colors,a.colors=
new Float32Array(e),this._getFloat32Array(a.colors,0,e));a.num_tex_coords=this._getInt32();0<a.num_tex_coords&&(a.tex_coord_size=this._getInt8(),e=a.tex_coord_size*a.num_tex_coords,a.tex_coords=new Float32Array(e),this._getFloat32Array(a.tex_coords,0,e));var c=this._getBool();c&&(a.skin=new b.XModelSkin,this._getSkin(a.skin));a.num_vertices=this._getInt32();if(0<a.num_vertices)for(a.vertices=Array(a.num_vertices),e=0;e<a.num_vertices;++e){var d=new b.XModelVertex;this._getVertex(d,a.num_positions,
a.num_normals,a.num_colors,a.num_tex_coords,c);a.vertices[e]=d}a.num_materials=this._getInt16();0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_elements=this._getInt32();if(0<a.num_elements)for(a.elements=Array(a.num_elements),e=0;e<a.num_elements;++e)c=new b.XModelElement,this._getElement(c),a.elements[e]=c;a.user_data=this._getUserData()};b.XModelDecoder.prototype._getSkin=function(a){a.num_weighted_indices=this._getInt32();a.weighted_index_stride=
this._getInt8();if(0<a.num_weighted_indices){a.weighted_index_sizes=new Uint8Array(a.num_weighted_indices);var e=a.weighted_index_stride*a.num_weighted_indices;a.indices=new Int16Array(e);a.weights=new Float32Array(e);for(var c=0;c<e;++c)a.indices[c]=-1,a.weights[c]=0;b.ArrayUtils.fill(a.indices,0,e,-1);b.ArrayUtils.fill(a.weights,0,e,0);for(e=c=0;c<a.num_weighted_indices;++c,e+=a.weighted_index_stride){var d=this._getInt8();a.weighted_index_sizes[c]=d;for(var g=0;g<d;++g){var f=e+g;a.indices[f]=
this._getInt16();a.weights[f]=this._getFloat32()}}}a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),this._getStructureArray(a.nodes,0,a.num_nodes),c=b.XModelStructure.SIZE_MATRIX*a.num_nodes,a.offset_matrices=new Float32Array(c),this._getFloat32Array(a.offset_matrices,0,c),c=b.XModelStructure.SIZE_QUATERNION*a.num_nodes,a.offset_quaternions=new Float32Array(c),this._getFloat32Array(a.offset_quaternions,0,c))};b.XModelDecoder.prototype._getVertex=function(a,b,c,d,g,f){0<b&&(a.position=
this._getInt32());0<c&&(a.normal=this._getInt32());0<d&&(a.color=this._getInt32());0<g&&(a.tex_coord=this._getInt32());f&&(a.skinning=this._getInt32())};b.XModelDecoder.prototype._getElement=function(a){a.material=this._getInt16();a.num_vertices=this._getInt8();0<a.num_vertices&&(a.vertices=new Uint32Array(a.num_vertices),this._getInt32Array(a.vertices,0,a.num_vertices))};b.XModelDecoder.prototype._getNode=function(a){a.name=this._getString();a.connected=this._getBool();this._getBoolArray(a.lock_axises,
0,b.XModelStructure.SIZE_VECTOR_3);this._getBoolArray(a.limit_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.min_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.max_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.bone_tail,0,b.XModelStructure.SIZE_VECTOR_3);this._getStructureArray(a.transforms,0,b.XModelNode.NUM_TRANSFORMS);a.num_iks=this._getInt16();0<a.num_iks&&(a.iks=Array(a.num_iks),this._getStructureArray(a.iks,0,a.num_iks));a.num_meshes=
this._getInt16();if(0<a.num_meshes){a.meshes=Array(a.num_meshes);this._getStructureArray(a.meshes,0,a.num_meshes);for(var e=0;e<a.num_meshes;++e){var c=a.meshes[e];null!=c&&(c.parent=a)}}a.num_children=this._getInt16();if(0<a.num_children)for(a.children=Array(a.num_children),this._getStructureArray(a.children,0,a.num_children),e=0;e<a.num_children;++e)c=a.children[e],null!=c&&(c.parent=a);a.user_data=this._getUserData()};b.XModelDecoder.prototype._getIK=function(a){a.target=this._getStructure();a.max_iterations=
this._getInt16();a.chain_length=this._getInt16();a.influence=this._getFloat32()};b.XModelDecoder.prototype._getAnimation=function(a){a.name=this._getString();a.target=this._getStructure();a.index=this._getInt16();a.num_keys=this._getInt16();0<a.num_keys&&(a.keys=Array(a.num_keys),this._getStructureArray(a.keys,0,a.num_keys));a.num_children=this._getInt16();0<a.num_children&&(a.children=Array(a.num_children),this._getStructureArray(a.children,0,a.num_children));a.user_data=this._getUserData()};b.XModelDecoder.prototype._getAnimationKey=
function(a){a.interpolate=this._getInt8();a.time=this._getFloat64();a.value_size=this._getInt16();0<a.value_size&&(a.value=new Float32Array(a.value_size),this._getFloat32Array(a.value,0,a.value_size))};b.XModelDecoder.prototype._getAnimationSet=function(a){a.name=this._getString();a.num_animations=this._getInt16();0<a.num_animations&&(a.animations=Array(a.num_animations),this._getStructureArray(a.animations,0,a.num_animations));a.user_data=this._getUserData()}})(xpl);(function(b){b.XModelMaterialUtils=function(){};b.XModelMaterialUtils.getTextures=function(a,b,c,d){var g=0;null!=a&&(a.emissive_map&&(b&&0<d&&(b[c++]=a.emissive_map,d--),g++),a.ambient_map&&(b&&0<d&&(b[c++]=a.ambient_map,d--),g++),a.diffuse_map&&(b&&0<d&&(b[c++]=a.diffuse_map,d--),g++),a.specular_map&&(b&&0<d&&(b[c++]=a.specular_map,d--),g++),a.shininess_map&&(b&&0<d&&(b[c++]=a.shininess_map,d--),g++),a.bump_map&&(b&&0<d&&(b[c++]=a.bump_map),g++));return g};b.XModelMaterialUtils.releaseTexture=function(a){null!=
a&&(a.emissive_map&&(a.emissive_map.data=null,a.emissive_map.data_size=0),a.ambient_map&&(a.ambient_map.data=null,a.ambient_map.data_size=0),a.diffuse_map&&(a.diffuse_map.data=null,a.diffuse_map.data_size=0),a.specular_map&&(a.specular_map.data=null,a.specular_map.data_size=0),a.shininess_map&&(a.shininess_map.data=null,a.shininess_map.data_size=0),a.bump_map&&(a.bump_map.data=null,a.bump_map.data_size=0))}})(xpl);(function(b){b.XModelMeshUtils=function(){};Object.defineProperties(b.XModelMeshUtils,{ATTRIBUTE_STRUCTURE_SIZE:{value:0},ATTRIBUTE_POSITION:{value:1},ATTRIBUTE_NORMAL:{value:2},ATTRIBUTE_COLOR:{value:3},ATTRIBUTE_TEXCOORD:{value:4},ATTRIBUTE_BONELENGTH:{value:5},ATTRIBUTE_BONEINDICES:{value:6},ATTRIBUTE_BONEWEIGHTS:{value:7},MAX_ATTRIBUTE:{value:8},TYPE_VOID:{value:0},TYPE_UNSIGNED_BYTE:{value:1},TYPE_UNSIGNED_SHORT:{value:2},TYPE_UNSIGNED_INT:{value:3},TYPE_FLOAT:{value:4}});b.XModelMeshUtils.getPositions=
function(a,b,c,d,g,f){var h=0;if(null!=a&&null!=a.positions&&0<a.position_size){void 0===f&&(f=-1);c<b&&(c=b);var m;-1!=f?(f=a.subsets[f],m=f.num_vertices):(f=null,m=a.num_vertices);for(var k=0;k<m;++k){var l=a.vertices[null==f?k:f.vertices[k]];if(-1!=l.position)for(var l=a.position_size*l.position,n=0;n<b&&n<a.position_size;++n)d[g+n]=a.positions[l++],h++;else n=0;for(;n<b;++n)d[g+n]=0,h++;g+=c}}return h};b.XModelMeshUtils.getNormals=function(a,b,c,d,g,f){var h=0;if(null!=a&&null!=a.normals&&0<a.normal_size){void 0===
f&&(f=-1);c<b&&(c=b);var m;-1!=f?(f=a.subsets[f],m=f.num_vertices):(f=null,m=a.num_vertices);for(var k=0;k<m;++k){var l=a.vertices[null==f?k:f.vertices[k]];if(-1!=l.normal)for(var l=a.normal_size*l.normal,n=0;n<b&&n<a.normal_size;++n)d[g+n]=a.normals[l++],h++;else n=0;for(;n<b;++n)d[g+n]=0,h++;g+=c}}return h};b.XModelMeshUtils.getColors=function(a,b,c,d,g,f){var h=0;if(null!=a&&null!=a.colors&&0<a.color_size){void 0===f&&(f=-1);c<b&&(c=b);var m;-1!=f?(f=a.subsets[f],m=f.num_vertices):(f=null,m=a.num_vertices);
for(var k=d instanceof Uint8Array||d instanceof Int8Array?255:1,l=0;l<m;++l){var n=a.vertices[null==f?l:f.vertices[l]];if(-1!=n.color)for(var n=a.color_size*n.color,p=0;p<b&&p<a.color_size;++p)d[g+p]=a.colors[n++]*k,h++;else p=0;for(;p<b;++p)d[g+p]=0,h++;g+=c}}return h};b.XModelMeshUtils.getTexCoords=function(a,b,c,d,g,f){var h=0;if(null!=a&&null!=a.tex_coords&&0<a.tex_coord_size){void 0===f&&(f=-1);c<b&&(c=b);var m;-1!=f?(f=a.subsets[f],m=f.num_vertices):(f=null,m=a.num_vertices);for(var k=0;k<m;++k){var l=
a.vertices[null==f?k:f.vertices[k]];if(-1!=l.tex_coord)for(var l=a.tex_coord_size*l.tex_coord,n=0;n<b&&n<a.tex_coord_size;++n)d[g+n]=a.tex_coords[l++],h++;else n=0;for(;n<b;++n)d[g+n]=0,h++;g+=c}}return h};b.XModelMeshUtils.getSkinBoneLengths=function(a,b,c,d,g){if(null!=a&&null!=a.skin&&1<a.skin.weighted_index_stride){void 0===g&&(g=-1);-1!=g?(b=a.subsets[g],g=b.num_vertices):(b=null,g=a.num_vertices);for(var f=0;f<g;++f){var h=a.vertices[null==b?f:b.vertices[f]];c[d]=-1!=h.skinning?a.skin.weighted_index_sizes[h.skinning]:
0}}return 0};b.XModelMeshUtils.getSkinBoneIndices=function(a,e,c,d,g,f){var h=0;if(null!=a&&null!=a.skin&&0<a.skin.weighted_index_stride){void 0===f&&(f=-1);c<e&&(c=e);var m;-1!=f?(f=a.subsets[f],m=f.num_vertices):(f=null,m=a.num_vertices);for(var k=0;k<m;++k){var l=a.vertices[null==f?k:f.vertices[k]];if(-1!=l.skinning)for(var n=a.skin.weighted_index_sizes[l.skinning],l=a.skin.weighted_index_stride*l.skinning,p=0;p<e&&p<n&&a.skin.weighted_index_stride;++p){if(null==f)d[g+p]=a.skin.indices[l++];else{var q=
b.ArrayUtils.search(f.bones,0,f.num_bones);d[g+p]=0<=q?q:0}h++}else p=0;for(;p<e;++p)d[g+p]=0,h++;g+=c}}return h};b.XModelMeshUtils.getSkinBoneWeights=function(a,b,c,d,g,f){var h=0;if(null!=a&&null!=a.skin&&0<a.skin.weighted_index_stride){void 0===f&&(f=-1);c<b&&(c=b);var m;-1!=f?(f=a.subsets[f],m=f.num_vertices):(f=null,m=a.num_vertices);for(var k=0;k<m;++k){var l=a.vertices[null==f?k:f.vertices[k]];if(-1!=l.skinning)for(var n=a.skin.weighted_index_sizes[l.skinning],l=a.skin.weighted_index_stride*
l.skinning,p=0;p<b&&p<n&&a.skin.weighted_index_stride;++p)d[g+p]=a.skin.weights[l++],h++;else p=0;for(;p<b;++p)d[g+p]=0,h++;g+=c}}return h};b.XModelMeshUtils.getVerticesSize=function(a,e,c,d,g,f,h,m,k,l,n,p,q){if(null!=a&&null!=a.vertices&&0<a.num_vertices){void 0===q&&(q=-1);null!=n&&b.ArrayUtils.fill(n,p,p+b.XModelMeshUtils.MAX_ATTRIBUTE,-1);var r=0,u=e?1:-1==q?a.num_vertices:a.subset[q].num_vertices;0<d&&0<a.position_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_POSITION]=r),r+=u*a.position_size*
d,r=c*Math.floor((r+c-1)/c));0<g&&0<a.normal_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_NORMAL]=r),r+=u*a.normal_size*g,r=c*Math.floor((r+c-1)/c));0<f&&0<a.color_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_COLOR]=r),r+=u*a.color_size*f,r=c*Math.floor((r+c-1)/c));0<h&&0<a.tex_coord_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD]=r),r+=u*a.tex_coord_size*h,r=c*Math.floor((r+c-1)/c));null!=a.skin&&0<a.skin.weighted_index_stride&&(0<m&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH]=
r),r=c*Math.floor((r+u*m+c-1)/c)),0<k&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]=r),r+=u*a.skin.weighted_index_stride*k,r=c*Math.floor((r+c-1)/c)),0<l&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]=r),r+=u*a.skin.weighted_index_stride*l,r=c*Math.floor((r+c-1)/c)));if(e)return n[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=r,-1==q?a.num_vertices*r:a.subset[q].num_vertices;n[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=0;return r}return 0};b.XModelMeshUtils.getVertices=function(a,
e,c,d,g,f,h,m,k,l,n,p,q){if(null!=a&&null!=a.vertices&&0<a.num_vertices){var r=k[l+b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE];if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_POSITION])switch(e){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getPositions(a,a.position_size,r/4,new Float32Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_POSITION]),0,q)}if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_NORMAL])switch(c){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getNormals(a,a.normal_size,r/4,new Float32Array(n,p+
k[l+b.XModelMeshUtils.ATTRIBUTE_NORMAL]),0,q)}if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_COLOR])switch(d){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getColors(a,a.color_size,r,new Uint8Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_COLOR]),0,q);break;case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getColors(a,a.color_size,r/4,new Float32Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_COLOR]),0,q)}if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD])switch(g){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getTexCoords(a,
a.tex_coord_size,r/4,new Float32Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD]),0,q)}if(null!=a.skin&&0<a.skin.weighted_index_stride){if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH])switch(f){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getSkinBoneLengths(a,r,new Uint8Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH]),0,q)}if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES])switch(h){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getSkinBoneIndices(a,a.skin.weighted_index_stride,
r,new Uint8Array(n,p+k[l+b.XModelMeshUtils.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),0,q);break;case b.XModelMeshUtils.TYPE_UNSIGNED_SHORT:b.XModelMeshUtils.getSkinBoneIndices(a,a.skin.weighted_index_stride,r/2,new Uint16Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),0,q)}if(0<=k[l+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS])switch(m){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getSkinBoneWeights(a,a.skin.weighted_index_stride,r/4,new Float32Array(n,p+k[l+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]),
0,q)}}}};b.XModelMeshUtils.getNumTriangledFaceIndices=function(a,b,c){var d=0;if(null!=a){void 0===c&&(c=-1);-1!=c&&(a=a.subsets[c]);c=a.num_elements;a=a.elements;for(var g=0;g<c;++g){var f=a[g];f.material==b&&3<=f.num_vertices&&(d+=3*(f.num_vertices-2))}}return d};b.XModelMeshUtils.getNumAllTriangledFaceIndices=function(a,e,c,d,g,f){var h=0;if(null!=a){for(var m=0;m<a.num_materials;++m){null!=e&&(e[c+m]=h);var k=b.XModelMeshUtils.getNumTriangledFaceIndices(a,m,f);null!=d&&(d[g+m]=k);h+=k}null!=e&&
(e[c+a.num_materials]=h);k=b.XModelMeshUtils.getNumTriangledFaceIndices(a,-1,f);null!=d&&(d[g+a.num_materials]=k);h+=k}return h};b.XModelMeshUtils.getTriangledFaceIndices=function(a,b,c,d,g,f){var h=0;if(null!=a){void 0===f&&(f=-1);-1!=f&&(a=a.subsets[f]);f=a.num_elements;a=a.elements;var m,k;c?(c=0,m=2,k=1):(c=0,m=1,k=2);for(var l=0;l<f;++l){var n=a[l];if(n.material==b)for(var p=0,q=n.num_vertices-2;p<q;++p)d[g+c]=n.vertices[0],d[g+m]=n.vertices[p+1],d[g+k]=n.vertices[p+2],g+=3,h+=3}}return h};b.XModelMeshUtils.getAllTriangledFaceIndices=
function(a,e,c,d,g,f,h){var m=0;if(null!=a)for(var k=0;k<a.num_materials;++k)m+=b.XModelMeshUtils.getTriangledFaceIndices(a,k,e,g,f+c[d+k],h)};b.XModelMeshUtils.releaseShape=function(a){if(null!=a&&(a.positions=null,a.normals=null,a.colors=null,a.tex_coords=null,a.vertices=null,null!=a.skin&&(a.skin.weighted_index_sizes=null,a.skin.indices=null,a.skin.weights=null),a.elements=null,null!=a.subsets))for(var b=0;b<a.num_subsets;++b){var c=a.subsets[b];c.bones=null;c.vertices=null;c.elements=null}};b.XModelMeshUtils.getTextures=
function(a,e,c,d){var g=0;if(null!=a)for(var f=0;f<a.num_materials;++f){var h=b.XModelMaterialUtils.getTextures(a.materials[f],e,c,d);c+=h;d-=h;g+=h}return g};b.XModelMeshUtils.releaseTextures=function(a){if(null!=a)for(var e=0;e<a.num_materials;++e)b.XModelMaterialUtils.releaseTexture(a.materials[e])}})(xpl);(function(b){var a=b.Geometry.SIZE_VECTOR_3,e=b.Geometry.SIZE_MATRIX_4X4;b.XModelSkinUtils=function(){};b.XModelSkinUtils.updateMatrixPallet=function(a,d,g,f){if(null!=a){for(var h=0;h<a.num_nodes&&h<d;++h){var m=e*h,k=a.nodes[h];null!=k?b.Matrix4x4.mulv(g,f+m,k.combined_matrix,0,a.offset_matrices,m):b.Matrix4x4.loadIdentity(g,f+m)}return Math.min(a.num_nodes,d)}return 0};b.XModelSkinUtils.updatePositions=function(c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y){m<a&&(m=a);n<a&&(n=a);y<p&&(y=p);u<p&&(u=p);if(1==
p)for(var w=0;w<g;++w)b.Vector3.mulMatrix4x4v(k,l,c,d+e*q[r],f,h,!0),h+=m,l+=n,r+=u;else if(1<p)for(var z=new Float32Array(a),w=0;w<g;++w){b.Vector3.loadZero(k,l);for(var A=0;A<p;++A){var E=x[v+A];0<E&&(b.Vector3.mulMatrix4x4v(z,0,c,d+e*q[r+A],f,h,!0),b.Vector3.mulv(z,0,z,0,E),b.Vector3.addv(k,l,k,l,z,0))}h+=m;l+=n;r+=u;v+=y}};b.XModelSkinUtils.updateNormals=function(c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y){m<a&&(m=a);n<a&&(n=a);y<p&&(y=p);u<p&&(u=p);if(1==p)for(var w=0;w<g;++w)b.Vector3.mulMatrix4x4Axisv(k,
l,c,d+e*q[r],f,h),h+=m,l+=n,r+=u;else if(1<p)for(var z=new Float32Array(a),w=0;w<g;++w){b.Vector3.loadZero(k,l);for(var A=0;A<p;++A){var E=x[v+A];0<E&&(b.Vector3.mulMatrix4x4Axisv(z,0,c,d+e*q[r+A],f,h),b.Vector3.mulv(z,0,z,0,E),b.Vector3.addv(k,l,k,l,z,0))}h+=m;l+=n;r+=u;v+=y}}})(xpl);(function(b){b.XModelTransformUtils=function(){};b.XModelTransformUtils.applyTransform=function(a,e,c){if(null!=a){var d;switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:a=a.value;d=0*b.XModelStructure.SIZE_AXIS_ROTATE;b.Matrix4x4.mulRotate(e,c,a[d+b.XModelAxisRotate.X],a[d+b.XModelAxisRotate.Y],a[d+b.XModelAxisRotate.Z],a[d+b.XModelAxisRotate.ANGLE],!0,!0);break;case b.XModelStructure.TYPE_QUATERNION:a=a.value;d=0*b.XModelStructure.SIZE_QUATERNION;b.Matrix4x4.mulQuaternionv(e,c,a,
d,!0);break;case b.XModelStructure.TYPE_SCALE:a=a.value;d=0*b.XModelStructure.SIZE_SCALE;b.Matrix4x4.mulScale(e,c,a[d+b.Geometry.VX],a[d+b.Geometry.VY],a[d+b.Geometry.VZ]);break;case b.XModelStructure.TYPE_TRANSLATE:a=a.value;d=0*b.XModelStructure.SIZE_TRANSLATE;b.Matrix4x4.mulTranslate(e,c,a[d+b.Geometry.VX],a[d+b.Geometry.VY],a[d+b.Geometry.VZ],!0);break;case b.XModelStructure.TYPE_MATRIX:a=a.value,d=0*b.XModelStructure.SIZE_MATRIX,b.Matrix4x4.mulv(e,c,e,c,a,d)}}};b.XModelTransformUtils.resetTransform=
function(a){if(null!=a)switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_AXIS_ROTATE);break;case b.XModelStructure.TYPE_QUATERNION:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_QUATERNION);break;case b.XModelStructure.TYPE_SCALE:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_SCALE);break;case b.XModelStructure.TYPE_TRANSLATE:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_TRANSLATE);
break;case b.XModelStructure.TYPE_MATRIX:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_MATRIX)}}})(xpl);(function(b){var a=b.Geometry.VX,e=b.Geometry.VY,c=b.Geometry.VZ,d=b.Geometry.CI,g=b.Geometry.CJ,f=b.Geometry.CK,h=b.Geometry.M4X4_00,m=b.Geometry.M4X4_01,k=b.Geometry.M4X4_02,l=b.Geometry.M4X4_03,n=b.Geometry.M4X4_10,p=b.Geometry.M4X4_11,q=b.Geometry.M4X4_12,r=b.Geometry.M4X4_13,u=b.Geometry.M4X4_20,x=b.Geometry.M4X4_21,v=b.Geometry.M4X4_22,y=b.Geometry.M4X4_23;b.XModelKinematicsUtils=function(){};var w=function(a){this.node=a;this.local_transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);
this.transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.offset_transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.rotate=new Float32Array(b.XModelStructure.SIZE_QUATERNION);this.min_sins=new Float32Array(b.XModelStructure.SIZE_VECTOR_3);this.max_sins=new Float32Array(b.XModelStructure.SIZE_VECTOR_3);b.Matrix4x4.loadIdentity(this.local_transform,0);for(a=0;a<b.XModelNode.TRANSFORM_ROTATE;++a)b.XModelTransformUtils.applyTransform(this.node.transforms[a],this.local_transform,
0);b.Matrix4x4.normalizeAxisv(this.local_transform,0,this.local_transform,0,!0);a=this.local_transform[h];var d=this.local_transform[m],c=this.local_transform[n],f=this.local_transform[p],e=this.local_transform[u],g=this.local_transform[x];0>(c*g-e*f)*this.local_transform[k]+(e*d-a*g)*this.local_transform[q]+(a*f-c*d)*this.local_transform[v]&&(this.local_transform[h]=-this.local_transform[h],this.local_transform[m]=-this.local_transform[m],this.local_transform[k]=-this.local_transform[k],this.local_transform[n]=
-this.local_transform[n],this.local_transform[p]=-this.local_transform[p],this.local_transform[q]=-this.local_transform[q],this.local_transform[u]=-this.local_transform[u],this.local_transform[x]=-this.local_transform[x],this.local_transform[v]=-this.local_transform[v]);a=this.node.transforms[b.XModelNode.TRANSFORM_ROTATE];a.structure_type==b.XModelStructure.TYPE_AXIS_ROTATE?b.Quaternion.loadRotate(this.rotate,0,a.value[b.XModelAxisRotate.X],a.value[b.XModelAxisRotate.Y],a.value[b.XModelAxisRotate.Z],
a.value[b.XModelAxisRotate.ANGLE],!0):a.structure_type==b.XModelStructure.TYPE_QUATERNION?(b.Quaternion.loadv(this.rotate,0,a.value,0),b.Quaternion.normalizev(this.rotate,0,this.rotate,0)):b.Quaternion.loadIdentity(this.rotate,0);for(a=0;a<b.XModelStructure.SIZE_VECTOR_3;++a)this.min_sins[a]=Math.sin(.5*this.node.min_angles[a]),this.max_sins[a]=Math.sin(.5*this.node.max_angles[a])};w.prototype.updateOffsetTransform=function(){var a=this.transform[h],d=this.transform[n],c=this.transform[u],f=this.transform[m],
e=this.transform[p],g=this.transform[x],w=this.transform[k],F=this.transform[q],K=this.transform[v],C=-this.transform[l],L=-this.transform[r],P=-this.transform[y];b.Matrix4x4.load(this.offset_transform,0,a,d,c,C*a+L*d+P*c,f,e,g,C*f+L*e+P*g,w,F,K,C*w+L*F+P*K,0,0,0,1,!1)};b.XModelKinematicsUtils.applyInverseKinematicesLocation=function(h,k,m,n,p){if(null!=h&&1<=n){for(var q=h,u=1;u<n&&null!=q.parent;)q=q.parent,u++;if(1==n||1>=u)m=1;n=Array(u);var v=h;for(h=0;h<u;++h)n[h]=new w(v),v=v.parent;var x=
new Float32Array(b.XModelStructure.SIZE_VECTOR_3),C=new Float32Array(b.XModelStructure.SIZE_QUATERNION),L=new Float32Array(b.XModelStructure.SIZE_QUATERNION),P=new Float32Array(b.XModelStructure.SIZE_QUATERNION),M=!1;for(h=0;h<m;++h){var v=n[0],N=u,M=n,I=M[N-1];null!=I.node.parent?b.Matrix4x4.mulv(I.transform,0,I.node.parent.combined_matrix,0,I.local_transform,0):b.Matrix4x4.loadv(I.transform,0,I.local_transform,0,!1);b.Matrix4x4.mulQuaternionv(I.transform,0,I.rotate,0,!0);I.updateOffsetTransform();
for(N-=2;0<=N;--N){var T=I,I=M[N];b.Matrix4x4.mulv(I.transform,0,T.transform,0,I.local_transform,0);b.Matrix4x4.mulQuaternionv(I.transform,0,I.rotate,0,!0);I.updateOffsetTransform()}b.Vector3.mulMatrix4x4v(x,0,v.transform,0,v.node.bone_tail,0,!0);v=x[a]-k[a];M=x[e]-k[e];I=x[c]-k[c];if(v*v+M*M+I*I<=p)break;M=!1;for(I=0;I<u;++I){var v=n[I],N=v.transform[l],T=v.transform[r],X=v.transform[y];b.Quaternion.loadRotateVector3(C,0,x[a]-N,x[e]-T,x[c]-X,!0,k[a]-N,k[e]-T,k[c]-X,!0,(I+1)/u*(h==m-1?1:.5));M&&(b.Quaternion.mulv(C,
0,C,0,P,0),M=!1);b.Quaternion.loadv(P,0,C,0);b.Vector3.mulMatrix4x4Axisv(C,d,v.offset_transform,0,C,d,!0);b.Quaternion.conjugatev(C,0,C,0);b.Quaternion.loadv(L,0,v.rotate,0);b.Quaternion.mulv(v.rotate,0,C,0,v.rotate,0);for(var R=0;R<b.XModelStructure.SIZE_VECTOR_3;++R)if(v.node.lock_axises[R])v.rotate[d+R]=0,M=!0;else{var Y=v.rotate[d+R],J=b.MathUtils.mid(Y,v.min_sins[R],v.max_sins[R]);Y!=J&&(v.rotate[d+R]=J,M=!0)}M&&(b.Quaternion.normalizev(v.rotate,0,v.rotate,0),b.Quaternion.divv(C,0,v.rotate,0,
L,0));b.Quaternion.conjugatev(C,0,C,0);b.Vector3.sub(x,0,x[a],x[e],x[c],N,T,X);b.Vector3.mulMatrix4x4Axisv(C,d,v.transform,0,C,d,!0);b.Vector3.mulQuaternionv(x,0,C,0,x,0);b.Vector3.add(x,0,x[a],x[e],x[c],N,T,X);M&&b.Quaternion.divv(P,0,P,0,C,0)}}for(h=0;h<u;++h)v=n[h],k=v.node.transforms[b.XModelNode.TRANSFORM_ROTATE],k.structure_type==b.XModelStructure.TYPE_AXIS_ROTATE?(m=v.rotate[d],p=v.rotate[g],x=v.rotate[f],C=m*m+p*p+x*x,0<C&&(C=Math.sqrt(C),m/=C,p/=C,x/=C),k.value[b.XModelAxisRotate.ANGLE]=
Math.acos(v.rotation[b.Geometry.CR]),k.value[b.XModelAxisRotate.X]=m,k.value[b.XModelAxisRotate.Y]=p,k.value[b.XModelAxisRotate.Z]=x):k.structure_type==b.XModelStructure.TYPE_QUATERNION&&b.Quaternion.loadv(k.value,0,v.rotate,0);null!=q.parent?b.XModelNodeUtils.updateCombinationv(q,q.num_children,q.children,0,q.parent.combined_matrix,0):b.XModelNodeUtils.updateCombination(q)}};b.XModelKinematicsUtils.applyInverseKinematices=function(a,d,c,f,e){null!=a&&null!=d&&(e=new Float32Array(b.XModelStructure.SIZE_VECTOR_3),
b.Vector3.loadZero(e,0),b.Vector3.mulMatrix4x4v(e,0,d.combined_matrix,0,e,0,!0),b.XModelKinematicsUtils.applyInverseKinematicesLocation(a,e,c,f,1E-4))};b.XModelKinematicsUtils.applyCopyTransform=function(a,b){}})(xpl);(function(b){b.XModelAnimationUtils=function(){};b.XModelAnimationUtils.setAnimation=function(a,e){if(null!=a){if(0<a.num_keys){var c,d,g;if(1==a.num_keys)c=a.keys[0],d=a.keys[0],g=0;else{a:{g=0;d=a.num_keys;for(d--;g<=d;){c=g+d>>1;var f=a.keys[c].time;if(f<e)g=c+1;else if(f>e)d=c-1;else{g=c;break a}}g=-(g+1)}0<=g?(c=a.keys[g],d=a.keys[g],g=0):-1!=g?(g=-(g+2),g<a.num_keys-1?(c=a.keys[g+0],d=a.keys[g+1],g=(e-c.time)/(d.time-c.time)):(c=a.keys[g],d=a.keys[g],g=0)):(c=a.keys[0],d=a.keys[0],g=0)}switch(a.target.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:f=
a.target;0>=g?-1==a.index?(b.Vector3.loadv(f.value,0,c.value,0),f.value[b.XModelAxisRotate.ANGLE]=c.value[b.XModelAxisRotate.ANGLE]):f.value[a.index]=c.value[0]:-1==a.index?(b.Vector3.slerpv(f.value,0,c.value,0,d.value,0,g),f.value[b.XModelAxisRotate.ANGLE]=c.value[b.XModelAxisRotate.ANGLE]*(1-g)+d.value[b.XModelAxisRotate.ANGLE]*g):f.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_QUATERNION:f=a.target;0>=g?-1==a.index?b.Quaternion.loadv(f.value,0,c.value,0):f.value[a.index]=
c.value[0]:-1==a.index?b.Quaternion.slerpv(f.value,0,c.value,0,d.value,0,g):f.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_SCALE:f=a.target;0>=g?-1==a.index?b.Vector3.loadv(f.value,0,c.value,0):f.value[a.index]=c.value[0]:-1==a.index?b.Vector3.lerpv(f.value,0,c.value,0,d.value,0,g):f.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_TRANSLATE:f=a.target;0>=g?-1==a.index?b.Vector3.loadv(f.value,0,c.value,0):f.value[a.index]=c.value[0]:
-1==a.index?b.Vector3.lerpv(f.value,0,c.value,0,d.value,0,g):f.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_MATRIX:f=a.target,0>=g?-1==a.index?b.Matrix4x4.loadv(f.value,0,c.value,0):f.value[a.index]=c.value[0]:-1==a.index?b.Matrix4x4.slrepAxisAndLrepOtherv(f.value,0,c.value,0,d.value,0,g,!0):f.value[a.index]=c.value[0]*(1-g)+d.value[0]*g}}for(g=0;g<a.num_children;++g)b.XModelAnimation.setAnimation(a.children[g],e)}};b.XModelAnimationUtils.setAnimationSet=function(a,
e){if(null!=a)for(var c=0;c<a.num_animations;++c)b.XModelAnimationUtils.setAnimation(a.animations[c],e)};b.XModelAnimationUtils.getAnimationTotalTime=function(a){var e=0;if(null!=a){for(var c=0;c<a.num_keys;++c){var d=a.keys[a.num_keys-1].time;e<d&&(e=d)}for(c=0;c<a.num_children;++c)d=b.XModelAnimationUtils.getAnimationTotalTime(a.children[c]),e<d&&(e=d)}return e};b.XModelAnimationUtils.getAnimationSetTotalTime=function(a){var e=0;if(null!=a)for(var c=0;c<a.num_animations;++c){var d=b.XModelAnimationUtils.getAnimationTotalTime(a.animations[c]);
e<d&&(e=d)}return e}})(xpl);(function(b){b.XModelNodeUtils=function(){};b.XModelNodeUtils.getTextures=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_meshes;++f){var h=b.XModelMeshUtils.getTextures(a.meshes[f],e,c,d);c+=h;d-=h;g+=h}for(f=0;f<a.num_children;++f)h=b.XModelNodeUtils.getTextures(a.children[f],e,c,d),c+=h,d-=h,g+=h}return g};b.XModelNodeUtils.releaseTextures=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseTextures(a.meshes[e]);for(e=0;e<a.num_children;++e)b.XModelNodeUtils.releaseTextures(a.children[e])}};
b.XModelNodeUtils.getMeshes=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_meshes;++f){var h=a.meshes[f];null!=h&&(null!=e&&0<d&&(e[c++]=h,d--),g++)}for(f=0;f<a.num_children;++f)h=b.XModelNodeUtils.getMeshes(a.children[f],e,c,d),c+=h,d-=h,g+=h}return g};b.XModelNodeUtils.releaseShapes=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseShape(a.meshes[e]);for(e=0;e<a.num_children;++e)b.XModelNodeUtils.releaseShapes(a.children[e])}};b.XModelNodeUtils.getNodes=
function(a,e,c,d){var g=0;if(null!=a){null!=e&&0<d&&(e[c++]=a,d--);g++;for(var f=0;f<a.num_children;++f){var h=b.XModelNodeUtils.getNodes(a.children[f],e,c,d);c+=h;d-=h;g+=h}}return g};b.XModelNodeUtils.updateParent=function(a,e){if(null!=a){a.parent=e;for(var c=0;c<a.num_meshes;++c)a.meshes[c].parent=a;for(c=0;c<a.num_children;++c)b.XModelNodeUtils.updateParent(a.children[c],a)}};b.XModelNodeUtils.updateCombinationp=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z){if(null!=a){b.Matrix4x4.load(a.combined_matrix,
0,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z);for(var A=0;A<b.XModelNode.NUM_TRANSFORMS;++A)b.XModelTransformUtils.applyTransform(a.transforms[A],a.combined_matrix,0);g=a.combined_matrix[b.Geometry.M4X4_00];f=a.combined_matrix[b.Geometry.M4X4_01];h=a.combined_matrix[b.Geometry.M4X4_02];m=a.combined_matrix[b.Geometry.M4X4_03];k=a.combined_matrix[b.Geometry.M4X4_10];l=a.combined_matrix[b.Geometry.M4X4_11];n=a.combined_matrix[b.Geometry.M4X4_12];p=a.combined_matrix[b.Geometry.M4X4_13];q=a.combined_matrix[b.Geometry.M4X4_20];
r=a.combined_matrix[b.Geometry.M4X4_21];u=a.combined_matrix[b.Geometry.M4X4_22];x=a.combined_matrix[b.Geometry.M4X4_23];v=a.combined_matrix[b.Geometry.M4X4_30];y=a.combined_matrix[b.Geometry.M4X4_31];w=a.combined_matrix[b.Geometry.M4X4_32];z=a.combined_matrix[b.Geometry.M4X4_33];for(A=0;A<e;++A)a=c[d+A],b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,g,f,h,m,k,l,n,p,q,r,u,x,v,y,w,z)}};b.XModelNodeUtils.updateCombinationv=function(a,e,c,d,g,f){b.XModelNodeUtils.updateCombinationp(a,
e,c,d,g[f+b.Geometry.M4X4_00],g[f+b.Geometry.M4X4_01],g[f+b.Geometry.M4X4_02],g[f+b.Geometry.M4X4_03],g[f+b.Geometry.M4X4_10],g[f+b.Geometry.M4X4_11],g[f+b.Geometry.M4X4_12],g[f+b.Geometry.M4X4_13],g[f+b.Geometry.M4X4_20],g[f+b.Geometry.M4X4_21],g[f+b.Geometry.M4X4_22],g[f+b.Geometry.M4X4_23],g[f+b.Geometry.M4X4_30],g[f+b.Geometry.M4X4_31],g[f+b.Geometry.M4X4_32],g[f+b.Geometry.M4X4_33])};b.XModelNodeUtils.updateCombination=function(a,e,c,d){b.XModelNodeUtils.updateCombinationp(a,e,c,d,1,0,0,0,0,
1,0,0,0,0,1,0,0,0,0,1)};b.XModelNodeUtils.updateCombinationAllp=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v){null!=a&&b.XModelNodeUtils.updateCombinationp(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v)};b.XModelNodeUtils.updateCombinationAllv=function(a,e,c){null!=a&&b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,e[c+b.Geometry.M4X4_00],e[c+b.Geometry.M4X4_01],e[c+b.Geometry.M4X4_02],e[c+b.Geometry.M4X4_03],e[c+b.Geometry.M4X4_10],e[c+b.Geometry.M4X4_11],e[c+b.Geometry.M4X4_12],e[c+b.Geometry.M4X4_13],
e[c+b.Geometry.M4X4_20],e[c+b.Geometry.M4X4_21],e[c+b.Geometry.M4X4_22],e[c+b.Geometry.M4X4_23],e[c+b.Geometry.M4X4_30],e[c+b.Geometry.M4X4_31],e[c+b.Geometry.M4X4_32],e[c+b.Geometry.M4X4_33])};b.XModelNodeUtils.updateCombinationAll=function(a){null!=a&&b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};b.XModelNodeUtils.updateOffset=function(a){if(null!=a){b.Matrix4x4.inversev(a.offset_matrix,0,a.combined_matrix,0);for(var e=0;e<a.num_children;++e)b.XModelNodeUtils.updateOffset(a.children[e])}};
b.XModelNodeUtils.applyKinematics=function(a){if(null!=a){for(var e=0;e<a.num_iks;++e){var c=a.iks[e];null!=c&&b.XModelKinematicsUtils.applyInverseKinematices(a,c.target,c.max_iterations,c.chain_length,1E-4*Math.PI)}for(e=0;e<a.num_children;++e)b.XModelNodeUtils.applyKinematics(a.children[e])}};b.XModelNodeUtils.resetTransforms=function(a){if(null!=a){for(var e=0;e<b.XModelNode.NUM_TRANSFORMS;++e)b.XModelTransformUtils.resetTransform(a.transforms[e]);for(e=0;e<a.num_children;++e)b.XModelNodeUtils.resetTransforms(a.children[e])}};
b.XModelNodeUtils.forEachMesh=function(a,e,c){if(null!=a){for(var d=0;d<a.num_meshes;++d){var g=a.meshes[d];null!=g&&e(g,c)}for(d=0;d<a.num_children;++d)b.XModelNodeUtils.forEachMesh(a.children[d],e,c)}};b.XModelNodeUtils.forEachNode=function(a,e,c,d){if(null!=a){e(a,c,d);c+=1;for(var g=0;g<a.num_children;++g)b.XModelNodeUtils.forEachNode(a.children[g],e,c,d)}}})(xpl);(function(b){b.XModelContainerUtils=function(){};b.XModelContainerUtils.getTextures=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_textures;++f){var h=a.textures[f];null!=h&&(null!=e&&0<d&&(e[c++]=h,d--),g++)}for(f=0;f<a.num_materials;++f)h=b.XModelMaterialUtils.getTextures(a.materials[f],e,c,d),c+=h,d-=h,g+=h;for(f=0;f<a.num_meshes;++f)h=b.XModelMeshUtils.getTextures(a.meshes[f],e,c,d),c+=h,d-=h,g+=h;for(f=0;f<a.num_nodes;++f)h=b.XModelNodeUtils.getTextures(a.nodes[f],e,c,d),c+=h,d-=h,
g+=h}return g};b.XModelContainerUtils.releaseTextures=function(a){if(null!=a){for(var e=0;e<a.num_textures;++e){var c=a.textures[e];null!=c&&(c.data=null,c.data_size=0)}for(e=0;e<a.num_materials;++e)b.XModelMaterialUtils.releaseTexture(a.materials[e]);for(e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseTextures(a.meshes[e]);for(e=0;e<a.num_nodes;++e)b.XModelNodeUtils.releaseTextures(a.nodes[e])}};b.XModelContainerUtils.getMeshes=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_meshes;++f){var h=
a.meshes[f];null!=h&&(null!=e&&0<d&&(e[c++]=h,d--),g++)}for(f=0;f<a.num_nodes;++f)h=b.XModelNodeUtils.getMeshes(node,e,c,d),c+=h,d-=h,g+=h}return g};b.XModelContainerUtils.releaseShapes=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseShape(a.meshes[e]);for(e=0;e<a.num_nodes;++e)b.XModelNodeUtils.releaseShapes(a.nodes[e])}};b.XModelContainerUtils.getNodes=function(a,e,c,d){var g=0;if(null!=a)for(var f=0;f<a.num_nodes;++f){var h=b.XModelNodeUtils.getNodes(a.nodes[f],
e,c,d);c+=h;d-=h;g+=h}return g};b.XModelContainerUtils.updateParent=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e){var c=a.meshes[e];null!=c&&(c.parent=null)}for(e=0;e<a.num_nodes;++e)b.XModelNodeUtils.updateParent(a.nodes[e],null)}};b.XModelContainerUtils.updateCombinationp=function(a,e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v){if(null!=a)for(var y=0;y<a.num_nodes;++y)b.XModelNodeUtils.updateCombinationAllp(a.nodes[y],e,c,d,g,f,h,m,k,l,n,p,q,r,u,x,v)};b.XModelContainerUtils.updateCombinationv=function(a,
e,c){if(null!=a)for(var d=0;d<a.num_nodes;++d)b.XModelNodeUtils.updateCombinationAllv(a.nodes[d],e,c)};b.XModelContainerUtils.updateCombination=function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.updateCombinationAll(a.nodes[e])};b.XModelContainerUtils.updateOffset=function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.updateOffset(a.nodes[e])};b.XModelContainerUtils.setAnimation=function(a,e,c,d){if(null!=a&&0<=e&&e<a.num_animation_sets){e=a.animation_sets[e];var g=
b.XModelAnimationUtils.getAnimationSetTotalTime(e);c*=a.time_rate;0<g&&d?c%=g:b.MathUtils.mid(0,g,c);b.XModelAnimationUtils.setAnimationSet(e,c)}};b.XModelContainerUtils.getAnimationTotalTime=function(a,e){return null!=a&&0<=e&&e<a.num_animation_sets?b.XModelAnimationUtils.getAnimationSetTotalTime(a.animation_sets[e])/a.time_rate:0};b.XModelContainerUtils.applyKinematics=function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.applyKinematics(a.nodes[e])};b.XModelContainerUtils.resetTransforms=
function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.resetTransforms(a.nodes[e])};b.XModelContainerUtils.resetOffset=function(a){b.XModelContainerUtils.resetTransforms(a);b.XModelContainerUtils.updateCombination(a);b.XModelContainerUtils.updateOffset(a)};b.XModelContainerUtils.forEachMesh=function(a,e,c){if(null!=a){for(var d=0;d<a.num_meshes;++d){var g=a.meshes[d];null!=g&&e(g,c)}for(d=0;d<a.num_nodes;++d)b.XModelNodeUtils.forEachMesh(a.nodes[d],e,c)}};b.XModelContainerUtils.forEachNode=
function(a,e,c){if(null!=a)for(var d=0;d<a.num_nodes;++d)b.XModelNodeUtils.forEachNode(a.nodes[d],e,0,c)}})(xpl);(function(b){b.XModelOptimizeUtils=function(){};b.XModelOptimizeUtils.optimizeMeshVertices=function(a){};b.XModelOptimizeUtils.optimizeMeshElements=function(a){};var a=function(){this.bones=[];this.vertices=[];this.elements=[]};a.prototype.addBone=function(a){var c=b.ArrayUtils.binarySearch(this.bones,0,this.bones.length,a);0>c&&this.bones.splice(-c-1,0,a)};a.prototype.addVertex=function(a){var c=b.ArrayUtils.binarySearch(this.vertices,0,this.vertices.length,a);0>c&&this.vertices.splice(-c-1,0,a)};
a.prototype.addElement=function(a){var c=b.ArrayUtils.binarySearch(this.elements,0,this.elements.length,a);0>c&&this.elements.splice(-c-1,0,a)};a.prototype.merge=function(a,b,d,g){if(b)for(b=0;b<a.bones.length;++b)this.addBone(a.bones[b]);if(d)for(b=0;b<a.vertices.length;++b)this.addVertex(a.vertices[b]);if(g)for(b=0;b<a.elements.length;++b)this.addElement(a.elements[b])};b.XModelOptimizeUtils.optimizeMeshSkinForMatrixPallet=function(e,c){if(null!=e&&null!=e.skin&&c<e.skin.num_nodes){if(void 0===
c||16>c)c=16;for(var d={},g=0;g<e.num_elements;++g){var f=new a;f.addElement(g);for(var h=e.elements[g],m=0;m<h.num_vertices;++m){var k=h.vertices[m];f.addVertex(k);for(var k=e.vertices[k],l=e.skin.weighted_index_stride*k.skinning,n=e.skin.weighted_index_sizes[k.skinning],k=0;k<n;++k)f.addBone(e.skin.indices[l+k])}m="["+f.bones.toString()+"]";void 0!==d[m]?d[m].merge(f,!1,!0,!0):d[m]=f}h=[];for(m in d)h.push(d[m]);h.sort(function(a,b){return b.bones.length-a.bones.length});for(g=h.length-1;0<=g;--g)for(f=
h[g],m=0;m<g;++m)if(k=h[m],b.ArrayUtils.isContained(k.bones,0,k.bones.length,f.bones,0,f.bones.length)){k.merge(f,!1,!0,!0);delete h[g];break}for(g=0;g<h.length-1;++g)if(f=h[g],void 0!==f&&f.bones.length<=c)for(m=g+1;m<h.length&&f.bones.length<c;++m)k=h[m],void 0!==k&&f.bones.length+k.bones.length<=c&&(f.merge(k,!0,!0,!0),delete h[m]);h=h.filter(function(a){return void 0!==a});e.num_subsets=h.length;e.subsets=Array(e.num_subsets);for(g=0;g<e.num_subsets;++g)for(f=h[g],d=new b.XModelMeshSubset,e.subsets[g]=
d,d.num_bones=f.bones.length,d.bones=new Uint16Array(f.bones),d.num_vertices=f.vertices.length,d.vertices=new Uint32Array(f.vertices),d.num_elements=f.elements.length,d.elements=Array(d.num_elements),m=0;m<f.elements.length;++m)for(l=e.elements[f.elements[m]],n=new b.XModelElement,d.elements[m]=n,n.material=l.material,n.num_vertices=l.num_vertices,n.vertices=new Uint32Array(n.num_vertices),k=0;k<n.num_vertices;++k){var p=b.ArrayUtils.binarySearch(d.vertices,0,d.num_vertices,l.vertices[k]);n.vertices[k]=
0<=p?p:0}}};b.XModelOptimizeUtils.optimizeMeshSkinForWeightedIndices=function(a,b){}})(xpl);(function(b){b.XModelWrapper=function(){this._container=null;this.__prev_anim_index=-1;this.__min_bounds=new Float32Array([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]);this.__max_bounds=new Float32Array([-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]);this.__is_canseled=this.__is_completed=!1};Object.defineProperties(b.XModelWrapper.prototype,{container:{get:function(){return this._container}},isCompleted:{get:function(){return this.__is_completed}},isCanceled:{get:function(){return this.__is_canseled}},
numAnimationSets:{get:function(){return null!=this._container?this._container.num_animation_sets:0}}});b.XModelWrapper.prototype._complete=function(){this.__is_completed=!0;b.XModelContainerUtils.forEachMesh(this._container,function(a,b){for(var c=0;c<a.num_positions;++c)for(var d=0;d<a.position_size;++d){var g=a.positions[a.position_size*c+d];this.__min_bounds[d]=Math.min(this.__min_bounds[d],g);this.__max_bounds[d]=Math.max(this.__max_bounds[d],g)}}.bind(this),null)};b.XModelWrapper.prototype.cancel=
function(){this.__is_canseled=!0};b.XModelWrapper.prototype.getMinBound=function(a){return this.__min_bounds[a]};b.XModelWrapper.prototype.getMaxBound=function(a){return this.__max_bounds[a]};b.XModelWrapper.prototype.getSize=function(a){return this.__max_bounds[a]-this.__min_bounds[a]};b.XModelWrapper.prototype.getCenter=function(a){return.5*(this.__min_bounds[a]+this.__max_bounds[a])};b.XModelWrapper.prototype.resetPose=function(){b.XModelContainerUtils.resetTransforms(this._container);b.XModelContainerUtils.updateCombination(this._container)};
b.XModelWrapper.prototype.setAnimation=function(a,e,c,d){void 0==d&&(d=!1);void 0==c&&(c=!1);this.__prev_anim_index!=a?(this.__prev_anim_index=a,this.resetPose()):b.XModelContainerUtils.resetTransforms(this._container);b.XModelContainerUtils.setAnimation(this._container,a,e,c);d&&b.XModelContainerUtils.applyKinematics(this._container);b.XModelContainerUtils.updateCombination(this._container)};b.XModelWrapper.prototype.dispose=function(){this.cancel();this.__is_completed=!1}})(xpl);
(function(b){b.XModelWrapperGL=function(){b.XModelWrapper.call(this);this.__white_texture=this.__config=null;this.__remain_textures=0;this.__is_update_anim=!1};Object.setPrototypeOf(b.XModelWrapperGL.prototype,b.XModelWrapper.prototype);Object.defineProperties(b.XModelWrapperGL,{CONFIG_MEMORY_ALIGNMENT_SIZE:{value:"memory_alignment_size"},CONFIG_USE_VERTEX_ARRAY_OBJECT:{value:"use_vertex_array_object"},CONFIG_USE_MIPMAP_TEXTURE:{value:"use_mipmap_texture"},CONFIG_USE_SKINNING:{value:"use_skinning"},
CONFIG_GPU_SKINNING:{value:"gpu_skinning"},CONFIG_MAX_BONE_WEIGHTED_INDICES:{value:"max_bone_weighted_indices"},CONFIG_MAX_BONE_MATRICES:{value:"max_bone_matrices"},CONFIG_PATH_ALIAS:{value:"path_alias"},CONFIG_USE_MORFING:{value:"use_mofing"},CONFIG_GPU_MORFING:{value:"gpu_morfing"},UNIFORM_DIFFUSE:{value:"d_diffuse"},UNIFORM_DIFFUSE_MAP:{value:"u_diffuse_map"},UNIFORM_SPECULAR:{value:"u_specular"},UNIFORM_SPECULAR_MAP:{value:"u_specular_map"},UNIFORM_BONE_MATRICES:{value:"u_bone_matrices"},ATTRIBUTE_POSITION:{value:"a_position"},
ATTRIBUTE_NORMAL:{value:"a_normal"},ATTRIBUTE_COLOR:{value:"a_color"},ATTRIBUTE_TEXCOORD:{value:"a_tex_coord"},ATTRIBUTE_BONEINDICES:{value:"a_bone_indices"},ATTRIBUTE_BONEWEIGHTS:{value:"a_bone_weights"}});var a=b.XModelWrapperGL;b.XModelWrapperGL.defaultConfig=function(){var b={};b[a.CONFIG_MEMORY_ALIGNMENT_SIZE]=4;b[a.CONFIG_USE_VERTEX_ARRAY_OBJECT]=!1;b[a.CONFIG_USE_MIPMAP_TEXTURE]=!1;b[a.CONFIG_USE_SKINNING]=!1;b[a.CONFIG_GPU_SKINNING]=!1;b[a.CONFIG_MAX_BONE_MATRICES]=32;b[a.CONFIG_MAX_BONE_WEIGHTED_INDICES]=
4;b[a.CONFIG_USE_MORFING]=!1;b[a.CONFIG_GPU_MORFING]=!1;b[a.CONFIG_PATH_ALIAS]=null;return b};b.XModelWrapperGL.copyConfig=function(b){for(var c={},f=$jscomp.makeIterator([a.CONFIG_MEMORY_ALIGNMENT_SIZE,a.CONFIG_USE_VERTEX_ARRAY_OBJECT,a.CONFIG_USE_MIPMAP_TEXTURE,a.CONFIG_USE_SKINNING,a.CONFIG_GPU_SKINNING,a.CONFIG_MAX_BONE_MATRICES,a.CONFIG_MAX_BONE_WEIGHTED_INDICES,a.CONFIG_USE_MORFING,a.CONFIG_GPU_MORFING,a.CONFIG_PATH_ALIAS]),e=f.next();!e.done;e=f.next())e=e.value,c[e]=b[e];return c};b.XModelWrapperGL.defaultUniforms=
function(){var b={};b[a.UNIFORM_DIFFUSE]=0;b[a.UNIFORM_DIFFUSE_MAP]=0;return b};b.XModelWrapperGL.defaultAttributes=function(){var b={};b[a.ATTRIBUTE_POSITION]=-1;b[a.ATTRIBUTE_NORMAL]=-1;b[a.ATTRIBUTE_COLOR]=-1;b[a.ATTRIBUTE_TEXCOORD]=-1;b[a.ATTRIBUTE_BONEINDICES]=-1;b[a.ATTRIBUTE_BONEWEIGHTS]=-1;return b};var e=function(d,e,f,h,m){if(null==e.getExtension("OES_element_index_uint"))throw Error("Required the OES_element_index_uint");null==h&&(h="");var k=new XMLHttpRequest,l=0;k.open("GET",h+f,!0);
k.responseType="arraybuffer";k.onload=function(d){if(!this.isCanceled)if(200==d.target.status)if(this._container=(new b.XModelDecoder).decode(d.target.response),null!=this._container){b.XModelContainerUtils.forEachMesh(this._container,function(d,c){xpl.XModelOptimizeUtils.optimizeMeshSkinForMatrixPallet(d,16);var f=!m[a.CONFIG_USE_SKINNING]||m[a.CONFIG_GPU_SKINNING],h,k,n,p;m[a.CONFIG_USE_SKINNING]&&m[a.CONFIG_GPU_SKINNING]?(h=2,k=b.XModelMeshUtils.TYPE_UNSIGNED_SHORT,n=4,p=b.XModelMeshUtils.TYPE_FLOAT):
(h=0,k=b.XModelMeshUtils.TYPE_VOID,n=0,p=b.XModelMeshUtils.TYPE_VOID);var z=new Int32Array(b.XModelMeshUtils.MAX_ATTRIBUTE),f=b.XModelMeshUtils.getVerticesSize(d,f,m[a.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,1,4,0,h,n,z,0),f=new ArrayBuffer(f);b.XModelMeshUtils.getVertices(d,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_UNSIGNED_BYTE,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_VOID,k,p,z,0,f,0);null!=d.skin&&(l=Math.max(d.skin.num_nodes,l));var A,E,G,B,D;(k=m[a.CONFIG_USE_SKINNING]&&
!m[a.CONFIG_GPU_SKINNING]&&null!=d.skin&&0<d.skin.num_nodes)?(D=new Int32Array(b.XModelMeshUtils.MAX_ATTRIBUTE),p=b.XModelMeshUtils.getVerticesSize(d,!1,m[a.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,0,0,0,2,4,D,0),p=new ArrayBuffer(p),h=new Float32Array(p,D[b.XModelMeshUtils.ATTRIBUTE_POSITION]),n=new Float32Array(p,D[b.XModelMeshUtils.ATTRIBUTE_NORMAL]),A=new Uint16Array(p,D[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),E=new Float32Array(p,D[b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]),b.XModelMeshUtils.getVertices(d,
b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_UNSIGNED_SHORT,b.XModelMeshUtils.TYPE_FLOAT,D,0,p,0),G=new ArrayBuffer(D[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),B=new Float32Array(G,D[b.XModelMeshUtils.ATTRIBUTE_POSITION]),D=new Float32Array(G,D[b.XModelMeshUtils.ATTRIBUTE_NORMAL])):D=B=G=E=A=n=h=p=null;var H=new Int32Array(d.num_materials+1),F=new Uint32Array(d.num_materials+1),
K=b.XModelMeshUtils.getNumAllTriangledFaceIndices(d,H,0,F,0),K=new Uint32Array(K);b.XModelMeshUtils.getAllTriangledFaceIndices(d,!0,H,0,K,0);d.vertex_buffer=b.GLUtils.createBuffer(e,e.ARRAY_BUFFER,f,k?e.STREAM_DRAW:e.STATIC_DRAW);d.element_buffer=b.GLUtils.createBuffer(e,e.ELEMENT_ARRAY_BUFFER,K.buffer,e.STATIC_DRAW);d.user_object={vertices_offsets:z,src_vertices:p,src_positions:h,src_normals:n,src_bone_indices:A,src_bone_weights:E,dest_vertices:G,dest_positions:B,dest_normals:D,elements_offsets:H,
elements_sizes:F}},null);0<l&&(this.__matrix_pallet=new Float32Array(b.Geometry.SIZE_MATRIX_4X4*l),this.resetPose());var f=b.XModelContainerUtils.getTextures(this._container,null,0,0);d=Array(f);b.XModelContainerUtils.getTextures(this._container,d,0,f);d=b.ArrayUtils.convertToSet(d,0,d.length,function(a,b){return a.name==b.name});this.__remain_textures=d.length;for(f=0;f<d.length;++f)c(this,e,d[f],h,m);0>=this.__remain_textures&&this._complete()}else this.cancel();else this.cancel()}.bind(d);k.send()},
c=function(d,c,f,e,m){var k=new XMLHttpRequest;null!=m[a.CONFIG_PATH_ALIAS]&&null!=m[a.CONFIG_PATH_ALIAS][f.ref]?k.open("GET",m[a.CONFIG_PATH_ALIAS][f.ref],!0):k.open("GET",e+f.ref,!0);k.responseType="blob";k.onload=function(e){if(!d.isCanceled){if(200==e.target.status){e=e.target.response;var h=new Image;h.onload=function(){f.texture=b.GLUtils.createTexture2DFromImage(c,c.RGBA,c.UNSIGNED_BYTE,h);c.bindTexture(c.TEXTURE_2D,f.texture);m[a.CONFIG_USE_MIPMAP_TEXTURE]&&c.generateMipmap(c.TEXTURE_2D);
c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.MIRRORED_REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.MIRRORED_REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR)};h.src=URL.createObjectURL(e)}this.__remain_textures--;0>=this.__remain_textures&&this._complete()}}.bind(d);k.send()};b.XModelWrapperGL.prototype.initializeWithUrl=function(a,c,f,h){this.__white_texture=b.GLUtils.createTexture2D(a,a.RGBA,a.UNSIGNED_BYTE,
1,1,new Uint8Array([255,255,255,255]),!1,null,0);this.__config=b.XModelWrapperGL.copyConfig(h);e(this,a,c,f,this.__config)};b.XModelWrapperGL.prototype.setAnimation=function(a,c,f,e){b.XModelWrapper.prototype.setAnimation.call(this,a,c,f,e);this.__is_update_anim=!0};b.XModelWrapperGL.prototype._complete=function(){b.XModelWrapper.prototype._complete.call(this);b.XModelContainerUtils.releaseShapes(this._container)};b.XModelWrapperGL.prototype.draw=function(c,e,f){b.XModelContainerUtils.forEachMesh(this._container,
function(h,m){c.bindBuffer(c.ARRAY_BUFFER,h.vertex_buffer);var k=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE],l=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_POSITION];-1!=f.a_position&&-1!=l&&(c.enableVertexAttribArray(f.a_position),c.vertexAttribPointer(f.a_position,h.position_size,c.FLOAT,!1,k,l));l=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_NORMAL];-1!=f.a_normal&&-1!=l&&(c.enableVertexAttribArray(f.a_normal),c.vertexAttribPointer(f.a_normal,
h.normal_size,c.FLOAT,!1,k,l));l=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_COLOR];-1!=f.a_color&&-1!=l&&(c.enableVertexAttribArray(f.a_color),c.vertexAttribPointer(f.a_color,h.color_size,c.UNSIGNED_BYTE,!1,k,l));l=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_TEXCOORD];-1!=f.a_tex_coord&&-1!=l&&(c.enableVertexAttribArray(f.a_tex_coord),c.vertexAttribPointer(f.a_tex_coord,h.tex_coord_size,c.FLOAT,!1,k,l));null!=h.skin&&this.__config[a.CONFIG_USE_SKINNING]&&(l=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES],
-1!=f.a_bone_indices&&-1!=l&&(c.enableVertexAttribArray(f.a_bone_indices),c.vertexAttribPointer(f.a_bone_indices,h.skin.weighted_index_stride,c.UNSIGNED_SHORT,!1,k,l)),l=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS],-1!=f.a_bone_weights&&-1!=l&&(c.enableVertexAttribArray(f.a_bone_weights),c.vertexAttribPointer(f.a_bone_weights,h.skin.weighted_index_stride,c.FLOAT,!1,k,l)));if(null!=h.skin&&this.__config[a.CONFIG_USE_SKINNING])if(null!=h.user_object.src_vertices&&this.__is_update_anim){b.XModelSkinUtils.updateMatrixPallet(h.skin,
h.skin.num_nodes,this.__matrix_pallet,0);-1!=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_POSITION]&&b.XModelSkinUtils.updatePositions(this.__matrix_pallet,0,h.num_vertices,h.user_object.src_positions,0,0,h.user_object.dest_positions,0,0,h.skin.weighted_index_stride,h.user_object.src_bone_indices,0,0,h.user_object.src_bone_weights,0,0);if(-1!=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_NORMAL]){for(k=0;k<h.skin.num_nodes;++k)l=b.Geometry.SIZE_MATRIX_4X4*k,b.Matrix4x4.loadAxisv(this.__matrix_pallet,
l,this.__matrix_pallet,l,!1),b.Matrix4x4.normalizeAxisv(this.__matrix_pallet,l,this.__matrix_pallet,l,!0);b.XModelSkinUtils.updateNormals(this.__matrix_pallet,0,h.num_vertices,h.user_object.src_normals,0,0,h.user_object.dest_normals,0,0,h.skin.weighted_index_stride,h.user_object.src_bone_indices,0,0,h.user_object.src_bone_weights,0,0)}c.bufferSubData(c.ARRAY_BUFFER,0,h.user_object.dest_vertices);this.__is_update_anim=!1}else b.XModelSkinUtils.updateMatrixPallet(h.skin,h.skin.num_nodes,this.__matrix_pallet,
0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.element_buffer);for(k=0;k<h.num_materials;++k)l=h.materials[k],null!=e.u_ambient_map?(c.activeTexture(c.TEXTURE1),c.uniform1i(e.u_ambient_map,0),null!=l.ambient_map&&null!=l.ambient_map.texture?(c.uniform4fv(e.u_ambient_map,l.ambient),c.bindTexture(c.TEXTURE_2D,l.ambient_map.texture)):(c.uniform4f(e.u_ambient_color,1,1,1,1),c.bindTexture(c.TEXTURE_2D,this.__white_texture))):null!=e.u_ambient_color&&c.uniform4f(e.u_ambient_color,1,1,1,1),null!=e.u_diffuse_map?
(c.activeTexture(c.TEXTURE0),c.uniform1i(e.u_diffuse_map,0),null!=l.diffuse_map&&null!=l.diffuse_map.texture?(c.uniform4fv(e.u_diffuse_color,l.diffuse),c.bindTexture(c.TEXTURE_2D,l.diffuse_map.texture)):(c.uniform4f(e.u_diffuse_color,1,1,1,1),c.bindTexture(c.TEXTURE_2D,this.__white_texture))):null!=e.u_diffuse_color&&c.uniform4f(e.u_diffuse_color,1,1,1,1),c.drawElements(c.TRIANGLES,h.user_object.elements_sizes[k],c.UNSIGNED_INT,4*h.user_object.elements_offsets[k]);-1!=f.a_position&&c.disableVertexAttribArray(f.a_position);
-1!=f.a_normal&&c.disableVertexAttribArray(f.a_normal);-1!=f.a_color&&c.disableVertexAttribArray(f.a_color);-1!=f.a_tex_coord&&c.disableVertexAttribArray(f.a_tex_coord);-1!=f.a_bone_indices&&c.disableVertexAttribArray(f.a_bone_indices);-1!=f.a_bone_weights&&c.disableVertexAttribArray(f.a_bone_weights)}.bind(this),null)};b.XModelWrapperGL.prototype.dispose=function(a){b.XModelWrapper.prototype.dispose.call(this);b.XModelContainerUtils.forEachMesh(this._container,function(b,c){null!=b.vertex_buffer&&
(a.deleteBuffer(b.vertex_buffer),b.vertex_buffer=null);null!=b.element_buffer&&(a.deleteBuffer(b.element_buffer),b.element_buffer=null)},null);a.deleteTexture(this.__white_texture);for(var c=b.XModelContainerUtils.getTextures(this._container,null,0,0),f=Array(c),e=0;e<c;++e){var m=f[e];null!=m&&(a.deleteTexture(m.texture),m.texture=null)}}})(xpl);
