/*


 Copyright (c) 2016, Syuuhei Kuno
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this
 list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice,
 this list of conditions and the following disclaimer in the documentation
 and/or other materials provided with the distribution.

 3. Neither the name of xplain_for_js nor the names of its
 contributors may be used to endorse or promote products derived from
 this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp={scope:{},getGlobal:function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global?global:b}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return"jscomp_symbol_"+b+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=b[Symbol.iterator];if(a)return a.call(b);var e=0;return{next:function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}}}};
$jscomp.arrayFromIterator=function(b){for(var a,e=[];!(a=b.next()).done;)e.push(a.value);return e};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.inherits=function(b,a){function e(){}e.prototype=a.prototype;b.prototype=new e;b.prototype.constructor=b;for(var c in a)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(a,c);d&&Object.defineProperty(b,c,d)}else b[c]=a[c]};$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var e=0,c={next:function(){if(e<b.length){var d=e++;return{value:a(d,b[d]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};$jscomp.initSymbol();$jscomp.initSymbolIterator();c[Symbol.iterator]=function(){return c};return c};
$jscomp.findInternal=function(b,a,e){b instanceof String&&(b=String(b));for(var c=b.length,d=0;d<c;d++){var g=b[d];if(a.call(e,g,d,b))return{i:d,v:g}}return{i:-1,v:void 0}};
$jscomp.array.from=function(b,a,e){$jscomp.initSymbolIterator();a=null!=a?a:function(a){return a};var c=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=b[Symbol.iterator];"function"==typeof d&&(b=d.call(b));if("function"==typeof b.next)for(;!(d=b.next()).done;)c.push(a.call(e,d.value));else for(var d=b.length,g=0;g<d;g++)c.push(a.call(e,b[g]));return c};$jscomp.array.of=function(b){return $jscomp.array.from(arguments)};
$jscomp.array.entries=function(){return $jscomp.iteratorFromArray(this,function(b,a){return[b,a]})};$jscomp.array.installHelper_=function(b,a){!Array.prototype[b]&&Object.defineProperties&&Object.defineProperty&&Object.defineProperty(Array.prototype,b,{configurable:!0,enumerable:!1,writable:!0,value:a})};$jscomp.array.entries$install=function(){$jscomp.array.installHelper_("entries",$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.iteratorFromArray(this,function(b){return b})};
$jscomp.array.keys$install=function(){$jscomp.array.installHelper_("keys",$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})};$jscomp.array.values$install=function(){$jscomp.array.installHelper_("values",$jscomp.array.values)};
$jscomp.array.copyWithin=function(b,a,e){var c=this.length;b=Number(b);a=Number(a);e=Number(null!=e?e:c);if(b<a)for(e=Math.min(e,c);a<e;)a in this?this[b++]=this[a++]:(delete this[b++],a++);else for(e=Math.min(e,c+a-b),b+=e-a;e>a;)--e in this?this[--b]=this[e]:delete this[b];return this};$jscomp.array.copyWithin$install=function(){$jscomp.array.installHelper_("copyWithin",$jscomp.array.copyWithin)};
$jscomp.array.fill=function(b,a,e){var c=this.length||0;0>a&&(a=Math.max(0,c+a));if(null==e||e>c)e=c;e=Number(e);0>e&&(e=Math.max(0,c+e));for(a=Number(a||0);a<e;a++)this[a]=b;return this};$jscomp.array.fill$install=function(){$jscomp.array.installHelper_("fill",$jscomp.array.fill)};$jscomp.array.find=function(b,a){return $jscomp.findInternal(this,b,a).v};$jscomp.array.find$install=function(){$jscomp.array.installHelper_("find",$jscomp.array.find)};
$jscomp.array.findIndex=function(b,a){return $jscomp.findInternal(this,b,a).i};$jscomp.array.findIndex$install=function(){$jscomp.array.installHelper_("findIndex",$jscomp.array.findIndex)};$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.Map$isConformant=function(){if($jscomp.ASSUME_NO_NATIVE_MAP)return!1;var b=$jscomp.global.Map;if(!b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),e=new b($jscomp.makeIterator([[a,"s"]]));if("s"!=e.get(a)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var c=e.entries(),d=c.next();if(d.done||d.value[0]!=a||"s"!=d.value[1])return!1;d=c.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!c.next().done?!1:!0}catch(g){return!1}};
$jscomp.Map=function(b){this.data_={};this.head_=$jscomp.Map.createHead();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var a;!(a=b.next()).done;)a=a.value,this.set(a[0],a[1])}};
$jscomp.Map.prototype.set=function(b,a){var e=$jscomp.Map.maybeGetEntry(this,b);e.list||(e.list=this.data_[e.id]=[]);e.entry?e.entry.value=a:(e.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,value:a},e.list.push(e.entry),this.head_.previous.next=e.entry,this.head_.previous=e.entry,this.size++);return this};
$jscomp.Map.prototype.delete=function(b){b=$jscomp.Map.maybeGetEntry(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead();this.size=0};$jscomp.Map.prototype.has=function(b){return!!$jscomp.Map.maybeGetEntry(this,b).entry};
$jscomp.Map.prototype.get=function(b){return(b=$jscomp.Map.maybeGetEntry(this,b).entry)&&b.value};$jscomp.Map.prototype.entries=function(){return $jscomp.Map.makeIterator_(this,function(b){return[b.key,b.value]})};$jscomp.Map.prototype.keys=function(){return $jscomp.Map.makeIterator_(this,function(b){return b.key})};$jscomp.Map.prototype.values=function(){return $jscomp.Map.makeIterator_(this,function(b){return b.value})};
$jscomp.Map.prototype.forEach=function(b,a){for(var e=this.entries(),c;!(c=e.next()).done;)c=c.value,b.call(a,c[1],c[0],this)};$jscomp.Map.maybeGetEntry=function(b,a){var e=$jscomp.Map.getId(a),c=b.data_[e];if(c&&Object.prototype.hasOwnProperty.call(b.data_,e))for(b=0;b<c.length;b++){var d=c[b];if(a!==a&&d.key!==d.key||a===d.key)return{id:e,list:c,index:b,entry:d}}return{id:e,list:c,index:-1,entry:void 0}};
$jscomp.Map.makeIterator_=function(b,a){var e=b.head_,c={next:function(){if(e){for(;e.head!=b.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:a(e)};e=null}return{done:!0,value:void 0}}};$jscomp.initSymbol();$jscomp.initSymbolIterator();c[Symbol.iterator]=function(){return c};return c};$jscomp.Map.mapIndex_=0;$jscomp.Map.createHead=function(){var b={};return b.previous=b.next=b.head=b};
$jscomp.Map.getId=function(b){if(!(b instanceof Object))return"p_"+b;if(!($jscomp.Map.idKey in b))try{$jscomp.Map.defineProperty(b,$jscomp.Map.idKey,{value:++$jscomp.Map.mapIndex_})}catch(a){}return $jscomp.Map.idKey in b?b[$jscomp.Map.idKey]:"o_ "+b};$jscomp.Map.defineProperty=Object.defineProperty?function(b,a,e){Object.defineProperty(b,a,{value:String(e)})}:function(b,a,e){b[a]=String(e)};$jscomp.Map.Entry=function(){};
$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();$jscomp.Map$isConformant()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.idKey=Symbol("map-id-key"),$jscomp.Map$install=function(){})};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(b){b=Number(b)>>>0;if(0===b)return 32;var a=0;0===(b&4294901760)&&(b<<=16,a+=16);0===(b&4278190080)&&(b<<=8,a+=8);0===(b&4026531840)&&(b<<=4,a+=4);0===(b&3221225472)&&(b<<=2,a+=2);0===(b&2147483648)&&a++;return a};$jscomp.math.imul=function(b,a){b=Number(b);a=Number(a);var e=b&65535,c=a&65535;return e*c+((b>>>16&65535)*c+e*(a>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1};
$jscomp.math.log10=function(b){return Math.log(b)/Math.LN10};$jscomp.math.log2=function(b){return Math.log(b)/Math.LN2};$jscomp.math.log1p=function(b){b=Number(b);if(.25>b&&-.25<b){for(var a=b,e=1,c=b,d=0,g=1;d!=c;)a*=b,g*=-1,c=(d=c)+g*a/++e;return c}return Math.log(1+b)};$jscomp.math.expm1=function(b){b=Number(b);if(.25>b&&-.25<b){for(var a=b,e=1,c=b,d=0;d!=c;)a*=b/++e,c=(d=c)+a;return c}return Math.exp(b)-1};$jscomp.math.cosh=function(b){b=Number(b);return(Math.exp(b)+Math.exp(-b))/2};
$jscomp.math.sinh=function(b){b=Number(b);return 0===b?b:(Math.exp(b)-Math.exp(-b))/2};$jscomp.math.tanh=function(b){b=Number(b);if(0===b)return b;var a=Math.exp(-2*Math.abs(b)),a=(1-a)/(1+a);return 0>b?-a:a};$jscomp.math.acosh=function(b){b=Number(b);return Math.log(b+Math.sqrt(b*b-1))};$jscomp.math.asinh=function(b){b=Number(b);if(0===b)return b;var a=Math.log(Math.abs(b)+Math.sqrt(b*b+1));return 0>b?-a:a};
$jscomp.math.atanh=function(b){b=Number(b);return($jscomp.math.log1p(b)-$jscomp.math.log1p(-b))/2};$jscomp.math.hypot=function(b,a,e){b=Number(b);a=Number(a);var c,d,g,f=Math.max(Math.abs(b),Math.abs(a));for(c=2;c<arguments.length;c++)f=Math.max(f,Math.abs(arguments[c]));if(1E100<f||1E-100>f){b/=f;a/=f;g=b*b+a*a;for(c=2;c<arguments.length;c++)d=Number(arguments[c])/f,g+=d*d;return Math.sqrt(g)*f}g=b*b+a*a;for(c=2;c<arguments.length;c++)d=Number(arguments[c]),g+=d*d;return Math.sqrt(g)};
$jscomp.math.trunc=function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var a=Math.floor(Math.abs(b));return 0>b?-a:a};$jscomp.math.cbrt=function(b){if(0===b)return b;b=Number(b);var a=Math.pow(Math.abs(b),1/3);return 0>b?-a:a};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b};$jscomp.number.isInteger=function(b){return $jscomp.number.isFinite(b)?b===Math.floor(b):!1};
$jscomp.number.isNaN=function(b){return"number"===typeof b&&isNaN(b)};$jscomp.number.isSafeInteger=function(b){return $jscomp.number.isInteger(b)&&Math.abs(b)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=function(){return Math.pow(2,-52)}();$jscomp.number.MAX_SAFE_INTEGER=function(){return 9007199254740991}();$jscomp.number.MIN_SAFE_INTEGER=function(){return-9007199254740991}();$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(b,a){for(var e=1;e<arguments.length;e++){var c=arguments[e];if(c)for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(b[d]=c[d])}return b};$jscomp.object.is=function(b,a){return b===a?0!==b||1/b===1/a:b!==b&&a!==a};$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.Set$isConformant=function(){if($jscomp.ASSUME_NO_NATIVE_SET)return!1;var b=$jscomp.global.Set;if(!b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),e=new b($jscomp.makeIterator([a]));if(!e.has(a)||1!=e.size||e.add(a)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var c=e.entries(),d=c.next();if(d.done||d.value[0]!=a||d.value[1]!=a)return!1;d=c.next();return d.done||d.value[0]==a||4!=d.value[0].x||d.value[1]!=d.value[0]?!1:c.next().done}catch(g){return!1}};
$jscomp.Set=function(b){this.map_=new $jscomp.Map;if(b){b=$jscomp.makeIterator(b);for(var a;!(a=b.next()).done;)this.add(a.value)}this.size=this.map_.size};$jscomp.Set.prototype.add=function(b){this.map_.set(b,b);this.size=this.map_.size;return this};$jscomp.Set.prototype.delete=function(b){b=this.map_.delete(b);this.size=this.map_.size;return b};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(b){return this.map_.has(b)};
$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};$jscomp.Set.prototype.forEach=function(b,a){var e=this;this.map_.forEach(function(c){return b.call(a,c,c,e)})};$jscomp.Set$install=function(){$jscomp.Map$install();$jscomp.Set$isConformant()?$jscomp.Set=$jscomp.global.Set:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values,$jscomp.Set$install=function(){})};
$jscomp.string=$jscomp.string||{};$jscomp.checkStringArgs=function(b,a,e){if(null==b)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return b+""};
$jscomp.string.fromCodePoint=function(b){for(var a="",e=0;e<arguments.length;e++){var c=Number(arguments[e]);if(0>c||1114111<c||c!==Math.floor(c))throw new RangeError("invalid_code_point "+c);65535>=c?a+=String.fromCharCode(c):(c-=65536,a+=String.fromCharCode(c>>>10&1023|55296),a+=String.fromCharCode(c&1023|56320))}return a};
$jscomp.string.repeat=function(b){var a=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var e="";b;)if(b&1&&(e+=a),b>>>=1)a+=a;return e};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(b){var a=$jscomp.checkStringArgs(this,null,"codePointAt"),e=a.length;b=Number(b)||0;if(0<=b&&b<e){b|=0;var c=a.charCodeAt(b);if(55296>c||56319<c||b+1===e)return c;b=a.charCodeAt(b+1);return 56320>b||57343<b?c:1024*(c-55296)+b+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(b,a){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,a||0)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};$jscomp.string.startsWith=function(b,a){var e=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var c=e.length,d=b.length;a=Math.max(0,Math.min(a|0,e.length));for(var g=0;g<d&&a<c;)if(e[a++]!=b[g++])return!1;return g>=d};
$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};$jscomp.string.endsWith=function(b,a){var e=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===a&&(a=e.length);a=Math.max(0,Math.min(a|0,e.length));for(var c=b.length;0<c&&0<a;)if(e[--a]!=b[--c])return!1;return 0>=c};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
var xpl=null,xpl="object"==typeof module?module.exports:"object"==typeof exports?exports:{};
(function(b){b.defaultValue=function(a,b){return void 0===a?b:a};b.about={};Object.defineProperties(b.about,{NAME:{value:"xPlain for JavaScript"},CODE_NAME:{value:"ORBIS"},VERSION_CODE:{value:2},VERSION_NAME:{value:"0.9.1"},AUTHOR:{value:["Syuuhei Kuno"]},COPYRIGHT:{value:"Copyright (c) 2016, xPlain All rights reserved."},LICENSE:{value:"http://opensource.org/licenses/BSD-3-Clause"},REPOSITORY:{value:"git@github.com:redlily/xplain_for_js.git"}});b.getAbout=function(){return b.about.NAME+"\nVersion code: "+
b.about.VERSION_CODE+"\nVersion name: "+b.about.VERSION_NAME+"\nAuthor: "+b.about.AUTHOR+"\nCopyright: "+b.about.COPYRIGHT+"\nLicense: "+b.about.LICENSE+"\nRepository: "+b.about.REPOSITORY};b.printAbout=function(){console.log(b.getAbout)};var a=new DataView(new ArrayBuffer(8));b.Size=function(a){return Number.parseInt.apply(null,arguments)};b.Ptrdiff=function(a){return Number.parseInt.apply(null,arguments)};b.Int8=function(a){return Number.parseInt.apply(null,arguments)<<24>>24};Object.defineProperties(b.Int8,
{MIN_VALUE:{value:-Math.pow(2,7)},MAX_VALUE:{value:Math.pow(2,7)-1}});b.Uint8=function(a){return Number.parseInt.apply(null,arguments)<<24>>>24};Object.defineProperties(b.Uint8,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,8)-1}});b.Int16=function(a){return Number.parseInt.apply(null,arguments)<<16>>16};Object.defineProperties(b.Int16,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,8)-1}});b.Uint16=function(a){return Number.parseInt.apply(null,arguments)<<16>>>16};Object.defineProperties(b.Uint16,
{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,16)-1}});b.Int32=function(a){return Number.parseInt.apply(null,arguments)<<0>>0};Object.defineProperties(b.Int32,{MIN_VALUE:{value:-Math.pow(2,31)},MAX_VALUE:{value:Math.pow(2,31)-1}});b.Uint32=function(a){return Number.parseInt.apply(null,arguments)<<0>>>0};Object.defineProperties(b.Uint32,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,32)-1}});b.Float32=function(a){return Number.parseFloat.apply(null,arguments)};b.Float32.hashCode=function(b){a.setFloat64(b);
return a.getUint32(0).toString(16)};b.Float64=function(a){return Number.parseFloat.apply(null,arguments)};b.Float64.hashCode=function(b){a.setFloat64(b);return a.getUint32(0).toString(16)+a.getUint32(1).toString(16)};b.Enum=function(a){return Number.parseInt.apply(null,arguments)}})(xpl);(function(b){b.SystemUtils=function(){throw Error("Unsupported operation!");};if("object"==typeof window){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;b.SystemUtils.requestAnimationFrame=function(b){return a(b)};b.SystemUtils.cancelAnimationFrame=function(a){e(a)}}if("object"==typeof document){var c=
document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;b.SystemUtils.isSupportedFullScreen=function(a){return null!=(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen)};b.SystemUtils.requestFullScreen=function(a){if("function"==typeof a.requestFullscreen)a.requestFullscreen();else if("function"==typeof a.mozRequestFullScreen)a.mozRequestFullScreen();else if("function"==typeof a.webkitRequestFullscreen)a.webkitRequestFullscreen();
else if("function"==typeof a.msRequestFullscreen)a.msRequestFullscreen();else return!1;return!0};b.SystemUtils.isFullScreen=function(){return window.innerWidth==screen.width&&window.innerHeight==screen.height};b.SystemUtils.cancelFullScreen=function(){null!=c&&c()}}})(xpl);(function(b){b.MathUtils=function(){throw Error("Unsupported operation!");};b.MathUtils.min=function(a,b,c){return a<b?a<c?a:c:b<c?b:c};b.MathUtils.mid=function(a,b,c){return a<b?b<c?b:c<a?a:c:a<c?a:c<b?b:c};b.MathUtils.max=function(a,b,c){return a<b?b<c?c:b:a<c?c:a};b.MathUtils.log=function(a,b){return Math.log(b)/Math.log(a)};b.MathUtils.cqrt=function(a){return 0<=a?Math.pow(a,1/3):-Math.pow(-a,1/3)};b.MathUtils.floorPow2=function(a){a=Math.floor(a);a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a|=a>>
32;return a^a>>1};b.MathUtils.ceilPow2=function(a){a=Math.floor(a);--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;return(a|a>>32)+1}})(xpl);(function(b){b.ArrayUtils=function(){throw Error("Unsupported operation!");};b.ArrayUtils.copy=function(a,b,c,d,g){for(var f=0;f<g;++f)c[d+f]=a[b+f]};b.ArrayUtils.fill=function(a,b,c,d){for(;b<c;++b)a[b]=d};b.ArrayUtils.binarySearch=function(a,e,c,d,g){g=b.defaultValue(g,null);for(c--;e<=c;){var f=e+c>>1,h=a[f],h=null!=g?g(h,d):h-d;if(0>h)e=f+1;else if(0<h)c=f-1;else return f}return-(e+1)};b.ArrayUtils.convertToSet=function(a,e,c,d){d=b.defaultValue(d,null);var g=[];a:for(;e<c;++e){for(var f=a[e],
h=0;h<g.length;++h)if(null!=d?d(g[h],f):g[h]==f)continue a;g.push(f)}return g};b.ArrayUtils.isContained=function(a,e,c,d,g,f,h){h=b.defaultValue(h,null);if(f-g<=c-e){a:for(;g<f;++g){for(var k=d[g],l=e;l<c;++l)if(null!=h?0==h(a[l],k):a[l]==k)continue a;return!1}return!0}return!1}})(xpl);(function(b){b.StringUtils=function(){throw Error("Unsupported operation!");};b.StringUtils.encodeUTF8=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&c<a.length-1&&(d=(d&1023)<<10|(a.charCodeAt(++c)&1023)+65536);128>d?b.push(d):2048>d?b.push(d>>6&31|192,d>>0&63|128):65536>d?b.push(d>>12&15|224,d>>6&63|128,d>>0&63|128):2097152>d?b.push(d>>18&7|240,d>>12&63|128,d>>6&63|128,d>>0&63|128):67108864>d?b.push(d>>24&3|248,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|
128):2147483648>d&&b.push(d>>30&1|252,d>>24&63|128,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|128)}return b};b.StringUtils.decodeUTF8=function(a){for(var b="",c=0;c<a.length;){var d=255&a[c],g=0;128>d?g=0:223>d?(d=(31&d)<<6,g=1):239>d?(d=(15&d)<<12,g=2):247>d?(d=(7&d)<<18,g=3):251>d?(d=(3&d)<<24,g=4):253>d&&(d=(1&d)<<30,g=5);for(c++;0<g&&c<a.length;){var f=a[c];if(128>f)break;d|=(63&f)<<6*--g;c++}b=55295>d||57344<=d&&65535>=d?b+String.fromCharCode(d):b+String.fromCharCode(55296|d-65536>>10&1023,
56320|d&1023)}return b}})(xpl);(function(b){b.Geometry=function(){throw Error("Unsupported operation!");};Object.defineProperties(b.Geometry,{VX:{value:0},VY:{value:1},VZ:{value:2},VW:{value:3},SIZE_VECTOR_3:{value:3},CR:{value:0},CI:{value:1},CJ:{value:2},CK:{value:3},SIZE_QUATERNION:{value:4},M4X4_00:{value:0},M4X4_10:{value:1},M4X4_20:{value:2},M4X4_30:{value:3},M4X4_01:{value:4},M4X4_11:{value:5},M4X4_21:{value:6},M4X4_31:{value:7},M4X4_02:{value:8},M4X4_12:{value:9},M4X4_22:{value:10},M4X4_32:{value:11},M4X4_03:{value:12},
M4X4_13:{value:13},M4X4_23:{value:14},M4X4_33:{value:15},SIZE_MATRIX_4X4:{value:16}})})(xpl);(function(b){b.Matrix4x4=function(){throw Error("Unsupported operation!");};b.Matrix4x4.load=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w){(w=b.defaultValue(w,!1))?(a[e+0]=c,a[e+4]=h,a[e+8]=n,a[e+12]=t,a[e+1]=d,a[e+5]=k,a[e+9]=p,a[e+13]=u,a[e+2]=g,a[e+6]=l,a[e+10]=q,a[e+14]=v,a[e+3]=f,a[e+7]=m,a[e+11]=r):(a[e+0]=c,a[e+4]=d,a[e+8]=g,a[e+12]=f,a[e+1]=h,a[e+5]=k,a[e+9]=l,a[e+13]=m,a[e+2]=n,a[e+6]=p,a[e+10]=q,a[e+14]=r,a[e+3]=t,a[e+7]=u,a[e+11]=v);a[e+15]=x};b.Matrix4x4.loadv=function(a,e,c,d,g){b.Matrix4x4.load(a,
e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.loadZero=function(a,e){b.Matrix4x4.load(a,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!1)};b.Matrix4x4.loadIdentity=function(a,e){b.Matrix4x4.load(a,e,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,!1)};b.Matrix4x4.lrepv=function(a,e,c,d,g,f,h){var k=1-h;b.Matrix4x4.load(a,e,c[d+0]*k+g[f+0]*h,c[d+4]*k+g[f+4]*h,c[d+8]*k+g[f+8]*h,c[d+12]*k+g[f+12]*h,c[d+1]*k+g[f+1]*h,c[d+5]*k+g[f+5]*h,c[d+
9]*k+g[f+9]*h,c[d+13]*k+g[f+13]*h,c[d+2]*k+g[f+2]*h,c[d+6]*k+g[f+6]*h,c[d+10]*k+g[f+10]*h,c[d+14]*k+g[f+14]*h,c[d+3]*k+g[f+3]*h,c[d+7]*k+g[f+7]*h,c[d+11]*k+g[f+11]*h,c[d+15]*k+g[f+15]*h,!1)};b.Matrix4x4.transposev=function(a,b,c,d){var g=c[d+4],f=c[d+8],h=c[d+12],k=c[d+1],l=c[d+5],m=c[d+9],n=c[d+13],p=c[d+2],q=c[d+6],r=c[d+10],t=c[d+14],u=c[d+3],v=c[d+7],x=c[d+11],w=c[d+15];a[b+0]=c[d+0];a[b+4]=k;a[b+8]=p;a[b+12]=u;a[b+1]=g;a[b+5]=l;a[b+9]=q;a[b+13]=v;a[b+2]=f;a[b+6]=m;a[b+10]=r;a[b+14]=x;a[b+3]=
h;a[b+7]=n;a[b+11]=t;a[b+15]=w};b.Matrix4x4.determinant=function(a,b){var c=a[b+1],d=a[b+5],g=a[b+9],f=a[b+13],h=a[b+2],k=a[b+6],l=a[b+10],m=a[b+14],n=a[b+3],p=a[b+7],q=a[b+11],r=a[b+15];return a[b+0]*(d*(l*r-m*q)+g*(m*p-k*r)+f*(k*q-l*p))+a[b+4]*(c*(m*q-l*r)+g*(h*r-m*n)+f*(l*n-h*q))+a[b+8]*(c*(k*r-m*p)+d*(m*n-h*r)+f*(h*p-k*n))+a[b+12]*(c*(l*p-k*q)+d*(h*q-l*n)+g*(k*n-h*p))};b.Matrix4x4.inversev=function(a,e,c,d){var g=c[d+0],f=c[d+4],h=c[d+8],k=c[d+12],l=c[d+1],m=c[d+5],n=c[d+9],p=c[d+13],q=c[d+2],
r=c[d+6],t=c[d+10],u=c[d+14],v=c[d+3],x=c[d+7],w=c[d+11],B=c[d+15];c=l*r;d=l*t;var E=l*u,F=l*x,H=l*w,C=l*B,K=m*q,G=m*t,z=m*u,J=m*v,A=m*w,y=m*B,M=n*q,L=n*r,I=n*u,D=n*v,N=n*x,S=n*B,T=p*q,V=p*r,P=p*t,Q=p*v,O=p*x,U=p*w,R=q*x,W=q*w,q=q*B,X=r*v,Y=r*w,r=r*B,Z=t*v,aa=t*x,t=t*B,v=u*v,x=u*x,u=u*w,w=m*(t-u)+n*(x-r)+p*(Y-aa),B=l*(u-t)+n*(q-v)+p*(Z-W),p=l*(r-x)+m*(v-q)+p*(R-X),l=l*(aa-Y)+m*(W-Z)+n*(X-R),m=g*w+f*B+h*p+k*l;b.Matrix4x4.load(a,e,w/m,(f*(u-t)+h*(r-x)+k*(aa-Y))/m,(f*(S-U)+h*(O-y)+k*(A-N))/m,(f*(P-I)+
h*(z-V)+k*(L-G))/m,B/m,(g*(t-u)+h*(v-q)+k*(W-Z))/m,(g*(U-S)+h*(C-Q)+k*(D-H))/m,(g*(I-P)+h*(T-E)+k*(d-M))/m,p/m,(g*(x-r)+f*(q-v)+k*(X-R))/m,(g*(y-O)+f*(Q-C)+k*(F-J))/m,(g*(V-z)+f*(E-T)+k*(K-c))/m,l/m,(g*(Y-aa)+f*(Z-W)+h*(R-X))/m,(g*(N-A)+f*(H-D)+h*(J-F))/m,(g*(G-L)+f*(M-d)+h*(c-K))/m,!1)};b.Matrix4x4.add=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B,E,F,H,C,K,G,z,J,A,y,M,L,I,D){b.Matrix4x4.load(a,e,c+w,d+B,g+E,f+F,h+H,k+C,l+K,m+G,n+z,p+J,q+A,r+y,t+M,u+L,v+I,x+D,!1)};b.Matrix4x4.addv=function(a,
e,c,d,g,f){b.Matrix4x4.add(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.sub=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B,E,F,H,C,K,G,z,J,A,y,M,L,I,D){b.Matrix4x4.load(a,e,c-w,d-B,g-E,f-F,h-H,k-C,l-K,m-G,n-z,p-J,q-A,r-y,t-M,u-L,v-I,x-D,!1)};b.Matrix4x4.subv=function(a,e,c,d,g,f){b.Matrix4x4.sub(a,
e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.mul=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B,E,F,H,C,K,G,z,J,A,y,M,L,I,D){b.Matrix4x4.load(a,e,c*w+d*H+g*z+f*M,c*B+d*C+g*J+f*L,c*E+d*K+g*A+f*I,c*F+d*G+g*y+f*D,h*w+k*H+l*z+m*M,h*B+k*C+l*J+m*L,h*E+k*K+l*A+m*I,h*F+k*G+l*y+m*D,n*w+p*H+q*z+r*M,n*
B+p*C+q*J+r*L,n*E+p*K+q*A+r*I,n*F+p*G+q*y+r*D,t*w+u*H+v*z+x*M,t*B+u*C+v*J+x*L,t*E+u*K+v*A+x*I,t*F+u*G+v*y+x*D,!1)};b.Matrix4x4.mulv=function(a,e,c,d,g,f){b.Matrix4x4.mul(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.mulScalar=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w){b.Matrix4x4.load(a,
e,c*w,d*w,g*w,f*w,h*w,k*w,l*w,m*w,n*w,p*w,q*w,r*w,t*w,u*w,v*w,x*w,!1)};b.Matrix4x4.mulScalarv=function(a,e,c,d,g){b.Matrix4x4.mulScalar(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.div=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B,E,F,H,C,K,G,z,J,A,y,M,L,I,D){var N=H*J,S=H*A,T=H*y,V=H*L,P=H*I,Q=H*D,O=C*z,U=C*A,R=C*y,W=C*M,X=C*I,Y=C*D,Z=K*z,aa=K*J,ha=K*y,ia=K*M,ja=K*L,ka=K*D,la=G*z,ma=G*J,na=G*A,oa=G*M,
pa=G*L,qa=G*I,ba=z*L,ca=z*I;z*=D;var da=J*M,ea=J*I;J*=D;var fa=A*M,ga=A*L;A*=D;M*=y;L*=y;y*=I;I=C*(A-y)+K*(L-J)+G*(ea-ga);D=H*(y-A)+K*(z-M)+G*(fa-ca);G=H*(J-L)+C*(M-z)+G*(ba-da);H=H*(ga-ea)+C*(ca-fa)+K*(da-ba);C=w*I+B*D+E*G+F*H;b.Matrix4x4.mul(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,I/C,(B*(y-A)+E*(J-L)+F*(ga-ea))/C,(B*(ka-qa)+E*(pa-Y)+F*(X-ja))/C,(B*(na-ha)+E*(R-ma)+F*(aa-U))/C,D/C,(w*(A-y)+E*(M-z)+F*(ca-fa))/C,(w*(qa-ka)+E*(Q-oa)+F*(ia-P))/C,(w*(ha-na)+E*(la-T)+F*(S-Z))/C,G/C,(w*(L-J)+B*(z-M)+F*(da-
ba))/C,(w*(Y-pa)+B*(oa-Q)+F*(V-W))/C,(w*(ma-R)+B*(T-la)+F*(O-N))/C,H/C,(w*(ea-ga)+B*(fa-ca)+E*(ba-da))/C,(w*(ja-X)+B*(P-ia)+E*(W-V))/C,(w*(U-aa)+B*(Z-S)+E*(N-O))/C)};b.Matrix4x4.divv=function(a,e,c,d,g,f){b.Matrix4x4.div(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[f+0],g[f+4],g[f+8],g[f+12],g[f+1],g[f+5],g[f+9],g[f+13],g[f+2],g[f+6],g[f+10],g[f+14],g[f+3],g[f+7],g[f+11],g[f+15])};b.Matrix4x4.divScalar=function(a,e,c,d,
g,f,h,k,l,m,n,p,q,r,t,u,v,x,w){b.Matrix4x4.load(a,e,c/w,d/w,g/w,f/w,h/w,k/w,l/w,m/w,n/w,p/w,q/w,r/w,t/w,u/w,v/w,x/w,!1)};b.Matrix4x4.divScalarv=function(a,e,c,d,g){b.Matrix4x4.divScalar(a,e,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.convertToString=function(a,b){return"Matrix4x4(\n    "+a[b+0]+", "+a[b+4]+", "+a[b+8]+", "+a[b+12]+",\n    "+a[b+1]+", "+a[b+5]+", "+a[b+9]+", "+a[b+13]+",\n    "+a[b+2]+", "+a[b+
6]+", "+a[b+10]+", "+a[b+14]+",\n    "+a[b+3]+", "+a[b+7]+", "+a[b+11]+", "+a[b+15]+")"}})(xpl);(function(b){null!=b.Matrix4x4&&(b.Matrix4x4.loadScale=function(a,e,c,d,g){b.Matrix4x4.load(a,e,c,0,0,0,0,d,0,0,0,0,g,0,0,0,0,1,!1)},b.Matrix4x4.loadScalev=function(a,e,c,d){b.Matrix4x4.loadScale(a,e,c[d+0],c[d+0],c[d+0])},b.Matrix4x4.loadTranslate=function(a,e,c,d,g,f){f=b.defaultValue(f,!0);b.Matrix4x4.load(a,e,1,0,0,c,0,1,0,d,0,0,1,g,0,0,0,1,!f)},b.Matrix4x4.loadTranslatev=function(a,b,c,d,g){},b.Matrix4x4.loadRotateXAxis=function(a,e,c,d){d=b.defaultValue(d,!0);var g=Math.cos(c);c=Math.sin(c);
b.Matrix4x4.load(a,e,1,0,0,0,0,g,-c,0,0,c,g,0,0,0,0,1,!d)},b.Matrix4x4.loadRotateYAxis=function(a,e,c,d){d=b.defaultValue(d,!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,e,g,0,c,0,0,1,0,0,-c,0,g,0,0,0,0,1,!d)},b.Matrix4x4.loadRotateZAxis=function(a,e,c,d){d=b.defaultValue(d,!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,e,g,-c,0,0,c,g,0,0,0,0,1,0,0,0,0,1,!d)},b.Matrix4x4.loadRotate=function(a,e,c,d,g,f,h,k){h=b.defaultValue(h,!0);k=b.defaultValue(k,!0);var l=Math.cos(f);f=Math.sin(f);
h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));h=1-l;var m=c*h,n=d*h,p=d*m,q=g*m,r=g*n,t=c*f,u=d*f;f*=g;b.Matrix4x4.load(a,e,l+c*m,p-f,q+u,0,p+f,l+d*n,r-t,0,q-u,r+t,l+g*g*h,0,0,0,0,1,!k)},b.Matrix4x4.loadLookAt=function(a,e,c,d,g,f,h,k,l,m,n,p){l=b.defaultValue(l,0);m=b.defaultValue(m,1);n=b.defaultValue(n,0);p=b.defaultValue(p,!0);f-=c;h-=d;k-=g;var q=f*f+h*h+k*k;0<q&&(q=Math.sqrt(q),f/=q,h/=q,k/=q);q=h*n-k*m;n=k*l-f*n;l=f*m-h*l;m=q*q+n*n+l*l;0<m&&(m=Math.sqrt(m),q/=m,n/=m,l/=m);m=h*l-k*
n;var r=k*q-f*l,t=f*n-h*q;b.Matrix4x4.load(a,e,q,n,l,-(q*c+n*d+l*g),m,r,t,-(m*c+r*d+t*g),f,h,k,-(f*c+h*d+k*g),0,0,0,1,!p)},b.Matrix4x4.loadPerspective=function(a,e,c,d,g,f,h,k,l,m,n){h=b.defaultValue(h,2);k=b.defaultValue(k,2);l=b.defaultValue(l,-1);m=b.defaultValue(m,1);n=b.defaultValue(n,!0);var p=f-g;f*=m-l;b.Matrix4x4.load(a,e,g*h/c,0,0,0,0,g*k/d,0,0,0,0,f/p+l,g*f/-p,0,0,1,0,!n)},b.Matrix4x4.loadAxisv=function(a,e,c,d,g){b.Matrix4x4.load(a,e,c[d+0],c[d+4],c[d+8],0,c[d+1],c[d+5],c[d+9],0,c[d+2],
c[d+6],c[d+10],0,0,0,0,1,g)},b.Matrix4x4.mulScale=function(a,b,c,d,g){a[b+0]*=c;a[b+4]*=d;a[b+8]*=g;a[b+1]*=c;a[b+5]*=d;a[b+9]*=g;a[b+2]*=c;a[b+6]*=d;a[b+10]*=g;a[b+3]*=c;a[b+7]*=d;a[b+11]*=g},b.Matrix4x4.mulTranslate=function(a,e,c,d,g,f){if(f=b.defaultValue(f,!0))a[e+12]+=a[e+0]*c+a[e+4]*d+a[e+8]*g,a[e+13]+=a[e+1]*c+a[e+5]*d+a[e+9]*g,a[e+14]+=a[e+2]*c+a[e+6]*d+a[e+10]*g,a[e+15]+=a[e+3]*c+a[e+7]*d+a[e+11]*g;else{f=a[e+12];var h=a[e+13],k=a[e+14],l=a[e+15];a[e+0]+=f*c;a[e+4]+=f*d;a[e+8]+=f*g;a[e+
1]+=h*c;a[e+5]+=h*d;a[e+9]+=h*g;a[e+2]+=k*c;a[e+6]+=k*d;a[e+10]+=k*g;a[e+3]+=l*c;a[e+7]+=l*d;a[e+11]+=l*g}},b.Matrix4x4.mulRotateXAxis=function(a,e,c,d){(d=b.defaultValue(d,!0))?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var g=a[e+4],f=a[e+8],h=a[e+5],k=a[e+9],l=a[e+6],m=a[e+10],n=a[e+7],p=a[e+11];a[e+4]=g*d+f*c;a[e+8]=g*-c+f*d;a[e+5]=h*d+k*c;a[e+9]=h*-c+k*d;a[e+6]=l*d+m*c;a[e+10]=l*-c+m*d;a[e+7]=n*d+p*c;a[e+11]=n*-c+p*d},b.Matrix4x4.mulRotateYAxis=function(a,e,c,d){(d=b.defaultValue(d,
!0))?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var g=a[e+0],f=a[e+8],h=a[e+1],k=a[e+9],l=a[e+2],m=a[e+10],n=a[e+3],p=a[e+11];a[e+0]=g*d+f*-c;a[e+8]=g*c+f*d;a[e+1]=h*d+k*-c;a[e+9]=h*c+k*d;a[e+2]=l*d+m*-c;a[e+10]=l*c+m*d;a[e+3]=n*d+p*-c;a[e+11]=n*c+p*d},b.Matrix4x4.mulRotateZAxis=function(a,e,c,d){(d=b.defaultValue(d,!0))?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var g=a[e+0],f=a[e+4],h=a[e+1],k=a[e+5],l=a[e+2],m=a[e+6],n=a[e+3],p=a[e+7];a[e+0]=g*d+f*c;a[e+4]=g*
-c+f*d;a[e+1]=h*d+k*c;a[e+5]=h*-c+k*d;a[e+2]=l*d+m*c;a[e+6]=l*-c+m*d;a[e+3]=n*d+p*c;a[e+7]=n*-c+p*d},b.Matrix4x4.mulRotate=function(a,e,c,d,g,f,h,k){h=b.defaultValue(h,!0);(k=b.defaultValue(k,!0))?(k=Math.cos(f),f=Math.sin(f)):(k=Math.cos(f),f=-Math.sin(f));h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));h=1-k;var l=c*h,m=d*h,n=d*l,p=g*l,q=g*m,r=c*f,t=d*f,u=g*f;f=a[e+0];var v=a[e+4],x=a[e+8],w=a[e+1],B=a[e+5],E=a[e+9],F=a[e+2],H=a[e+6],C=a[e+10],K=a[e+3],G=a[e+7],z=a[e+11];c=k+c*l;var l=n-
u,J=p+t,n=n+u;d=k+d*m;m=q-r;p-=t;q+=r;g=k+g*g*h;a[e+0]=f*c+v*n+x*p;a[e+4]=f*l+v*d+x*q;a[e+8]=f*J+v*m+x*g;a[e+1]=w*c+B*n+E*p;a[e+5]=w*l+B*d+E*q;a[e+9]=w*J+B*m+E*g;a[e+2]=F*c+H*n+C*p;a[e+6]=F*l+H*d+C*q;a[e+10]=F*J+H*m+C*g;a[e+3]=K*c+G*n+z*p;a[e+7]=K*l+G*d+z*q;a[e+11]=K*J+G*m+z*g},b.Matrix4x4.mulLookAt=function(a,e,c,d,g,f,h,k,l,m,n,p){p=b.defaultValue(p,!0);f-=c;h-=d;k-=g;var q=f*f+h*h+k*k;0<q&&(q=Math.sqrt(q),f/=q,h/=q,k/=q);q=h*n-k*m;n=k*l-f*n;l=f*m-h*l;m=q*q+n*n+l*l;0<m&&(m=Math.sqrt(m),q/=m,n/=
m,l/=m);m=h*l-k*n;var r=k*q-f*l,t=f*n-h*q,u=-(q*c+n*d+l*g),v=-(m*c+r*d+t*g);c=-(f*c+h*d+k*g);d=a[e+0];g=a[e+4];var x=a[e+8],w=a[e+1],B=a[e+5],E=a[e+9],F=a[e+2],H=a[e+6],C=a[e+10],K=a[e+3],G=a[e+7],z=a[e+11];if(p)a[e+0]=d*q+g*m+x*f,a[e+4]=d*n+g*r+x*h,a[e+8]=d*l+g*t+x*k,a[e+12]+=d*u+g*v+x*c,a[e+1]=w*q+B*m+E*f,a[e+5]=w*n+B*r+E*h,a[e+9]=w*l+B*t+E*k,a[e+13]+=w*u+B*v+E*c,a[e+2]=F*q+H*m+C*f,a[e+6]=F*n+H*r+C*h,a[e+10]=F*l+H*t+C*k,a[e+14]+=F*u+H*v+C*c,a[e+3]=K*q+G*m+z*f,a[e+7]=K*n+G*r+z*h,a[e+11]=K*l+G*t+
z*k,a[e+15]+=K*u+G*v+z*c;else{p=a[e+12];var J=a[e+13],A=a[e+14],y=a[e+15];a[e+0]=d*q+g*n+x*l+p*u;a[e+4]=d*m+g*r+x*t+p*v;a[e+8]=d*f+g*h+x*k+p*c;a[e+1]=w*q+B*n+E*l+J*u;a[e+5]=w*m+B*r+E*t+J*v;a[e+9]=w*f+B*h+E*k+J*c;a[e+2]=F*q+H*n+C*l+A*u;a[e+6]=F*m+H*r+C*t+A*v;a[e+10]=F*f+H*h+C*k+A*c;a[e+3]=K*q+G*n+z*l+y*u;a[e+7]=K*m+G*r+z*t+y*v;a[e+11]=K*f+G*h+z*k+y*c}},b.Matrix4x4.mulPerspective=function(a,e,c,d,g,f,h,k,l,m,n){h=b.defaultValue(h,2);k=b.defaultValue(k,2);l=b.defaultValue(l,-1);m=b.defaultValue(m,1);
n=b.defaultValue(n,!0);var p=f-g,q=f*(m-l);f=a[e+8];m=a[e+9];var r=a[e+10],t=a[e+11];c=g*h/c;d=g*k/d;l=q/p+l;n?(g=g*q/-p,a[e+0]*=c,a[e+4]*=d,a[e+8]=f*l+a[e+12],a[e+12]=f*g,a[e+1]*=c,a[e+5]*=d,a[e+9]=m*l+a[e+13],a[e+13]=m*g,a[e+2]*=c,a[e+6]*=d,a[e+10]=r*l+a[e+14],a[e+14]=r*g,a[e+3]*=c,a[e+7]*=d,a[e+11]=t*l+a[e+15],a[e+15]=t*g):(g=g*q/-p,a[e+0]*=c,a[e+4]*=d,a[e+8]=f*l+a[e+12]*g,a[e+12]=f,a[e+1]*=c,a[e+5]*=d,a[e+9]=m*l+a[e+13]*g,a[e+13]=m,a[e+2]*=c,a[e+6]*=d,a[e+10]=r*l+a[e+14]*g,a[e+14]=r,a[e+3]*=c,
a[e+7]*=d,a[e+11]=t*l+a[e+15]*g,a[e+15]=t)},b.Matrix4x4.normalizeAxisv=function(a,e,c,d,g){g=b.defaultValue(g,!0);var f,h,k,l,m,n,p,q;f=c[d+0];m=c[d+5];q=c[d+10];g?(h=c[d+1],k=c[d+2],l=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]):(h=c[d+4],k=c[d+8],l=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]);d=f*f+h*h+k*k;0<d&&(d=Math.sqrt(d),f/=d,h/=d,k/=d);d=l*l+m*m+n*n;0<d&&(d=Math.sqrt(d),l/=d,m/=d,n/=d);d=p*p+c*c+q*q;0<d&&(d=Math.sqrt(d),p/=d,c/=d,q/=d);a[e+0]=f;a[e+5]=m;a[e+10]=q;g?(a[e+1]=h,a[e+2]=k,a[e+4]=l,a[e+6]=n,a[e+8]=
p,a[e+9]=c):(a[e+4]=h,a[e+8]=k,a[e+1]=l,a[e+9]=n,a[e+2]=p,a[e+6]=c)},b.Matrix4x4.slrepAxisAndLrepOtherv=function(a,e,c,d,g,f,h,k){k=b.defaultValue(k,!0);var l=1-h,m,n,p,q,r,t,u,v,x,w,B,E,F,H,C;m=c[d+0];r=c[d+5];x=c[d+10];C=c[d+15];k?(n=c[d+1],p=c[d+2],w=c[d+3],q=c[d+4],t=c[d+6],B=c[d+7],u=c[d+8],v=c[d+9],E=c[d+11],F=c[d+12],H=c[d+13],c=c[d+14]):(n=c[d+4],p=c[d+8],w=c[d+12],q=c[d+1],t=c[d+9],B=c[d+13],u=c[d+2],v=c[d+6],E=c[d+14],F=c[d+3],H=c[d+7],c=c[d+11]);var K,G,z,J,A,y,M,L,I,D,N,S,T,V;K=g[f+0];
A=g[f+5];D=g[f+10];V=g[f+15];k?(G=g[f+1],z=g[f+2],d=g[f+3],J=g[f+4],y=g[f+6],M=g[f+7],L=g[f+8],I=g[f+9],N=g[f+11],S=g[f+12],T=g[f+13],g=g[f+14]):(G=g[f+4],z=g[f+8],d=g[f+12],J=g[f+1],y=g[f+9],M=g[f+13],L=g[f+2],I=g[f+6],N=g[f+14],S=g[f+3],T=g[f+7],g=g[f+11]);var P=m*m+n*n+p*p;0<P&&(P=Math.sqrt(P),m/=P,n/=P,p/=P);var Q=q*q+r*r+t*t;0<Q&&(Q=Math.sqrt(Q),q/=Q,r/=Q,t/=Q);f=u*u+v*v+x*x;0<f&&(f=Math.sqrt(f),u/=f,v/=f,x/=f);var O=K*K+G*G+z*z;0<O&&(O=Math.sqrt(O),K/=O,G/=O,z/=O);var U=J*J+A*A+y*y;0<U&&(U=
Math.sqrt(U),J/=U,A/=U,y/=U);var R=L*L+I*I+D*D;0<R&&(R=Math.sqrt(R),L/=R,I/=R,D/=R);var W=m*K+n*G+p*z;if(1<=W)z=P*l+O*h,m*=z,n*=z,p*=z;else if(-1>=W)z=P*l-O*h,m*=z,n*=z,p*=z;else{var P=P*l+O*h,O=Math.acos(W),X=Math.sin(O),W=Math.sin(O*l)/X,O=Math.sin(O*h)/X;m=(m*W+K*O)*P;n=(n*W+G*O)*P;p=(p*W+z*O)*P}z=q*J+r*A+t*y;1<=z?(y=Q*l+U*h,q*=y,r*=y,t*=y):-1>=z?(y=Q*l-U*h,q*=y,r*=y,t*=y):(Q=Q*l+U*h,z=Math.acos(z),G=Math.sin(z),U=Math.sin(z*l)/G,z=Math.sin(z*h)/G,q=(q*U+J*z)*Q,r=(r*U+A*z)*Q,t=(t*U+y*z)*Q);y=u*
L+v*I+x*D;1<=y?(D=f*l+R*h,u*=D,v*=D,x*=D):-1>=y?(D=f*l-R*h,u*=D,v*=D,x*=D):(f=f*l+R*h,y=Math.acos(y),A=Math.sin(y),R=Math.sin(y*l)/A,y=Math.sin(y*h)/A,u=(u*R+L*y)*f,v=(v*R+I*y)*f,x=(x*R+D*y)*f);b.Matrix4x4.load(a,e,m,q,u,F*l+S*h,n,r,v,H*l+T*h,p,t,x,c*l+g*h,w*l+d*h,B*l+M*h,E*l+N*h,C*l+V*h,!k)},b.Matrix4x4.fromQuaternionv=function(a,e,c,d,g){g=b.defaultValue(g,!0);var f=c[d+0],h=c[d+1],k=c[d+2],l=c[d+3];c=f*f;d=h*h;var m=k*k,n=l*l,p=h*k*2,q=h*l*2,r=k*l*2,h=f*h*2,k=f*k*2,f=f*l*2;b.Matrix4x4.load(a,e,
d+c-n-m,p-f,q+k,0,p+f,m+c-d-n,r-h,0,q-k,r+h,n+c-m-d,0,0,0,0,1,!g)},b.Matrix4x4.mulQuaternionv=function(a,e,c,d,g){g=b.defaultValue(g,!0);var f=c[d+0],h=c[d+1],k=c[d+2],l=c[d+3],m=f*f,n=h*h,p=k*k,q=l*l,r=h*k*2;d=h*l*2;c=k*l*2;var h=f*h*2,k=f*k*2,t=f*l*2,f=a[e+0],l=a[e+4],u=a[e+8],v=a[e+1],x=a[e+5],w=a[e+9],B=a[e+2],E=a[e+6],F=a[e+10],H=a[e+3],C=a[e+7],K=a[e+11],G=n+m-q-p,z=p+m-n-q,m=q+m-p-n;g?(g=r-t,n=d+k,r+=t,p=c-h,d-=k,c+=h):(g=r+t,n=d-k,r-=t,p=c+h,d+=k,c-=h);a[e+0]=f*G+l*r+u*d;a[e+4]=f*g+l*z+u*
c;a[e+8]=f*n+l*p+u*m;a[e+1]=v*G+x*r+w*d;a[e+5]=v*g+x*z+w*c;a[e+9]=v*n+x*p+w*m;a[e+2]=B*G+E*r+F*d;a[e+6]=B*g+E*z+F*c;a[e+10]=B*n+E*p+F*m;a[e+3]=H*G+C*r+K*d;a[e+7]=H*g+C*z+K*c;a[e+11]=H*n+C*p+K*m},b.Matrix4x4.mulQuaternionAxisv=function(a,e,c,d,g){g=b.defaultValue(g,!0);var f=c[d+0],h=c[d+1],k=c[d+2],l=c[d+3],m=f*f,n=h*h,p=k*k,q=l*l,r=h*k*2;d=h*l*2;c=k*l*2;var h=f*h*2,k=f*k*2,t=f*l*2,f=a[e+0],l=a[e+4],u=a[e+8],v=a[e+1],x=a[e+5],w=a[e+9],B=a[e+2],E=a[e+6],F=a[e+10],H=n+m-q-p,C=p+m-n-q,m=q+m-p-n;g?(g=
r-t,n=d+k,r+=t,p=c-h,d-=k,c+=h):(g=r+t,n=d-k,r-=t,p=c+h,d+=k,c-=h);a[e+0]=f*H+l*r+u*d;a[e+4]=f*g+l*C+u*c;a[e+8]=f*n+l*p+u*m;a[e+1]=v*H+x*r+w*d;a[e+5]=v*g+x*C+w*c;a[e+9]=v*n+x*p+w*m;a[e+2]=B*H+E*r+F*d;a[e+6]=B*g+E*C+F*c;a[e+10]=B*n+E*p+F*m},b.Matrix4x4.toQuaternionv=function(a,e,c,d,g,f){g=b.defaultValue(g,!1);f=b.defaultValue(f,!0);var h=c[d+0],k=c[d+5],l=c[d+10],m,n,p,q,r;f?(f=c[d+4],m=c[d+8],n=c[d+1],p=c[d+9],q=c[d+2],r=c[d+6]):(f=c[d+1],m=c[d+2],n=c[d+4],p=c[d+6],q=c[d+8],r=c[d+9]);c=(n*r-q*k)*
m+(q*f-h*r)*p+(h*k-n*f)*l;d=0>c;0!=c&&(c=Math.pow(Math.abs(c),1/3),h/=c,n/=c,q/=c,f/=c,k/=c,r/=c,m/=c,p/=c,l/=c,c=Math.sqrt(c));p=.5*(r-p);m=.5*(m-q);f=.5*(n-f);n=p*p+m*m+f*f;0<n&&(n=Math.sqrt(n),d?(p/=-n,m/=-n,f/=-n):(p/=n,m/=n,f/=n));b.MathUtils.mid(.5*(h+k+l-1),1,-1);h=d?-b.MathUtils.mid(.5*(h+k+l+1),1,-1):b.MathUtils.mid(.5*(h+k+l-1),1,-1);k=.5*Math.acos(h);h=Math.cos(k);n=Math.sin(k);g?(a[e+0]=c*h,a[e+1]=c*n*p,a[e+2]=c*n*m,a[e+3]=c*n*f):(a[e+0]=c*-h,a[e+1]=c*-n*p,a[e+2]=c*-n*m,a[e+3]=c*-n*f)},
b.Matrix4x4.toRotateAxisv=function(a,e,c,d,g){g=b.defaultValue(g,!0);var f=c[d+0],h=c[d+5],k=c[d+10],l,m,n,p;g?(g=c[d+4],l=c[d+8],m=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]):(g=c[d+1],l=c[d+2],m=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]);d=.5*(g+m);var q=.5*(p+l),r=.5*(n+c),f=Math.min(f-(0!=r?Math.abs(d*q/r):0),h-(0!=q?Math.abs(d*r/q):0),k-(0!=d?Math.abs(q*r/d):0)),h=.5*(n-c);l=.5*(p-l);g=.5*(g-m);m=h*h+l*l+g*g;p=f*f+m;0<p&&(f/=Math.sqrt(p));if(1<=f)return a[e+0]=0,a[e+1]=0,a[e+2]=0;0<m?(m=Math.sqrt(m),a[e+0]=-h/
m,a[e+1]=-l/m,a[e+2]=-g/m):(a[e+0]=0,a[e+1]=0,a[e+2]=0);return Math.acos(f)})})(xpl);(function(b){b.Quaternion=function(){throw Error("Unsupported operation!");};b.Quaternion.load=function(a,b,c,d,g,f){a[b+0]=c;a[b+1]=d;a[b+2]=g;a[b+3]=f};b.Quaternion.loadv=function(a,e,c,d){b.Quaternion.load(a,e,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.loadZero=function(a,e){b.Quaternion.load(a,e,0,0,0,0)};b.Quaternion.loadIdentity=function(a,e){b.Quaternion.load(a,e,1,0,0,0)};b.Quaternion.absSq=function(a,b){var c=a[b+0],d=a[b+1],g=a[b+2];a=a[b+3];return c*c+d*d+g*g+a*a};b.Quaternion.abs=function(a,
e){return Math.sqrt(b.Quaternion.absSq(a,e))};b.Quaternion.normalizev=function(a,e,c,d){var g=c[d+0],f=c[d+1],h=c[d+2];c=c[d+3];d=g*g+f*f+h*h+c*c;0<d?(d=Math.sqrt(d),b.Quaternion.load(a,e,g/d,f/d,h/d,c/d)):b.Quaternion.loadZero(a,e)};b.Quaternion.exp=function(a,e,c,d,g,f){c=Math.exp(c);var h=Math.sqrt(d*d+g*g+f*f),k=c*Math.sin(h)/h;b.Quaternion.load(a,e,c*Math.cos(h),d*k,g*k,f*k)};b.Quaternion.expv=function(a,e,c,d){b.Quaternion.exp(a,e,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.cis=function(a,e,
c,d,g){var f=Math.sqrt(c*c+d*d+g*g),h=Math.sin(f)/f;b.Quaternion.load(a,e,Math.cos(f),c*h,d*h,g*h)};b.Quaternion.cisv=function(a,e,c,d){b.Quaternion.cis(a,e,c[d+0],c[d+1],c[d+2])};b.Quaternion.log=function(a,e,c,d,g,f){var h=Math.sqrt(c*c+d*d+g*g+f*f);c=Math.acos(c/h)/Math.sqrt(d*d+g*g+f*f);b.Quaternion.load(a,e,Math.log(h),d*c,g*c,f*c)};b.Quaternion.logv=function(a,e,c,d){b.Quaternion.log(a,e,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.lerp=function(a,e,c,d,g,f,h,k,l,m,n){var p=1-n;b.Quaternion.load(a,
e,c*p+h*n,d*p+k*n,g*p+l*n,f*p+m*n)};b.Quaternion.lerpv=function(a,e,c,d,g,f,h){b.Quaternion.lerp(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3],h)};b.Quaternion.slerp=function(a,e,c,d,g,f,h,k,l,m,n){var p=c*c+d*d+g*g+f*f;0<p&&(p=Math.sqrt(p),c/=p,d/=p,g/=p,f/=p);var q=h*h+k*k+l*l+m*m;0<q&&(q=Math.sqrt(q),h/=q,k/=q,l/=q,m/=q);var r=c*h+d*k+g*l+f*m;if(1<=r)h=p*(1-n)+q*n,b.Quaternion.load(a,e,c*h,d*h,g*h,f*h);else if(-1>=r)h=p*(1-n)-q*n,b.Quaternion.load(a,e,c*h,d*h,g*h,f*h);else{var p=
p*(1-n)+q*n,q=Math.acos(r),t=Math.sin(q),r=Math.sin(q*(1-n))/t;n=Math.sin(q*n)/t;b.Quaternion.load(a,e,(c*r+h*n)*p,(d*r+k*n)*p,(g*r+l*n)*p,(f*r+m*n)*p)}};b.Quaternion.slerpv=function(a,e,c,d,g,f,h){b.Quaternion.slerp(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3],h)};b.Quaternion.dot=function(a,b,c,d,g,f,h,k){return a*g+b*f+c*h+d*k};b.Quaternion.dotv=function(a,b,c,d){return a[b+0]*c[d+0]+a[b+1]*c[d+1]+a[b+2]*c[d+2]+a[b+3]*c[d+3]};b.Quaternion.conjugatev=function(a,e,c,d){b.Quaternion.load(a,
e,c[d+0],-c[d+1],-c[d+2],-c[d+3])};b.Quaternion.reversev=function(a,e,c,d){b.Quaternion.load(a,e,-c[d+0],-c[d+1],-c[d+2],-c[d+3])};b.Quaternion.inversev=function(a,e,c,d){var g=c[d+0],f=c[d+1],h=c[d+2];c=c[d+3];d=g*g+f*f+h*h+c*c;0<d&&(d=Math.sqrt(d),g/=d,f/=-d,h/=-d,c/=-d);b.Quaternion.load(a,e,g,f,h,c)};b.Quaternion.add=function(a,e,c,d,g,f,h,k,l,m){b.Quaternion.load(a,e,c+h,d+k,g+l,f+m)};b.Quaternion.addv=function(a,e,c,d,g,f){b.Quaternion.add(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],
g[f+3])};b.Quaternion.sub=function(a,e,c,d,g,f,h,k,l,m){b.Quaternion.load(a,e,c-h,d-k,g-l,f-m)};b.Quaternion.subv=function(a,e,c,d,g,f){b.Quaternion.sub(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.mul=function(a,e,c,d,g,f,h,k,l,m){b.Quaternion.load(a,e,c*h-(d*k+g*l+f*m),c*k+d*h+(g*m-f*l),c*l+g*h+(f*k-d*m),c*m+f*h+(d*l-g*k))};b.Quaternion.mulv=function(a,e,c,d,g,f){b.Quaternion.mul(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.mulScalar=function(a,
e,c,d,g,f,h){b.Quaternion.load(a,e,c*h,d*h,g*h,f*h)};b.Quaternion.mulScalarv=function(a,e,c,d,g){b.Quaternion.mulScalar(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g)};b.Quaternion.div=function(a,e,c,d,g,f,h,k,l,m){var n=h*h+k*k+l*l+m*m;b.Quaternion.load(a,e,(c*h+(d*k+g*l+f*m))/n,(-c*k+d*h-(g*m-f*l))/n,(-c*l+g*h-(f*k-d*m))/n,(-c*m+f*h-(d*l-g*k))/n)};b.Quaternion.divv=function(a,e,c,d,g,f){b.Quaternion.div(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g[f+0],g[f+1],g[f+2],g[f+3])};b.Quaternion.divScalar=function(a,e,c,d,g,
f,h){b.Quaternion.load(a,e,c/h,d/h,g/h,f/h)};b.Quaternion.divScalarv=function(a,e,c,d,g){b.Quaternion.divScalar(a,e,c[d+0],c[d+1],c[d+2],c[d+3],g)};b.Quaternion.convertToString=function(a,b){return"Quaternion("+a[b+0]+", "+a[b+1]+", "+a[b+2]+", "+a[b+3]+")"}})(xpl);(function(b){null!=b.Quaternion&&(b.Quaternion.loadIAxisRotate=function(a,e,c){c*=.5;b.Quaternion.load(a,e,Math.cos(c),Math.sin(c),0,0)},b.Quaternion.loadJAxisRotate=function(a,e,c){c*=.5;b.Quaternion.load(a,e,Math.cos(c),0,Math.sin(c),0)},b.Quaternion.loadKAxisRotate=function(a,e,c){c*=.5;b.Quaternion.load(a,e,Math.cos(c),0,0,Math.sin(c))},b.Quaternion.loadRotate=function(a,e,c,d,g,f,h){if(h=b.defaultValue(h,!0))h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h);f*=.5;h=Math.sin(f);b.Quaternion.load(a,
e,Math.cos(f),c*h,d*h,g*h)},b.Quaternion.loadRotateVector3=function(a,e,c,d,g,f,h,k,l,m,n){n=b.defaultValue(n,1);if(f)if(f=c*c+d*d+g*g,0<f)f=Math.sqrt(f),c/=f,d/=f,g/=f;else{b.Quaternion.loadIdentity(a,e);return}if(m)if(m=h*h+k*k+l*l,0<m)m=Math.sqrt(m),h/=m,k/=m,l/=m;else{b.Quaternion.loadIdentity(a,e);return}f=c*h+d*k+g*l;1<=f?b.Quaternion.loadIdentity(a,e):(m=d*l-g*k,g=g*h-c*l,c=c*k-d*h,d=m*m+g*g+c*c,0<d?(d=Math.sqrt(d),n*=.5*Math.acos(f),h=Math.sin(n),b.Quaternion.load(a,e,Math.cos(n),m/d*h,g/
d*h,c/d*h)):b.Quaternion.loadIdentity(a,e))},b.Quaternion.loadRotateVector3v=function(a,e,c,d,g,f,h,k,l){b.Quaternion.loadRotateVector3(a,e,c[d+0],c[d+1],c[d+2],g,f[h+0],f[h+1],f[h+2],k,l)},b.Quaternion.mulIAxisRotate=function(a,e,c){c*=.5;var d=Math.cos(c);c=Math.sin(c);var g=a[e+0],f=a[e+1],h=a[e+2],k=a[e+3];b.Quaternion.load(a,e,g*d-f*c,g*c+f*d,h*d+k*c,k*d-h*c)},b.Quaternion.mulJAxisRotate=function(a,e,c){c*=.5;var d=Math.cos(c);c=Math.sin(c);var g=a[e+0],f=a[e+1],h=a[e+2],k=a[e+3];b.Quaternion.load(a,
e,g*d-h*c,f*d-k*c,g*c+h*d,k*d+f*c)},b.Quaternion.mulKAxisRotate=function(a,e,c){c*=.5;var d=Math.cos(c);c=Math.sin(c);var g=a[e+0],f=a[e+1],h=a[e+2],k=a[e+3];b.Quaternion.load(a,e,g*d-k*c,f*d+h*c,h*d-f*c,g*c+k*d)},b.Quaternion.mulRotate=function(a,e,c,d,g,f,h){if(h=b.defaultValue(h,!0))h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h);f*=.5;h=Math.cos(f);f=Math.sin(f);c*=f;d*=f;g*=f;f=a[e+0];var k=a[e+1],l=a[e+2],m=a[e+3];b.Quaternion.load(a,e,f*h-(k*c+l*d+m*g),f*c+k*h+(l*g-m*d),f*d+l*h+(m*c-k*g),
f*g+m*h+(k*d-l*c))})})(xpl);(function(b){b.Vector3=function(){throw Error("Unsupported operation!");};b.Vector3.load=function(a,b,c,d,g){a[b+0]=c;a[b+1]=d;a[b+2]=g};b.Vector3.loadv=function(a,e,c,d){b.Vector3.load(a,e,c[d+0],c[d+1],c[d+2])};b.Vector3.loadZero=function(a,e){b.Vector3.load(a,e,0,0,0)};b.Vector3.lenSq=function(a,b){var c=a[b+0],d=a[b+1];a=a[b+2];return c*c+d*d+a*a};b.Vector3.len=function(a,e){return Math.sqrt(b.Vector3.lenSq(a,e))};b.Vector3.normalizev=function(a,e,c,d){var g=c[d+0],f=c[d+1];c=c[d+2];d=g*g+f*f+
c*c;0<d?(d=Math.sqrt(d),b.Vector3.load(a,e,g/d,f/d,c/d)):b.Vector3.loadZero(a,e)};b.Vector3.lerp=function(a,e,c,d,g,f,h,k,l){var m=1-l;b.Vector3.load(a,e,c*m+f*l,d*m+h*l,g*m+k*l)};b.Vector3.lerpv=function(a,e,c,d,g,f,h){b.Vector3.lerp(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2],h)};b.Vector3.slerp=function(a,e,c,d,g,f,h,k,l){var m=c*c+d*d+g*g;0<m&&(m=Math.sqrt(m),c/=m,d/=m,g/=m);var n=f*f+h*h+k*k;0<n&&(n=Math.sqrt(n),f/=n,h/=n,k/=n);var p=c*f+d*h+g*k;if(1<=p)f=m*(1-l)+n*l,b.Vector3.load(a,e,c*f,
d*f,g*f);else if(-1>=p)f=m*(1-l)-n*l,b.Vector3.load(a,e,c*f,d*f,g*f);else{var m=m*(1-l)+n*l,n=Math.acos(p),q=Math.sin(n),p=Math.sin(n*(1-l))/q;l=Math.sin(n*l)/q;b.Vector3.load(a,e,(c*p+f*l)*m,(d*p+h*l)*m,(g*p+k*l)*m)}};b.Vector3.slerpv=function(a,e,c,d,g,f,h){b.Vector3.slerp(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2],h)};b.Vector3.dot=function(a,b,c,d,g,f){return a*d+b*g+c*f};b.Vector3.dotv=function(a,b,c,d){return a[b+0]*c[d+0]+a[b+1]*c[d+1]+a[b+2]*c[d+2]};b.Vector3.cross=function(a,e,c,d,g,f,
h,k){b.Vector3.load(a,e,d*k-g*h,g*f-c*k,c*h-d*f)};b.Vector3.crossv=function(a,e,c,d,g,f){b.Vector3.cross(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2])};b.Vector3.cos=function(a,b,c,d,g,f){var h=a*a+b*b+c*c;0<h&&(h=Math.sqrt(h),a/=h,b/=h,c/=h);h=d*d+g*g+f*f;0<h&&(h=Math.sqrt(h),d/=h,g/=h,f/=h);return a*d+b*g+c*f};b.Vector3.cosv=function(a,e,c,d){return b.Vector3.cos(a[e+0],a[e+1],a[e+2],c[d+0],c[d+1],c[d+2])};b.Vector3.reversev=function(a,e,c,d){b.Vector3.load(a,e,-c[d+0],-c[d+1],-c[d+2])};b.Vector3.add=
function(a,e,c,d,g,f,h,k){b.Vector3.load(a,e,c+f,d+h,g+k)};b.Vector3.addv=function(a,e,c,d,g,f){b.Vector3.add(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2])};b.Vector3.sub=function(a,e,c,d,g,f,h,k){b.Vector3.load(a,e,c-f,d-h,g-k)};b.Vector3.subv=function(a,e,c,d,g,f){b.Vector3.sub(a,e,c[d+0],c[d+1],c[d+2],g[f+0],g[f+1],g[f+2])};b.Vector3.mul=function(a,e,c,d,g,f){b.Vector3.load(a,e,c*f,d*f,g*f)};b.Vector3.mulv=function(a,e,c,d,g){b.Vector3.mul(a,e,c[d+0],c[d+1],c[d+2],g)};b.Vector3.mulQuaternionv=
function(a,e,c,d,g,f){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=g[f+0];var m=g[f+1],n=g[f+2];g=-(k*d+l*m+c*n);f=h*d+(l*n-c*m);var p=h*m+(c*d-k*n);d=h*n+(k*m-l*d);b.Vector3.load(a,e,-g*k+f*h-(p*c-d*l),-g*l+p*h-(d*k-f*c),-g*c+d*h-(f*l-p*k))};b.Vector3.mulMatrix4x4v=function(a,e,c,d,g,f,h){if(h=b.defaultValue(h,!0)){h=g[f+0];var k=g[f+1];g=g[f+2];f=c[d+3]*h+c[d+7]*k+c[d+11]*g+c[d+15];b.Vector3.load(a,e,(c[d+0]*h+c[d+4]*k+c[d+8]*g+c[d+12])/f,(c[d+1]*h+c[d+5]*k+c[d+9]*g+c[d+13])/f,(c[d+2]*h+c[d+6]*k+c[d+
10]*g+c[d+14])/f)}else h=c[d+0],k=c[d+1],c=c[d+2],d=h*g[f+12]+k*g[f+13]+c*g[f+14]+g[f+15],b.Vector3.load(a,e,(h*g[f+0]+k*g[f+1]+c*g[f+2]+g[f+3])/d,(h*g[f+4]+k*g[f+5]+c*g[f+6]+g[f+7])/d,(h*g[f+8]+k*g[f+9]+c*g[f+10]+g[f+11])/d)};b.Vector3.mulMatrix4x4Axisv=function(a,e,c,d,g,f,h){if(h=b.defaultValue(h,!0)){h=g[f+0];var k=g[f+1];g=g[f+2];b.Vector3.load(a,e,c[d+0]*h+c[d+4]*k+c[d+8]*g,c[d+1]*h+c[d+5]*k+c[d+9]*g,c[d+2]*h+c[d+6]*k+c[d+10]*g)}else h=c[d+0],k=c[d+1],c=c[d+2],b.Vector3.load(a,e,h*g[f+0]+k*
g[f+1]+c*g[f+2],h*g[f+4]+k*g[f+5]+c*g[f+6],h*g[f+8]+k*g[f+9]+c*g[f+10])};b.Vector3.div=function(a,e,c,d,g,f){b.Vector3.load(a,e,c*f,d*f,g*f)};b.Vector3.divv=function(a,e,c,d,g){b.Vector3.div(a,e,c[d+0],c[d+1],c[d+2],g)};b.Vector3.convertToString=function(a,b){return"Vector3("+a[b+0]+", "+a[b+1]+", "+a[b+2]+")"}})(xpl);(function(b){b.GLUtils=function(){throw Error("Unsupported operation!");};Object.defineProperties(b.GLUtils,{TYPE_VERTEX_SHADER:{value:"OpenGL Vertex Shader"},TYPE_FRAGMENT_SHADER:{value:"OpenGL Fragment Shader"},TYPE_PROGRAM:{value:"OpenGL Program"}});b.GLUtils.createBuffer=function(a,b,c,d){if(b==a.ARRAY_BUFFER||b==a.ELEMENT_ARRAY_BUFFER){var g=a.createBuffer();null!=g&&(a.bindBuffer(b,g),a.bufferData(b,c,d));return g}return null};b.GLUtils.createTexture2D=function(a,e,c,d,g,f,h,k,l){f=b.defaultValue(f,
null);h=b.defaultValue(h,!1);k=b.defaultValue(k,null);l=b.defaultValue(l,0);var m=a.createTexture();if(null!=m){a.bindTexture(a.TEXTURE_2D,m);var n=b.MathUtils.ceilPow2(d),p=b.MathUtils.ceilPow2(g);d==n&&g==p?(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,e,n,p,0,e,c,f)):(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,e,texWidth,texHeight,0,e,c,null),null!=f&&a.texSubImage2D(a.TEXTURE_2D,0,0,0,d,g,e,c,f));h&&a.generateMipmap(a.TEXTURE_2D);null!=k&&(k[l+0]=n,k[l+
1]=p)}return m};b.GLUtils.createTexture2DFromImage=function(a,b,c,d){var g=a.createTexture();null!=g&&(a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,b,b,c,d));return g};b.GLUtils.createShader=function(a,e,c,d){d=b.defaultValue(d,null);if(e==a.VERTEX_SHADER||e==a.FRAGMENT_SHADER){var g=a.createShader(e);return null==g||(a.shaderSource(g,c),a.compileShader(g),a.getShaderParameter(g,a.COMPILE_STATUS))?g:(c=a.getShaderInfoLog(g),console.error("Shader compile error:\n"+c),null!=d&&(e==a.VERTEX_SHADER?
d(b.GLUtils.TYPE_VERTEX_SHADER,c):e==a.FRAGMENT_SHADER&&d(b.GLUtils.TYPE_FRAGMENT_SHADER,+c)),a.deleteShader(g),null)}return null};b.GLUtils.createProgram=function(a,e,c,d,g){if(null!=e&&null!=c){var f=a.createProgram();if(null!=f){a.attachShader(f,e);a.attachShader(f,c);if(null!=d)for(var h in d)a.bindAttribLocation(f,d[h],h);a.linkProgram(f);if(!a.getProgramParameter(f,a.LINK_STATUS))return e=a.getProgramInfoLog(f),console.error("Program linkage error:\n"+e),null!=g&&g(b.GLUtils.TYPE_PROGRAM,e),
a.deleteProgram(f),null}return f}return null};b.GLUtils.createShaderProgram=function(a,e,c,d,g){e=b.GLUtils.createShader(a,a.VERTEX_SHADER,e,g);if(null==e)return null;c=b.GLUtils.createShader(a,a.FRAGMENT_SHADER,c,g);if(null==c)return a.deleteShader(e),null;d=b.GLUtils.createProgram(a,e,c,d,g);a.deleteShader(e);a.deleteShader(c);return d}})(xpl);(function(b){var a=1;b.XModelStructure=function(b){this.structure_type=b;var c=a++;this.valueOf=function(){return c};this.hashCode=function(){return c}};b.XModelStructure.prototype.equals=function(a){return this==a};Object.defineProperties(b.XModelStructure,{TYPE_UNDEFINED:{value:-1},TYPE_NULL:{value:0},TYPE_RGB:{value:16},TYPE_RGBA:{value:17},TYPE_AXIS_ROTATE:{value:1},TYPE_QUATERNION:{value:2},TYPE_SCALE:{value:3},TYPE_TRANSLATE:{value:4},TYPE_MATRIX:{value:5},TYPE_CONTAINER:{value:6},TYPE_TEXTURE:{value:7},
TYPE_MATERIAL:{value:8},TYPE_MESH:{value:9},TYPE_SUB_MESH:{value:15},TYPE_NODE:{value:10},TYPE_IK:{value:11},TYPE_ANIMATION:{value:12},TYPE_ANIMATION_KEY:{value:13},TYPE_ANIMATION_SET:{value:14},SIZE_SINGLE:{value:1},SIZE_RGB:{value:3},SIZE_RGBA:{value:4},SIZE_VECTOR_3:{value:3},SIZE_AXIS_ROTATE:{value:4},SIZE_QUATERNION:{value:4},SIZE_SCALE:{value:3},SIZE_TRANSLATE:{value:3},SIZE_MATRIX:{value:16},NUM_BLEND_SLOT:{value:4}})})(xpl);
(function(b){b.XModelUserData=function(){this.data_size=0;this.data=null}})(xpl);(function(b){b.XModelParameter=function(a){b.XModelStructure.call(this,a)};Object.setPrototypeOf(b.XModelParameter.prototype,b.XModelStructure.prototype)})(xpl);(function(b){b.XModelFloat32Array=function(a,e){b.XModelStructure.call(this,a);this.size=e;this.values=new Float32Array(e*(b.XModelStructure.NUM_BLEND_SLOT+1))};Object.setPrototypeOf(b.XModelFloat32Array.prototype,b.XModelParameter.prototype)})(xpl);
(function(b){b.XModelAxisRotate=function(){b.XModelFloat32Array.call(this,b.XModelStructure.TYPE_AXIS_ROTATE,b.XModelStructure.SIZE_AXIS_ROTATE)};Object.setPrototypeOf(b.XModelAxisRotate.prototype,b.XModelFloat32Array.prototype);Object.defineProperties(b.XModelStructure,{X:{value:0},Y:{value:1},Z:{value:2},ANGLE:{value:3},SIZE:{value:4}})})(xpl);
(function(b){b.XModelQuaternion=function(){b.XModelFloat32Array.call(this,b.XModelStructure.TYPE_QUATERNION,b.XModelStructure.SIZE_QUATERNION)};Object.setPrototypeOf(b.XModelQuaternion.prototype,b.XModelFloat32Array.prototype)})(xpl);(function(b){b.XModelScale=function(){b.XModelFloat32Array.call(this,b.XModelStructure.TYPE_SCALE,xpl.XModelStructure.SIZE_SCALE)};Object.setPrototypeOf(b.XModelScale.prototype,b.XModelFloat32Array.prototype)})(xpl);
(function(b){b.XModelTranslate=function(){b.XModelFloat32Array.call(this,b.XModelStructure.TYPE_TRANSLATE,b.XModelStructure.SIZE_TRANSLATE)};Object.setPrototypeOf(b.XModelTranslate.prototype,b.XModelFloat32Array.prototype)})(xpl);(function(b){b.XModelMatrix=function(){b.XModelFloat32Array.call(this,b.XModelStructure.TYPE_MATRIX,b.XModelStructure.SIZE_MATRIX)};Object.setPrototypeOf(b.XModelMatrix.prototype,b.XModelFloat32Array.prototype)})(xpl);
(function(b){b.XModelExtensible=function(a){b.XModelStructure.call(this,a);this.user_object=this.user_data=null};Object.setPrototypeOf(b.XModelExtensible.prototype,b.XModelStructure.prototype)})(xpl);
(function(b){b.XModelContainer=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_CONTAINER);this.name=null;this.num_textures=0;this.textures=null;this.num_materials=0;this.materials=null;this.num_meshes=0;this.meshes=null;this.num_nodes=0;this.nodes=null;this.time_rate=1;this.num_animation_sets=0;this.animation_sets=null};Object.setPrototypeOf(b.XModelContainer.prototype,b.XModelExtensible.prototype);b.XModelContainer.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelTexture=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_TEXTURE);this.ref=this.name=null;this.data_size=0;this.texture=this.data=null;this.z_size=this.y_size=this.x_size=0};Object.setPrototypeOf(b.XModelTexture.prototype,b.XModelExtensible.prototype);b.XModelTexture.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelMaterial=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_MATERIAL);this.name=null;this.emissive=[0,0,0,1];this.ambient=[.1,.1,.1,1];this.diffuse=[1,1,1,1];this.specular=[.4,.4,.4,1];this.shininess=5;this.bump=1;this.bump_map=this.shininess_map=this.specular_map=this.diffuse_map=this.ambient_map=this.emissive_map=null;this.draw_mode=b.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS};Object.setPrototypeOf(b.XModelMaterial.prototype,b.XModelExtensible.prototype);Object.defineProperties(b.XModelMaterial,
{DRAW_MODE_FACE_NONE_BITS:{value:0},DRAW_MODE_FACE_FRONT_BITS:{value:1},DRAW_MODE_FACE_BACK_BITS:{value:2},DRAW_MODE_FACE_FRONT_AND_BACK_BITS:{value:b.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS|b.XModelMaterial.DRAW_MODE_FACE_BACK_BITS}});b.XModelMaterial.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelMeshBase=function(a){b.XModelExtensible.call(this,a);this.element_buffer=this.vertex_array=this.vertex_buffer=null};Object.setPrototypeOf(b.XModelMeshBase.prototype,b.XModelExtensible.prototype)})(xpl);
(function(b){b.XModelMesh=function(){b.XModelMeshBase.call(this,b.XModelStructure.TYPE_MESH);this.name=null;this.position_size=this.num_positions=0;this.positions=null;this.normal_size=this.num_normals=0;this.normals=null;this.color_size=this.num_colors=0;this.colors=null;this.tex_coord_size=this.num_tex_coords=0;this.skin=this.tex_coords=null;this.num_vertices=0;this.vertices=null;this.num_materials=0;this.materials=null;this.num_elements=0;this.elements=null;this.num_subsets=0;this.parent=this.subsets=
null};Object.setPrototypeOf(b.XModelMesh.prototype,b.XModelMeshBase.prototype);Object.defineProperties(b.XModelMesh,{TYPE_POSITION:{value:0},TYPE_NORMAL:{value:1}});b.XModelMesh.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelMeshSubset=function(){b.XModelMeshBase.call(this,b.XModelStructure.TYPE_SUB_MESH);this.num_bones=0;this.bones=null;this.num_vertices=0;this.vertices=null;this.num_elements=0;this.elements=null};Object.setPrototypeOf(b.XModelMesh.prototype,b.XModelMeshBase.prototype)})(xpl);
(function(b){b.XModelSkin=function(){this.weighted_index_stride=this.num_weighted_indices=0;this.weights=this.indices=this.weighted_index_sizes=null;this.num_nodes=0;this.offset_matrices=this.nodes=null}})(xpl);
(function(b){b.XModelVertex=function(){this.skinning=this.tex_coord=this.color=this.normal=this.position=-1};b.XModelVertex.prototype.hashCode=function(){return this.position^this.normal^this.color^this.tex_coord^this.skinning};b.XModelVertex.prototype.equals=function(a){return this===a?!0:null!=a&&a instanceof b.XModelVertex?this.position==a.position&&this.normal==a.normal&&this.color==a.color&&this.tex_coord==a.tex_coord&&this.skinning==a.skinning:!1}})(xpl);
(function(b){b.XModelElement=function(){this.material=-1;this.num_vertices=0;this.vertices=null};b.XModelElement.prototype.hashCode=function(){for(var a=this.material^this.num_vertices,b=0;b<this.num_vertices;++b)a^=this.vertices[b];return a};b.XModelElement.prototype.equals=function(a){if(a instanceof b.XModelElement&&this.material==a.material&&this.num_vertices==a.num_vertices){for(var e=0;e<this.vertices;++e)if(null==this.vertices[e]||!this.vertices[e].equals(a.vertices[e]))return!1;return!0}return!1}})(xpl);
(function(b){b.XModelNode=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_NODE);this.name=null;this.connected=!0;this.lock_axises=new Uint8Array([!1,!1,!1]);this.limit_angles=new Uint8Array([!1,!1,!1]);this.min_angles=new Float32Array([-Math.PI,-Math.PI,-Math.PI]);this.max_angles=new Float32Array([Math.PI,Math.PI,Math.PI]);this.bone_tail=new Float32Array([0,0,0]);this.transforms=[null,null,null,null];this.num_iks=0;this.iks=null;this.num_meshes=0;this.meshes=null;this.num_children=
0;this.parent=this.children=null;this.offset_matrix=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.combined_matrix=new Float32Array(b.XModelStructure.SIZE_MATRIX)};Object.setPrototypeOf(b.XModelNode.prototype,b.XModelExtensible.prototype);Object.defineProperties(b.XModelNode,{TRANSFORM_MATRIX:{value:0},TRANSFORM_TRANSLATE:{value:1},TRANSFORM_SCALE:{value:2},TRANSFORM_ROTATE:{value:3},NUM_TRANSFORMS:{value:4}});b.XModelNode.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelIK=function(){b.XModelStructure.call(this,b.XModelStructure.TYPE_IK);this.target=null;this.max_iterations=500;this.influence=this.chain_length=1};Object.setPrototypeOf(b.XModelIK.prototype,b.XModelStructure.prototype)})(xpl);
(function(b){b.XModelAnimation=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_ANIMATION);this.target=this.name=null;this.index=-1;this.num_keys=0;this.keys=null;this.num_children=0;this.children=null};Object.setPrototypeOf(b.XModelAnimation.prototype,b.XModelExtensible.prototype);b.XModelAnimation.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelAnimationKey=function(){b.XModelStructure.call(this,b.XModelStructure.TYPE_ANIMATION_KEY);this.interpolate=b.XModelAnimationKey.INTERPOLATE_UNKNOWN;this.value_size=this.after_time=this.before_time=this.time=0;this.after_value=this.before_value=this.value=null};Object.setPrototypeOf(b.XModelAnimationKey.prototype,b.XModelStructure.prototype);Object.defineProperties(b.XModelAnimationKey,{INTERPOLATE_UNKNOWN:{value:-1},INTERPOLATE_LINER:{value:0},INTERPOLATE_BEZIER:{value:1}})})(xpl);
(function(b){b.XModelAnimationSet=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_ANIMATION_SET);this.name=null;this.num_animations=0;this.animations=null};Object.setPrototypeOf(b.XModelAnimationSet.prototype,b.XModelExtensible.prototype);b.XModelAnimationSet.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelCodec=function(){};Object.defineProperties(b.XModelCodec,{CODE_NAME:{value:"EX-MACHINA"},MAGIC_NUMBER:{value:1633971576},END_OF_DATA:{value:1685614437},VERSION:{value:36},COMPATIBILITY_VERSION:{value:36},VERSION_NAME:{value:"0.9.92"},COMPATIBILITY_VERSION_NAME:{value:"0.9.92"}})})(xpl);(function(b){b.XModelDecoder=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};Object.setPrototypeOf(b.XModelDecoder.prototype,b.XModelCodec.prototype);b.XModelDecoder.prototype.decode=function(a){this.__data_view=new DataView(a);this.__data_offset=0;this.__inst_map={};this.__weak_inst_map={};if(this._getInt32()!=b.XModelCodec.MAGIC_NUMBER||this._getInt32()<b.XModelCodec.COMPATIBILITY_VERSION)return this._recycle(),null;a=this._getInt32();a=this._createStructureProcedure(a);
this._getStructureProcedure(a);this._getInt32()!=b.XModelCodec.END_OF_DATA&&console.error("Warning! This data doesn't has a terminator in the binary!");this._recycle();return a};b.XModelDecoder.prototype._recycle=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};b.XModelDecoder.prototype._getInt8=function(){var a=this.__data_view.getInt8(this.__data_offset);this.__data_offset+=1;return a};b.XModelDecoder.prototype._getUint8=function(){var a=this.__data_view.getUint8(this.__data_offset);
this.__data_offset+=1;return a};b.XModelDecoder.prototype._getInt16=function(){var a=this.__data_view.getInt16(this.__data_offset,!0);this.__data_offset+=2;return a};b.XModelDecoder.prototype._getInt32=function(){var a=this.__data_view.getInt32(this.__data_offset,!0);this.__data_offset+=4;return a};b.XModelDecoder.prototype._getFloat32=function(){var a=this.__data_view.getFloat32(this.__data_offset,!0);this.__data_offset+=4;return a};b.XModelDecoder.prototype._getFloat64=function(){var a=this.__data_view.getFloat64(this.__data_offset,
!0);this.__data_offset+=8;return a};b.XModelDecoder.prototype._getInt8Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt8()};b.XModelDecoder.prototype._getUint8Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getUint8()};b.XModelDecoder.prototype._getInt16Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt16()};b.XModelDecoder.prototype._getInt32Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt32()};b.XModelDecoder.prototype._getFloat32Array=function(a,b,c){for(var d=
0;d<c;++d)a[b+d]=this._getFloat32()};b.XModelDecoder.prototype._getFloat64Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getFloat64()};b.XModelDecoder.prototype._getBool=function(){return 0!=this._getInt8()};b.XModelDecoder.prototype._getBoolArray=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getBool()};b.XModelDecoder.prototype._getString=function(){var a=this._getInt16();if(0<a){var e=Array(a);this._getUint8Array(e,0,a);return b.StringUtils.decodeUTF8(e)}return null};b.XModelDecoder.prototype._getStringArray=
function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getString()};b.XModelDecoder.prototype._getStructure=function(){var a=this._getInt32();if(0==a)return null;var b=this._getInt32(),c=this.__inst_map[a];if(null!=c)return c;c=this.__weak_inst_map[a];null!=c?delete this.__weak_inst_map[a]:c=this._createStructureProcedure(b);this.__inst_map[a]=c;this._getStructureProcedure(c);return c};b.XModelDecoder.prototype._getStructureArray=function(a,b,c){for(var d=0;d<c;++d)a[b++]=this._getStructure()};b.XModelDecoder.prototype._getStructureRef=
function(){var a=this._getInt32();if(0==a)return null;var b=this._getInt32(),c=this.__inst_map[a]||this.__weak_inst_map[a];if(null!=c)return c;c=this._createStructureProcedure(b);this.__weak_inst_map[a]=c};b.XModelDecoder.prototype._getStructureRefArray=function(a,b,c){for(var d=0;d<c;++d)a[b++]=this._getStructureRef()};b.XModelDecoder.prototype._createStructureProcedure=function(a){switch(a){case b.XModelStructure.TYPE_AXIS_ROTATE:return new b.XModelAxisRotate;case b.XModelStructure.TYPE_QUATERNION:return new b.XModelQuaternion;
case b.XModelStructure.TYPE_SCALE:return new b.XModelScale;case b.XModelStructure.TYPE_TRANSLATE:return new b.XModelTranslate;case b.XModelStructure.TYPE_MATRIX:return new b.XModelMatrix;case b.XModelStructure.TYPE_CONTAINER:return new b.XModelContainer;case b.XModelStructure.TYPE_TEXTURE:return new b.XModelTexture;case b.XModelStructure.TYPE_MATERIAL:return new b.XModelMaterial;case b.XModelStructure.TYPE_MESH:return new b.XModelMesh;case b.XModelStructure.TYPE_NODE:return new b.XModelNode;case b.XModelStructure.TYPE_IK:return new b.XModelIK;
case b.XModelStructure.TYPE_ANIMATION:return new b.XModelAnimation;case b.XModelStructure.TYPE_ANIMATION_KEY:return new b.XModelAnimationKey;case b.XModelStructure.TYPE_ANIMATION_SET:return new b.XModelAnimationSet}return null};b.XModelDecoder.prototype._getStructureProcedure=function(a){switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:return this._getAxisRotate(a),!0;case b.XModelStructure.TYPE_QUATERNION:return this._getQuaternion(a),!0;case b.XModelStructure.TYPE_SCALE:return this._getScale(a),
!0;case b.XModelStructure.TYPE_TRANSLATE:return this._getTranslate(a),!0;case b.XModelStructure.TYPE_MATRIX:return this._getMatrix(a),!0;case b.XModelStructure.TYPE_CONTAINER:return this._getContainer(a),!0;case b.XModelStructure.TYPE_TEXTURE:return this._getTexture(a),!0;case b.XModelStructure.TYPE_MATERIAL:return this._getMaterial(a),!0;case b.XModelStructure.TYPE_MESH:return this._getMesh(a),!0;case b.XModelStructure.TYPE_NODE:return this._getNode(a),!0;case b.XModelStructure.TYPE_IK:return this._getIK(a),
!0;case b.XModelStructure.TYPE_ANIMATION:return this._getAnimation(a),!0;case b.XModelStructure.TYPE_ANIMATION_KEY:return this._getAnimationKey(a),!0;case b.XModelStructure.TYPE_ANIMATION_SET:return this._getAnimationSet(a),!0}return!1};b.XModelDecoder.prototype._getUserData=function(){this._getInt32();return null};b.XModelDecoder.prototype._getAxisRotate=function(a){this._getFloat32Array(a.values,0,b.XModelStructure.SIZE_AXIS_ROTATE)};b.XModelDecoder.prototype._getQuaternion=function(a){this._getFloat32Array(a.values,
0,b.XModelStructure.SIZE_QUATERNION)};b.XModelDecoder.prototype._getScale=function(a){this._getFloat32Array(a.values,0,b.XModelStructure.SIZE_SCALE)};b.XModelDecoder.prototype._getTranslate=function(a){this._getFloat32Array(a.values,0,b.XModelStructure.SIZE_TRANSLATE)};b.XModelDecoder.prototype._getMatrix=function(a){this._getFloat32Array(a.values,0,b.XModelStructure.SIZE_MATRIX)};b.XModelDecoder.prototype._getContainer=function(a){a.name=this._getString();a.num_textures=this._getInt16();0<a.num_textures&&
(a.textures=Array(a.num_textures),this._getStructureArray(a.textures,0,a.num_textures));a.num_materials=this._getInt16();0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_meshes=this._getInt16();0<a.num_meshes&&(a.meshes=Array(a.num_meshes),this._getStructureArray(a.meshes,0,a.num_meshes));a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),this._getStructureArray(a.nodes,0,a.num_nodes));a.time_rate=this._getFloat64();
a.num_animation_sets=this._getInt16();0<a.num_animation_sets&&(a.animation_sets=Array(a.num_animation_sets),this._getStructureArray(a.animation_sets,0,a.num_animation_sets));a.userData=this._getUserData()};b.XModelDecoder.prototype._getTexture=function(a){a.name=this._getString();a.ref=this._getString();a.data_size=this._getInt32();0<a.data_size&&(a.data=new Int8Array(a.data_size),this._getInt8Array(a.data,0,a.data_size));a.user_data=this._getUserData()};b.XModelDecoder.prototype._getMaterial=function(a){a.name=
this._getString();this._getFloat32Array(a.emissive,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.ambient,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.diffuse,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.specular,0,b.XModelStructure.SIZE_RGBA);a.shininess=this._getFloat32();a.bump=this._getFloat32();a.emissive_map=this._getStructure();a.ambient_map=this._getStructure();a.diffuse_map=this._getStructure();a.specular_map=this._getStructure();a.shininess_map=this._getStructure();
a.bump_map=this._getStructure();a.draw_mode=this._getInt32();a.user_data=this._getUserData()};b.XModelDecoder.prototype._getMesh=function(a){a.name=this._getString();a.num_positions=this._getInt32();if(0<a.num_positions){a.position_size=this._getInt8();var e=a.position_size*a.num_positions;a.positions=new Float32Array(e);this._getFloat32Array(a.positions,0,e)}a.num_normals=this._getInt32();0<a.num_normals&&(a.normal_size=this._getInt8(),e=a.normal_size*a.num_normals,a.normals=new Float32Array(e),
this._getFloat32Array(a.normals,0,e));a.num_colors=this._getInt32();0<a.num_colors&&(a.color_size=this._getInt8(),e=a.color_size*a.num_colors,a.colors=new Float32Array(e),this._getFloat32Array(a.colors,0,e));a.num_tex_coords=this._getInt32();0<a.num_tex_coords&&(a.tex_coord_size=this._getInt8(),e=a.tex_coord_size*a.num_tex_coords,a.tex_coords=new Float32Array(e),this._getFloat32Array(a.tex_coords,0,e));if(e=this._getBool())a.skin=new b.XModelSkin,this._getSkin(a.skin);a.num_vertices=this._getInt32();
if(0<a.num_vertices){a.vertices=Array(a.num_vertices);for(var c=0;c<a.num_vertices;++c){var d=new b.XModelVertex;this._getVertex(d,a.num_positions,a.num_normals,a.num_colors,a.num_tex_coords,e);a.vertices[c]=d}}a.num_materials=this._getInt16();0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_elements=this._getInt32();if(0<a.num_elements)for(a.elements=Array(a.num_elements),e=0;e<a.num_elements;++e)c=new b.XModelElement,this._getElement(c),
a.elements[e]=c;a.user_data=this._getUserData()};b.XModelDecoder.prototype._getSkin=function(a){a.num_weighted_indices=this._getInt32();a.weighted_index_stride=this._getInt8();if(0<a.num_weighted_indices){a.weighted_index_sizes=new Uint8Array(a.num_weighted_indices);var e=a.weighted_index_stride*a.num_weighted_indices;a.indices=new Int16Array(e);a.weights=new Float32Array(e);for(var c=0;c<e;++c)a.indices[c]=-1,a.weights[c]=0;b.ArrayUtils.fill(a.indices,0,e,-1);b.ArrayUtils.fill(a.weights,0,e,0);for(c=
e=0;e<a.num_weighted_indices;++e,c+=a.weighted_index_stride){var d=this._getInt8();a.weighted_index_sizes[e]=d;for(var g=0;g<d;++g){var f=c+g;a.indices[f]=this._getInt16();a.weights[f]=this._getFloat32()}}}a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),this._getStructureArray(a.nodes,0,a.num_nodes),e=b.XModelStructure.SIZE_MATRIX*a.num_nodes,a.offset_matrices=new Float32Array(e),this._getFloat32Array(a.offset_matrices,0,e))};b.XModelDecoder.prototype._getVertex=function(a,
b,c,d,g,f){0<b&&(a.position=this._getInt32());0<c&&(a.normal=this._getInt32());0<d&&(a.color=this._getInt32());0<g&&(a.tex_coord=this._getInt32());f&&(a.skinning=this._getInt32())};b.XModelDecoder.prototype._getElement=function(a){a.material=this._getInt16();a.num_vertices=this._getInt8();0<a.num_vertices&&(a.vertices=new Uint32Array(a.num_vertices),this._getInt32Array(a.vertices,0,a.num_vertices))};b.XModelDecoder.prototype._getNode=function(a){a.name=this._getString();a.connected=this._getBool();
this._getBoolArray(a.lock_axises,0,b.XModelStructure.SIZE_VECTOR_3);this._getBoolArray(a.limit_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.min_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.max_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.bone_tail,0,b.XModelStructure.SIZE_VECTOR_3);this._getStructureArray(a.transforms,0,b.XModelNode.NUM_TRANSFORMS);a.num_iks=this._getInt16();0<a.num_iks&&(a.iks=Array(a.num_iks),this._getStructureArray(a.iks,
0,a.num_iks));a.num_meshes=this._getInt16();if(0<a.num_meshes){a.meshes=Array(a.num_meshes);this._getStructureArray(a.meshes,0,a.num_meshes);for(var e=0;e<a.num_meshes;++e){var c=a.meshes[e];null!=c&&(c.parent=a)}}a.num_children=this._getInt16();if(0<a.num_children)for(a.children=Array(a.num_children),this._getStructureArray(a.children,0,a.num_children),e=0;e<a.num_children;++e)c=a.children[e],null!=c&&(c.parent=a);a.user_data=this._getUserData()};b.XModelDecoder.prototype._getIK=function(a){a.target=
this._getStructure();a.max_iterations=this._getInt16();a.chain_length=this._getInt16();a.influence=this._getFloat32()};b.XModelDecoder.prototype._getAnimation=function(a){a.name=this._getString();a.target=this._getStructure();a.index=this._getInt16();a.num_keys=this._getInt16();0<a.num_keys&&(a.keys=Array(a.num_keys),this._getStructureArray(a.keys,0,a.num_keys));a.num_children=this._getInt16();0<a.num_children&&(a.children=Array(a.num_children),this._getStructureArray(a.children,0,a.num_children));
a.user_data=this._getUserData()};b.XModelDecoder.prototype._getAnimationKey=function(a){a.interpolate=this._getInt8();a.time=this._getFloat64();a.value_size=this._getInt16();0<a.value_size&&(a.value=new Float32Array(a.value_size),this._getFloat32Array(a.value,0,a.value_size))};b.XModelDecoder.prototype._getAnimationSet=function(a){a.name=this._getString();a.num_animations=this._getInt16();0<a.num_animations&&(a.animations=Array(a.num_animations),this._getStructureArray(a.animations,0,a.num_animations));
a.user_data=this._getUserData()}})(xpl);(function(b){b.XModelMaterialUtils=function(){throw Error("Unsupported operation");};b.XModelMaterialUtils.getTextures=function(a,b,c,d){var g=0;null!=a&&(a.emissive_map&&(b&&0<d&&(b[c++]=a.emissive_map,d--),g++),a.ambient_map&&(b&&0<d&&(b[c++]=a.ambient_map,d--),g++),a.diffuse_map&&(b&&0<d&&(b[c++]=a.diffuse_map,d--),g++),a.specular_map&&(b&&0<d&&(b[c++]=a.specular_map,d--),g++),a.shininess_map&&(b&&0<d&&(b[c++]=a.shininess_map,d--),g++),a.bump_map&&(b&&0<d&&(b[c++]=a.bump_map),g++));return g};b.XModelMaterialUtils.releaseTexture=
function(a){null!=a&&(a.emissive_map&&(a.emissive_map.data=null,a.emissive_map.data_size=0),a.ambient_map&&(a.ambient_map.data=null,a.ambient_map.data_size=0),a.diffuse_map&&(a.diffuse_map.data=null,a.diffuse_map.data_size=0),a.specular_map&&(a.specular_map.data=null,a.specular_map.data_size=0),a.shininess_map&&(a.shininess_map.data=null,a.shininess_map.data_size=0),a.bump_map&&(a.bump_map.data=null,a.bump_map.data_size=0))}})(xpl);(function(b){b.XModelMeshUtils=function(){throw Error("Unsupported operation");};Object.defineProperties(b.XModelMeshUtils,{ATTRIBUTE_STRUCTURE_SIZE:{value:0},ATTRIBUTE_POSITION:{value:1},ATTRIBUTE_NORMAL:{value:2},ATTRIBUTE_COLOR:{value:3},ATTRIBUTE_TEXCOORD:{value:4},ATTRIBUTE_BONELENGTH:{value:5},ATTRIBUTE_BONEINDICES:{value:6},ATTRIBUTE_BONEWEIGHTS:{value:7},MAX_ATTRIBUTE:{value:8},TYPE_VOID:{value:0},TYPE_UNSIGNED_BYTE:{value:1},TYPE_UNSIGNED_SHORT:{value:2},TYPE_UNSIGNED_INT:{value:3},TYPE_FLOAT:{value:4}});
b.XModelMeshUtils.getAttributeValues=function(a,e,c,d,g,f,h){d=b.defaultValue(d,0);g=b.defaultValue(g,1);f=b.defaultValue(f,0);h=b.defaultValue(h,-1);e=0;if(null!=a&&null!=a.positions&&0<a.position_size){f<g&&(f=g);-1==h?(h=null,c=a.num_vertices):(h=a.subsets[h],c=h.num_vertices);for(var k=0;k<c;++k){var l=a.vertices[null==h?k:h.vertices[k]];if(-1!=l.position){for(var l=a.position_size*l.position,m=0;m<g&&m<a.position_size;++m)buf[d+m]=a.positions[l++],e++;for(;m<g;++m)buf[d+m]=0,e++}else for(l=0;l<
g;++l)buf[d+l]=0,e++;d+=f}}return e};b.XModelMeshUtils.getPositions=function(a,e,c,d,g,f){c=b.defaultValue(c,0);d=b.defaultValue(d,3);g=b.defaultValue(g,0);f=b.defaultValue(f,-1);var h=0;if(null!=a&&null!=a.positions&&0<a.position_size){g<d&&(g=d);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?l:f.vertices[l]];if(-1!=m.position){for(var m=a.position_size*m.position,n=0;n<d&&n<a.position_size;++n)e[c+n]=a.positions[m++],h++;for(;n<
d;++n)e[c+n]=0,h++}else for(m=0;m<d;++m)e[c+m]=0,h++;c+=g}}return h};b.XModelMeshUtils.getNormals=function(a,e,c,d,g,f){g=b.defaultValue(g,0);e=b.defaultValue(e,3);c=b.defaultValue(c,0);f=b.defaultValue(f,-1);var h=0;if(null!=a&&null!=a.normals&&0<a.normal_size){c<e&&(c=e);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?l:f.vertices[l]];if(-1!=m.normal){for(var m=a.normal_size*m.normal,n=0;n<e&&n<a.normal_size;++n)d[g+n]=a.normals[m++],
h++;for(;n<e;++n)d[g+n]=0,h++}else for(m=0;m<e;++m)d[g+m]=0,h++;g+=c}}return h};b.XModelMeshUtils.getColors=function(a,e,c,d,g,f){g=b.defaultValue(g,0);e=b.defaultValue(e,4);c=b.defaultValue(c,0);f=b.defaultValue(f,-1);var h=0;if(null!=a&&null!=a.colors&&0<a.color_size){void 0===f&&(f=-1);c<e&&(c=e);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=d instanceof Uint8Array||d instanceof Int8Array?255:1,m=0;m<k;++m){var n=a.vertices[null==f?m:f.vertices[m]];if(-1!=n.color){for(var n=
a.color_size*n.color,p=0;p<e&&p<a.color_size;++p)d[g+p]=a.colors[n++]*l,h++;for(;p<e;++p)d[g+p]=0,h++}else for(n=0;n<e;++n)d[g+n]=0,h++;g+=c}}return h};b.XModelMeshUtils.getTexCoords=function(a,e,c,d,g,f){g=b.defaultValue(g,0);e=b.defaultValue(e,2);c=b.defaultValue(c,0);f=b.defaultValue(f,-1);var h=0;if(null!=a&&null!=a.tex_coords&&0<a.tex_coord_size){void 0===f&&(f=-1);c<e&&(c=e);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?
l:f.vertices[l]];if(-1!=m.tex_coord){for(var m=a.tex_coord_size*m.tex_coord,n=0;n<e&&n<a.tex_coord_size;++n)d[g+n]=a.tex_coords[m++],h++;for(;n<e;++n)d[g+n]=0,h++}else for(m=0;m<e;++m)d[g+m]=0,h++;g+=c}}return h};b.XModelMeshUtils.getSkinBoneLengths=function(a,b,c,d,g){if(null!=a&&null!=a.skin&&1<a.skin.weighted_index_stride){void 0===g&&(g=-1);-1==g?(b=null,g=a.num_vertices):(b=a.subsets[g],g=b.num_vertices);for(var f=0;f<g;++f){var h=a.vertices[null==b?f:b.vertices[f]];c[d]=-1!=h.skinning?a.skin.weighted_index_sizes[h.skinning]:
0}}return 0};b.XModelMeshUtils.getSkinBoneIndices=function(a,e,c,d,g,f){c=b.defaultValue(c,0);f=b.defaultValue(f,-1);var h=0;if(null!=a&&null!=a.skin&&0<a.skin.weighted_index_stride){void 0===f&&(f=-1);c<e&&(c=e);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?l:f.vertices[l]];if(-1!=m.skinning){for(var n=a.skin.weighted_index_sizes[m.skinning],m=a.skin.weighted_index_stride*m.skinning,p=0;p<e&&p<n&&a.skin.weighted_index_stride;++p){if(null==
f)d[g+p]=a.skin.indices[m++];else{var q=b.ArrayUtils.binarySearch(f.bones,0,f.num_bones,a.skin.indices[m++]);d[g+p]=0<=q?q:0}h++}for(;p<e;++p)d[g+p]=0,h++}else for(n=0;n<e;++n)d[g+n]=0,h++;g+=c}}return h};b.XModelMeshUtils.getSkinBoneWeights=function(a,e,c,d,g,f){c=b.defaultValue(c,0);f=b.defaultValue(f,-1);var h=0;if(null!=a&&null!=a.skin&&0<a.skin.weighted_index_stride){void 0===f&&(f=-1);c<e&&(c=e);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=
a.vertices[null==f?l:f.vertices[l]];if(-1!=m.skinning){for(var n=a.skin.weighted_index_sizes[m.skinning],m=a.skin.weighted_index_stride*m.skinning,p=0;p<e&&p<n&&a.skin.weighted_index_stride;++p)d[g+p]=a.skin.weights[m++],h++;for(;p<e;++p)d[g+p]=0,h++}else for(n=0;n<e;++n)d[g+n]=0,h++;g+=c}}return h};b.XModelMeshUtils.getVerticesSize=function(a,e,c,d,g,f,h,k,l,m,n,p,q){n=b.defaultValue(n,null);p=b.defaultValue(p,0);q=b.defaultValue(q,-1);if(null!=a&&null!=a.vertices&&0<a.num_vertices){void 0===q&&
(q=-1);null!=n&&b.ArrayUtils.fill(n,p,p+b.XModelMeshUtils.MAX_ATTRIBUTE,-1);var r=0,t=e?1:-1==q?a.num_vertices:a.subsets[q].num_vertices;0<d&&0<a.position_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_POSITION]=r),r+=t*a.position_size*d,r=c*Math.floor((r+c-1)/c));0<g&&0<a.normal_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_NORMAL]=r),r+=t*a.normal_size*g,r=c*Math.floor((r+c-1)/c));0<f&&0<a.color_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_COLOR]=r),r+=t*a.color_size*f,r=c*Math.floor((r+
c-1)/c));0<h&&0<a.tex_coord_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD]=r),r+=t*a.tex_coord_size*h,r=c*Math.floor((r+c-1)/c));null!=a.skin&&0<a.skin.weighted_index_stride&&(0<k&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH]=r),r=c*Math.floor((r+t*k+c-1)/c)),0<l&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]=r),r+=t*a.skin.weighted_index_stride*l,r=c*Math.floor((r+c-1)/c)),0<m&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]=r),r+=t*a.skin.weighted_index_stride*
m,r=c*Math.floor((r+c-1)/c)));if(e)return n[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=r,(-1==q?a.num_vertices:a.subsets[q].num_vertices)*r;n[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=0;return r}return 0};b.XModelMeshUtils.getVertices=function(a,e,c,d,g,f,h,k,l,m,n,p,q){if(null!=a&&null!=a.vertices&&0<a.num_vertices){var r=l[m+b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE],t;if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_POSITION])switch(t=p+l[m+b.XModelMeshUtils.ATTRIBUTE_POSITION],e){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getPositions(a,
new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,a.position_size,r/4,q)}if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_NORMAL])switch(t=p+l[m+b.XModelMeshUtils.ATTRIBUTE_NORMAL],c){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getNormals(a,a.normal_size,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_COLOR])switch(t=p+l[m+b.XModelMeshUtils.ATTRIBUTE_COLOR],d){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getColors(a,a.color_size,
r,new Uint8Array(n,t),0,q);break;case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getColors(a,a.color_size,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD])switch(t=p+l[m+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD],g){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getTexCoords(a,a.tex_coord_size,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}if(null!=a.skin&&0<a.skin.weighted_index_stride){if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH])switch(t=
p+l[m+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH],f){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getSkinBoneLengths(a,r,new Uint8Array(n,t),0,q)}if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES])switch(t=p+l[m+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES],h){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getSkinBoneIndices(a,a.skin.weighted_index_stride,r,new Uint8Array(n,t),0,q);break;case b.XModelMeshUtils.TYPE_UNSIGNED_SHORT:b.XModelMeshUtils.getSkinBoneIndices(a,a.skin.weighted_index_stride,
r/2,new Uint16Array(n,t,Math.floor((n.byteLength-t)/2)),0,q)}if(0<=l[m+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS])switch(t=p+l[m+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS],k){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getSkinBoneWeights(a,a.skin.weighted_index_stride,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}}}};b.XModelMeshUtils.getNumTriangledFaceIndices=function(a,b,c){var d=0;if(null!=a){void 0===c&&(c=-1);-1!=c&&(a=a.subsets[c]);c=a.num_elements;a=a.elements;for(var g=
0;g<c;++g){var f=a[g];f.material==b&&3<=f.num_vertices&&(d+=3*(f.num_vertices-2))}}return d};b.XModelMeshUtils.getNumAllTriangledFaceIndices=function(a,e,c,d,g,f){var h=0;if(null!=a){for(var k=0;k<a.num_materials;++k){null!=e&&(e[c+k]=h);var l=b.XModelMeshUtils.getNumTriangledFaceIndices(a,k,f);null!=d&&(d[g+k]=l);h+=l}null!=e&&(e[c+a.num_materials]=h);e=b.XModelMeshUtils.getNumTriangledFaceIndices(a,-1,f);null!=d&&(d[g+a.num_materials]=e);h+=e}return h};b.XModelMeshUtils.getTriangledFaceIndices=
function(a,b,c,d,g,f){var h=0;if(null!=a){void 0===f&&(f=-1);-1!=f&&(a=a.subsets[f]);f=a.num_elements;a=a.elements;var k,l;c?(c=0,k=2,l=1):(c=0,k=1,l=2);for(var m=0;m<f;++m){var n=a[m];if(n.material==b)for(var p=0,q=n.num_vertices-2;p<q;++p)d[g+c]=n.vertices[0],d[g+k]=n.vertices[p+1],d[g+l]=n.vertices[p+2],g+=3,h+=3}}return h};b.XModelMeshUtils.getAllTriangledFaceIndices=function(a,e,c,d,g,f,h){var k=0;if(null!=a)for(var l=0;l<a.num_materials;++l)k+=b.XModelMeshUtils.getTriangledFaceIndices(a,l,e,
g,f+c[d+l],h);return k};b.XModelMeshUtils.releaseShape=function(a){if(null!=a&&(a.positions=null,a.normals=null,a.colors=null,a.tex_coords=null,a.vertices=null,null!=a.skin&&(a.skin.weighted_index_sizes=null,a.skin.indices=null,a.skin.weights=null),a.elements=null,null!=a.subsets))for(var b=0;b<a.num_subsets;++b){var c=a.subsets[b];c.vertices=null;c.elements=null}};b.XModelMeshUtils.getTextures=function(a,e,c,d){var g=0;if(null!=a)for(var f=0;f<a.num_materials;++f){var h=b.XModelMaterialUtils.getTextures(a.materials[f],
e,c,d);c+=h;d-=h;g+=h}return g};b.XModelMeshUtils.releaseTextures=function(a){if(null!=a)for(var e=0;e<a.num_materials;++e)b.XModelMaterialUtils.releaseTexture(a.materials[e])}})(xpl);(function(b){var a=b.Geometry.SIZE_VECTOR_3,e=b.Geometry.SIZE_MATRIX_4X4;b.XModelSkinUtils=function(){throw Error("Unsupported operation");};b.XModelSkinUtils.updateMatrixPallet=function(a,d,g,f){if(null!=a){for(var h=0;h<a.num_nodes&&h<d;++h){var k=e*h,l=a.nodes[h];null!=l?b.Matrix4x4.mulv(g,f+k,l.combined_matrix,0,a.offset_matrices,k):b.Matrix4x4.loadIdentity(g,f+k)}return Math.min(a.num_nodes,d)}return 0};b.XModelSkinUtils.updateVertices=function(c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w){k<a&&(k=a);n<
a&&(n=a);x<p&&(x=p);t<p&&(t=p);switch(w){case b.XModelMesh.TYPE_POSITION:w=b.Vector3.mulMatrix4x4v;break;case b.XModelMesh.TYPE_NORMAL:w=b.Vector3.mulMatrix4x4Axisv;break;default:throw Error("Unsupported the type of NaN");}if(1==p)for(p=0;p<g;++p)w(l,m,c,d+e*q[r],f,h,!0),h+=k,m+=n,r+=t;else if(1<p)for(var B=new Float32Array(a),E=0;E<g;++E){b.Vector3.loadZero(l,m);for(var F=0;F<p;++F){var H=u[v+F];0<H&&(w(B,0,c,d+e*q[r+F],f,h,!0),b.Vector3.mulv(B,0,B,0,H),b.Vector3.addv(l,m,l,m,B,0))}h+=k;m+=n;r+=
t;v+=x}}})(xpl);(function(b){b.XModelParameterUtils=function(){throw Error("Unsupported operation");};b.XModelParameterUtils.copy=function(a,e,c){if(null!=a)switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:case b.XModelStructure.TYPE_QUATERNION:case b.XModelStructure.TYPE_SCALE:case b.XModelStructure.TYPE_TRANSLATE:case b.XModelStructure.TYPE_MATRIX:b.ArrayUtils.copy(a.values,a.size*c,a.values,a.size*e,a.size)}};b.XModelParameter.blendFloatArray=function(a,b,c,d,g){if(null!=a)for(var f=0;f<a.size;++f)a.values[a.size*
b+f]=a.values[a.size*c+f]*(1-g)+a.values[a.size*d+f]*g};b.XModelParameterUtils.blend=function(a,e,c,d,g){g=b.defaultValue(g,0);if(null!=a)switch(a.structure_type){case b.XModelStructure.TYPE_RGB:case b.XModelStructure.TYPE_RGBA:b.XModelParameterUtils.blendFloatArray(a,e,c,d,g);break;case b.XModelStructure.TYPE_AXIS_ROTATE:b.Vector3.slerpv(a.values,a.size*e,a.values,a.size*c,a.values,a.size*d,g);a.values[a.size*e+b.XModelAxisRotate.ANGLE]=a.values[a.size*c+b.XModelAxisRotate.ANGLE]*(1-g)+a.values[a.size*
c+b.XModelAxisRotate.ANGLE]*g;break;case b.XModelStructure.TYPE_QUATERNION:b.Quaternion.slerpv(a.values,a.size*e,a.values,a.size*c,a.values,a.size*d,g);break;case b.XModelStructure.TYPE_SCALE:case b.XModelStructure.TYPE_TRANSLATE:b.Vector3.lerpv(a.values,a.size*e,a.values,a.size*c,a.values,a.size*d,g);break;case b.XModelStructure.TYPE_MATRIX:b.Matrix4x4.slrepAxisAndLrepOtherv(a.values,a.size*e,a.values,a.size*c,a.values,a.size*d,g)}};b.XModelParameterUtils.applyTransform=function(a,e,c,d){d=b.defaultValue(d,
0);if(null!=a)switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:d*=a.size;b.Matrix4x4.mulRotate(e,c,a.values[d+b.XModelAxisRotate.X],a.values[d+b.XModelAxisRotate.Y],a.values[d+b.XModelAxisRotate.Z],a.values[d+b.XModelAxisRotate.ANGLE],!0);break;case b.XModelStructure.TYPE_QUATERNION:b.Matrix4x4.mulQuaternionv(e,c,a.values,a.size*d);break;case b.XModelStructure.TYPE_SCALE:d*=a.size;b.Matrix4x4.mulScale(e,c,a.values[d+b.Geometry.VX],a.values[d+b.Geometry.VY],a.values[d+b.Geometry.VZ]);
break;case b.XModelStructure.TYPE_TRANSLATE:d*=a.size;b.Matrix4x4.mulTranslate(e,c,a.values[d+b.Geometry.VX],a.values[d+b.Geometry.VY],a.values[d+b.Geometry.VZ],!0);break;case b.XModelStructure.TYPE_MATRIX:b.Matrix4x4.mulv(e,c,e,c,a.values,a.size*d)}}})(xpl);(function(b){var a=b.Geometry.VX,e=b.Geometry.VY,c=b.Geometry.VZ,d=b.Geometry.CI,g=b.Geometry.CJ,f=b.Geometry.CK,h=b.Geometry.M4X4_00,k=b.Geometry.M4X4_01,l=b.Geometry.M4X4_02,m=b.Geometry.M4X4_03,n=b.Geometry.M4X4_10,p=b.Geometry.M4X4_11,q=b.Geometry.M4X4_12,r=b.Geometry.M4X4_13,t=b.Geometry.M4X4_20,u=b.Geometry.M4X4_21,v=b.Geometry.M4X4_22,x=b.Geometry.M4X4_23;b.XModelKinematicsUtils=function(){throw Error("Unsupported operation");};var w=function(a,c){this.node=a;this.local_transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);
this.transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.offset_transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.rotate=new Float32Array(b.XModelStructure.SIZE_QUATERNION);this.min_sins=new Float32Array(b.XModelStructure.SIZE_VECTOR_3);this.max_sins=new Float32Array(b.XModelStructure.SIZE_VECTOR_3);b.Matrix4x4.loadIdentity(this.local_transform,0);for(a=0;a<b.XModelNode.TRANSFORM_ROTATE;++a)b.XModelParameterUtils.applyTransform(this.node.transforms[a],this.local_transform,
0,1);b.Matrix4x4.normalizeAxisv(this.local_transform,0,this.local_transform,0,!0);a=this.local_transform[h];var d=this.local_transform[k],e=this.local_transform[n],g=this.local_transform[p],f=this.local_transform[t],m=this.local_transform[u];0>(e*m-f*g)*this.local_transform[l]+(f*d-a*m)*this.local_transform[q]+(a*g-e*d)*this.local_transform[v]&&(this.local_transform[h]=-this.local_transform[h],this.local_transform[k]=-this.local_transform[k],this.local_transform[l]=-this.local_transform[l],this.local_transform[n]=
-this.local_transform[n],this.local_transform[p]=-this.local_transform[p],this.local_transform[q]=-this.local_transform[q],this.local_transform[t]=-this.local_transform[t],this.local_transform[u]=-this.local_transform[u],this.local_transform[v]=-this.local_transform[v]);a=this.node.transforms[b.XModelNode.TRANSFORM_ROTATE];a.structure_type==b.XModelStructure.TYPE_AXIS_ROTATE?(c*=a.size,b.Quaternion.loadRotate(this.rotate,0,a.values[c+b.XModelAxisRotate.X],a.values[c+b.XModelAxisRotate.Y],a.values[c+
b.XModelAxisRotate.Z],a.values[c+b.XModelAxisRotate.ANGLE],!0)):a.structure_type==b.XModelStructure.TYPE_QUATERNION?(b.Quaternion.loadv(this.rotate,0,a.values,a.size*c),b.Quaternion.normalizev(this.rotate,0,this.rotate,0)):b.Quaternion.loadIdentity(this.rotate,0);for(a=0;a<b.XModelStructure.SIZE_VECTOR_3;++a)this.min_sins[a]=Math.sin(.5*this.node.min_angles[a]),this.max_sins[a]=Math.sin(.5*this.node.max_angles[a])};w.prototype.updateOffsetTransform=function(){var a=this.transform[h],c=this.transform[n],
d=this.transform[t],e=this.transform[k],g=this.transform[p],f=this.transform[u],w=this.transform[l],z=this.transform[q],J=this.transform[v],A=-this.transform[m],y=-this.transform[r],M=-this.transform[x];b.Matrix4x4.load(this.offset_transform,0,a,c,d,A*a+y*c+M*d,e,g,f,A*e+y*g+M*f,w,z,J,A*w+y*z+M*J,0,0,0,1,!1)};b.XModelKinematicsUtils.applyInverseKinematicsLocation=function(h,k,l,n,p,q){if(null!=h&&1<=n){for(var t=h,v=1;v<n&&null!=t.parent;)t=t.parent,v++;if(1==n||1>=v)l=1;n=Array(v);var u=h;for(h=
0;h<v;++h)n[h]=new w(u,q),u=u.parent;var A=new Float32Array(b.XModelStructure.SIZE_VECTOR_3),y=new Float32Array(b.XModelStructure.SIZE_QUATERNION),M=new Float32Array(b.XModelStructure.SIZE_QUATERNION),L=new Float32Array(b.XModelStructure.SIZE_QUATERNION),I;for(h=0;h<l;++h){var u=n[0],D=v;I=n;var N=I[D-1];null!=N.node.parent?b.Matrix4x4.mulv(N.transform,0,N.node.parent.combined_matrix,0,N.local_transform,0):b.Matrix4x4.loadv(N.transform,0,N.local_transform,0,!1);b.Matrix4x4.mulQuaternionv(N.transform,
0,N.rotate,0,!0);N.updateOffsetTransform();for(D-=2;0<=D;--D){var S=N,N=I[D];b.Matrix4x4.mulv(N.transform,0,S.transform,0,N.local_transform,0);b.Matrix4x4.mulQuaternionv(N.transform,0,N.rotate,0,!0);N.updateOffsetTransform()}b.Vector3.mulMatrix4x4v(A,0,u.transform,0,u.node.bone_tail,0,!0);u=A[a]-k[a];I=A[e]-k[e];N=A[c]-k[c];if(u*u+I*I+N*N<=p)break;I=!1;for(N=0;N<v;++N){var u=n[N],D=u.transform[m],S=u.transform[r],T=u.transform[x];b.Quaternion.loadRotateVector3(y,0,A[a]-D,A[e]-S,A[c]-T,!0,k[a]-D,k[e]-
S,k[c]-T,!0,(N+1)/v*(h==l-1?1:.5));I&&(b.Quaternion.mulv(y,0,y,0,L,0),I=!1);b.Quaternion.loadv(L,0,y,0);b.Vector3.mulMatrix4x4Axisv(y,d,u.offset_transform,0,y,d,!0);b.Quaternion.conjugatev(y,0,y,0);b.Quaternion.loadv(M,0,u.rotate,0);b.Quaternion.mulv(u.rotate,0,y,0,u.rotate,0);for(var V=0;V<b.XModelStructure.SIZE_VECTOR_3;++V)if(u.node.lock_axises[V])u.rotate[d+V]=0,I=!0;else{var P=u.rotate[d+V],Q=b.MathUtils.mid(P,u.min_sins[V],u.max_sins[V]);P!=Q&&(u.rotate[d+V]=Q,I=!0)}I&&(b.Quaternion.normalizev(u.rotate,
0,u.rotate,0),b.Quaternion.divv(y,0,u.rotate,0,M,0));b.Quaternion.conjugatev(y,0,y,0);b.Vector3.sub(A,0,A[a],A[e],A[c],D,S,T);b.Vector3.mulMatrix4x4Axisv(y,d,u.transform,0,y,d,!0);b.Vector3.mulQuaternionv(A,0,y,0,A,0);b.Vector3.add(A,0,A[a],A[e],A[c],D,S,T);I&&b.Quaternion.divv(L,0,L,0,y,0)}}for(h=0;h<v;++h)u=n[h],k=u.node.transforms[b.XModelNode.TRANSFORM_ROTATE],k.structure_type==b.XModelStructure.TYPE_AXIS_ROTATE?(l=u.rotate[d],p=u.rotate[g],A=u.rotate[f],y=l*l+p*p+A*A,0<y&&(y=Math.sqrt(y),l/=
y,p/=y,A/=y),y=k.size*q,k.values[y+b.XModelAxisRotate.X]=l,k.values[y+b.XModelAxisRotate.Y]=p,k.values[y+b.XModelAxisRotate.Z]=A,k.values[y+b.XModelAxisRotate.ANGLE]=Math.acos(u.rotation[b.Geometry.CR])):k.structure_type==b.XModelStructure.TYPE_QUATERNION&&b.Quaternion.loadv(k.values,k.size*q,u.rotate,0);q=t;null!=q.parent?b.XModelNodeUtils.updateCombinationv(q,q.num_children,q.children,0,q.parent.combined_matrix,0):b.XModelNodeUtils.updateCombination(q)}};b.XModelKinematicsUtils.applyInverseKinematics=
function(a,c,d,e,g,f){null!=a&&null!=c&&(g=new Float32Array(b.XModelStructure.SIZE_VECTOR_3),b.Vector3.loadZero(g,0),b.Vector3.mulMatrix4x4v(g,0,c.combined_matrix,0,g,0),b.XModelKinematicsUtils.applyInverseKinematicsLocation(a,g,d,e,1E-4,f))};b.XModelKinematicsUtils.applyCopyTransform=function(a,b){}})(xpl);(function(b){b.XModelAnimationUtils=function(){throw Error("Unsupported operation");};b.interpolateRotate=function(a,e,c,d,g){if(null!=a){var f=a.target;g*=f.size;-1==a.index?(b.Vector3.slerpv(f.values,g,e.value,0,c.value,0,d),f.values[g+b.XModelAxisRotate.ANGLE]=e.value[b.XModelAxisRotate.ANGLE]*(1-d)+c.value[b.XModelAxisRotate.ANGLE]*d):f.values[g+a.index]=e.value[0]*(1-d)+c.value[0]*d}};b.interpolateQuaternion=function(a,e,c,d,g){if(null!=a){var f=a.target;g*=f.size;-1==a.index?b.Quaternion.slerpv(f.values,
g,e.value,0,c.value,0,d):f.values[g+a.index]=e.value[0]*(1-d)+c.value[0]*d}};b.interpolateScale=function(a,e,c,d,g){if(null!=a){var f=a.target;g*=f.size;-1==a.index?b.Vector3.lerpv(f.values,g,key0.value,0,key1.value,0,weight):f.values[g+a.index]=e.value[0]*(1-d)+c.value[0]*d}};b.interpolateTranslate=function(a,e,c,d,g){if(null!=a){var f=a.target;g*=f.size;-1==a.index?b.Vector3.lerpv(f.values,g,e.value,0,c.value,0,weight):f.values[g+a.index]=e.value[0]*(1-d)+c.value[0]*d}};b.interpolateMatrix=function(a,
e,c,d,g){if(null!=a){var f=a.target;g*=f.size;-1==a.index?b.Matrix4x4.slrepAxisAndLrepOtherv(f.values,g,e.value,0,c.value,0,weight):f.values[g+a.index]=e.value[0]*(1-d)+c.value[0]*d}};b.XModelAnimationUtils.setAnimation=function(a,e){if(null!=a){if(0<a.num_keys){var c,d,g;if(1==a.num_keys)c=a.keys[0],d=a.keys[0],g=0;else{a:{c=0;d=a.num_keys;for(d--;c<=d;){g=c+d>>1;var f=a.keys[g].time;if(f<e)c=g+1;else if(f>e)d=g-1;else{d=g;break a}}d=-(c+1)}0<=d?(c=a.keys[d],d=a.keys[d],g=0):-1!=d?(d=-(d+2),d<a.num_keys-
1?(c=a.keys[d+0],d=a.keys[d+1],g=(e-c.time)/(d.time-c.time)):(c=a.keys[d],d=a.keys[d],g=0)):(c=a.keys[0],d=a.keys[0],g=0)}switch(a.target.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:b.interpolateRotate(a,c,d,g,1);break;case b.XModelStructure.TYPE_QUATERNION:b.interpolateQuaternion(a,c,d,g,1);break;case b.XModelStructure.TYPE_SCALE:b.interpolateScale(a,c,d,g,1);break;case b.XModelStructure.TYPE_TRANSLATE:b.interpolateTranslate(a,c,d,g,1);break;case b.XModelStructure.TYPE_MATRIX:b.interpolateMatrix(a,
c,d,g,1)}}for(c=0;c<a.num_children;++c)b.XModelAnimation.setAnimation(a.children[c],e)}};b.XModelAnimationUtils.setAnimationSet=function(a,e){if(null!=a)for(var c=0;c<a.num_animations;++c)b.XModelAnimationUtils.setAnimation(a.animations[c],e)};b.XModelAnimationUtils.getAnimationTotalTime=function(a){var e=0;if(null!=a){for(var c=0;c<a.num_keys;++c){var d=a.keys[a.num_keys-1].time;e<d&&(e=d)}for(c=0;c<a.num_children;++c)d=b.XModelAnimationUtils.getAnimationTotalTime(a.children[c]),e<d&&(e=d)}return e};
b.XModelAnimationUtils.getAnimationSetTotalTime=function(a){var e=0;if(null!=a)for(var c=0;c<a.num_animations;++c){var d=b.XModelAnimationUtils.getAnimationTotalTime(a.animations[c]);e<d&&(e=d)}return e}})(xpl);(function(b){b.XModelNodeUtils=function(){throw Error("Unsupported operation");};b.XModelNodeUtils.getTextures=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_meshes;++f){var h=b.XModelMeshUtils.getTextures(a.meshes[f],e,c,d);c+=h;d-=h;g+=h}for(f=0;f<a.num_children;++f)h=b.XModelNodeUtils.getTextures(a.children[f],e,c,d),c+=h,d-=h,g+=h}return g};b.XModelNodeUtils.releaseTextures=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseTextures(a.meshes[e]);for(e=0;e<
a.num_children;++e)b.XModelNodeUtils.releaseTextures(a.children[e])}};b.XModelNodeUtils.getMeshes=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_meshes;++f){var h=a.meshes[f];null!=h&&(null!=e&&0<d&&(e[c++]=h,d--),g++)}for(f=0;f<a.num_children;++f)h=b.XModelNodeUtils.getMeshes(a.children[f],e,c,d),c+=h,d-=h,g+=h}return g};b.XModelNodeUtils.releaseShapes=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseShape(a.meshes[e]);for(e=0;e<a.num_children;++e)b.XModelNodeUtils.releaseShapes(a.children[e])}};
b.XModelNodeUtils.getNodes=function(a,e,c,d){var g=0;if(null!=a){null!=e&&0<d&&(e[c++]=a,d--);g++;for(var f=0;f<a.num_children;++f){var h=b.XModelNodeUtils.getNodes(a.children[f],e,c,d);c+=h;d-=h;g+=h}}return g};b.XModelNodeUtils.updateParent=function(a,e){if(null!=a){a.parent=e;for(e=0;e<a.num_meshes;++e)a.meshes[e].parent=a;for(e=0;e<a.num_children;++e)b.XModelNodeUtils.updateParent(a.children[e],a)}};b.XModelNodeUtils.updateCombinationp=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B){if(null!=
a){b.Matrix4x4.load(a.combined_matrix,0,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B);for(var E=0;E<b.XModelNode.NUM_TRANSFORMS;++E)b.XModelParameterUtils.applyTransform(a.transforms[E],a.combined_matrix,0,1);g=a.combined_matrix[b.Geometry.M4X4_00];f=a.combined_matrix[b.Geometry.M4X4_01];h=a.combined_matrix[b.Geometry.M4X4_02];k=a.combined_matrix[b.Geometry.M4X4_03];l=a.combined_matrix[b.Geometry.M4X4_10];m=a.combined_matrix[b.Geometry.M4X4_11];n=a.combined_matrix[b.Geometry.M4X4_12];p=a.combined_matrix[b.Geometry.M4X4_13];
q=a.combined_matrix[b.Geometry.M4X4_20];r=a.combined_matrix[b.Geometry.M4X4_21];t=a.combined_matrix[b.Geometry.M4X4_22];u=a.combined_matrix[b.Geometry.M4X4_23];v=a.combined_matrix[b.Geometry.M4X4_30];x=a.combined_matrix[b.Geometry.M4X4_31];w=a.combined_matrix[b.Geometry.M4X4_32];B=a.combined_matrix[b.Geometry.M4X4_33];for(E=0;E<e;++E)a=c[d+E],b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,g,f,h,k,l,m,n,p,q,r,t,u,v,x,w,B)}};b.XModelNodeUtils.updateCombinationv=function(a,e,c,d,
g,f){b.XModelNodeUtils.updateCombinationp(a,e,c,d,g[f+b.Geometry.M4X4_00],g[f+b.Geometry.M4X4_01],g[f+b.Geometry.M4X4_02],g[f+b.Geometry.M4X4_03],g[f+b.Geometry.M4X4_10],g[f+b.Geometry.M4X4_11],g[f+b.Geometry.M4X4_12],g[f+b.Geometry.M4X4_13],g[f+b.Geometry.M4X4_20],g[f+b.Geometry.M4X4_21],g[f+b.Geometry.M4X4_22],g[f+b.Geometry.M4X4_23],g[f+b.Geometry.M4X4_30],g[f+b.Geometry.M4X4_31],g[f+b.Geometry.M4X4_32],g[f+b.Geometry.M4X4_33])};b.XModelNodeUtils.updateCombination=function(a,e,c,d){b.XModelNodeUtils.updateCombinationp(a,
e,c,d,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};b.XModelNodeUtils.updateCombinationAllp=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v){null!=a&&b.XModelNodeUtils.updateCombinationp(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v)};b.XModelNodeUtils.updateCombinationAllv=function(a,e,c){null!=a&&b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,e[c+b.Geometry.M4X4_00],e[c+b.Geometry.M4X4_01],e[c+b.Geometry.M4X4_02],e[c+b.Geometry.M4X4_03],e[c+b.Geometry.M4X4_10],e[c+b.Geometry.M4X4_11],e[c+b.Geometry.M4X4_12],
e[c+b.Geometry.M4X4_13],e[c+b.Geometry.M4X4_20],e[c+b.Geometry.M4X4_21],e[c+b.Geometry.M4X4_22],e[c+b.Geometry.M4X4_23],e[c+b.Geometry.M4X4_30],e[c+b.Geometry.M4X4_31],e[c+b.Geometry.M4X4_32],e[c+b.Geometry.M4X4_33])};b.XModelNodeUtils.updateCombinationAll=function(a){null!=a&&b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};b.XModelNodeUtils.updateOffset=function(a){if(null!=a){b.Matrix4x4.inversev(a.offset_matrix,0,a.combined_matrix,0);for(var e=
0;e<a.num_children;++e)b.XModelNodeUtils.updateOffset(a.children[e])}};b.XModelNodeUtils.applyKinematics=function(a){if(null!=a){for(var e=0;e<a.num_iks;++e){var c=a.iks[e];null!=c&&b.XModelKinematicsUtils.applyInverseKinematics(a,c.target,c.max_iterations,c.chain_length,1E-4*Math.PI,1)}for(e=0;e<a.num_children;++e)b.XModelNodeUtils.applyKinematics(a.children[e])}};b.XModelNodeUtils.resetTransforms=function(a){if(null!=a){for(var e=0;e<b.XModelNode.NUM_TRANSFORMS;++e)b.XModelParameterUtils.copy(a.transforms[e],
1,0);for(e=0;e<a.num_children;++e)b.XModelNodeUtils.resetTransforms(a.children[e])}};b.XModelNodeUtils.forEachMesh=function(a,e,c){if(null!=a){for(var d=0;d<a.num_meshes;++d){var g=a.meshes[d];null!=g&&e(g,c)}for(d=0;d<a.num_children;++d)b.XModelNodeUtils.forEachMesh(a.children[d],e,c)}};b.XModelNodeUtils.forEachNode=function(a,e,c,d){if(null!=a){e(a,c,d);c+=1;for(var g=0;g<a.num_children;++g)b.XModelNodeUtils.forEachNode(a.children[g],e,c,d)}}})(xpl);(function(b){b.XModelContainerUtils=function(){throw Error("Unsupported operation");};b.XModelContainerUtils.getTextures=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<a.num_textures;++f){var h=a.textures[f];null!=h&&(null!=e&&0<d&&(e[c++]=h,d--),g++)}for(f=0;f<a.num_materials;++f)h=b.XModelMaterialUtils.getTextures(a.materials[f],e,c,d),c+=h,d-=h,g+=h;for(f=0;f<a.num_meshes;++f)h=b.XModelMeshUtils.getTextures(a.meshes[f],e,c,d),c+=h,d-=h,g+=h;for(f=0;f<a.num_nodes;++f)h=b.XModelNodeUtils.getTextures(a.nodes[f],
e,c,d),c+=h,d-=h,g+=h}return g};b.XModelContainerUtils.releaseTextures=function(a){if(null!=a){for(var e=0;e<a.num_textures;++e){var c=a.textures[e];null!=c&&(c.data=null,c.data_size=0)}for(e=0;e<a.num_materials;++e)b.XModelMaterialUtils.releaseTexture(a.materials[e]);for(e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseTextures(a.meshes[e]);for(e=0;e<a.num_nodes;++e)b.XModelNodeUtils.releaseTextures(a.nodes[e])}};b.XModelContainerUtils.getMeshes=function(a,e,c,d){var g=0;if(null!=a){for(var f=0;f<
a.num_meshes;++f){var h=a.meshes[f];null!=h&&(null!=e&&0<d&&(e[c++]=h,d--),g++)}for(f=0;f<a.num_nodes;++f)h=b.XModelNodeUtils.getMeshes(node,e,c,d),c+=h,d-=h,g+=h}return g};b.XModelContainerUtils.releaseShapes=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e)b.XModelMeshUtils.releaseShape(a.meshes[e]);for(e=0;e<a.num_nodes;++e)b.XModelNodeUtils.releaseShapes(a.nodes[e])}};b.XModelContainerUtils.getNodes=function(a,e,c,d){var g=0;if(null!=a)for(var f=0;f<a.num_nodes;++f){var h=b.XModelNodeUtils.getNodes(a.nodes[f],
e,c,d);c+=h;d-=h;g+=h}return g};b.XModelContainerUtils.updateParent=function(a){if(null!=a){for(var e=0;e<a.num_meshes;++e){var c=a.meshes[e];null!=c&&(c.parent=null)}for(e=0;e<a.num_nodes;++e)b.XModelNodeUtils.updateParent(a.nodes[e],null)}};b.XModelContainerUtils.updateCombinationp=function(a,e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v){if(null!=a)for(var x=0;x<a.num_nodes;++x)b.XModelNodeUtils.updateCombinationAllp(a.nodes[x],e,c,d,g,f,h,k,l,m,n,p,q,r,t,u,v)};b.XModelContainerUtils.updateCombinationv=function(a,
e,c){if(null!=a)for(var d=0;d<a.num_nodes;++d)b.XModelNodeUtils.updateCombinationAllv(a.nodes[d],e,c)};b.XModelContainerUtils.updateCombination=function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.updateCombinationAll(a.nodes[e])};b.XModelContainerUtils.updateOffset=function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.updateOffset(a.nodes[e])};b.XModelContainerUtils.setAnimation=function(a,e,c,d){if(null!=a&&0<=e&&e<a.num_animation_sets){e=a.animation_sets[e];var g=
b.XModelAnimationUtils.getAnimationSetTotalTime(e);c*=a.time_rate;0<g&&d?c%=g:b.MathUtils.mid(0,g,c);b.XModelAnimationUtils.setAnimationSet(e,c)}};b.XModelContainerUtils.getAnimationTotalTime=function(a,e){return null!=a&&0<=e&&e<a.num_animation_sets?b.XModelAnimationUtils.getAnimationSetTotalTime(a.animation_sets[e])/a.time_rate:0};b.XModelContainerUtils.applyKinematics=function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.applyKinematics(a.nodes[e])};b.XModelContainerUtils.resetTransforms=
function(a){if(null!=a)for(var e=0;e<a.num_nodes;++e)b.XModelNodeUtils.resetTransforms(a.nodes[e])};b.XModelContainerUtils.resetOffset=function(a){b.XModelContainerUtils.resetTransforms(a);b.XModelContainerUtils.updateCombination(a);b.XModelContainerUtils.updateOffset(a)};b.XModelContainerUtils.forEachMesh=function(a,e,c){if(null!=a){for(var d=0;d<a.num_meshes;++d){var g=a.meshes[d];null!=g&&e(g,c)}for(d=0;d<a.num_nodes;++d)b.XModelNodeUtils.forEachMesh(a.nodes[d],e,c)}};b.XModelContainerUtils.forEachNode=
function(a,e,c){if(null!=a)for(var d=0;d<a.num_nodes;++d)b.XModelNodeUtils.forEachNode(a.nodes[d],e,0,c)}})(xpl);(function(b){b.XModelOptimizeUtils=function(){throw Error("Unsupported operation");};b.XModelOptimizeUtils.optimizeMeshVertices=function(a){null!=a&&console.log("it's not implemented yet.")};b.XModelOptimizeUtils.optimizeMeshElements=function(a){null!=a&&console.log("it's not implemented yet.")};var a=function(){this.bones=[];this.vertices=[];this.elements=[]};a.prototype.addBone=function(a){var c=b.ArrayUtils.binarySearch(this.bones,0,this.bones.length,a);0>c&&this.bones.splice(-c-1,0,a)};a.prototype.addVertex=
function(a){var c=b.ArrayUtils.binarySearch(this.vertices,0,this.vertices.length,a);0>c&&this.vertices.splice(-c-1,0,a)};a.prototype.addElement=function(a){var c=b.ArrayUtils.binarySearch(this.elements,0,this.elements.length,a);0>c&&this.elements.splice(-c-1,0,a)};a.prototype.merge=function(a,b,d,g){if(b)for(b=0;b<a.bones.length;++b)this.addBone(a.bones[b]);if(d)for(d=0;d<a.vertices.length;++d)this.addVertex(a.vertices[d]);if(g)for(g=0;g<a.elements.length;++g)this.addElement(a.elements[g])};b.XModelOptimizeUtils.optimizeMeshSkinForMatrixPallet=
function(e,c){if(null!=e&&null!=e.skin&&c<e.skin.num_nodes){if(void 0===c||16>c)c=16;for(var d={},g=0;g<e.num_elements;++g){var f=new a;f.addElement(g);for(var h=e.elements[g],k=0;k<h.num_vertices;++k){var l=h.vertices[k];f.addVertex(l);for(var m=e.vertices[l],l=e.skin.weighted_index_stride*m.skinning,m=e.skin.weighted_index_sizes[m.skinning],n=0;n<m;++n)f.addBone(e.skin.indices[l+n])}h="["+f.bones.toString()+"]";void 0!==d[h]?d[h].merge(f,!1,!0,!0):d[h]=f}var g=[],p;for(p in d)g.push(d[p]);g.sort(function(a,
b){return b.bones.length-a.bones.length});for(d=g.length-1;0<=d;--d)for(p=g[d],f=0;f<d;++f)if(h=g[f],b.ArrayUtils.isContained(h.bones,0,h.bones.length,p.bones,0,p.bones.length)){h.merge(p,!1,!0,!0);delete g[d];break}g=g.filter(function(a){return void 0!==a});console.log(g.length);for(d=0;d<g.length-1;++d)if(p=g[d],void 0!==p&&p.bones.length<=c)for(f=d+1;f<g.length&&p.bones.length<c;++f)h=g[f],void 0!==h&&p.bones.length+h.bones.length<=c&&(p.merge(h,!0,!0,!0),delete g[f]);g=g.filter(function(a){return void 0!==
a});console.log(g.length);e.num_subsets=g.length;e.subsets=Array(e.num_subsets);for(c=0;c<e.num_subsets;++c)for(d=g[c],p=new b.XModelMeshSubset,e.subsets[c]=p,p.num_bones=d.bones.length,p.bones=new Uint16Array(d.bones),p.num_vertices=d.vertices.length,p.vertices=new Uint32Array(d.vertices),p.num_elements=d.elements.length,p.elements=Array(p.num_elements),f=0;f<d.elements.length;++f)for(h=e.elements[d.elements[f]],k=new b.XModelElement,p.elements[f]=k,k.material=h.material,k.num_vertices=h.num_vertices,
k.vertices=new Uint32Array(k.num_vertices),l=0;l<k.num_vertices;++l)m=b.ArrayUtils.binarySearch(p.vertices,0,p.num_vertices,h.vertices[l]),k.vertices[l]=0<=m?m:0}};b.XModelOptimizeUtils.optimizeMeshSkinForWeightedIndices=function(a,c){b.defaultValue(c,4);null!=a&&null!=a.skin&&console.log("it's not implemented yet.")}})(xpl);(function(b){b.XModelWrapper=function(){this._container=null;this.__prev_anim_index=-1;this.__min_bounds=new Float32Array([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]);this.__max_bounds=new Float32Array([-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]);this.__is_canseled=this.__is_completed=!1};Object.defineProperties(b.XModelWrapper.prototype,{container:{get:function(){return this._container}},isCompleted:{get:function(){return this.__is_completed}},isCanceled:{get:function(){return this.__is_canseled}},
numAnimationSets:{get:function(){return null!=this._container?this._container.num_animation_sets:0}}});b.XModelWrapper.prototype._complete=function(){this.__is_completed=!0;b.XModelContainerUtils.forEachMesh(this._container,function(a,b){for(b=0;b<a.num_positions;++b)for(var c=0;c<a.position_size;++c){var d=a.positions[a.position_size*b+c];this.__min_bounds[c]=Math.min(this.__min_bounds[c],d);this.__max_bounds[c]=Math.max(this.__max_bounds[c],d)}}.bind(this),null)};b.XModelWrapper.prototype.cancel=
function(){this.__is_canseled=!0};b.XModelWrapper.prototype.getMinBound=function(a){return this.__min_bounds[a]};b.XModelWrapper.prototype.getMaxBound=function(a){return this.__max_bounds[a]};b.XModelWrapper.prototype.getSize=function(a){return this.__max_bounds[a]-this.__min_bounds[a]};b.XModelWrapper.prototype.getCenter=function(a){return.5*(this.__min_bounds[a]+this.__max_bounds[a])};b.XModelWrapper.prototype.resetPose=function(){b.XModelContainerUtils.resetTransforms(this._container);b.XModelContainerUtils.updateCombination(this._container)};
b.XModelWrapper.prototype.setAnimation=function(a,e,c,d){void 0==c&&(c=!1);void 0==d&&(d=!1);this.__prev_anim_index!=a?(this.__prev_anim_index=a,this.resetPose()):b.XModelContainerUtils.resetTransforms(this._container);b.XModelContainerUtils.setAnimation(this._container,a,e,c);d&&b.XModelContainerUtils.applyKinematics(this._container);b.XModelContainerUtils.updateCombination(this._container)};b.XModelWrapper.prototype.dispose=function(){this.cancel();this.__is_completed=!1}})(xpl);
(function(b){b.XModelWrapperGL=function(){b.XModelWrapper.call(this);this.__white_texture=this.__config=null;this.__remain_textures=0;this.__is_update_anim=!1;this.__subset_matrix_pallet=this.__matrix_pallet=null};Object.setPrototypeOf(b.XModelWrapperGL.prototype,b.XModelWrapper.prototype);Object.defineProperties(b.XModelWrapperGL,{CONFIG_MEMORY_ALIGNMENT_SIZE:{value:"memory_alignment_size"},CONFIG_USE_VERTEX_ARRAY_OBJECT:{value:"use_vertex_array_object"},CONFIG_USE_MIPMAP_TEXTURE:{value:"use_mipmap_texture"},
CONFIG_USE_SKINNING:{value:"use_skinning"},CONFIG_GPU_SKINNING:{value:"gpu_skinning"},CONFIG_MAX_BONE_WEIGHTED_INDICES:{value:"max_bone_weighted_indices"},CONFIG_MAX_BONE_MATRICES:{value:"max_bone_matrices"},CONFIG_PATH_ALIAS:{value:"path_alias"},CONFIG_USE_MORFING:{value:"use_mofing"},CONFIG_GPU_MORFING:{value:"gpu_morfing"},UNIFORM_DIFFUSE:{value:"u_diffuse"},UNIFORM_DIFFUSE_MAP:{value:"u_diffuse_map"},UNIFORM_SPECULAR:{value:"u_specular"},UNIFORM_SPECULAR_MAP:{value:"u_specular_map"},UNIFORM_BONE_MATRICES:{value:"u_bone_matrices"},
UNIFORM_MAX_BONES:{value:"u_max_bones"},ATTRIBUTE_POSITION:{value:"a_position"},ATTRIBUTE_NORMAL:{value:"a_normal"},ATTRIBUTE_COLOR:{value:"a_color"},ATTRIBUTE_TEXCOORD:{value:"a_tex_coord"},ATTRIBUTE_BONEINDICES:{value:"a_bone_indices"},ATTRIBUTE_BONEWEIGHTS:{value:"a_bone_weights"}});var a=b.XModelWrapperGL;b.XModelWrapperGL.defaultConfig=function(){var b={};b[a.CONFIG_MEMORY_ALIGNMENT_SIZE]=4;b[a.CONFIG_USE_VERTEX_ARRAY_OBJECT]=!1;b[a.CONFIG_USE_MIPMAP_TEXTURE]=!1;b[a.CONFIG_USE_SKINNING]=!0;b[a.CONFIG_GPU_SKINNING]=
!0;b[a.CONFIG_MAX_BONE_MATRICES]=16;b[a.CONFIG_MAX_BONE_WEIGHTED_INDICES]=4;b[a.CONFIG_USE_MORFING]=!1;b[a.CONFIG_GPU_MORFING]=!1;b[a.CONFIG_PATH_ALIAS]=null;return b};b.XModelWrapperGL.copyConfig=function(b){for(var c={},e=$jscomp.makeIterator([a.CONFIG_MEMORY_ALIGNMENT_SIZE,a.CONFIG_USE_VERTEX_ARRAY_OBJECT,a.CONFIG_USE_MIPMAP_TEXTURE,a.CONFIG_USE_SKINNING,a.CONFIG_GPU_SKINNING,a.CONFIG_MAX_BONE_MATRICES,a.CONFIG_MAX_BONE_WEIGHTED_INDICES,a.CONFIG_USE_MORFING,a.CONFIG_GPU_MORFING,a.CONFIG_PATH_ALIAS]),
h=e.next();!h.done;h=e.next())h=h.value,c[h]=b[h];return c};b.XModelWrapperGL.defaultUniforms=function(){var b={};b[a.UNIFORM_DIFFUSE]=null;b[a.UNIFORM_DIFFUSE_MAP]=null;b[a.UNIFORM_BONE_MATRICES]=null;b[a.UNIFORM_MAX_BONES]=null;return b};b.XModelWrapperGL.defaultAttributes=function(){var b={};b[a.ATTRIBUTE_POSITION]=-1;b[a.ATTRIBUTE_NORMAL]=-1;b[a.ATTRIBUTE_COLOR]=-1;b[a.ATTRIBUTE_TEXCOORD]=-1;b[a.ATTRIBUTE_BONEINDICES]=-1;b[a.ATTRIBUTE_BONEWEIGHTS]=-1;return b};var e=function(d,e,f,h,k){if(null==
e.getExtension("OES_element_index_uint"))throw Error("Required the OES_element_index_uint");null==h&&(h="");var l=0,m=new XMLHttpRequest;m.open("GET",h+f,!0);m.responseType="arraybuffer";m.onload=function(d){if(!this.isCanceled)if(200==d.target.status)if(this._container=(new b.XModelDecoder).decode(d.target.response),null!=this._container){b.XModelContainerUtils.forEachMesh(this._container,function(c,d){var e=k[a.CONFIG_USE_SKINNING]&&null!=c.skin&&0<c.skin.num_nodes,g=!k[a.CONFIG_GPU_SKINNING]&&
e,f=k[a.CONFIG_GPU_SKINNING]&&e,h=!e||f,m,n,p,F;f?(m=2,n=4,p=b.XModelMeshUtils.TYPE_UNSIGNED_SHORT,F=b.XModelMeshUtils.TYPE_FLOAT):(n=m=0,F=p=b.XModelMeshUtils.TYPE_VOID);f&&b.XModelOptimizeUtils.optimizeMeshSkinForMatrixPallet(c,k[a.CONFIG_MAX_BONE_MATRICES]);e=function(e){var f=-1==e?c:c.subsets[e],l=new Int32Array(b.XModelMeshUtils.MAX_ATTRIBUTE),t=b.XModelMeshUtils.getVerticesSize(c,h,k[a.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,1,4,0,m,n,l,0,e),t=new ArrayBuffer(t);b.XModelMeshUtils.getVertices(c,b.XModelMeshUtils.TYPE_FLOAT,
b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_UNSIGNED_BYTE,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_VOID,p,F,l,0,t,0,e);var v,J,A,y,M,L,I,D;g?(D=new Int32Array(b.XModelMeshUtils.MAX_ATTRIBUTE),v=b.XModelMeshUtils.getVerticesSize(c,!1,k[a.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,0,0,0,2,4,D,0,e),v=new ArrayBuffer(v),J=new Float32Array(v,D[b.XModelMeshUtils.ATTRIBUTE_POSITION]),A=new Float32Array(v,D[b.XModelMeshUtils.ATTRIBUTE_NORMAL]),y=new Uint16Array(v,D[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),
M=new Float32Array(v,D[b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]),b.XModelMeshUtils.getVertices(c,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_UNSIGNED_SHORT,b.XModelMeshUtils.TYPE_FLOAT,D,0,v,0,e),L=new ArrayBuffer(D[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),I=new Float32Array(L,D[b.XModelMeshUtils.ATTRIBUTE_POSITION]),D=new Float32Array(L,D[b.XModelMeshUtils.ATTRIBUTE_NORMAL])):
D=I=L=M=y=A=J=v=null;var N=new Int32Array(c.num_materials+1),S=new Uint32Array(c.num_materials+1),T=b.XModelMeshUtils.getNumAllTriangledFaceIndices(c,N,0,S,0,e),T=new Uint32Array(T);b.XModelMeshUtils.getAllTriangledFaceIndices(c,!0,N,0,T,0,e);f.vertex_buffer=b.GLUtils.createBuffer(d,d.ARRAY_BUFFER,t,g?d.STREAM_DRAW:d.STATIC_DRAW);f.element_buffer=b.GLUtils.createBuffer(d,d.ELEMENT_ARRAY_BUFFER,T.buffer,d.STATIC_DRAW);f.user_object={vertices_offsets:l,src_vertices:v,src_positions:J,src_normals:A,src_bone_indices:y,
src_bone_weights:M,dest_vertices:L,dest_positions:I,dest_normals:D,elements_offsets:N,elements_sizes:S}};if(null!=c.subsets&&0<c.num_subsets)for(f=0;f<c.num_subsets;++f)e(f);else e(-1);null!=c.skin&&(l=Math.max(c.skin.num_nodes,l))},e);0<l&&(this.__matrix_pallet=new Float32Array(b.Geometry.SIZE_MATRIX_4X4*l),this.__subset_matrix_pallet=new Float32Array(Math.max(b.Geometry.SIZE_MATRIX_4X4*l,b.Geometry.SIZE_MATRIX_4X4*k[a.CONFIG_MAX_BONE_MATRICES])),this.resetPose());var f=b.XModelContainerUtils.getTextures(this._container,
null,0,0);d=Array(f);b.XModelContainerUtils.getTextures(this._container,d,0,f);d=b.ArrayUtils.convertToSet(d,0,d.length,function(a,b){return a.name==b.name});this.__remain_textures=d.length;for(f=0;f<d.length;++f)c(this,e,d[f],h,k);0>=this.__remain_textures&&this._complete()}else this.cancel();else this.cancel()}.bind(d);m.send()},c=function(c,e,f,h,k){var l=new XMLHttpRequest;null!=k[a.CONFIG_PATH_ALIAS]&&null!=k[a.CONFIG_PATH_ALIAS][f.ref]?l.open("GET",k[a.CONFIG_PATH_ALIAS][f.ref],!0):l.open("GET",
h+f.ref,!0);l.responseType="blob";l.onload=function(h){if(!c.isCanceled){if(200==h.target.status){h=h.target.response;var l=new Image;l.onload=function(){f.texture=b.GLUtils.createTexture2DFromImage(e,e.RGBA,e.UNSIGNED_BYTE,l);e.bindTexture(e.TEXTURE_2D,f.texture);k[a.CONFIG_USE_MIPMAP_TEXTURE]&&e.generateMipmap(e.TEXTURE_2D);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,
e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)};l.src=URL.createObjectURL(h)}this.__remain_textures--;0>=this.__remain_textures&&this._complete()}}.bind(c);l.send()};b.XModelWrapperGL.prototype.initializeWithUrl=function(a,c,f,h){this.__white_texture=b.GLUtils.createTexture2D(a,a.RGBA,a.UNSIGNED_BYTE,1,1,new Uint8Array([255,255,255,255]),!1,null,0);this.__config=b.XModelWrapperGL.copyConfig(h);e(this,a,c,f,this.__config)};b.XModelWrapperGL.prototype.setAnimation=function(a,
c,e,h){b.XModelWrapper.prototype.setAnimation.call(this,a,c,e,h);this.__is_update_anim=!0};b.XModelWrapperGL.prototype._complete=function(){b.XModelWrapper.prototype._complete.call(this);b.XModelContainerUtils.releaseShapes(this._container)};b.XModelWrapperGL.prototype.draw=function(c,e,f){b.XModelContainerUtils.forEachMesh(this._container,function(c,d){var l=this.__config[a.CONFIG_USE_SKINNING],m=this.__config[a.CONFIG_GPU_SKINNING];null!=c.skin&&l&&b.XModelSkinUtils.updateMatrixPallet(c.skin,c.skin.num_nodes,
this.__matrix_pallet,0);var n=function(n){var p,t;-1==n?(p=null,t=c):t=p=c.subsets[n];var u=-1==n?c:c.subsets[n];d.bindBuffer(d.ARRAY_BUFFER,u.vertex_buffer);var v=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE],x=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_POSITION];-1!=f.a_position&&-1!=x&&(d.enableVertexAttribArray(f.a_position),d.vertexAttribPointer(f.a_position,c.position_size,d.FLOAT,!1,v,x));x=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_NORMAL];
-1!=f.a_normal&&-1!=x&&(d.enableVertexAttribArray(f.a_normal),d.vertexAttribPointer(f.a_normal,c.normal_size,d.FLOAT,!1,v,x));x=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_COLOR];-1!=f.a_color&&-1!=x&&(d.enableVertexAttribArray(f.a_color),d.vertexAttribPointer(f.a_color,c.color_size,d.UNSIGNED_BYTE,!1,v,x));x=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_TEXCOORD];-1!=f.a_tex_coord&&-1!=x&&(d.enableVertexAttribArray(f.a_tex_coord),d.vertexAttribPointer(f.a_tex_coord,c.tex_coord_size,
d.FLOAT,!1,v,x));null!=c.skin&&this.__config[a.CONFIG_USE_SKINNING]&&(x=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES],-1!=f.a_bone_indices&&-1!=x&&(d.enableVertexAttribArray(f.a_bone_indices),d.vertexAttribPointer(f.a_bone_indices,c.skin.weighted_index_stride,d.UNSIGNED_SHORT,!1,v,x)),u=u.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS],-1!=f.a_bone_weights&&-1!=u&&(d.enableVertexAttribArray(f.a_bone_weights),d.vertexAttribPointer(f.a_bone_weights,c.skin.weighted_index_stride,
d.FLOAT,!1,v,u)));if(l&&null!=c.skin)if(m){if(null!=e.u_bone_matrices)if(null!=e.u_max_bones&&d.uniform1i(e.u_max_bones,c.skin.weighted_index_stride),-1==n)d.uniformMatrix4fv(e.u_bone_matrices,!1,this.__matrix_pallet);else{for(v=0;v<p.num_bones;++v)b.Matrix4x4.loadv(this.__subset_matrix_pallet,b.Geometry.SIZE_MATRIX_4X4*v,this.__matrix_pallet,b.Geometry.SIZE_MATRIX_4X4*p.bones[v],!1);d.uniformMatrix4fv(e.u_bone_matrices,!1,this.__subset_matrix_pallet)}}else{if(this.__is_update_anim){null!=e.u_max_bones&&
d.uniform1i(e.u_max_bones,0);-1!=c.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_POSITION]&&b.XModelSkinUtils.updateVertices(this.__matrix_pallet,0,t.num_vertices,t.user_object.src_positions,0,0,t.user_object.dest_positions,0,0,t.skin.weighted_index_stride,t.user_object.src_bone_indices,0,0,t.user_object.src_bone_weights,0,0,b.XModelMesh.TYPE_POSITION);if(-1!=t.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_NORMAL]){for(v=0;v<c.skin.num_nodes;++v)p=b.Geometry.SIZE_MATRIX_4X4*
v,b.Matrix4x4.loadAxisv(this.__matrix_pallet,p,this.__matrix_pallet,p,!1),b.Matrix4x4.normalizeAxisv(this.__matrix_pallet,p,this.__matrix_pallet,p,!0);b.XModelSkinUtils.updateVertices(this.__matrix_pallet,0,t.num_vertices,t.user_object.src_normals,0,0,t.user_object.dest_normals,0,0,t.skin.weighted_index_stride,t.user_object.src_bone_indices,0,0,t.user_object.src_bone_weights,0,0,xpl.XModelMesh.TYPE_NORMAL)}d.bufferSubData(d.ARRAY_BUFFER,0,t.user_object.dest_vertices);this.__is_update_anim=!1}}else null!=
e.u_max_bones&&d.uniform1i(e.u_max_bones,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,t.element_buffer);for(v=0;v<c.num_materials;++v)p=c.materials[v],u=t.user_object.elements_sizes[v],0<u&&(null!=e.u_ambient_map?(d.activeTexture(d.TEXTURE1),d.uniform1i(e.u_ambient_map,1),null!=p.ambient_map&&null!=p.ambient_map.texture?(d.uniform4fv(e.u_ambient_map,p.ambient),d.bindTexture(d.TEXTURE_2D,p.ambient_map.texture)):(d.uniform4f(e.u_ambient_color,1,1,1,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=
e.u_ambient_color&&d.uniform4f(e.u_ambient_color,1,1,1,1),null!=e.u_diffuse_map?(d.activeTexture(d.TEXTURE0),d.uniform1i(e.u_diffuse_map,0),null!=p.diffuse_map&&null!=p.diffuse_map.texture?(d.uniform4fv(e.u_diffuse_color,p.diffuse),d.bindTexture(d.TEXTURE_2D,p.diffuse_map.texture)):(d.uniform4f(e.u_diffuse_color,1,1,1,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=e.u_diffuse_color&&d.uniform4f(e.u_diffuse_color,1,1,1,1),null!=e.u_specular_map?(d.activeTexture(d.TEXTURE1),d.uniform1i(e.u_specular_map,
2),null!=p.specular_map&&null!=p.specular_map.texture?(d.uniform4fv(e.u_specular_map,p.specular),d.bindTexture(d.TEXTURE_2D,p.specular_map.texture)):(d.uniform4f(e.u_specular_color,1,1,1,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=e.u_specular_color&&d.uniform4f(e.u_specular_color,1,1,1,1),null!=e.u_bump_map?(d.activeTexture(d.TEXTURE1),d.uniform1i(e.u_bump_map,3),null!=p.bump_map&&null!=p.bump_map.texture?(d.uniform4fv(e.u_bump_map,p.bump),d.bindTexture(d.TEXTURE_2D,p.bump_map.texture)):
(d.uniform4f(e.u_bump_color,.5,.5,.5,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=e.u_bump_color&&d.uniform4f(e.u_bump_color,1,1,1,1),d.drawElements(d.TRIANGLES,u,d.UNSIGNED_INT,4*t.user_object.elements_offsets[v]));d.bindBuffer(d.ARRAY_BUFFER,(-1==n?c:c.subsets[n]).vertex_buffer);-1!=f.a_position&&d.disableVertexAttribArray(f.a_position);-1!=f.a_normal&&d.disableVertexAttribArray(f.a_normal);-1!=f.a_color&&d.disableVertexAttribArray(f.a_color);-1!=f.a_tex_coord&&d.disableVertexAttribArray(f.a_tex_coord);
-1!=f.a_bone_indices&&d.disableVertexAttribArray(f.a_bone_indices);-1!=f.a_bone_weights&&d.disableVertexAttribArray(f.a_bone_weights)}.bind(this);if(null!=c.subsets&&0<c.num_subsets)for(var p=0;p<c.num_subsets;++p)n(p);else n(-1)}.bind(this),c)};b.XModelWrapperGL.prototype.dispose=function(a){b.XModelWrapper.prototype.dispose.call(this);b.XModelContainerUtils.forEachMesh(this._container,function(a,b){null!=a.vertex_buffer&&(b.deleteBuffer(a.vertex_buffer),a.vertex_buffer=null);null!=a.element_buffer&&
(b.deleteBuffer(a.element_buffer),a.element_buffer=null)},a);a.deleteTexture(this.__white_texture);for(var c=b.XModelContainerUtils.getTextures(this._container,null,0,0),e=Array(c),h=0;h<c;++h){var k=e[h];null!=k&&(a.deleteTexture(k.texture),k.texture=null)}}})(xpl);
