/*

 Copyright (c) 2015, Syuuhei Kuno
 All rights reserved.

 Redistribution and use in source and binary forms, with or without modification,
 are permitted provided that the following conditions are met:

  1. Redistributions of source code must retain the above copyright notice, this
     list of conditions and the following disclaimer.

  2. Redistributions in binary form must reproduce the above copyright notice,
     this list of conditions and the following disclaimer in the documentation
     and/or other materials provided with the distribution.

  3. Neither the name of the copyright holder nor the names of its contributors
     may be used to endorse or promote products derived from this software
     without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return"jscomp_symbol_"+b+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();if(b[Symbol.iterator])return b[Symbol.iterator]();if(!(b instanceof Array||"string"==typeof b||b instanceof String))throw new TypeError(b+" is not iterable");var a=0;return{next:function(){return a==b.length?{done:!0}:{done:!1,value:b[a++]}}}};$jscomp.arrayFromIterator=function(b){for(var a,f=[];!(a=b.next()).done;)f.push(a.value);return f};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};
$jscomp.arrayFromArguments=function(b){for(var a=[],f=0;f<b.length;f++)a.push(b[f]);return a};$jscomp.inherits=function(b,a){function f(){}f.prototype=a.prototype;b.prototype=new f;b.prototype.constructor=b;for(var c in a)if($jscomp.global.Object.defineProperties){var d=$jscomp.global.Object.getOwnPropertyDescriptor(a,c);void 0!==d&&$jscomp.global.Object.defineProperty(b,c,d)}else b[c]=a[c]};var xpl;
"object"==typeof module?(xpl=module.exports,xpl.running_type="Node.js"):"object"==typeof exports?(xpl=exports,xpl.running_type="CommonJS"):xpl={running_type:"direct link"};
(function(b){Object.defineProperties(b,{RUNTYPE_NODE_JS:{value:"Node.js"},RUNTYPE_COMMON_JS:{value:"CommonJS"},RUNTYPE_DIRECT_LINK:{value:"direct link"}});b.about={};Object.defineProperties(b.about,{NAME:{value:"xPlain for JavaScript"},CODE_NAME:{value:"DEUS"},VERSION_CODE:{value:1},VERSION_NAME:{value:"0.9.0"},AUTHOR:{value:"Syuuhei Kuno"},COPYRIGHT:{value:"Copyright (c) 2015, Syuuhei Kuno All rights reserved."},LICENSE:{value:"http://opensource.org/licenses/BSD-3-Clause"},REPOSITORY:{value:"git@github.com:redlily/xplain_for_js.git"}});
b.getAbout=function(){return b.about.name+"\nVersion code:  "+b.about.VERSION_CODE+"\nVersion name:  "+b.about.VERSION_NAME+"\nAuthor:        "+b.about.AUTHOR+"\nCopyright:     "+b.about.COPYRIGHT+"\nLicense:       "+b.about.LICENSE+"\nRepository:    "+b.about.REPOSITORY};b.putAboutToStdout=function(){console.log(b.getAbout)};b.size_t=function(){return Number.parseInt.apply(null,arguments)};b.ptrdiff_t=function(){return Number.parseInt.apply(null,arguments)};b.enum_t=function(){return Number.parseInt.apply(null,
arguments)};b.int8_t=function(){return Number.parseInt.apply(null,arguments)<<24>>24};Object.defineProperties(b.int8_t,{MIN_VALUE:{value:-Math.pow(2,7)},MAX_VALUE:{value:Math.pow(2,7)-1}});b.int16_t=function(){return Number.parseInt.apply(null,arguments)<<16>>16};Object.defineProperties(b.int16_t,{MIN_VALUE:{value:-Math.pow(2,15)},MAX_VALUE:{value:Math.pow(2,15)-1}});b.int32_t=function(){return Number.parseInt.apply(null,arguments)<<0>>0};Object.defineProperties(b.int32_t,{MIN_VALUE:{value:-Math.pow(2,
31)},MAX_VALUE:{value:Math.pow(2,31)-1}});b.float32_t=function(){return Number.parseFloat.apply(null,arguments)};b.float64_t=function(){return Number.parseFloat.apply(null,arguments)}})(xpl);(function(b){b.SystemUtils=function(){};if("object"==typeof window){var a=null,f=null;"function"==typeof window.requestAnimationFrame?(a=window.requestAnimationFrame,f=window.cancelAnimationFrame):"function"==typeof window.mozRequestAnimationFrame?(a=window.mozRequestAnimationFrame,f=window.mozCancelAnimationFrame):"function"==typeof window.webkitRequestAnimationFrame?(a=function(a){var d=window.webkitRequestAnimationFrame(function(){d.__is_cancel||a()});return d},f=function(a){a.__is_cancel=!0}):
"Function"==typeof window.msRequestAnimationFrame?(a=function(a){var d=window.msRequestAnimationFrame(function(){d.__is_cancel||a()});return d},f=function(a){a.__is_cancel=!0}):(a=function(a){return setTimeout(a,2)},f=clearTimeout);b.SystemUtils.requestAnimationFrame=function(c){return a(c)};b.SystemUtils.cancelAnimationFrame=function(a){f(timer)}}"object"==typeof document&&(b.SystemUtils.isSupportedFullScreen=function(a){return null!=(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||
a.msRequestFullscreen)},b.SystemUtils.requestFullScreen=function(a){if("function"==typeof a.requestFullscreen)a.requestFullscreen();else if("function"==typeof a.mozRequestFullScreen)a.mozRequestFullScreen();else if("function"==typeof a.webkitRequestFullscreen)a.webkitRequestFullscreen();else if("function"==typeof a.msRequestFullscreen)a.msRequestFullscreen();else return!1;return!0},b.SystemUtils.isFullScreen=function(){return window.innerWidth==screen.width&&window.innerHeight==screen.height},b.SystemUtils.cancelFullScreen=
function(){"function"==typeof document.exitFullscreen?document.exitFullscreen():"function"==typeof document.mozCancelFullScreen?document.mozCancelFullScreen():"function"==typeof document.webkitExitFullscreen?document.webkitExitFullscreen():"function"==typeof document.msExitFullscreen&&document.msExitFullscreen()})})(xpl);(function(b){b.MathUtils=function(){throw Error("Unsupported operation");};b.MathUtils.min=function(a,f,c){return a<f?a<c?a:c:f<c?f:c};b.MathUtils.mid=function(a,f,c){return a<f?f<c?f:c<a?a:c:a<c?a:c<f?f:c};b.MathUtils.max=function(a,f,c){return a<f?f<c?c:f:a<c?c:a};b.MathUtils.log=function(a,f){return Math.log(f)/Math.log(a)};b.MathUtils.cqrt=function(a){return 0<=a?Math.pow(a,1/3):-Math.pow(-a,1/3)};b.MathUtils.floorPow2=function(a){a=Math.floor(a);a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a|=a>>
32;return a^a>>1};b.MathUtils.cailPow2=function(a){a=Math.floor(a);--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;return(a|a>>32)+1}})(xpl);(function(b){b.ArrayUtils=function(){throw Error("Unsupported operation");};b.ArrayUtils.copy=function(a,f,c,d,b){for(var e=0;e<b;++e)c[d+e]=a[f+e]};b.ArrayUtils.fill=function(a,f,c,d){for(;f<c;++f)a[f]=d};b.ArrayUtils.binarySearch=function(a,f,c,d,b){for(c--;f<=c;){var e=f+c>>1,h=a[e],h=null!=b?b(h,d):h-d;if(0>h)f=e+1;else if(0<h)c=e-1;else return e}return-(f+1)};b.ArrayUtils.convertToSet=function(a,f,c,d){var b=[];a:for(;f<c;++f){for(var e=a[f],h=0;h<b.length;++h)if(null!=d?d(b[h],e):b[h]==e)continue a;
b.push(e)}return b}})(xpl);(function(b){b.StringUtils=function(){};b.StringUtils.encodeUTF8=function(a){for(var f=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&c<a.length-1&&(d=(d&1023)<<10|(a.charCodeAt(++c)&1023)+65536);128>d?f.push(d):2048>d?f.push(d>>6&31|192,d>>0&63|128):65536>d?f.push(d>>12&15|224,d>>6&63|128,d>>0&63|128):2097152>d?f.push(d>>18&7|240,d>>12&63|128,d>>6&63|128,d>>0&63|128):67108864>d?f.push(d>>24&3|248,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|128):2147483648>d&&f.push(d>>30&1|252,
d>>24&63|128,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|128)}return f};b.StringUtils.decodeUTF8=function(a){for(var f="",c=0;c<a.length;){var d=255&a[c],b=0;128>d?b=0:223>d?(d=(31&d)<<6,b=1):239>d?(d=(15&d)<<12,b=2):247>d?(d=(7&d)<<18,b=3):251>d?(d=(3&d)<<24,b=4):253>d&&(d=(1&d)<<30,b=5);for(c++;0<b&&c<a.length;){var e=a[c];if(128>e)break;d|=(63&e)<<6*--b;c++}f=55295>d||57344<=d&&65535>=d?f+String.fromCharCode(d):f+String.fromCharCode(55296|d-65536>>10&1023,56320|d&1023)}return f}})(xpl);(function(b){b.Geometry=function(){throw Error("Unsupported operation");};Object.defineProperties(b.Geometry,{VX:{value:0},VY:{value:1},VZ:{value:2},VW:{value:3},SIZE_VECTOR_2:{value:2},SIZE_VECTOR_3:{value:3},CR:{value:0},CI:{value:1},CJ:{value:2},CK:{value:3},SIZE_COMPLEX:{value:2},SIZE_QUATERNION:{value:4},M4X4_00:{value:0},M4X4_10:{value:1},M4X4_20:{value:2},M4X4_30:{value:3},M4X4_01:{value:4},M4X4_11:{value:5},M4X4_21:{value:6},M4X4_31:{value:7},M4X4_02:{value:8},M4X4_12:{value:9},M4X4_22:{value:10},
M4X4_32:{value:11},M4X4_03:{value:12},M4X4_13:{value:13},M4X4_23:{value:14},M4X4_33:{value:15},SIZE_MATRIX_4X4:{value:16}})})(xpl);(function(b){b.Matrix4x4=function(){throw Error("Unsupported operation");};b.Matrix4x4.load=function(a,f,c,d,b,e,h,l,k,m,n,p,q,r,v,x,u,y,w){null==w&&(w=!1);1==w?(a[f+0]=c,a[f+4]=h,a[f+8]=n,a[f+12]=v,a[f+1]=d,a[f+5]=l,a[f+9]=p,a[f+13]=x,a[f+2]=b,a[f+6]=k,a[f+10]=q,a[f+14]=u,a[f+3]=e,a[f+7]=m,a[f+11]=r):(a[f+0]=c,a[f+4]=d,a[f+8]=b,a[f+12]=e,a[f+1]=h,a[f+5]=l,a[f+9]=k,a[f+13]=m,a[f+2]=n,a[f+6]=p,a[f+10]=q,a[f+14]=r,a[f+3]=v,a[f+7]=x,a[f+11]=u);a[f+15]=y};b.Matrix4x4.loadv=function(a,f,c,d,g){b.Matrix4x4.load(a,
f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.loadZero=function(a,f){b.Matrix4x4.load(a,f,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!1)};b.Matrix4x4.loadIdentity=function(a,f){b.Matrix4x4.load(a,f,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,!1)};b.Matrix4x4.lrepv=function(a,f,c,d,g,e,h){var l=1-h;b.Matrix4x4.load(a,f,c[d+0]*l+g[e+0]*h,c[d+4]*l+g[e+4]*h,c[d+8]*l+g[e+8]*h,c[d+12]*l+g[e+12]*h,c[d+1]*l+g[e+1]*h,c[d+5]*l+g[e+5]*h,c[d+
9]*l+g[e+9]*h,c[d+13]*l+g[e+13]*h,c[d+2]*l+g[e+2]*h,c[d+6]*l+g[e+6]*h,c[d+10]*l+g[e+10]*h,c[d+14]*l+g[e+14]*h,c[d+3]*l+g[e+3]*h,c[d+7]*l+g[e+7]*h,c[d+11]*l+g[e+11]*h,c[d+15]*l+g[e+15]*h,!1)};b.Matrix4x4.transposev=function(a,f,c,d){var b=c[d+4],e=c[d+8],h=c[d+12],l=c[d+1],k=c[d+5],m=c[d+9],n=c[d+13],p=c[d+2],q=c[d+6],r=c[d+10],v=c[d+14],x=c[d+3],u=c[d+7],y=c[d+11],w=c[d+15];a[f+0]=c[d+0];a[f+4]=l;a[f+8]=p;a[f+12]=x;a[f+1]=b;a[f+5]=k;a[f+9]=q;a[f+13]=u;a[f+2]=e;a[f+6]=m;a[f+10]=r;a[f+14]=y;a[f+3]=
h;a[f+7]=n;a[f+11]=v;a[f+15]=w};b.Matrix4x4.determinant=function(a,f){var c=a[f+1],d=a[f+5],b=a[f+9],e=a[f+13],h=a[f+2],l=a[f+6],k=a[f+10],m=a[f+14],n=a[f+3],p=a[f+7],q=a[f+11],r=a[f+15];return a[f+0]*(d*(k*r-m*q)+b*(m*p-l*r)+e*(l*q-k*p))+a[f+4]*(c*(m*q-k*r)+b*(h*r-m*n)+e*(k*n-h*q))+a[f+8]*(c*(l*r-m*p)+d*(m*n-h*r)+e*(h*p-l*n))+a[f+12]*(c*(k*p-l*q)+d*(h*q-k*n)+b*(l*n-h*p))};b.Matrix4x4.inversev=function(a,f,c,d){var g=c[d+0],e=c[d+4],h=c[d+8],l=c[d+12],k=c[d+1],m=c[d+5],n=c[d+9],p=c[d+13],q=c[d+2],
r=c[d+6],v=c[d+10],x=c[d+14],u=c[d+3],y=c[d+7],w=c[d+11],A=c[d+15];c=k*r;d=k*v;var z=k*x,E=k*y,G=k*w,B=k*A,D=m*q,H=m*v,F=m*x,K=m*u,C=m*w,L=m*A,P=n*q,M=n*r,N=n*x,I=n*u,T=n*y,X=n*A,R=p*q,Y=p*r,J=p*v,V=p*u,O=p*y,W=p*w,S=q*y,Q=q*w,q=q*A,U=r*u,Z=r*w,r=r*A,aa=v*u,ba=v*y,v=v*A,u=x*u,y=x*y,x=x*w,w=m*(v-x)+n*(y-r)+p*(Z-ba),A=k*(x-v)+n*(q-u)+p*(aa-Q),p=k*(r-y)+m*(u-q)+p*(S-U),k=k*(ba-Z)+m*(Q-aa)+n*(U-S),m=g*w+e*A+h*p+l*k;b.Matrix4x4.load(a,f,w/m,(e*(x-v)+h*(r-y)+l*(ba-Z))/m,(e*(X-W)+h*(O-L)+l*(C-T))/m,(e*(J-
N)+h*(F-Y)+l*(M-H))/m,A/m,(g*(v-x)+h*(u-q)+l*(Q-aa))/m,(g*(W-X)+h*(B-V)+l*(I-G))/m,(g*(N-J)+h*(R-z)+l*(d-P))/m,p/m,(g*(y-r)+e*(q-u)+l*(U-S))/m,(g*(L-O)+e*(V-B)+l*(E-K))/m,(g*(Y-F)+e*(z-R)+l*(D-c))/m,k/m,(g*(Z-ba)+e*(aa-Q)+h*(S-U))/m,(g*(T-C)+e*(G-I)+h*(K-E))/m,(g*(H-M)+e*(P-d)+h*(c-D))/m,!1)};b.Matrix4x4.add=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A,z,E,G,B,D,H,F,K,C,L,P,M,N,I){b.Matrix4x4.load(a,f,c+w,d+A,g+z,e+E,h+G,l+B,k+D,m+H,n+F,p+K,q+C,r+L,v+P,x+M,u+N,y+I,!1)};b.Matrix4x4.addv=function(a,
f,c,d,g,e){b.Matrix4x4.add(a,f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[e+0],g[e+4],g[e+8],g[e+12],g[e+1],g[e+5],g[e+9],g[e+13],g[e+2],g[e+6],g[e+10],g[e+14],g[e+3],g[e+7],g[e+11],g[e+15])};b.Matrix4x4.sub=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A,z,E,G,B,D,H,F,K,C,L,P,M,N,I){b.Matrix4x4.load(a,f,c-w,d-A,g-z,e-E,h-G,l-B,k-D,m-H,n-F,p-K,q-C,r-L,v-P,x-M,u-N,y-I,!1)};b.Matrix4x4.subv=function(a,f,c,d,g,e){b.Matrix4x4.sub(a,
f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[e+0],g[e+4],g[e+8],g[e+12],g[e+1],g[e+5],g[e+9],g[e+13],g[e+2],g[e+6],g[e+10],g[e+14],g[e+3],g[e+7],g[e+11],g[e+15])};b.Matrix4x4.mul=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A,z,E,G,B,D,H,F,K,C,L,P,M,N,I){b.Matrix4x4.load(a,f,c*w+d*G+g*F+e*P,c*A+d*B+g*K+e*M,c*z+d*D+g*C+e*N,c*E+d*H+g*L+e*I,h*w+l*G+k*F+m*P,h*A+l*B+k*K+m*M,h*z+l*D+k*C+m*N,h*E+l*H+k*L+m*I,n*w+p*G+q*F+r*P,n*
A+p*B+q*K+r*M,n*z+p*D+q*C+r*N,n*E+p*H+q*L+r*I,v*w+x*G+u*F+y*P,v*A+x*B+u*K+y*M,v*z+x*D+u*C+y*N,v*E+x*H+u*L+y*I,!1)};b.Matrix4x4.mulv=function(a,f,c,d,g,e){b.Matrix4x4.mul(a,f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[e+0],g[e+4],g[e+8],g[e+12],g[e+1],g[e+5],g[e+9],g[e+13],g[e+2],g[e+6],g[e+10],g[e+14],g[e+3],g[e+7],g[e+11],g[e+15])};b.Matrix4x4.mulScalar=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w){b.Matrix4x4.load(a,
f,c*w,d*w,g*w,e*w,h*w,l*w,k*w,m*w,n*w,p*w,q*w,r*w,v*w,x*w,u*w,y*w,!1)};b.Matrix4x4.mulScalarv=function(a,f,c,d,g){b.Matrix4x4.mulScalar(a,f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.div=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A,z,E,G,B,D,H,F,K,C,L,P,M,N,I){var T=G*K,X=G*C,R=G*L,Y=G*M,J=G*N,V=G*I,O=B*F,W=B*C,S=B*L,Q=B*P,U=B*N,Z=B*I,aa=D*F,ba=D*K,ia=D*L,ja=D*P,ka=D*M,la=D*I,ma=H*F,na=H*K,oa=H*C,pa=H*P,
qa=H*M,ra=H*N,ca=F*M,da=F*N;F*=I;var ea=K*P,fa=K*N;K*=I;var ga=C*P,ha=C*M;C*=I;P*=L;M*=L;L*=N;N=B*(C-L)+D*(M-K)+H*(fa-ha);I=G*(L-C)+D*(F-P)+H*(ga-da);H=G*(K-M)+B*(P-F)+H*(ca-ea);G=G*(ha-fa)+B*(da-ga)+D*(ea-ca);B=w*N+A*I+z*H+E*G;b.Matrix4x4.mul(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,N/B,(A*(L-C)+z*(K-M)+E*(ha-fa))/B,(A*(la-ra)+z*(qa-Z)+E*(U-ka))/B,(A*(oa-ia)+z*(S-na)+E*(ba-W))/B,I/B,(w*(C-L)+z*(P-F)+E*(da-ga))/B,(w*(ra-la)+z*(V-pa)+E*(ja-J))/B,(w*(ia-oa)+z*(ma-R)+E*(X-aa))/B,H/B,(w*(M-K)+A*(F-P)+E*(ea-
ca))/B,(w*(Z-qa)+A*(pa-V)+E*(Y-Q))/B,(w*(na-S)+A*(R-ma)+E*(O-T))/B,G/B,(w*(fa-ha)+A*(ga-da)+z*(ca-ea))/B,(w*(ka-U)+A*(J-ja)+z*(Q-Y))/B,(w*(W-ba)+A*(aa-X)+z*(T-O))/B)};b.Matrix4x4.divv=function(a,f,c,d,g,e){b.Matrix4x4.div(a,f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g[e+0],g[e+4],g[e+8],g[e+12],g[e+1],g[e+5],g[e+9],g[e+13],g[e+2],g[e+6],g[e+10],g[e+14],g[e+3],g[e+7],g[e+11],g[e+15])};b.Matrix4x4.divScalar=function(a,f,c,
d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w){b.Matrix4x4.load(a,f,c/w,d/w,g/w,e/w,h/w,l/w,k/w,m/w,n/w,p/w,q/w,r/w,v/w,x/w,u/w,y/w,!1)};b.Matrix4x4.divScalarv=function(a,f,c,d,g){b.Matrix4x4.divScalar(a,f,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],g)};b.Matrix4x4.convertToString=function(a,f){return"Matrix4x4("+a[f+0]+", "+a[f+4]+", "+a[f+8]+", "+a[f+12]+",\n          "+a[f+1]+", "+a[f+5]+", "+a[f+9]+", "+a[f+13]+",\n          "+a[f+2]+
", "+a[f+6]+", "+a[f+10]+", "+a[f+14]+",\n          "+a[f+3]+", "+a[f+7]+", "+a[f+11]+", "+a[f+15]+")"}})(xpl);(function(b){b.Matrix4x4&&(b.Matrix4x4.loadScale=function(a,f,c,d,g){b.Matrix4x4.load(a,f,c,0,0,0,0,d,0,0,0,0,g,0,0,0,0,1,!1)},b.Matrix4x4.loadTranslate=function(a,f,c,d,g,e){null==e&&(e=!0);b.Matrix4x4.load(a,f,1,0,0,c,0,1,0,d,0,0,1,g,0,0,0,1,e?!1:!0)},b.Matrix4x4.loadRotateXAxis=function(a,f,c,d){null==d&&(d=!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,f,1,0,0,0,0,g,-c,0,0,c,g,0,0,0,0,1,d?!1:!0)},b.Matrix4x4.loadRotateYAxis=function(a,f,c,d){null==d&&(d=!0);var g=Math.cos(c);c=Math.sin(c);
b.Matrix4x4.load(a,f,g,0,c,0,0,1,0,0,-c,0,g,0,0,0,0,1,d?!1:!0)},b.Matrix4x4.loadRotateZAxis=function(a,f,c,d){null==d&&(d=!0);var g=Math.cos(c);c=Math.sin(c);b.Matrix4x4.load(a,f,g,-c,0,0,c,g,0,0,0,0,1,0,0,0,0,1,d?!1:!0)},b.Matrix4x4.loadRotate=function(a,f,c,d,g,e,h,l){null==h&&(h=!0);null==l&&(l=!0);var k=Math.cos(e);e=Math.sin(e);h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));h=1-k;var m=c*h,n=d*h,p=d*m,q=g*m,r=g*n,v=c*e,x=d*e;e*=g;b.Matrix4x4.load(a,f,k+c*m,p-e,q+x,0,p+e,k+d*n,r-v,0,
q-x,r+v,k+g*g*h,0,0,0,0,1,l?!1:!0)},b.Matrix4x4.loadLookAt=function(a,f,c,d,g,e,h,l,k,m,n,p){null==p&&(p=!0);e-=c;h-=d;l-=g;var q=e*e+h*h+l*l;0<q&&(q=Math.sqrt(q),e/=q,h/=q,l/=q);q=h*n-l*m;n=l*k-e*n;k=e*m-h*k;m=q*q+n*n+k*k;0<m&&(m=Math.sqrt(m),q/=m,n/=m,k/=m);m=h*k-l*n;var r=l*q-e*k,v=e*n-h*q;b.Matrix4x4.load(a,f,q,n,k,-(q*c+n*d+k*g),m,r,v,-(m*c+r*d+v*g),e,h,l,-(e*c+h*d+l*g),0,0,0,1,p?!1:!0)},b.Matrix4x4.loadPerspective=function(a,f,c,d,g,e,h,l,k,m,n){null==n&&(n=!0);var p=e-g;e*=m-k;b.Matrix4x4.load(a,
f,g*h/c,0,0,0,0,g*l/d,0,0,0,0,e/p+k,g*e/-p,0,0,1,0,n?!1:!0)},b.Matrix4x4.loadAxisv=function(a,f,c,d,g){b.Matrix4x4.load(a,f,c[d+0],c[d+4],c[d+8],0,c[d+1],c[d+5],c[d+9],0,c[d+2],c[d+6],c[d+10],0,0,0,0,1,g)},b.Matrix4x4.mulScale=function(a,f,c,d,b){a[f+0]*=c;a[f+4]*=d;a[f+8]*=b;a[f+1]*=c;a[f+5]*=d;a[f+9]*=b;a[f+2]*=c;a[f+6]*=d;a[f+10]*=b;a[f+3]*=c;a[f+7]*=d;a[f+11]*=b},b.Matrix4x4.mulTranslate=function(a,f,c,d,b,e){null==e&&(e=!0);if(e)a[f+12]+=a[f+0]*c+a[f+4]*d+a[f+8]*b,a[f+13]+=a[f+1]*c+a[f+5]*d+
a[f+9]*b,a[f+14]+=a[f+2]*c+a[f+6]*d+a[f+10]*b,a[f+15]+=a[f+3]*c+a[f+7]*d+a[f+11]*b;else{e=a[f+12];var h=a[f+13],l=a[f+14],k=a[f+15];a[f+0]+=e*c;a[f+4]+=e*d;a[f+8]+=e*b;a[f+1]+=h*c;a[f+5]+=h*d;a[f+9]+=h*b;a[f+2]+=l*c;a[f+6]+=l*d;a[f+10]+=l*b;a[f+3]+=k*c;a[f+7]+=k*d;a[f+11]+=k*b}},b.Matrix4x4.mulRotateXAxis=function(a,f,c,d){null==d&&(d=!0);d?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var b=a[f+4],e=a[f+8],h=a[f+5],l=a[f+9],k=a[f+6],m=a[f+10],n=a[f+7],p=a[f+11];a[f+4]=b*d+e*c;a[f+
8]=b*-c+e*d;a[f+5]=h*d+l*c;a[f+9]=h*-c+l*d;a[f+6]=k*d+m*c;a[f+10]=k*-c+m*d;a[f+7]=n*d+p*c;a[f+11]=n*-c+p*d},b.Matrix4x4.mulRotateYAxis=function(a,f,c,d){null==d&&(d=!0);d?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var b=a[f+0],e=a[f+8],h=a[f+1],l=a[f+9],k=a[f+2],m=a[f+10],n=a[f+3],p=a[f+11];a[f+0]=b*d+e*-c;a[f+8]=b*c+e*d;a[f+1]=h*d+l*-c;a[f+9]=h*c+l*d;a[f+2]=k*d+m*-c;a[f+10]=k*c+m*d;a[f+3]=n*d+p*-c;a[f+11]=n*c+p*d},b.Matrix4x4.mulRotateZAxis=function(a,b,c,d){null==d&&(d=!0);d?(d=
Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var g=a[b+0],e=a[b+4],h=a[b+1],l=a[b+5],k=a[b+2],m=a[b+6],n=a[b+3],p=a[b+7];a[b+0]=g*d+e*c;a[b+4]=g*-c+e*d;a[b+1]=h*d+l*c;a[b+5]=h*-c+l*d;a[b+2]=k*d+m*c;a[b+6]=k*-c+m*d;a[b+3]=n*d+p*c;a[b+7]=n*-c+p*d},b.Matrix4x4.mulRotate=function(a,b,c,d,g,e,h,l){1==h&&(h=!0);null==l&&(l=!0);l?(l=Math.cos(e),e=Math.sin(e)):(l=Math.cos(e),e=-Math.sin(e));h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));h=1-l;var k=c*h,m=d*h,n=d*k,p=g*k,q=g*m,r=c*e,
v=d*e,x=g*e;e=a[b+0];var u=a[b+4],y=a[b+8],w=a[b+1],A=a[b+5],z=a[b+9],E=a[b+2],G=a[b+6],B=a[b+10],D=a[b+3],H=a[b+7],F=a[b+11];c=l+c*k;var k=n-x,K=p+v,n=n+x;d=l+d*m;m=q-r;p-=v;q+=r;g=l+g*g*h;a[b+0]=e*c+u*n+y*p;a[b+4]=e*k+u*d+y*q;a[b+8]=e*K+u*m+y*g;a[b+1]=w*c+A*n+z*p;a[b+5]=w*k+A*d+z*q;a[b+9]=w*K+A*m+z*g;a[b+2]=E*c+G*n+B*p;a[b+6]=E*k+G*d+B*q;a[b+10]=E*K+G*m+B*g;a[b+3]=D*c+H*n+F*p;a[b+7]=D*k+H*d+F*q;a[b+11]=D*K+H*m+F*g},b.Matrix4x4.mulLookAt=function(a,b,c,d,g,e,h,l,k,m,n,p){null==p&&(p=!0);e-=c;h-=
d;l-=g;var q=e*e+h*h+l*l;0<q&&(q=Math.sqrt(q),e/=q,h/=q,l/=q);q=h*n-l*m;n=l*k-e*n;k=e*m-h*k;m=q*q+n*n+k*k;0<m&&(m=Math.sqrt(m),q/=m,n/=m,k/=m);m=h*k-l*n;var r=l*q-e*k,v=e*n-h*q,x=-(q*c+n*d+k*g),u=-(m*c+r*d+v*g);c=-(e*c+h*d+l*g);d=a[b+0];g=a[b+4];var y=a[b+8],w=a[b+1],A=a[b+5],z=a[b+9],E=a[b+2],G=a[b+6],B=a[b+10],D=a[b+3],H=a[b+7],F=a[b+11];if(p)a[b+0]=d*q+g*m+y*e,a[b+4]=d*n+g*r+y*h,a[b+8]=d*k+g*v+y*l,a[b+12]+=d*x+g*u+y*c,a[b+1]=w*q+A*m+z*e,a[b+5]=w*n+A*r+z*h,a[b+9]=w*k+A*v+z*l,a[b+13]+=w*x+A*u+z*
c,a[b+2]=E*q+G*m+B*e,a[b+6]=E*n+G*r+B*h,a[b+10]=E*k+G*v+B*l,a[b+14]+=E*x+G*u+B*c,a[b+3]=D*q+H*m+F*e,a[b+7]=D*n+H*r+F*h,a[b+11]=D*k+H*v+F*l,a[b+15]+=D*x+H*u+F*c;else{p=a[b+12];var K=a[b+13],C=a[b+14],L=a[b+15];a[b+0]=d*q+g*n+y*k+p*x;a[b+4]=d*m+g*r+y*v+p*u;a[b+8]=d*e+g*h+y*l+p*c;a[b+1]=w*q+A*n+z*k+K*x;a[b+5]=w*m+A*r+z*v+K*u;a[b+9]=w*e+A*h+z*l+K*c;a[b+2]=E*q+G*n+B*k+C*x;a[b+6]=E*m+G*r+B*v+C*u;a[b+10]=E*e+G*h+B*l+C*c;a[b+3]=D*q+H*n+F*k+L*x;a[b+7]=D*m+H*r+F*v+L*u;a[b+11]=D*e+H*h+F*l+L*c}},b.Matrix4x4.mulPerspective=
function(a,b,c,d,g,e,h,l,k,m,n){null==n&&(n=!0);var p=e-g,q=e*(m-k);e=a[b+8];m=a[b+9];var r=a[b+10],v=a[b+11];c=g*h/c;d=g*l/d;k=q/p+k;n?(g=g*q/-p,a[b+0]*=c,a[b+4]*=d,a[b+8]=e*k+a[b+12],a[b+12]=e*g,a[b+1]*=c,a[b+5]*=d,a[b+9]=m*k+a[b+13],a[b+13]=m*g,a[b+2]*=c,a[b+6]*=d,a[b+10]=r*k+a[b+14],a[b+14]=r*g,a[b+3]*=c,a[b+7]*=d,a[b+11]=v*k+a[b+15],a[b+15]=v*g):(g=g*q/-p,a[b+0]*=c,a[b+4]*=d,a[b+8]=e*k+a[b+12]*g,a[b+12]=e,a[b+1]*=c,a[b+5]*=d,a[b+9]=m*k+a[b+13]*g,a[b+13]=m,a[b+2]*=c,a[b+6]*=d,a[b+10]=r*k+a[b+
14]*g,a[b+14]=r,a[b+3]*=c,a[b+7]*=d,a[b+11]=v*k+a[b+15]*g,a[b+15]=v)},b.Matrix4x4.normalizeAxisv=function(a,b,c,d,g){null==g&&(g=!0);var e,h,l,k,m,n,p,q;e=c[d+0];m=c[d+5];q=c[d+10];g?(h=c[d+1],l=c[d+2],k=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]):(h=c[d+4],l=c[d+8],k=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]);d=e*e+h*h+l*l;0<d&&(d=Math.sqrt(d),e/=d,h/=d,l/=d);d=k*k+m*m+n*n;0<d&&(d=Math.sqrt(d),k/=d,m/=d,n/=d);d=p*p+c*c+q*q;0<d&&(d=Math.sqrt(d),p/=d,c/=d,q/=d);a[b+0]=e;a[b+5]=m;a[b+10]=q;g?(a[b+1]=h,a[b+2]=l,a[b+
4]=k,a[b+6]=n,a[b+8]=p,a[b+9]=c):(a[b+4]=h,a[b+8]=l,a[b+1]=k,a[b+9]=n,a[b+2]=p,a[b+6]=c)},b.Matrix4x4.slrepAxisAndLrepOtherv=function(a,f,c,d,g,e,h,l){null==l&&(l=!0);var k=1-h,m,n,p,q,r,v,x,u,y,w,A,z,E,G,B;m=c[d+0];r=c[d+5];y=c[d+10];B=c[d+15];l?(n=c[d+1],p=c[d+2],w=c[d+3],q=c[d+4],v=c[d+6],A=c[d+7],x=c[d+8],u=c[d+9],z=c[d+11],E=c[d+12],G=c[d+13],c=c[d+14]):(n=c[d+4],p=c[d+8],w=c[d+12],q=c[d+1],v=c[d+9],A=c[d+13],x=c[d+2],u=c[d+6],z=c[d+14],E=c[d+3],G=c[d+7],c=c[d+11]);var D,H,F,K,C,L,P,M,N,I,T,
X,R,Y;D=g[e+0];C=g[e+5];I=g[e+10];Y=g[e+15];l?(H=g[e+1],F=g[e+2],d=g[e+3],K=g[e+4],L=g[e+6],P=g[e+7],M=g[e+8],N=g[e+9],T=g[e+11],X=g[e+12],R=g[e+13],g=g[e+14]):(H=g[e+4],F=g[e+8],d=g[e+12],K=g[e+1],L=g[e+9],P=g[e+13],M=g[e+2],N=g[e+6],T=g[e+14],X=g[e+3],R=g[e+7],g=g[e+11]);var J=m*m+n*n+p*p;0<J&&(J=Math.sqrt(J),m/=J,n/=J,p/=J);var V=q*q+r*r+v*v;0<V&&(V=Math.sqrt(V),q/=V,r/=V,v/=V);e=x*x+u*u+y*y;0<e&&(e=Math.sqrt(e),x/=e,u/=e,y/=e);var O=D*D+H*H+F*F;0<O&&(O=Math.sqrt(O),D/=O,H/=O,F/=O);var W=K*K+C*
C+L*L;0<W&&(W=Math.sqrt(W),K/=W,C/=W,L/=W);var S=M*M+N*N+I*I;0<S&&(S=Math.sqrt(S),M/=S,N/=S,I/=S);var Q=m*D+n*H+p*F;if(1<=Q)J=J*k+O*h,m*=J,n*=J,p*=J;else if(-1>=Q)J=J*k-O*h,m*=J,n*=J,p*=J;else{var J=J*k+O*h,O=Math.acos(Q),U=Math.sin(O),Q=Math.sin(O*k)/U,O=Math.sin(O*h)/U;m=(m*Q+D*O)*J;n=(n*Q+H*O)*J;p=(p*Q+F*O)*J}Q=q*K+r*C+v*L;1<=Q?(J=V*k+W*h,q*=J,r*=J,v*=J):-1>=Q?(J=V*k-W*h,q*=J,r*=J,v*=J):(J=V*k+W*h,O=Math.acos(Q),U=Math.sin(O),Q=Math.sin(O*k)/U,O=Math.sin(O*h)/U,q=(q*Q+K*O)*J,r=(r*Q+C*O)*J,v=(v*
Q+L*O)*J);L=x*M+u*N+y*I;1<=L?(J=e*k+S*h,x*=J,u*=J,y*=J):-1>=L?(J=e*k-S*h,x*=J,u*=J,y*=J):(J=e*k+S*h,O=Math.acos(L),U=Math.sin(O),Q=Math.sin(O*k)/U,O=Math.sin(O*h)/U,x=(x*Q+M*O)*J,u=(u*Q+N*O)*J,y=(y*Q+I*O)*J);b.Matrix4x4.load(a,f,m,q,x,E*k+X*h,n,r,u,G*k+R*h,p,v,y,c*k+g*h,w*k+d*h,A*k+P*h,z*k+T*h,B*k+Y*h,l?!1:!0)},b.Matrix4x4.toRotateAxisv=function(a,b,c,d,g){null==g&&(g=!0);var e=c[d+0],h=c[d+5],l=c[d+10],k,m,n,p;g?(g=c[d+4],k=c[d+8],m=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]):(g=c[d+1],k=c[d+2],m=c[d+4],
n=c[d+6],p=c[d+8],c=c[d+9]);d=.5*(g+m);var q=.5*(p+k),r=.5*(n+c),e=Math.min(e-(0!=r?Math.abs(d*q/r):0),h-(0!=q?Math.abs(d*r/q):0),l-(0!=d?Math.abs(q*r/d):0)),h=.5*(n-c);k=.5*(p-k);g=.5*(g-m);m=h*h+k*k+g*g;p=e*e+m;0<p&&(e/=Math.sqrt(p));if(1<=e)return a[b+0]=0,a[b+1]=0,a[b+2]=0;0<m?(m=Math.sqrt(m),a[b+0]=-h/m,a[b+1]=-k/m,a[b+2]=-g/m):(a[b+0]=0,a[b+1]=0,a[b+2]=0);return Math.acos(e)},b.Matrix4x4.fromQuaternionv=function(a,f,c,d,g){null==g&&(g=!0);var e=c[d+0],h=c[d+1],l=c[d+2],k=c[d+3];c=e*e;d=h*h;
var m=l*l,n=k*k,p=h*l*2,q=h*k*2,r=l*k*2,h=e*h*2,l=e*l*2,e=e*k*2;b.Matrix4x4.load(a,f,d+c-n-m,p-e,q+l,0,p+e,m+c-d-n,r-h,0,q-l,r+h,n+c-m-d,0,0,0,0,1,!g)},b.Matrix4x4.mulQuaternionv=function(a,b,c,d,g){null==g&&(g=!0);var e=c[d+0],h=c[d+1],l=c[d+2],k=c[d+3],m=e*e,n=h*h,p=l*l,q=k*k,r=h*l*2;d=h*k*2;c=l*k*2;var h=e*h*2,l=e*l*2,v=e*k*2,e=a[b+0],k=a[b+4],x=a[b+8],u=a[b+1],y=a[b+5],w=a[b+9],A=a[b+2],z=a[b+6],E=a[b+10],G=a[b+3],B=a[b+7],D=a[b+11],H=n+m-q-p,F=p+m-n-q,m=q+m-p-n;g?(g=r-v,n=d+l,r+=v,p=c-h,d-=l,
c+=h):(g=r+v,n=d-l,r-=v,p=c+h,d+=l,c-=h);a[b+0]=e*H+k*r+x*d;a[b+4]=e*g+k*F+x*c;a[b+8]=e*n+k*p+x*m;a[b+1]=u*H+y*r+w*d;a[b+5]=u*g+y*F+w*c;a[b+9]=u*n+y*p+w*m;a[b+2]=A*H+z*r+E*d;a[b+6]=A*g+z*F+E*c;a[b+10]=A*n+z*p+E*m;a[b+3]=G*H+B*r+D*d;a[b+7]=G*g+B*F+D*c;a[b+11]=G*n+B*p+D*m},b.Matrix4x4.mulQuaternionAxisv=function(a,b,c,d,g){null==g&&(g=!0);var e=c[d+0],h=c[d+1],l=c[d+2],k=c[d+3],m=e*e,n=h*h,p=l*l,q=k*k,r=h*l*2;d=h*k*2;c=l*k*2;var h=e*h*2,l=e*l*2,v=e*k*2,e=a[b+0],k=a[b+4],x=a[b+8],u=a[b+1],y=a[b+5],w=
a[b+9],A=a[b+2],z=a[b+6],E=a[b+10],G=n+m-q-p,B=p+m-n-q,m=q+m-p-n;g?(g=r-v,n=d+l,r+=v,p=c-h,d-=l,c+=h):(g=r+v,n=d-l,r-=v,p=c+h,d+=l,c-=h);a[b+0]=e*G+k*r+x*d;a[b+4]=e*g+k*B+x*c;a[b+8]=e*n+k*p+x*m;a[b+1]=u*G+y*r+w*d;a[b+5]=u*g+y*B+w*c;a[b+9]=u*n+y*p+w*m;a[b+2]=A*G+z*r+E*d;a[b+6]=A*g+z*B+E*c;a[b+10]=A*n+z*p+E*m},b.Matrix4x4.toQuaternionv=function(a,f,c,d,g,e){null==e&&(e=!0);var h=c[d+0],l=c[d+5],k=c[d+10],m,n,p,q,r;e?(e=c[d+4],m=c[d+8],n=c[d+1],p=c[d+9],q=c[d+2],r=c[d+6]):(e=c[d+1],m=c[d+2],n=c[d+4],
p=c[d+6],q=c[d+8],r=c[d+9]);c=(n*r-q*l)*m+(q*e-h*r)*p+(h*l-n*e)*k;d=0>c;0!=c&&(c=Math.pow(Math.abs(c),1/3),h/=c,n/=c,q/=c,e/=c,l/=c,r/=c,m/=c,p/=c,k/=c,c=Math.sqrt(c));p=.5*(r-p);m=.5*(m-q);e=.5*(n-e);q=p*p+m*m+e*e;0<q&&(q=Math.sqrt(q),d?(p/=-q,m/=-q,e/=-q):(p/=q,m/=q,e/=q));n=b.MathUtils.mid(.5*(h+l+k-1),1,-1);n=d?-b.MathUtils.mid(.5*(h+l+k+1),1,-1):b.MathUtils.mid(.5*(h+l+k-1),1,-1);h=.5*Math.acos(n);n=Math.cos(h);q=Math.sin(h);g?(a[f+0]=c*n,a[f+1]=c*q*p,a[f+2]=c*q*m,a[f+3]=c*q*e):(a[f+0]=c*-n,
a[f+1]=c*-q*p,a[f+2]=c*-q*m,a[f+3]=c*-q*e)})})(xpl);(function(b){b.Quaternion=function(){throw Error("Unsupported operation");};b.Quaternion.load=function(a,b,c,d,g,e){a[b+0]=c;a[b+1]=d;a[b+2]=g;a[b+3]=e};b.Quaternion.loadv=function(a,f,c,d){b.Quaternion.load(a,f,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.loadZero=function(a,f){b.Quaternion.load(a,f,0,0,0,0)};b.Quaternion.loadIdentity=function(a,f){b.Quaternion.load(a,f,1,0,0,0)};b.Quaternion.absSq=function(a,b){var c=a[b+0],d=a[b+1],g=a[b+2],e=a[b+3];return c*c+d*d+g*g+e*e};b.Quaternion.abs=function(a,
f){return Math.sqrt(b.Quaternion.absSq(a,f))};b.Quaternion.normalizev=function(a,f,c,d){var g=c[d+0],e=c[d+1],h=c[d+2];c=c[d+3];d=g*g+e*e+h*h+c*c;0<d?(d=Math.sqrt(d),b.Quaternion.load(a,f,g/d,e/d,h/d,c/d)):b.Quaternion.loadZero(a,f)};b.Quaternion.exp=function(a,f,c,d,g,e){c=Math.exp(c);var h=Math.sqrt(d*d+g*g+e*e),l=c*Math.sin(h)/h;b.Quaternion.load(a,f,c*Math.cos(h),d*l,g*l,e*l)};b.Quaternion.expv=function(a,f,c,d){b.Quaternion.exp(a,f,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.cis=function(a,f,
c,d,g){var e=Math.sqrt(c*c+d*d+g*g),h=Math.sin(e)/e;b.Quaternion.load(a,f,Math.cos(e),c*h,d*h,g*h)};b.Quaternion.cisv=function(a,f,c,d){b.Quaternion.cis(a,f,c[d+VX],c[d+VY],c[d+VZ])};b.Quaternion.log=function(a,f,c,d,g,e){var h=Math.sqrt(c*c+d*d+g*g+e*e);c=Math.acos(c/h)/Math.sqrt(d*d+g*g+e*e);b.Quaternion.load(a,f,Math.log(h),d*c,g*c,e*c)};b.Quaternion.logv=function(a,f,c,d){b.Quaternion.log(a,f,c[d+0],c[d+1],c[d+2],c[d+3])};b.Quaternion.lerp=function(a,f,c,d,g,e,h,l,k,m,n){var p=1-n;b.Quaternion.load(a,
f,c*p+h*n,d*p+l*n,g*p+k*n,e*p+m*n)};b.Quaternion.lerpv=function(a,f,c,d,g,e,h){b.Quaternion.lerp(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g[e+0],g[e+1],g[e+2],g[e+3],h)};b.Quaternion.slerp=function(a,f,c,d,g,e,h,l,k,m,n){var p=c*c+d*d+g*g+e*e;0<p&&(p=Math.sqrt(p),c/=p,d/=p,g/=p,e/=p);var q=h*h+l*l+k*k+m*m;0<q&&(q=Math.sqrt(q),h/=q,l/=q,k/=q,m/=q);var r=c*h+d*l+g*k+e*m;if(1<=r)p=p*(1-n)+q*n,b.Quaternion.load(a,f,c*p,d*p,g*p,e*p);else if(-1>=r)p=p*(1-n)-q*n,b.Quaternion.load(a,f,c*p,d*p,g*p,e*p);else{var p=
p*(1-n)+q*n,q=Math.acos(r),v=Math.sin(q),r=Math.sin(q*(1-n))/v;n=Math.sin(q*n)/v;b.Quaternion.load(a,f,(c*r+h*n)*p,(d*r+l*n)*p,(g*r+k*n)*p,(e*r+m*n)*p)}};b.Quaternion.slerpv=function(a,f,c,d,g,e,h){b.Quaternion.slerp(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g[e+0],g[e+1],g[e+2],g[e+3],h)};b.Quaternion.dot=function(a,b,c,d,g,e,h,l){return a*g+b*e+c*h+d*l};b.Quaternion.dotv=function(a,b,c,d){return a[b+0]*c[d+0]+a[b+1]*c[d+1]+a[b+2]*c[d+2]+a[b+3]*c[d+3]};b.Quaternion.conjugatev=function(a,f,c,d){b.Quaternion.load(a,
f,c[d+0],-c[d+1],-c[d+2],-c[d+3])};b.Quaternion.inversev=function(a,f,c,d){var g=c[d+0],e=c[d+1],h=c[d+2];c=c[d+3];d=g*g+e*e+h*h+c*c;0<d&&(d=Math.sqrt(d),g/=d,e/=-d,h/=-d,c/=-d);b.Quaternion.load(a,f,g,e,h,c)};b.Quaternion.add=function(a,f,c,d,g,e,h,l,k,m){b.Quaternion.load(a,f,c+h,d+l,g+k,e+m)};b.Quaternion.addv=function(a,f,c,d,g,e){b.Quaternion.add(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g[e+0],g[e+1],g[e+2],g[e+3])};b.Quaternion.sub=function(a,f,c,d,g,e,h,l,k,m){b.Quaternion.load(a,f,c-h,d-l,g-k,e-m)};
b.Quaternion.subv=function(a,f,c,d,g,e){b.Quaternion.sub(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g[e+0],g[e+1],g[e+2],g[e+3])};b.Quaternion.mul=function(a,f,c,d,g,e,h,l,k,m){b.Quaternion.load(a,f,c*h-(d*l+g*k+e*m),c*l+d*h+(g*m-e*k),c*k+g*h+(e*l-d*m),c*m+e*h+(d*k-g*l))};b.Quaternion.mulv=function(a,f,c,d,g,e){b.Quaternion.mul(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g[e+0],g[e+1],g[e+2],g[e+3])};b.Quaternion.mulScalar=function(a,f,c,d,g,e,h){b.Quaternion.load(a,f,c*h,d*h,g*h,e*h)};b.Quaternion.mulScalarv=function(a,
f,c,d,g){b.Quaternion.mulScalar(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g)};b.Quaternion.div=function(a,f,c,d,g,e,h,l,k,m){var n=h*h+l*l+k*k+m*m;b.Quaternion.load(a,f,(c*h+(d*l+g*k+e*m))/n,(-c*l+d*h-(g*m-e*k))/n,(-c*k+g*h-(e*l-d*m))/n,(-c*m+e*h-(d*k-g*l))/n)};b.Quaternion.divv=function(a,f,c,d,g,e){b.Quaternion.div(a,f,c[d+0],c[d+1],c[d+2],c[d+3],g[e+0],g[e+1],g[e+2],g[e+3])};b.Quaternion.divScalar=function(a,f,c,d,g,e,h){b.Quaternion.load(a,f,c/h,d/h,g/h,e/h)};b.Quaternion.divScalarv=function(a,f,c,d,g){b.Quaternion.divScalar(a,
f,c[d+0],c[d+1],c[d+2],c[d+3],g)};b.Quaternion.convertToString=function(a,b){return"Quaternion("+a[b+0]+", "+a[b+1]+", "+a[b+2]+", "+a[b+3]+")"}})(xpl);(function(b){b.Quaternion&&(b.Quaternion.loadIAxisRotate=function(a,f,c){c*=.5;b.Quaternion.load(a,f,Math.cos(c),Math.sin(c),0,0)},b.Quaternion.loadJAxisRotate=function(a,f,c){c*=.5;b.Quaternion.load(a,f,Math.cos(c),0,Math.sin(c),0)},b.Quaternion.loadKAxisRotate=function(a,f,c){c*=.5;b.Quaternion.load(a,f,Math.cos(c),0,0,Math.sin(c))},b.Quaternion.loadRotate=function(a,f,c,d,g,e,h){null==h&&(h=!0);h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));e*=.5;h=Math.sin(e);b.Quaternion.load(a,f,Math.cos(e),
c*h,d*h,g*h)},b.Quaternion.loadRotateVector3=function(a,f,c,d,g,e,h,l,k,m,n){null==n&&(n=1);if(e)if(e=c*c+d*d+g*g,0<e)e=Math.sqrt(e),c/=e,d/=e,g/=e;else{b.Quaternion.loadIdentity(a,f);return}if(m)if(m=h*h+l*l+k*k,0<m)m=Math.sqrt(m),h/=m,l/=m,k/=m;else{b.Quaternion.loadIdentity(a,f);return}e=c*h+d*l+g*k;1<=e?b.Quaternion.loadIdentity(a,f):(m=d*k-g*l,g=g*h-c*k,c=c*l-d*h,d=m*m+g*g+c*c,0<d?(d=Math.sqrt(d),n*=.5*Math.acos(e),h=Math.sin(n),b.Quaternion.load(a,f,Math.cos(n),m/d*h,g/d*h,c/d*h)):b.Quaternion.loadIdentity(a,
f))},b.Quaternion.loadRotateVector3v=function(a,f,c,d,g,e,h,l){b.Quaternion.loadRotateVector3(a,f,c[d+0],c[d+1],c[d+2],g,e[h+0],e[h+1],e[h+2],l,t)},b.Quaternion.mulIAxisRotate=function(a,f,c){c*=.5;var d=Math.sin(c);c=Math.cos(c);var g=a[f+0],e=a[f+1],h=a[f+2],l=a[f+3];b.Quaternion.load(a,f,g*c-e*d,g*d+e*c,h*c+l*d,l*c-h*d)},b.Quaternion.mulJAxisRotate=function(a,f,c){c*=.5;var d=Math.sin(c);c=Math.cos(c);var g=a[f+0],e=a[f+1],h=a[f+2],l=a[f+3];b.Quaternion.load(a,f,g*c-h*d,e*c-l*d,g*d+h*c,l*c+e*d)},
b.Quaternion.mulKAxisRotate=function(a,f,c){c*=.5;var d=Math.sin(c);c=Math.cos(c);var g=a[f+0],e=a[f+1],h=a[f+2],l=a[f+3];b.Quaternion.load(a,f,g*c-l*d,e*c+h*d,h*c-e*d,g*d+l*c)},b.Quaternion.mulRotate=function(a,f,c,d,g,e,h){null==h&&(h=!0);h&&(h=c*c+d*d+g*g,0<h&&(h=Math.sqrt(h),c/=h,d/=h,g/=h));e*=.5;h=Math.sin(e);e=Math.cos(e);c*=h;d*=h;g*=h;h=a[f+0];var l=a[f+1],k=a[f+2],m=a[f+3];b.Quaternion.load(a,f,h*e-(l*c+k*d+m*g),h*c+l*e+(k*g-m*d),h*d+k*e+(m*c-l*g),h*g+m*e+(l*d-k*c))})})(xpl);(function(b){b.Vector3=function(){throw Error("Unsupported operation");};b.Vector3.load=function(a,b,c,d,g){a[b+0]=c;a[b+1]=d;a[b+2]=g};b.Vector3.loadv=function(a,f,c,d){b.Vector3.load(a,f,c[d+0],c[d+1],c[d+2])};b.Vector3.loadZero=function(a,f){b.Vector3.load(a,f,0,0,0)};b.Vector3.lenSq=function(a,b){var c=a[b+0],d=a[b+1],g=a[b+2];return c*c+d*d+g*g};b.Vector3.len=function(a,f){return Math.sqrt(b.Vector3.lenSq(a,f))};b.Vector3.normalizev=function(a,f,c,d){var g=c[d+0],e=c[d+1];c=c[d+2];d=g*g+e*e+
c*c;0<d?(d=Math.sqrt(d),b.Vector3.load(a,f,g/d,e/d,c/d)):b.Vector3.loadZero(a,f)};b.Vector3.lerp=function(a,f,c,d,g,e,h,l,k){var m=1-k;b.Vector3.load(a,f,c*m+e*k,d*m+h*k,g*m+l*k)};b.Vector3.lerpv=function(a,f,c,d,g,e,h){b.Vector3.lerp(a,f,c[d+0],c[d+1],c[d+2],g[e+0],g[e+1],g[e+2],h)};b.Vector3.slerp=function(a,f,c,d,g,e,h,l,k){var m=c*c+d*d+g*g;0<m&&(m=Math.sqrt(m),c/=m,d/=m,g/=m);var n=e*e+h*h+l*l;0<n&&(n=Math.sqrt(n),e/=n,h/=n,l/=n);var p=c*e+d*h+g*l;if(1<=p)m=m*(1-k)+n*k,b.Vector3.load(a,f,c*m,
d*m,g*m);else if(-1>=p)m=m*(1-k)-n*k,b.Vector3.load(a,f,c*m,d*m,g*m);else{var m=m*(1-k)+n*k,n=Math.acos(p),q=Math.sin(n),p=Math.sin(n*(1-k))/q;k=Math.sin(n*k)/q;b.Vector3.load(a,f,(c*p+e*k)*m,(d*p+h*k)*m,(g*p+l*k)*m)}};b.Vector3.slerpv=function(a,f,c,d,g,e,h){b.Vector3.slerp(a,f,c[d+0],c[d+1],c[d+2],g[e+0],g[e+1],g[e+2],h)};b.Vector3.dot=function(a,b,c,d,g,e){return a*d+b*g+c*e};b.Vector3.dotv=function(a,b,c,d){return a[b+0]*c[d+0]+a[b+1]*c[d+1]+a[b+2]*c[d+2]};b.Vector3.cross=function(a,f,c,d,g,e,
h,l){b.Vector3.load(a,f,d*l-g*h,g*e-c*l,c*h-d*e)};b.Vector3.crossv=function(a,f,c,d,g,e){b.Vector3.cross(a,f,c[d+0],c[d+1],c[d+2],g[e+0],g[e+1],g[e+2])};b.Vector3.cos=function(a,b,c,d,g,e){var h=a*a+b*b+c*c;0<h&&(h=Math.sqrt(h),a/=h,b/=h,c/=h);h=d*d+g*g+e*e;0<h&&(h=Math.sqrt(h),d/=h,g/=h,e/=h);return a*d+b*g+c*e};b.Vector3.cosv=function(a,f,c,d){return b.Vector3.cos(a[f+0],a[f+1],a[f+2],c[d+0],c[d+1],c[d+2])};b.Vector3.reversev=function(a,f,c,d){b.Vector3.load(a,f,-c[d+0],-c[d+1],-c[d+2])};b.Vector3.add=
function(a,f,c,d,g,e,h,l){b.Vector3.load(a,f,c+e,d+h,g+l)};b.Vector3.addv=function(a,f,c,d,g,e){b.Vector3.add(a,f,c[d+0],c[d+1],c[d+2],g[e+0],g[e+1],g[e+2])};b.Vector3.sub=function(a,f,c,d,g,e,h,l){b.Vector3.load(a,f,c-e,d-h,g-l)};b.Vector3.subv=function(a,f,c,d,g,e){b.Vector3.sub(a,f,c[d+0],c[d+1],c[d+2],g[e+0],g[e+1],g[e+2])};b.Vector3.mul=function(a,f,c,d,g,e){b.Vector3.load(a,f,c*e,d*e,g*e)};b.Vector3.mulv=function(a,f,c,d,g){b.Vector3.mul(a,f,c[d+0],c[d+1],c[d+2],g)};b.Vector3.mulQuaternionv=
function(a,f,c,d,g,e){var h=c[d+0],l=c[d+1],k=c[d+2];c=c[d+3];d=g[e+0];var m=g[e+1],n=g[e+2];g=-(l*d+k*m+c*n);e=h*d+(k*n-c*m);var p=h*m+(c*d-l*n);d=h*n+(l*m-k*d);b.Vector3.load(a,f,-g*l+e*h-(p*c-d*k),-g*k+p*h-(d*l-e*c),-g*c+d*h-(e*k-p*l))};b.Vector3.mulMatrix4x4v=function(a,f,c,d,g,e,h){null==h&&(h=!0);if(h){h=g[e+0];var l=g[e+1],k=g[e+2],m=c[d+3]*h+c[d+7]*l+c[d+11]*k+c[d+15];b.Vector3.load(a,f,(c[d+0]*h+c[d+4]*l+c[d+8]*k+c[d+12])/m,(c[d+1]*h+c[d+5]*l+c[d+9]*k+c[d+13])/m,(c[d+2]*h+c[d+6]*l+c[d+10]*
k+c[d+14])/m)}else h=c[d+VX],l=c[d+VY],k=c[d+VZ],m=h*g[e+12]+l*g[e+13]+k*g[e+14]+g[e+15],b.Vector3.load(a,f,(h*g[e+0]+l*g[e+1]+k*g[e+2]+g[e+3])/m,(h*g[e+4]+l*g[e+5]+k*g[e+6]+g[e+7])/m,(h*g[e+8]+l*g[e+9]+k*g[e+10]+g[e+11])/m)};b.Vector3.mulMatrix4x4Axisv=function(a,f,c,d,g,e,h){null==h&&(h=!0);if(h){h=g[e+0];var l=g[e+1],k=g[e+2];b.Vector3.load(a,f,c[d+0]*h+c[d+4]*l+c[d+8]*k,c[d+1]*h+c[d+5]*l+c[d+9]*k,c[d+2]*h+c[d+6]*l+c[d+10]*k)}else h=c[d+VX],l=c[d+VY],k=c[d+VZ],b.Vector3.load(a,f,h*g[e+0]+l*g[e+
1]+k*g[e+2],h*g[e+4]+l*g[e+5]+k*g[e+6],h*g[e+8]+l*g[e+9]+k*g[e+10])};b.Vector3.div=function(a,f,c,d,g,e){b.Vector3.load(a,f,c*e,d*e,g*e)};b.Vector3.divv=function(a,f,c,d,g){b.Vector3.div(a,f,c[d+0],c[d+1],c[d+2],g)};b.Vector3.convertToString=function(a,b){return"Vector3("+a[b+0]+", "+a[b+1]+", "+a[b+2]+")"}})(xpl);(function(b){b.GLUtils=function(){};Object.defineProperties(b.GLUtils,{TYPE_VERTEX_SHADER:{value:"OpenGL Vertex Shader"},TYPE_FRAGMENT_SHADER:{value:"OpenGL Fragment Shader"},TYPE_PROGRAM:{value:"OpenGL Program"}});b.GLUtils.createBuffer=function(a,b,c,d){if(b==a.ARRAY_BUFFER||b==a.ELEMENT_ARRAY_BUFFER){var g=a.createBuffer();null!=g&&(a.bindBuffer(b,g),a.bufferData(b,c,d));return g}return null};b.GLUtils.createTexture2D=function(a,f,c,d,g,e,h,l,k){var m=a.createTexture();if(null!=m){a.bindTexture(a.TEXTURE_2D,
m);var n=b.MathUtils.cailPow2(d),p=b.MathUtils.cailPow2(g);d==n&&g==p?(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,f,n,p,0,f,c,e)):(a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,f,texWidth,texHeight,0,f,c,null),null!=e&&a.texSubImage2D(a.TEXTURE_2D,0,0,0,d,g,f,c,e));h&&a.generateMipmap(a.TEXTURE_2D);null!=l&&(l[k+0]=n,l[k+1]=p)}return m};b.GLUtils.createTexture2DFromImage=function(a,b,c,d){var g=a.createTexture();null!=g&&(a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,
0,b,b,c,d));return g};b.GLUtils.createShader=function(a,f,c,d){if(f==a.VERTEX_SHADER||f==a.FRAGMENT_SHADER){var g=a.createShader(f);return null==g||(a.shaderSource(g,c),a.compileShader(g),a.getShaderParameter(g,a.COMPILE_STATUS))?g:(c=a.getShaderInfoLog(g),console.error("Shader compile error:\n"+c),null!=d&&(f==a.VERTEX_SHADER?d(b.GLUtils.TYPE_VERTEX_SHADER,c):f==a.FRAGMENT_SHADER&&d(b.GLUtils.TYPE_FRAGMENT_SHADER,+c)),a.deleteShader(g),null)}return null};b.GLUtils.createProgram=function(a,f,c,d,
g){if(null!=f&&null!=c){var e=a.createProgram();if(null!=e){a.attachShader(e,f);a.attachShader(e,c);if(null!=d)for(var h in d)a.bindAttribLocation(e,d[h],h);a.linkProgram(e);if(!a.getProgramParameter(e,a.LINK_STATUS))return f=a.getProgramInfoLog(e),console.error("Program linkage error:\n"+f),null!=g&&g(b.GLUtils.TYPE_PROGRAM,f),a.deleteProgram(e),null}return e}return null};b.GLUtils.createShaderProgram=function(a,f,c,d,g){f=b.GLUtils.createShader(a,a.VERTEX_SHADER,f,g);if(null==f)return null;c=b.GLUtils.createShader(a,
a.FRAGMENT_SHADER,c,g);if(null==c)return a.deleteShader(f),null;d=b.GLUtils.createProgram(a,f,c,d,g);a.deleteShader(f);a.deleteShader(c);return d}})(xpl);(function(b){var a=1;b.XModelStructure=function(b){this.structure_type=b;var c=a++;this.valueOf=function(){return c};this.hashCode=function(){return c}};b.XModelStructure.prototype.equals=function(a){return this==a};Object.defineProperties(b.XModelStructure,{TYPE_UNDEFINED:{value:-1},TYPE_NULL:{value:0},TYPE_AXIS_ROTATE:{value:1},TYPE_QUATERNION:{value:2},TYPE_SCALE:{value:3},TYPE_TRANSLATE:{value:4},TYPE_MATRIX:{value:5},TYPE_CONTAINER:{value:6},TYPE_TEXTURE:{value:7},TYPE_MATERIAL:{value:8},TYPE_MESH:{value:9},
TYPE_NODE:{value:10},TYPE_IK:{value:11},TYPE_ANIMATION:{value:12},TYPE_ANIMATION_KEY:{value:13},TYPE_ANIMATION_SET:{value:14},SIZE_RGBA:{value:4},SIZE_VECTOR_3:{value:3},SIZE_AXIS_ROTATE:{value:4},SIZE_QUATERNION:{value:4},SIZE_SCALE:{value:3},SIZE_TRANSLATE:{value:3},SIZE_MATRIX:{value:16},NUM_BLEND_SLOT:{value:2}})})(xpl);(function(b){b.XModelUserData=function(){this.data_size=0;this.data=null}})(xpl);
(function(b){b.XModelTransform=function(a){b.XModelStructure.call(this,a)};Object.setPrototypeOf(b.XModelTransform.prototype,b.XModelStructure.prototype)})(xpl);
(function(b){b.XModelAxisRotate=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_AXIS_ROTATE);this.initial=new Float32Array([0,0,0,1]);this.value=new Float32Array([0,0,0,1,0,0,0,1])};Object.setPrototypeOf(b.XModelAxisRotate.prototype,b.XModelTransform.prototype);Object.defineProperties(b.XModelStructure,{ANGLE:{value:0},X:{value:1},Y:{value:2},Z:{value:3}})})(xpl);
(function(b){b.XModelQuaternion=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_QUATERNION);this.initial=new Float32Array([1,0,0,0]);this.value=new Float32Array([1,0,0,0,1,0,0,0])};Object.setPrototypeOf(b.XModelQuaternion.prototype,b.XModelTransform.prototype)})(xpl);
(function(b){b.XModelScale=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_SCALE);this.initial=new Float32Array([1,1,1]);this.value=new Float32Array([1,1,1,1,1,1])};Object.setPrototypeOf(b.XModelScale.prototype,b.XModelTransform.prototype)})(xpl);(function(b){b.XModelTranslate=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_TRANSLATE);this.initial=new Float32Array([0,0,0]);this.value=new Float32Array([0,0,0,0,0,0])};Object.setPrototypeOf(b.XModelTranslate.prototype,b.XModelTransform.prototype)})(xpl);
(function(b){b.XModelMatrix=function(){b.XModelTransform.call(this,b.XModelStructure.TYPE_MATRIX);this.initial=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Object.setPrototypeOf(b.XModelMatrix.prototype,b.XModelTransform.prototype)})(xpl);
(function(b){b.XModelExtensible=function(a){b.XModelStructure.call(this,a);this.user_object=this.user_data=null};Object.setPrototypeOf(b.XModelExtensible.prototype,b.XModelStructure.prototype)})(xpl);
(function(b){b.XModelContainer=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_CONTAINER);this.name=null;this.num_textures=0;this.textures=null;this.num_materials=0;this.materials=null;this.num_meshes=0;this.meshes=null;this.num_nodes=0;this.nodes=null;this.time_rate=1;this.num_animation_sets=0;this.animation_sets=null};Object.setPrototypeOf(b.XModelContainer.prototype,b.XModelExtensible.prototype);b.XModelContainer.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelTexture=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_TEXTURE);this.ref=this.name=null;this.data_size=0;this.texture=this.data=null;this.z_size=this.y_size=this.x_size=0};Object.setPrototypeOf(b.XModelTexture.prototype,b.XModelExtensible.prototype);b.XModelTexture.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelMaterial=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_MATERIAL);this.name=null;this.emissive=[0,0,0,1];this.ambient=[.1,.1,.1,1];this.diffuse=[1,1,1,1];this.specular=[.4,.4,.4,1];this.shininess=5;this.bump=1;this.bump_map=this.shininess_map=this.specular_map=this.diffuse_map=this.ambient_map=this.emissive_map=null;this.draw_mode=b.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS};Object.setPrototypeOf(b.XModelMaterial.prototype,b.XModelExtensible.prototype);Object.defineProperties(b.XModelMaterial,
{DRAW_MODE_FACE_NONE_BITS:{value:0},DRAW_MODE_FACE_FRONT_BITS:{value:1},DRAW_MODE_FACE_BACK_BITS:{value:2},DRAW_MODE_FACE_FRONT_AND_BACK_BITS:{value:b.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS|b.XModelMaterial.DRAW_MODE_FACE_BACK_BITS}});b.XModelMaterial.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelMesh=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_MESH);this.name=null;this.position_size=this.num_positions=0;this.positions=null;this.normal_size=this.num_normals=0;this.normals=null;this.color_size=this.num_colors=0;this.colors=null;this.tex_coord_size=this.num_tex_coords=0;this.skin=this.tex_coords=null;this.num_vertices=0;this.vertices=null;this.num_materials=0;this.materials=null;this.num_elements=0;this.element_buffer=this.vertex_buffer=this.parent=this.elements=
null};Object.setPrototypeOf(b.XModelMesh.prototype,b.XModelExtensible.prototype);b.XModelMesh.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelSkin=function(){this.weighted_index_stride=this.num_weighted_indices=0;this.weights=this.indices=this.weighted_index_sizes=null;this.num_nodes=0;this.offset_quaternions=this.offset_matrices=this.nodes=null}})(xpl);
(function(b){b.XModelVertex=function(){this.skin_weight=this.tex_coord=this.color=this.normal=this.position=-1};b.XModelVertex.prototype.hashCode=function(){return this.position^this.normal^this.color^this.tex_coord^this.skin_weight};b.XModelVertex.prototype.equals=function(a){return this===a?!0:null!=a&&a instanceof b.XModelVertex?this.position==a.position&&this.normal==a.normal&&this.color==a.color&&this.tex_coord==a.tex_coord&&this.skin_weight==a.skin_weight:!1}})(xpl);
(function(b){b.XModelElement=function(){this.material=-1;this.num_vertices=0;this.vertices=null};b.XModelElement.prototype.hashCode=function(){for(var a=0,b=0;b<this.num_vertices;++b)a^=this.vertices[b];return this.material^this.num_vertices^a};b.XModelElement.prototype.equals=function(a){if(this===a)return!0;if(a&&a instanceof b.XModelElement){for(var f=0;f<this.num_vertices&&f<a.num_vertices;++f)if(this.vertices[f]!=a.vertices[f])return!1;return this.material==a.material&&this.num_vertices==a.num_vertices}return!1}})(xpl);
(function(b){b.XModelNode=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_NODE);this.name=null;this.connected=!0;this.lock_axises=new Uint8Array([!1,!1,!1]);this.limit_angles=new Uint8Array([!1,!1,!1]);this.min_angles=new Float32Array([-Math.PI,-Math.PI,-Math.PI]);this.max_angles=new Float32Array([Math.PI,Math.PI,Math.PI]);this.bone_tail=new Float32Array([0,0,0]);this.transforms=[null,null,null,null];this.num_iks=0;this.iks=null;this.num_meshes=0;this.meshes=null;this.num_children=
0;this.parent=this.children=null;this.offset_matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.combined_matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Object.setPrototypeOf(b.XModelNode.prototype,b.XModelExtensible.prototype);Object.defineProperties(b.XModelNode,{TRANSFORM_MATRIX:{value:0},TRANSFORM_TRANSLATE:{value:1},TRANSFORM_SCALE:{value:2},TRANSFORM_ROTATE:{value:3},NUM_TRANSFORMS:{value:4}});b.XModelNode.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelIK=function(){b.XModelStructure.call(this,b.XModelStructure.TYPE_IK);this.target=null;this.max_iterations=500;this.influence=this.chain_length=1};Object.setPrototypeOf(b.XModelIK.prototype,b.XModelStructure.prototype);b.XModelIK.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelAnimation=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_ANIMATION);this.target=this.name=null;this.index=-1;this.num_keys=0;this.keys=null;this.num_children=0;this.children=null};Object.setPrototypeOf(b.XModelAnimation.prototype,b.XModelExtensible.prototype);b.XModelAnimation.prototype.toString=function(){return this.name}})(xpl);
(function(b){b.XModelAnimationKey=function(){b.XModelStructure.call(this,b.XModelStructure.TYPE_ANIMATION_KEY);this.interpolate=b.XModelAnimationKey.INTERPOLATE_UNKNOWN;this.value_size=this.after_time=this.before_time=this.time=0;this.after_value=this.before_value=this.value=null};Object.setPrototypeOf(b.XModelAnimationKey.prototype,b.XModelStructure.prototype);Object.defineProperties(b.XModelAnimationKey,{INTERPOLATE_UNKNOWN:{value:-1},INTERPOLATE_LINER:{value:0},INTERPOLATE_BEZIER:{value:1}})})(xpl);
(function(b){b.XModelAnimationSet=function(){b.XModelExtensible.call(this,b.XModelStructure.TYPE_ANIMATION_SET);this.name=null;this.num_animations=0;this.animations=null};Object.setPrototypeOf(b.XModelAnimationSet.prototype,b.XModelExtensible.prototype);b.XModelAnimationSet.prototype.toString=function(){return this.name}})(xpl);(function(b){b.XModelCodec=function(){};Object.defineProperties(b.XModelCodec,{CODE_NAME:{value:"EX-MACHINA"},MAGIC_NUMBER:{value:1633971576},END_OF_DATA:{value:1685614437},VERSION:{value:35},COMPATIBILITY_VERSION:{value:35},VERSION_NAME:{value:"0.9.90"},COMPATIBILITY_VERSION_NAME:{value:"0.9.90"}})})(xpl);(function(b){b.XModelDecoder=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};Object.setPrototypeOf(b.XModelDecoder.prototype,b.XModelCodec.prototype);b.XModelDecoder.prototype.decode=function(a){this.__data_view=new DataView(a);this.__data_offset=0;this.__inst_map={};this.__weak_inst_map={};if(this._getInt32()!=b.XModelCodec.MAGIC_NUMBER||this._getInt32()<b.XModelCodec.COMPATIBILITY_VERSION)return this._recycle(),null;a=this._getInt32();a=this._createStructureProcedure(a);
this._getStructureProcedure(a);this._getInt32()!=b.XModelCodec.END_OF_DATA&&console.error("Warning! This data doesn't has a terminator in the binary!");this._recycle();return a};b.XModelDecoder.prototype._recycle=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};b.XModelDecoder.prototype._getInt8=function(){var a=this.__data_view.getInt8(this.__data_offset);this.__data_offset+=1;return a};b.XModelDecoder.prototype._getUint8=function(){var a=this.__data_view.getUint8(this.__data_offset);
this.__data_offset+=1;return a};b.XModelDecoder.prototype._getInt16=function(){var a=this.__data_view.getInt16(this.__data_offset,!0);this.__data_offset+=2;return a};b.XModelDecoder.prototype._getInt32=function(){var a=this.__data_view.getInt32(this.__data_offset,!0);this.__data_offset+=4;return a};b.XModelDecoder.prototype._getFloat32=function(){var a=this.__data_view.getFloat32(this.__data_offset,!0);this.__data_offset+=4;return a};b.XModelDecoder.prototype._getFloat64=function(){var a=this.__data_view.getFloat64(this.__data_offset,
!0);this.__data_offset+=8;return a};b.XModelDecoder.prototype._getInt8Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt8()};b.XModelDecoder.prototype._getUint8Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getUint8()};b.XModelDecoder.prototype._getInt16Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt16()};b.XModelDecoder.prototype._getInt32Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getInt32()};b.XModelDecoder.prototype._getFloat32Array=function(a,b,c){for(var d=
0;d<c;++d)a[b+d]=this._getFloat32()};b.XModelDecoder.prototype._getFloat64Array=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getFloat64()};b.XModelDecoder.prototype._getBool=function(){return 0!=this._getInt8()};b.XModelDecoder.prototype._getBoolArray=function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getBool()};b.XModelDecoder.prototype._getString=function(){var a=this._getInt16();if(0<a){var f=Array(a);this._getUint8Array(f,0,a);return b.StringUtils.decodeUTF8(f)}return null};b.XModelDecoder.prototype._getStringArray=
function(a,b,c){for(var d=0;d<c;++d)a[b+d]=this._getString()};b.XModelDecoder.prototype._getStructure=function(){var a=this._getInt32();if(0==a)return null;var b=this.__inst_map[a];if(null!=b)return b;b=this._getInt32();b=this._createStructureProcedure(b);this.__inst_map[a]=b;this._getStructureProcedure(b);return b};b.XModelDecoder.prototype._getStructureArray=function(a,b,c){for(var d=0;d<c;++d)a[b++]=this._getStructure()};b.XModelDecoder.prototype._getStructureWeakRef=function(){return null};b.XModelDecoder.prototype._getStructureWeakRefArray=
function(a,b,c){for(var d=0;d<c;++d)a[b++]=this._getStructureWeakRef()};b.XModelDecoder.prototype._createStructureProcedure=function(a){switch(a){case b.XModelStructure.TYPE_AXIS_ROTATE:return new b.XModelAxisRotate;case b.XModelStructure.TYPE_QUATERNION:return new b.XModelQuaternion;case b.XModelStructure.TYPE_SCALE:return new b.XModelScale;case b.XModelStructure.TYPE_TRANSLATE:return new b.XModelTranslate;case b.XModelStructure.TYPE_MATRIX:return new b.XModelMatrix;case b.XModelStructure.TYPE_CONTAINER:return new b.XModelContainer;
case b.XModelStructure.TYPE_TEXTURE:return new b.XModelTexture;case b.XModelStructure.TYPE_MATERIAL:return new b.XModelMaterial;case b.XModelStructure.TYPE_MESH:return new b.XModelMesh;case b.XModelStructure.TYPE_NODE:return new b.XModelNode;case b.XModelStructure.TYPE_IK:return new b.XModelIK;case b.XModelStructure.TYPE_ANIMATION:return new b.XModelAnimation;case b.XModelStructure.TYPE_ANIMATION_KEY:return new b.XModelAnimationKey;case b.XModelStructure.TYPE_ANIMATION_SET:return new b.XModelAnimationSet}return null};
b.XModelDecoder.prototype._getStructureProcedure=function(a){switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:return this._getAxisRotate(a),!0;case b.XModelStructure.TYPE_QUATERNION:return this._getQuaternion(a),!0;case b.XModelStructure.TYPE_SCALE:return this._getScale(a),!0;case b.XModelStructure.TYPE_TRANSLATE:return this._getTranslate(a),!0;case b.XModelStructure.TYPE_MATRIX:return this._getMatrix(a),!0;case b.XModelStructure.TYPE_CONTAINER:return this._getContainer(a),!0;case b.XModelStructure.TYPE_TEXTURE:return this._getTexture(a),
!0;case b.XModelStructure.TYPE_MATERIAL:return this._getMaterial(a),!0;case b.XModelStructure.TYPE_MESH:return this._getMesh(a),!0;case b.XModelStructure.TYPE_NODE:return this._getNode(a),!0;case b.XModelStructure.TYPE_IK:return this._getIK(a),!0;case b.XModelStructure.TYPE_ANIMATION:return this._getAnimation(a),!0;case b.XModelStructure.TYPE_ANIMATION_KEY:return this._getAnimationKey(a),!0;case b.XModelStructure.TYPE_ANIMATION_SET:return this._getAnimationSet(a),!0}return!1};b.XModelDecoder.prototype._getUserData=
function(){this._getInt32();return null};b.XModelDecoder.prototype._getAxisRotate=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_AXIS_ROTATE);ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_AXIS_ROTATE)};b.XModelDecoder.prototype._getQuaternion=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_QUATERNION);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_QUATERNION)};b.XModelDecoder.prototype._getScale=function(a){this._getFloat32Array(a.initial,
0,b.XModelStructure.SIZE_SCALE);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_SCALE)};b.XModelDecoder.prototype._getTranslate=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_TRANSLATE);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_TRANSLATE)};b.XModelDecoder.prototype._getMatrix=function(a){this._getFloat32Array(a.initial,0,b.XModelStructure.SIZE_MATRIX);b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_MATRIX)};b.XModelDecoder.prototype._getContainer=
function(a){a.name=this._getString();a.num_textures=this._getInt16();0<a.num_textures&&(a.textures=Array(a.num_textures),this._getStructureArray(a.textures,0,a.num_textures));a.num_materials=this._getInt16();0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_meshes=this._getInt16();0<a.num_meshes&&(a.meshes=Array(a.num_meshes),this._getStructureArray(a.meshes,0,a.num_meshes));a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),
this._getStructureArray(a.nodes,0,a.num_nodes));a.time_rate=this._getFloat64();a.num_animation_sets=this._getInt16();0<a.num_animation_sets&&(a.animation_sets=Array(a.num_animation_sets),this._getStructureArray(a.animation_sets,0,a.num_animation_sets));a.userData=this._getUserData()};b.XModelDecoder.prototype._getTexture=function(a){a.name=this._getString();a.ref=this._getString();a.data_size=this._getInt32();0<a.data_size&&(a.data=new Int8Array(a.data_size),this._getInt8Array(a.data,0,a.data_size));
a.user_data=this._getUserData()};b.XModelDecoder.prototype._getMaterial=function(a){a.name=this._getString();this._getFloat32Array(a.emissive,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.ambient,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.diffuse,0,b.XModelStructure.SIZE_RGBA);this._getFloat32Array(a.specular,0,b.XModelStructure.SIZE_RGBA);a.shininess=this._getFloat32();a.bump=this._getFloat32();a.emissive_map=this._getStructure();a.ambient_map=this._getStructure();a.diffuse_map=
this._getStructure();a.specular_map=this._getStructure();a.shininess_map=this._getStructure();a.bump_map=this._getStructure();a.draw_mode=this._getInt32();a.user_data=this._getUserData()};b.XModelDecoder.prototype._getMesh=function(a){a.name=this._getString();a.num_positions=this._getInt32();if(0<a.num_positions){a.position_size=this._getInt8();var f=a.position_size*a.num_positions;a.positions=new Float32Array(f);this._getFloat32Array(a.positions,0,f)}a.num_normals=this._getInt32();0<a.num_normals&&
(a.normal_size=this._getInt8(),f=a.normal_size*a.num_normals,a.normals=new Float32Array(f),this._getFloat32Array(a.normals,0,f));a.num_colors=this._getInt32();0<a.num_colors&&(a.color_size=this._getInt8(),f=a.color_size*a.num_colors,a.colors=new Float32Array(f),this._getFloat32Array(a.colors,0,f));a.num_tex_coords=this._getInt32();0<a.num_tex_coords&&(a.tex_coord_size=this._getInt8(),f=a.tex_coord_size*a.num_tex_coords,a.tex_coords=new Float32Array(f),this._getFloat32Array(a.tex_coords,0,f));var c=
this._getBool();c&&(a.skin=new b.XModelSkin,this._getSkin(a.skin));a.num_vertices=this._getInt32();if(0<a.num_vertices)for(a.vertices=Array(a.num_vertices),f=0;f<a.num_vertices;++f){var d=new b.XModelVertex;this._getVertex(d,a.num_positions,a.num_normals,a.num_colors,a.num_tex_coords,c);a.vertices[f]=d}a.num_materials=this._getInt16();0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_elements=this._getInt32();if(0<a.num_elements)for(a.elements=
Array(a.num_elements),f=0;f<a.num_elements;++f)c=new b.XModelElement,this._getElement(c),a.elements[f]=c;a.user_data=this._getUserData()};b.XModelDecoder.prototype._getSkin=function(a){a.num_weighted_indices=this._getInt32();a.weighted_index_stride=this._getInt8();if(0<a.num_weighted_indices){a.weighted_index_sizes=new Int8Array(a.num_weighted_indices);var f=a.weighted_index_stride*a.num_weighted_indices;a.indices=new Int16Array(f);a.weights=new Float32Array(f);for(var c=0;c<f;++c)a.indices[c]=-1,
a.weights[c]=0;b.ArrayUtils.fill(a.indices,0,f,-1);b.ArrayUtils.fill(a.weights,0,f,0);for(f=c=0;c<a.num_weighted_indices;++c,f+=a.weighted_index_stride){var d=this._getInt8();a.weighted_index_sizes[c]=d;for(var g=0;g<d;++g){var e=f+g;a.indices[e]=this._getInt16();a.weights[e]=this._getFloat32()}}}a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),this._getStructureArray(a.nodes,0,a.num_nodes),c=b.XModelStructure.SIZE_MATRIX*a.num_nodes,a.offset_matrices=new Float32Array(c),this._getFloat32Array(a.offset_matrices,
0,c),c=b.XModelStructure.SIZE_QUATERNION*a.num_nodes,a.offset_quaternions=new Float32Array(c),this._getFloat32Array(a.offset_quaternions,0,c))};b.XModelDecoder.prototype._getVertex=function(a,b,c,d,g,e){0<b&&(a.position=this._getInt32());0<c&&(a.normal=this._getInt32());0<d&&(a.color=this._getInt32());0<g&&(a.tex_coord=this._getInt32());e&&(a.skin_weight=this._getInt32())};b.XModelDecoder.prototype._getElement=function(a){a.material=this._getInt16();a.num_vertices=this._getInt8();0<a.num_vertices&&
(a.vertices=new Int32Array(a.num_vertices),this._getInt32Array(a.vertices,0,a.num_vertices))};b.XModelDecoder.prototype._getNode=function(a){a.name=this._getString();a.connected=this._getBool();this._getBoolArray(a.lock_axises,0,b.XModelStructure.SIZE_VECTOR_3);this._getBoolArray(a.limit_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.min_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.max_angles,0,b.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(a.bone_tail,
0,b.XModelStructure.SIZE_VECTOR_3);this._getStructureArray(a.transforms,0,b.XModelNode.NUM_TRANSFORMS);a.num_iks=this._getInt16();0<a.num_iks&&(a.iks=Array(a.num_iks),this._getStructureArray(a.iks,0,a.num_iks));a.num_meshes=this._getInt16();if(0<a.num_meshes){a.meshes=Array(a.num_meshes);this._getStructureArray(a.meshes,0,a.num_meshes);for(var f=0;f<a.num_meshes;++f){var c=a.meshes[f];null!=c&&(c.parent=a)}}a.num_children=this._getInt16();if(0<a.num_children)for(a.children=Array(a.num_children),this._getStructureArray(a.children,
0,a.num_children),f=0;f<a.num_children;++f)c=a.children[f],null!=c&&(c.parent=a);a.user_data=this._getUserData()};b.XModelDecoder.prototype._getIK=function(a){a.target=this._getStructure();a.max_iterations=this._getInt16();a.chain_length=this._getInt16();a.influence=this._getFloat32()};b.XModelDecoder.prototype._getAnimation=function(a){a.name=this._getString();a.target=this._getStructure();a.index=this._getInt16();a.num_keys=this._getInt16();0<a.num_keys&&(a.keys=Array(a.num_keys),this._getStructureArray(a.keys,
0,a.num_keys));a.num_children=this._getInt16();0<a.num_children&&(a.children=Array(a.num_children),this._getStructureArray(a.children,0,a.num_children));a.user_data=this._getUserData()};b.XModelDecoder.prototype._getAnimationKey=function(a){a.interpolate=this._getInt8();a.time=this._getFloat64();a.value_size=this._getInt16();0<a.value_size&&(a.value=new Float32Array(a.value_size),this._getFloat32Array(a.value,0,a.value_size))};b.XModelDecoder.prototype._getAnimationSet=function(a){a.name=this._getString();
a.num_animations=this._getInt16();0<a.num_animations&&(a.animations=Array(a.num_animations),this._getStructureArray(a.animations,0,a.num_animations));a.user_data=this._getUserData()}})(xpl);(function(b){b.XModelMaterialUtils=function(){};b.XModelMaterialUtils.getTextures=function(a,b,c,d){var g=0;null!=a&&(a.emissive_map&&(b&&0<d&&(b[c++]=a.emissive_map,d--),g++),a.ambient_map&&(b&&0<d&&(b[c++]=a.ambient_map,d--),g++),a.diffuse_map&&(b&&0<d&&(b[c++]=a.diffuse_map,d--),g++),a.specular_map&&(b&&0<d&&(b[c++]=a.specular_map,d--),g++),a.shininess_map&&(b&&0<d&&(b[c++]=a.shininess_map,d--),g++),a.bump_map&&(b&&0<d&&(b[c++]=a.bump_map),g++));return g};b.XModelMaterialUtils.releaseTexture=function(a){null!=
a&&(a.emissive_map&&(a.emissive_map.data=null,a.emissive_map.data_size=0),a.ambient_map&&(a.ambient_map.data=null,a.ambient_map.data_size=0),a.diffuse_map&&(a.diffuse_map.data=null,a.diffuse_map.data_size=0),a.specular_map&&(a.specular_map.data=null,a.specular_map.data_size=0),a.shininess_map&&(a.shininess_map.data=null,a.shininess_map.data_size=0),a.bump_map&&(a.bump_map.data=null,a.bump_map.data_size=0))}})(xpl);(function(b){b.XModelMeshUtils=function(){};Object.defineProperties(b.XModelMeshUtils,{ATTRIBUTE_STRUCTURE_SIZE:{value:0},ATTRIBUTE_POSITION:{value:1},ATTRIBUTE_NORMAL:{value:2},ATTRIBUTE_COLOR:{value:3},ATTRIBUTE_TEXCOORD:{value:4},ATTRIBUTE_BONELENGTH:{value:5},ATTRIBUTE_BONEINDICES:{value:6},ATTRIBUTE_BONEWEIGHTS:{value:7},MAX_ATTRIBUTE:{value:8},TYPE_VOID:{value:0},TYPE_UNSIGNED_BYTE:{value:1},TYPE_UNSIGNED_SHORT:{value:2},TYPE_UNSIGNED_INT:{value:3},TYPE_FLOAT:{value:4}});b.XModelMeshUtils.getPositions=
function(a,b,c,d,g){var e=0;if(null!=a.positions&&0<a.position_size){c<b&&(c=b);for(var h=0;h<a.num_vertices;++h){var l=a.vertices[h];if(-1!=l.position)for(var l=a.position_size*l.position,k=0;k<b&&k<a.position_size;++k)d[g+k]=a.positions[l++],e++;else k=0;for(;k<b;++k)d[g+k]=0,e++;g+=c}}return e};b.XModelMeshUtils.getNormals=function(a,b,c,d,g){var e=0;if(null!=a.normals&&0<a.normal_size){c<b&&(c=b);for(var h=0;h<a.num_vertices;++h){var l=a.vertices[h];if(-1!=l.normal)for(var l=a.normal_size*l.normal,
k=0;k<b&&k<a.normal_size;++k)d[g+k]=a.normals[l++],e++;else k=0;for(;k<b;++k)d[g+k]=0,e++;g+=c}}return e};b.XModelMeshUtils.getColors=function(a,b,c,d,g){var e=0;if(null!=a.colors&&0<a.color_size){c<b&&(c=b);for(var h=d instanceof Uint8Array||d instanceof Int8Array?255:1,l=0;l<a.num_vertices;++l){var k=a.vertices[l];if(-1!=k.color)for(var k=a.color_size*k.color,m=0;m<b&&m<a.color_size;++m)d[g+m]=a.colors[k++]*h,e++;else m=0;for(;m<b;++m)d[g+m]=0,e++;g+=c}}return e};b.XModelMeshUtils.getTexCoords=
function(a,b,c,d,g){var e=0;if(null!=a.tex_coords&&0<a.tex_coord_size){c<b&&(c=b);for(var h=0;h<a.num_vertices;++h){var l=a.vertices[h];if(-1!=l.tex_coord)for(var l=a.tex_coord_size*l.tex_coord,k=0;k<b&&k<a.tex_coord_size;++k)d[g+k]=a.tex_coords[l++],e++;else k=0;for(;k<b;++k)d[g+k]=0,e++;g+=c}}return e};b.XModelMeshUtils.getSkinBoneLengths=function(a,b,c,d){b=a.skin;if(null!=b&&1<b.weighted_index_stride)for(var g=0;g<a.num_vertices;++g){var e=a.vertices[g];c[d]=-1!=e.skin_weight?b.weighted_index_sizes[e.skinning]:
0}return 0};b.XModelMeshUtils.getSkinBoneIndices=function(a,b,c,d,g){var e=0,h=a.skin;if(null!=h&&0<h.weighted_index_stride){c<b&&(c=b);for(var l=0;l<a.num_vertices;++l){var k=a.vertices[l];if(-1!=k.skinning)for(var m=h.weighted_index_sizes[k.skinning],k=h.weighted_index_stride*k.skin_weight,n=0;n<b&&n<m&&h.weighted_index_stride;++n)d[g+n]=h.indices[k++],e++;else n=0;for(;n<b;++n)d[g+n]=0,e++;g+=c}}return e};b.XModelMeshUtils.getSkinBoneWeights=function(a,b,c,d,g){var e=0,h=a.skin;if(null!=
h&&0<h.weighted_index_stride){c<b&&(c=b);for(var l=0;l<a.num_vertices;++l){var k=a.vertices[l];if(-1!=k.skinning)for(var m=h.weighted_index_sizes[k.skinning],k=h.weighted_index_stride*k.skin_weight,n=0;n<b&&n<m&&h.weighted_index_stride;++n)d[g+n]=h.weights[k++],e++;else n=0;for(;n<b;++n)d[g+n]=0,e++;g+=c}}return e};b.XModelMeshUtils.getVerticesSize=function(a,f,c,d,g,e,h,l,k,m,n,p){null!=n&&b.ArrayUtils.fill(n,p,p+b.XModelMeshUtils.MAX_ATTRIBUTE,-1);var q=0,r=f?1:a.num_vertices;0<d&&0<a.position_size&&
(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_POSITION]=q),q+=r*a.position_size*d,q=c*Math.floor((q+c-1)/c));0<g&&0<a.normal_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_NORMAL]=q),q+=r*a.normal_size*g,q=c*Math.floor((q+c-1)/c));0<e&&0<a.color_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_COLOR]=q),q+=r*a.color_size*e,q=c*Math.floor((q+c-1)/c));0<h&&0<a.tex_coord_size&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD]=q),q+=r*a.tex_coord_size*h,q=c*Math.floor((q+c-1)/c));null!=a.skin&&(1<a.skin.weighted_index_stride?
(0<l&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH]=q),q=c*Math.floor((q+r*l+c-1)/c)),0<k&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]=q),q+=r*a.skin.weighted_index_stride*k,q=c*Math.floor((q+c-1)/c)),0<m&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]=q),q+=r*a.skin.weighted_index_stride*m,q=c*Math.floor((q+c-1)/c))):0<a.skin.weighted_index_stride&&0<k&&(null!=n&&(n[p+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]=q),q+=r*a.skin.weighted_index_stride*m,q=c*Math.floor((q+c-
1)/c)));if(f)return n[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=q,a.num_vertices*q;n[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=0;return q};b.XModelMeshUtils.getVertices=function(a,f,c,d,g,e,h,l,k,m,n,p){var q=k[m+b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE];if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_POSITION])switch(f){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getPositions(a,a.position_size,q/4,new Float32Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_POSITION]),0)}if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_NORMAL])switch(c){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getNormals(a,
a.normal_size,q/4,new Float32Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_NORMAL]),0)}if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_COLOR])switch(d){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getColors(a,a.color_size,q,new Uint8Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_COLOR]),0);break;case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getColors(a,a.color_size,q/4,new Float32Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_COLOR]),0)}if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD])switch(g){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getTexCoords(a,
a.tex_coord_size,q/4,new Float32Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_TEXCOORD]),0)}if(a.skin){if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH])switch(e){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getSkinBoneLengths(a,q,new Uint8Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_BONELENGTH]),0)}if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES])switch(h){case b.XModelMeshUtils.TYPE_UNSIGNED_BYTE:b.XModelMeshUtils.getSkinBoneIndices(a,a.skin.weighted_index_stride,q,new Uint8Array(n,p+
k[m+b.XModelMeshUtils.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),0);break;case b.XModelMeshUtils.TYPE_UNSIGNED_SHORT:b.XModelMeshUtils.getSkinBoneIndices(a,a.skin.weighted_index_stride,q/2,new Uint16Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),0)}if(0<=k[m+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS])switch(l){case b.XModelMeshUtils.TYPE_FLOAT:b.XModelMeshUtils.getSkinBoneWeights(a,a.skin.weighted_index_stride,q/4,new Float32Array(n,p+k[m+b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]),0)}}};b.XModelMeshUtils.getNumTriangledFaceIndices=
function(a,b){var c=0;if(null!=a.elements)for(var d=0;d<a.num_elements;++d){var g=a.elements[d];g.material==b&&3<=g.num_vertices&&(c+=3*(g.num_vertices-2))}return c};b.XModelMeshUtils.getNumAllTriangledFaceIndices=function(a,f,c,d,g){var e=0;if(null!=a.elements){for(var h=0;h<a.num_materials;++h){null!=f&&(f[c+h]=e);var l=b.XModelMeshUtils.getNumTriangledFaceIndices(a,h);null!=d&&(d[g+h]=l);e+=l}null!=f&&(f[c+a.num_materials]=e);l=b.XModelMeshUtils.getNumTriangledFaceIndices(a,-1);null!=d&&(d[g+a.num_materials]=
l);e+=l}return e};b.XModelMeshUtils.getTriangledFaceIndices=function(a,b,c,d,g){var e=0;if(null!=a.elements){var h,l;c?(c=0,h=2,l=1):(c=0,h=1,l=2);for(var k=0;k<a.num_elements;++k){var m=a.elements[k];if(m.material==b)for(var n=0,p=m.num_vertices-2;n<p;++n)d[g+c]=m.vertices[0],d[g+h]=m.vertices[n+1],d[g+l]=m.vertices[n+2],g+=3,e+=3}}return e};b.XModelMeshUtils.getAllTriangledFaceIndices=function(a,f,c,d,g,e){var h=0;if(null!=a.elements)for(var l=0;l<a.num_materials;++l)h+=b.XModelMeshUtils.getTriangledFaceIndices(a,
l,f,g,e+c[d+l])};b.XModelMeshUtils.releaseShape=function(a){null!=a&&(a.positions=null,a.normals=null,a.colors=null,a.tex_coords=null,a.vertices=null,a.skin&&(a.skin.weighted_index_sizes=null,a.skin.indices=null,a.skin.weights=null),a.elements=null)};b.XModelMeshUtils.getTextures=function(a,f,c,d){var g=0;if(null!=a)for(var e=0;e<a.num_materials;++e){var h=b.XModelMaterialUtils.getTextures(a.materials[e],f,c,d);c+=h;d-=h;g+=h}return g};b.XModelMeshUtils.releaseTextures=function(a){if(null!=a)for(var f=
0;f<a.num_materials;++f)b.XModelMaterialUtils.releaseTexture(a.materials[f])}})(xpl);(function(b){var a=b.Geometry.SIZE_VECTOR_3,f=b.Geometry.SIZE_MATRIX_4X4;b.XModelSkinUtils=function(){};b.XModelSkinUtils.updateMatrixPallet=function(a,d,g,e){if(null!=a){for(var h=0;h<a.num_nodes&&h<d;++h){var l=f*h,k=a.nodes[h];null!=k?b.Matrix4x4.mulv(g,e+l,k.combined_matrix,0,a.offset_matrices,l):b.Matrix4x4.loadIdentity(g,e+l)}return Math.min(a.num_nodes,d)}return 0};b.XModelSkinUtils.updateRotationPallect=function(a,d,g,e){if(null!=a){for(var h=0;h<a.num_nodes&&h<d;++h){var l=f*h,k=a.nodes[h];
null!=k?b.Matrix4x4.mulv(g,e+l,k.combined_matrix,0,a.offset_matrices,l):b.Matrix4x4.loadIdentity(g,e+l)}return Math.min(a.num_nodes,d)}return 0};b.XModelSkinUtils.updatePositions=function(c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y){l<a&&(l=a);n<a&&(n=a);y<p&&(y=p);v<p&&(v=p);if(1==p)for(var w=0;w<g;++w)b.Vector3.mulMatrix4x4v(k,m,c,d+f*q[r],e,h,!0),h+=l,m+=n,r+=v;else if(1<p)for(var A=new Float32Array(a),w=0;w<g;++w){b.Vector3.loadZero(k,m);for(var z=0;z<p;++z){var E=x[u+z];0<E&&(b.Vector3.mulMatrix4x4v(A,0,
c,d+f*q[r+z],e,h,!0),b.Vector3.mulv(A,0,A,0,E),b.Vector3.addv(k,m,k,m,A,0))}h+=l;m+=n;r+=v;u+=y}};b.XModelSkinUtils.updateNormals=function(c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y){l<a&&(l=a);n<a&&(n=a);y<p&&(y=p);v<p&&(v=p);if(1==p)for(var w=0;w<g;++w)b.Vector3.mulMatrix4x4Axisv(k,m,c,d+f*q[r],e,h),h+=l,m+=n,r+=v;else if(1<p)for(var A=new Float32Array(a),w=0;w<g;++w){b.Vector3.loadZero(k,m);for(var z=0;z<p;++z){var E=x[u+z];0<E&&(b.Vector3.mulMatrix4x4Axisv(A,0,c,d+f*q[r+z],e,h),b.Vector3.mulv(A,0,A,0,E),
b.Vector3.addv(k,m,k,m,A,0))}h+=l;m+=n;r+=v;u+=y}}})(xpl);(function(b){b.XModelTransformUtils=function(){};b.XModelTransformUtils.applyTransform=function(a,f,c){if(null!=a){var d;switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:a=a.value;d=0*b.XModelStructure.SIZE_AXIS_ROTATE;b.Matrix4x4.mulRotate(f,c,a[d+b.XModelAxisRotate.X],a[d+b.XModelAxisRotate.Y],a[d+b.XModelAxisRotate.Z],a[d+b.XModelAxisRotate.ANGLE],!0,!0);break;case b.XModelStructure.TYPE_QUATERNION:a=a.value;d=0*b.XModelStructure.SIZE_QUATERNION;b.Matrix4x4.mulQuaternionv(f,c,a,
d,!0);break;case b.XModelStructure.TYPE_SCALE:a=a.value;d=0*b.XModelStructure.SIZE_SCALE;b.Matrix4x4.mulScale(f,c,a[d+b.Geometry.VX],a[d+b.Geometry.VY],a[d+b.Geometry.VZ]);break;case b.XModelStructure.TYPE_TRANSLATE:a=a.value;d=0*b.XModelStructure.SIZE_TRANSLATE;b.Matrix4x4.mulTranslate(f,c,a[d+b.Geometry.VX],a[d+b.Geometry.VY],a[d+b.Geometry.VZ],!0);break;case b.XModelStructure.TYPE_MATRIX:a=a.value,d=0*b.XModelStructure.SIZE_MATRIX,b.Matrix4x4.mulv(f,c,f,c,a,d)}}};b.XModelTransformUtils.resetTransform=
function(a){if(null!=a)switch(a.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_AXIS_ROTATE);break;case b.XModelStructure.TYPE_QUATERNION:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_QUATERNION);break;case b.XModelStructure.TYPE_SCALE:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_SCALE);break;case b.XModelStructure.TYPE_TRANSLATE:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_TRANSLATE);
break;case b.XModelStructure.TYPE_MATRIX:b.ArrayUtils.copy(a.initial,0,a.value,0,b.XModelStructure.SIZE_MATRIX)}}})(xpl);(function(b){var a=b.Geometry.VX,f=b.Geometry.VY,c=b.Geometry.VZ,d=b.Geometry.CI,g=b.Geometry.CJ,e=b.Geometry.CK,h=b.Geometry.M4X4_00,l=b.Geometry.M4X4_01,k=b.Geometry.M4X4_02,m=b.Geometry.M4X4_03,n=b.Geometry.M4X4_10,p=b.Geometry.M4X4_11,q=b.Geometry.M4X4_12,r=b.Geometry.M4X4_13,v=b.Geometry.M4X4_20,x=b.Geometry.M4X4_21,u=b.Geometry.M4X4_22,y=b.Geometry.M4X4_23;b.XModelKinematicsUtils=function(){};var w=function(a){this.node=a;this.local_transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);
this.transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.offset_transform=new Float32Array(b.XModelStructure.SIZE_MATRIX);this.rotate=new Float32Array(b.XModelStructure.SIZE_QUATERNION);this.min_sins=new Float32Array(b.XModelStructure.SIZE_VECTOR_3);this.max_sins=new Float32Array(b.XModelStructure.SIZE_VECTOR_3);b.Matrix4x4.loadIdentity(this.local_transform,0);for(a=0;a<b.XModelNode.TRANSFORM_ROTATE;++a)b.XModelTransformUtils.applyTransform(this.node.transforms[a],this.local_transform,
0);b.Matrix4x4.normalizeAxisv(this.local_transform,0,this.local_transform,0,!0);a=this.local_transform[h];var d=this.local_transform[l],c=this.local_transform[n],g=this.local_transform[p],e=this.local_transform[v],f=this.local_transform[x];0>(c*f-e*g)*this.local_transform[k]+(e*d-a*f)*this.local_transform[q]+(a*g-c*d)*this.local_transform[u]&&(this.local_transform[h]=-this.local_transform[h],this.local_transform[l]=-this.local_transform[l],this.local_transform[k]=-this.local_transform[k],this.local_transform[n]=
-this.local_transform[n],this.local_transform[p]=-this.local_transform[p],this.local_transform[q]=-this.local_transform[q],this.local_transform[v]=-this.local_transform[v],this.local_transform[x]=-this.local_transform[x],this.local_transform[u]=-this.local_transform[u]);a=this.node.transforms[b.XModelNode.TRANSFORM_ROTATE];a.structure_type==b.XModelStructure.TYPE_AXIS_ROTATE?b.Quaternion.loadRotate(this.rotate,0,a.value[b.XModelAxisRotate.X],a.value[b.XModelAxisRotate.Y],a.value[b.XModelAxisRotate.Z],
a.value[b.XModelAxisRotate.ANGLE],!0):a.structure_type==b.XModelStructure.TYPE_QUATERNION?(b.Quaternion.loadv(this.rotate,0,a.value,0),b.Quaternion.normalizev(this.rotate,0,this.rotate,0)):b.Quaternion.loadIdentity(this.rotate,0);for(a=0;a<b.XModelStructure.SIZE_VECTOR_3;++a)this.min_sins[a]=Math.sin(.5*this.node.min_angles[a]),this.max_sins[a]=Math.sin(.5*this.node.max_angles[a])};w.prototype.updateOffsetTransform=function(){var a=this.transform[h],d=this.transform[n],c=this.transform[v],g=this.transform[l],
e=this.transform[p],f=this.transform[x],w=this.transform[k],F=this.transform[q],K=this.transform[u],C=-this.transform[m],L=-this.transform[r],P=-this.transform[y];b.Matrix4x4.load(this.offset_transform,0,a,d,c,C*a+L*d+P*c,g,e,f,C*g+L*e+P*f,w,F,K,C*w+L*F+P*K,0,0,0,1,!1)};b.XModelKinematicsUtils.applyInverseKinematicesLocation=function(h,k,l,n,q){if(null!=h&&1<=n){for(var p=h,v=1;v<n&&null!=p.parent;)p=p.parent,v++;if(1==n||1>=v)l=1;n=Array(v);var u=h;for(h=0;h<v;++h)n[h]=new w(u),u=u.parent;var x=
new Float32Array(b.XModelStructure.SIZE_VECTOR_3),C=new Float32Array(b.XModelStructure.SIZE_QUATERNION),L=new Float32Array(b.XModelStructure.SIZE_QUATERNION),P=new Float32Array(b.XModelStructure.SIZE_QUATERNION),M=!1;for(h=0;h<l;++h){var u=n[0],N=v,M=n,I=M[N-1];null!=I.node.parent?b.Matrix4x4.mulv(I.transform,0,I.node.parent.combined_matrix,0,I.local_transform,0):b.Matrix4x4.loadv(I.transform,0,I.local_transform,0,!1);b.Matrix4x4.mulQuaternionv(I.transform,0,I.rotate,0,!0);I.updateOffsetTransform();
for(N-=2;0<=N;--N){var T=I,I=M[N];b.Matrix4x4.mulv(I.transform,0,T.transform,0,I.local_transform,0);b.Matrix4x4.mulQuaternionv(I.transform,0,I.rotate,0,!0);I.updateOffsetTransform()}b.Vector3.mulMatrix4x4v(x,0,u.transform,0,u.node.bone_tail,0,!0);u=x[a]-k[a];M=x[f]-k[f];I=x[c]-k[c];if(u*u+M*M+I*I<=q)break;M=!1;for(I=0;I<v;++I){var u=n[I],N=u.transform[m],T=u.transform[r],X=u.transform[y];b.Quaternion.loadRotateVector3(C,0,x[a]-N,x[f]-T,x[c]-X,!0,k[a]-N,k[f]-T,k[c]-X,!0,(I+1)/v*(h==l-1?1:.25));M&&
(b.Quaternion.mulv(C,0,C,0,P,0),M=!1);b.Quaternion.loadv(P,0,C,0);b.Vector3.mulMatrix4x4Axisv(C,d,u.offset_transform,0,C,d,!0);b.Quaternion.conjugatev(C,0,C,0);b.Quaternion.loadv(L,0,u.rotate,0);b.Quaternion.mulv(u.rotate,0,C,0,u.rotate,0);for(var R=0;R<b.XModelStructure.SIZE_VECTOR_3;++R)if(u.node.lock_axises[R])u.rotate[d+R]=0,M=!0;else{var Y=u.rotate[d+R],J=b.MathUtils.mid(Y,u.min_sins[R],u.max_sins[R]);Y!=J&&(u.rotate[d+R]=J,M=!0)}M&&(b.Quaternion.normalizev(u.rotate,0,u.rotate,0),b.Quaternion.divv(C,
0,u.rotate,0,L,0));b.Quaternion.conjugatev(C,0,C,0);b.Vector3.sub(x,0,x[a],x[f],x[c],N,T,X);b.Vector3.mulMatrix4x4Axisv(C,d,u.transform,0,C,d,!0);b.Vector3.mulQuaternionv(x,0,C,0,x,0);b.Vector3.add(x,0,x[a],x[f],x[c],N,T,X);M&&b.Quaternion.divv(P,0,P,0,C,0)}}for(h=0;h<v;++h)u=n[h],k=u.node.transforms[b.XModelNode.TRANSFORM_ROTATE],k.structure_type==b.XModelStructure.TYPE_AXIS_ROTATE?(l=u.rotate[d],q=u.rotate[g],x=u.rotate[e],C=l*l+q*q+x*x,0<C&&(C=Math.sqrt(C),l/=C,q/=C,x/=C),k.value[b.XModelAxisRotate.ANGLE]=
Math.acos(u.rotation[b.Geometry.CR]),k.value[b.XModelAxisRotate.X]=l,k.value[b.XModelAxisRotate.Y]=q,k.value[b.XModelAxisRotate.Z]=x):k.structure_type==b.XModelStructure.TYPE_QUATERNION&&b.Quaternion.loadv(k.value,0,u.rotate,0);null!=p.parent?b.XModelNodeUtils.updateCombinationv(p,p.num_children,p.children,0,p.parent.combined_matrix,0):b.XModelNodeUtils.updateCombination(p)}};b.XModelKinematicsUtils.applyInverseKinematices=function(a,d,c,g,e){null!=a&&null!=d&&(e=new Float32Array(b.XModelStructure.SIZE_VECTOR_3),
b.Vector3.loadZero(e,0),b.Vector3.mulMatrix4x4v(e,0,d.combined_matrix,0,e,0,!0),b.XModelKinematicsUtils.applyInverseKinematicesLocation(a,e,c,g,1E-5))}})(xpl);(function(b){b.XModelAnimationUtils=function(){};b.XModelAnimationUtils.setAnimation=function(a,f){if(null!=a){if(0<a.num_keys){var c,d,g;if(1==a.num_keys)c=a.keys[0],d=a.keys[0],g=0;else{a:{g=0;d=a.num_keys;for(d--;g<=d;){c=g+d>>1;var e=a.keys[c].time;if(e<f)g=c+1;else if(e>f)d=c-1;else{g=c;break a}}g=-(g+1)}0<=g?(c=a.keys[g],d=a.keys[g],g=0):-1!=g?(g=-(g+2),g<a.num_keys-1?(c=a.keys[g+0],d=a.keys[g+1],g=(f-c.time)/(d.time-c.time)):(c=a.keys[g],d=a.keys[g],g=0)):(c=a.keys[0],d=a.keys[0],g=0)}switch(a.target.structure_type){case b.XModelStructure.TYPE_AXIS_ROTATE:e=
a.target;0>=g?-1==a.index?(b.Vector3.loadv(e.value,0,c.value,0),e.value[b.XModelAxisRotate.ANGLE]=c.value[b.XModelAxisRotate.ANGLE]):e.value[a.index]=c.value[0]:-1==a.index?(b.Vector3.slerpv(e.value,0,c.value,0,d.value,0,g),e.value[b.XModelAxisRotate.ANGLE]=c.value[b.XModelAxisRotate.ANGLE]*(1-g)+d.value[b.XModelAxisRotate.ANGLE]*g):e.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_QUATERNION:e=a.target;0>=g?-1==a.index?b.Quaternion.loadv(e.value,0,c.value,0):e.value[a.index]=
c.value[0]:-1==a.index?b.Quaternion.slerpv(e.value,0,c.value,0,d.value,0,g):e.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_SCALE:e=a.target;0>=g?-1==a.index?b.Vector3.loadv(e.value,0,c.value,0):e.value[a.index]=c.value[0]:-1==a.index?b.Vector3.lerpv(e.value,0,c.value,0,d.value,0,g):e.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_TRANSLATE:e=a.target;0>=g?-1==a.index?b.Vector3.loadv(e.value,0,c.value,0):e.value[a.index]=c.value[0]:
-1==a.index?b.Vector3.lerpv(e.value,0,c.value,0,d.value,0,g):e.value[a.index]=c.value[0]*(1-g)+d.value[0]*g;break;case b.XModelStructure.TYPE_MATRIX:e=a.target,0>=g?-1==a.index?b.Matrix4x4.loadv(e.value,0,c.value,0):e.value[a.index]=c.value[0]:-1==a.index?b.Matrix4x4.slrepAxisAndLrepOtherv(e.value,0,c.value,0,d.value,0,g,!0):e.value[a.index]=c.value[0]*(1-g)+d.value[0]*g}}for(g=0;g<a.num_children;++g)b.XModelAnimation.setAnimation(a.children[g],f)}};b.XModelAnimationUtils.setAnimationSet=function(a,
f){if(null!=a)for(var c=0;c<a.num_animations;++c)b.XModelAnimationUtils.setAnimation(a.animations[c],f)};b.XModelAnimationUtils.getAnimationTotalTime=function(a){var f=0;if(null!=a){for(var c=0;c<a.num_keys;++c){var d=a.keys[a.num_keys-1].time;f<d&&(f=d)}for(c=0;c<a.num_children;++c)d=b.XModelAnimationUtils.getAnimationTotalTime(a.children[c]),f<d&&(f=d)}return f};b.XModelAnimationUtils.getAnimationSetTotalTime=function(a){var f=0;if(null!=a)for(var c=0;c<a.num_animations;++c){var d=b.XModelAnimationUtils.getAnimationTotalTime(a.animations[c]);
f<d&&(f=d)}return f}})(xpl);(function(b){b.XModelNodeUtils=function(){};b.XModelNodeUtils.getTextures=function(a,f,c,d){var g=0;if(null!=a){for(var e=0;e<a.num_meshes;++e){var h=b.XModelMeshUtils.getTextures(a.meshes[e],f,c,d);c+=h;d-=h;g+=h}for(e=0;e<a.num_children;++e)h=b.XModelNodeUtils.getTextures(a.children[e],f,c,d),c+=h,d-=h,g+=h}return g};b.XModelNodeUtils.releaseTextures=function(a){if(null!=a){for(var f=0;f<a.num_meshes;++f)b.XModelMeshUtils.releaseTextures(a.meshes[f]);for(f=0;f<a.num_children;++f)b.XModelNodeUtils.releaseTextures(a.children[f])}};
b.XModelNodeUtils.getMeshes=function(a,f,c,d){var g=0;if(null!=a){for(var e=0;e<a.num_meshes;++e){var h=a.meshes[e];null!=h&&(null!=f&&0<d&&(f[c++]=h,d--),g++)}for(e=0;e<a.num_children;++e)h=b.XModelNodeUtils.getMeshes(a.children[e],f,c,d),c+=h,d-=h,g+=h}return g};b.XModelNodeUtils.releaseShapes=function(a){if(null!=a){for(var f=0;f<a.num_meshes;++f)b.XModelMeshUtils.releaseShape(a.meshes[f]);for(f=0;f<a.num_children;++f)b.XModelNodeUtils.releaseShapes(a.children[f])}};b.XModelNodeUtils.getNodes=
function(a,f,c,d){var g=0;if(null!=a){null!=f&&0<d&&(f[c++]=a,d--);g++;for(var e=0;e<a.num_children;++e){var h=b.XModelNodeUtils.getNodes(a.children[e],f,c,d);c+=h;d-=h;g+=h}}return g};b.XModelNodeUtils.updateParent=function(a,f){if(null!=a){a.parent=f;for(var c=0;c<a.num_meshes;++c)a.meshes[c].parent=a;for(c=0;c<a.num_children;++c)b.XModelNodeUtils.updateParent(a.children[c],a)}};b.XModelNodeUtils.updateCombinationp=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A){if(null!=a){b.Matrix4x4.load(a.combined_matrix,
0,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A);for(var z=0;z<b.XModelNode.NUM_TRANSFORMS;++z)b.XModelTransformUtils.applyTransform(a.transforms[z],a.combined_matrix,0);g=a.combined_matrix[b.Geometry.M4X4_00];e=a.combined_matrix[b.Geometry.M4X4_01];h=a.combined_matrix[b.Geometry.M4X4_02];l=a.combined_matrix[b.Geometry.M4X4_03];k=a.combined_matrix[b.Geometry.M4X4_10];m=a.combined_matrix[b.Geometry.M4X4_11];n=a.combined_matrix[b.Geometry.M4X4_12];p=a.combined_matrix[b.Geometry.M4X4_13];q=a.combined_matrix[b.Geometry.M4X4_20];
r=a.combined_matrix[b.Geometry.M4X4_21];v=a.combined_matrix[b.Geometry.M4X4_22];x=a.combined_matrix[b.Geometry.M4X4_23];u=a.combined_matrix[b.Geometry.M4X4_30];y=a.combined_matrix[b.Geometry.M4X4_31];w=a.combined_matrix[b.Geometry.M4X4_32];A=a.combined_matrix[b.Geometry.M4X4_33];for(z=0;z<f;++z)a=c[d+z],b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,g,e,h,l,k,m,n,p,q,r,v,x,u,y,w,A)}};b.XModelNodeUtils.updateCombinationv=function(a,f,c,d,g,e){b.XModelNodeUtils.updateCombinationp(a,
f,c,d,g[e+b.Geometry.M4X4_00],g[e+b.Geometry.M4X4_01],g[e+b.Geometry.M4X4_02],g[e+b.Geometry.M4X4_03],g[e+b.Geometry.M4X4_10],g[e+b.Geometry.M4X4_11],g[e+b.Geometry.M4X4_12],g[e+b.Geometry.M4X4_13],g[e+b.Geometry.M4X4_20],g[e+b.Geometry.M4X4_21],g[e+b.Geometry.M4X4_22],g[e+b.Geometry.M4X4_23],g[e+b.Geometry.M4X4_30],g[e+b.Geometry.M4X4_31],g[e+b.Geometry.M4X4_32],g[e+b.Geometry.M4X4_33])};b.XModelNodeUtils.updateCombination=function(a,f,c,d){b.XModelNodeUtils.updateCombinationp(a,f,c,d,1,0,0,0,0,
1,0,0,0,0,1,0,0,0,0,1)};b.XModelNodeUtils.updateCombinationAllp=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u){null!=a&&b.XModelNodeUtils.updateCombinationp(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u)};b.XModelNodeUtils.updateCombinationAllv=function(a,f,c){null!=a&&b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,f[c+b.Geometry.M4X4_00],f[c+b.Geometry.M4X4_01],f[c+b.Geometry.M4X4_02],f[c+b.Geometry.M4X4_03],f[c+b.Geometry.M4X4_10],f[c+b.Geometry.M4X4_11],f[c+b.Geometry.M4X4_12],f[c+b.Geometry.M4X4_13],
f[c+b.Geometry.M4X4_20],f[c+b.Geometry.M4X4_21],f[c+b.Geometry.M4X4_22],f[c+b.Geometry.M4X4_23],f[c+b.Geometry.M4X4_30],f[c+b.Geometry.M4X4_31],f[c+b.Geometry.M4X4_32],f[c+b.Geometry.M4X4_33])};b.XModelNodeUtils.updateCombinationAll=function(a){null!=a&&b.XModelNodeUtils.updateCombinationp(a,a.num_children,a.children,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};b.XModelNodeUtils.updateOffset=function(a){if(null!=a){b.Matrix4x4.inversev(a.offset_matrix,0,a.combined_matrix,0);for(var f=0;f<a.num_children;++f)b.XModelNodeUtils.updateOffset(a.children[f])}};
b.XModelNodeUtils.applyKinematics=function(a){if(null!=a){for(var f=0;f<a.num_iks;++f){var c=a.iks[f];null!=c&&b.XModelKinematicsUtils.applyInverseKinematices(a,c.target,c.max_iterations,c.chain_length,1E-4*Math.PI)}for(f=0;f<a.num_children;++f)b.XModelNodeUtils.applyKinematics(a.children[f])}};b.XModelNodeUtils.resetTransforms=function(a){if(null!=a){for(var f=0;f<b.XModelNode.NUM_TRANSFORMS;++f)b.XModelTransformUtils.resetTransform(a.transforms[f]);for(f=0;f<a.num_children;++f)b.XModelNodeUtils.resetTransforms(a.children[f])}};
b.XModelNodeUtils.forEachMesh=function(a,f,c){if(null!=a){for(var d=0;d<a.num_meshes;++d){var g=a.meshes[d];null!=g&&f(g,c)}for(d=0;d<a.num_children;++d)b.XModelNodeUtils.forEachMesh(a.children[d],f,c)}};b.XModelNodeUtils.forEachNode=function(a,f,c,d){if(null!=a){f(a,c,d);c+=1;for(var g=0;g<a.num_children;++g)b.XModelNodeUtils.forEachNode(a.children[g],f,c,d)}}})(xpl);(function(b){b.XModelContainerUtils=function(){};b.XModelContainerUtils.getTextures=function(a,f,c,d){var g=0;if(null!=a){for(var e=0;e<a.num_textures;++e){var h=a.textures[e];null!=h&&(null!=f&&0<d&&(f[c++]=h,d--),g++)}for(e=0;e<a.num_materials;++e)h=b.XModelMaterialUtils.getTextures(a.materials[e],f,c,d),c+=h,d-=h,g+=h;for(e=0;e<a.num_meshes;++e)h=b.XModelMeshUtils.getTextures(a.meshes[e],f,c,d),c+=h,d-=h,g+=h;for(e=0;e<a.num_nodes;++e)h=b.XModelNodeUtils.getTextures(a.nodes[e],f,c,d),c+=h,d-=h,
g+=h}return g};b.XModelContainerUtils.releaseTextures=function(a){if(null!=a){for(var f=0;f<a.num_textures;++f){var c=a.textures[f];null!=c&&(c.data=null,c.data_size=0)}for(f=0;f<a.num_materials;++f)b.XModelMaterialUtils.releaseTexture(a.materials[f]);for(f=0;f<a.num_meshes;++f)b.XModelMeshUtils.releaseTextures(a.meshes[f]);for(f=0;f<a.num_nodes;++f)b.XModelNodeUtils.releaseTextures(a.nodes[f])}};b.XModelContainerUtils.getMeshes=function(a,f,c,d){var g=0;if(null!=a){for(var e=0;e<a.num_meshes;++e){var h=
a.meshes[e];null!=h&&(null!=f&&0<d&&(f[c++]=h,d--),g++)}for(e=0;e<a.num_nodes;++e)h=b.XModelNodeUtils.getMeshes(node,f,c,d),c+=h,d-=h,g+=h}return g};b.XModelContainerUtils.releaseShapes=function(a){if(null!=a){for(var f=0;f<a.num_meshes;++f)b.XModelMeshUtils.releaseShape(a.meshes[f]);for(f=0;f<a.num_nodes;++f)b.XModelNodeUtils.releaseShapes(a.nodes[f])}};b.XModelContainerUtils.getNodes=function(a,f,c,d){var g=0;if(null!=a)for(var e=0;e<a.num_nodes;++e){var h=b.XModelNodeUtils.getNodes(a.nodes[e],
f,c,d);c+=h;d-=h;g+=h}return g};b.XModelContainerUtils.updateParent=function(a){if(null!=a){for(var f=0;f<a.num_meshes;++f){var c=a.meshes[f];null!=c&&(c.parent=null)}for(f=0;f<a.num_nodes;++f)b.XModelNodeUtils.updateParent(a.nodes[f],null)}};b.XModelContainerUtils.updateCombinationp=function(a,f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u){if(null!=a)for(var y=0;y<a.num_nodes;++y)b.XModelNodeUtils.updateCombinationAllp(a.nodes[y],f,c,d,g,e,h,l,k,m,n,p,q,r,v,x,u)};b.XModelContainerUtils.updateCombinationv=function(a,
f,c){if(null!=a)for(var d=0;d<a.num_nodes;++d)b.XModelNodeUtils.updateCombinationAllv(a.nodes[d],f,c)};b.XModelContainerUtils.updateCombination=function(a){if(null!=a)for(var f=0;f<a.num_nodes;++f)b.XModelNodeUtils.updateCombinationAll(a.nodes[f])};b.XModelContainerUtils.updateOffset=function(a){if(null!=a)for(var f=0;f<a.num_nodes;++f)b.XModelNodeUtils.updateOffset(a.nodes[f])};b.XModelContainerUtils.setAnimation=function(a,f,c,d){if(null!=a&&0<=f&&f<a.num_animation_sets){f=a.animation_sets[f];var g=
b.XModelAnimationUtils.getAnimationSetTotalTime(f);c*=a.time_rate;0<g&&d?c%=g:b.MathUtils.mid(0,g,c);b.XModelAnimationUtils.setAnimationSet(f,c)}};b.XModelContainerUtils.getAnimationTotalTime=function(a,f){return null!=a&&0<=f&&f<a.num_animation_sets?b.XModelAnimationUtils.getAnimationSetTotalTime(a.animation_sets[f])/a.time_rate:0};b.XModelContainerUtils.applyKinematics=function(a){if(null!=a)for(var f=0;f<a.num_nodes;++f)b.XModelNodeUtils.applyKinematics(a.nodes[f])};b.XModelContainerUtils.resetTransforms=
function(a){if(null!=a)for(var f=0;f<a.num_nodes;++f)b.XModelNodeUtils.resetTransforms(a.nodes[f])};b.XModelContainerUtils.resetOffset=function(a){b.XModelContainerUtils.resetTransforms(a);b.XModelContainerUtils.updateCombination(a);b.XModelContainerUtils.updateOffset(a)};b.XModelContainerUtils.forEachMesh=function(a,f,c){if(null!=a){for(var d=0;d<a.num_meshes;++d){var g=a.meshes[d];null!=g&&f(g,c)}for(d=0;d<a.num_nodes;++d)b.XModelNodeUtils.forEachMesh(a.nodes[d],f,c)}};b.XModelContainerUtils.forEachNode=
function(a,f,c){if(null!=a)for(var d=0;d<a.num_nodes;++d)b.XModelNodeUtils.forEachNode(a.nodes[d],f,0,c)}})(xpl);(function(b){b.XModelWrapper=function(){this._container=null;this.__prev_anim_index=-1;this.__min_bounds=new Float32Array([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]);this.__max_bounds=new Float32Array([-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]);this.__is_canseled=this.__is_completed=!1};Object.defineProperties(b.XModelWrapper.prototype,{container:{get:function(){return this._container}},isCompleted:{get:function(){return this.__is_completed}},isCanceled:{get:function(){return this.__is_canseled}},
numAnimationSets:{get:function(){return null!=this._container?this._container.num_animation_sets:0}}});b.XModelWrapper.prototype._complete=function(){this.__is_completed=!0;b.XModelContainerUtils.forEachMesh(this._container,function(a,b){for(var c=0;c<a.num_positions;++c)for(var d=0;d<a.position_size;++d){var g=a.positions[a.position_size*c+d];this.__min_bounds[d]=Math.min(this.__min_bounds[d],g);this.__max_bounds[d]=Math.max(this.__max_bounds[d],g)}}.bind(this),null)};b.XModelWrapper.prototype.cansel=
function(){this.__is_canseled=!0};b.XModelWrapper.prototype.getMinBound=function(a){return this.__min_bounds[a]};b.XModelWrapper.prototype.getMaxBound=function(a){return this.__max_bounds[a]};b.XModelWrapper.prototype.getSize=function(a){return this.__max_bounds[a]-this.__min_bounds[a]};b.XModelWrapper.prototype.getCenter=function(a){return.5*(this.__min_bounds[a]+this.__max_bounds[a])};b.XModelWrapper.prototype.resetPose=function(){b.XModelContainerUtils.resetTransforms(this._container);b.XModelContainerUtils.updateCombination(this._container)};
b.XModelWrapper.prototype.setAnimation=function(a,f,c,d){void 0==d&&(d=!1);void 0==c&&(c=!1);this.__prev_anim_index!=a?(this.__prev_anim_index=a,this.resetPose()):b.XModelContainerUtils.resetTransforms(this._container);b.XModelContainerUtils.setAnimation(this._container,a,f,c);d&&b.XModelContainerUtils.applyKinematics(this._container);b.XModelContainerUtils.updateCombination(this._container)};b.XModelWrapper.prototype.dispose=function(){this.cancel();this.__is_completed=!1}})(xpl);
(function(b){b.XModelWrapperGL=function(){b.XModelWrapper.call(this);this.__white_texture=this.__config=null;this.__remain_textures=0;this.__is_update_anim=!1};Object.setPrototypeOf(b.XModelWrapperGL.prototype,b.XModelWrapper.prototype);Object.defineProperties(b.XModelWrapperGL,{CONFIG_MEMORY_ALIGNMENT_SIZE:{value:"memory_alignment_size"},CONFIG_USE_VERTEX_ARRAY_OBJECT:{value:"use_vertex_array_object"},CONFIG_USE_MIPMAP_TEXTURE:{value:"use_mipmap_texture"},CONFIG_USE_SKINNING:{value:"use_skinning"},
CONFIG_GPU_SKINNING:{value:"gpu_skinning"},CONFIG_MAX_BONE_WEIGHTED_INDICES:{value:"max_bone_weighted_indices"},CONFIG_MAX_BONE_MATRICES:{value:"max_bone_matrices"},CONFIG_PATH_ALIAS:{value:"path_alias"},CONFIG_USE_MORFING:{value:"use_mofing"},CONFIG_GPU_MORFING:{value:"gpu_morfing"},UNIFORM_DIFFUSE:{value:"d_diffuse"},UNIFORM_DIFFUSE_MAP:{value:"u_diffuse_map"},UNIFORM_SPECULAR:{value:"u_specular"},UNIFORM_SPECULAR_MAP:{value:"u_specular_map"},UNIFORM_BONE_MATRICES:{value:"u_bone_matrices"},ATTRIBUTE_POSITION:{value:"a_position"},
ATTRIBUTE_NORMAL:{value:"a_normal"},ATTRIBUTE_COLOR:{value:"a_color"},ATTRIBUTE_TEXCOORD:{value:"a_tex_coord"},ATTRIBUTE_BONEINDICES:{value:"a_bone_indices"},ATTRIBUTE_BONEWEIGHTS:{value:"a_bone_weights"}});var a=b.XModelWrapperGL;b.XModelWrapperGL.defaultConfig=function(){var b={};b[a.CONFIG_MEMORY_ALIGNMENT_SIZE]=4;b[a.CONFIG_USE_VERTEX_ARRAY_OBJECT]=!1;b[a.CONFIG_USE_MIPMAP_TEXTURE]=!1;b[a.CONFIG_USE_SKINNING]=!1;b[a.CONFIG_GPU_SKINNING]=!1;b[a.CONFIG_MAX_BONE_MATRICES]=32;b[a.CONFIG_MAX_BONE_WEIGHTED_INDICES]=
4;b[a.CONFIG_USE_MORFING]=!1;b[a.CONFIG_GPU_MORFING]=!1;b[a.CONFIG_PATH_ALIAS]=null;return b};b.XModelWrapperGL.copyConfig=function(b){for(var c={},e=$jscomp.makeIterator([a.CONFIG_MEMORY_ALIGNMENT_SIZE,a.CONFIG_USE_VERTEX_ARRAY_OBJECT,a.CONFIG_USE_MIPMAP_TEXTURE,a.CONFIG_USE_SKINNING,a.CONFIG_GPU_SKINNING,a.CONFIG_MAX_BONE_MATRICES,a.CONFIG_MAX_BONE_WEIGHTED_INDICES,a.CONFIG_USE_MORFING,a.CONFIG_GPU_MORFING,a.CONFIG_PATH_ALIAS]),f=e.next();!f.done;f=e.next())f=f.value,c[f]=b[f];return c};b.XModelWrapperGL.defaultUniforms=
function(){var b={};b[a.UNIFORM_DIFFUSE]=0;b[a.UNIFORM_DIFFUSE_MAP]=0;return b};b.XModelWrapperGL.defaultAttributes=function(){var b={};b[a.ATTRIBUTE_POSITION]=-1;b[a.ATTRIBUTE_NORMAL]=-1;b[a.ATTRIBUTE_COLOR]=-1;b[a.ATTRIBUTE_TEXCOORD]=-1;b[a.ATTRIBUTE_BONEINDICES]=-1;b[a.ATTRIBUTE_BONEWEIGHTS]=-1;return b};var f=function(d,g,e,f,l){if(null==g.getExtension("OES_element_index_uint"))throw Error("Required the OES_element_index_uint");null==f&&(f="");var k=new XMLHttpRequest,m=0;k.open("GET",f+e,!0);
k.responseType="arraybuffer";k.onload=function(d){if(!this.isCanceled)if(200==d.target.status)if(this._container=(new b.XModelDecoder).decode(d.target.response),null!=this._container){b.XModelContainerUtils.forEachMesh(this._container,function(d,c){var e=!l[a.CONFIG_USE_SKINNING]||l[a.CONFIG_GPU_SKINNING],f,h,k,n;l[a.CONFIG_USE_SKINNING]&&l[a.CONFIG_GPU_SKINNING]?(f=2,h=b.XModelMeshUtils.TYPE_UNSIGNED_SHORT,k=4,n=b.XModelMeshUtils.TYPE_FLOAT):(f=0,h=b.XModelMeshUtils.TYPE_VOID,k=0,n=b.XModelMeshUtils.TYPE_VOID);
var p=new Int32Array(b.XModelMeshUtils.MAX_ATTRIBUTE),e=b.XModelMeshUtils.getVerticesSize(d,e,l[a.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,1,4,0,f,k,p,0),e=new ArrayBuffer(e);b.XModelMeshUtils.getVertices(d,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_UNSIGNED_BYTE,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_VOID,h,n,p,0,e,0);null!=d.skin&&(m=Math.max(d.skin.num_nodes,m));var z,E,G,B,D;(h=l[a.CONFIG_USE_SKINNING]&&!l[a.CONFIG_GPU_SKINNING]&&null!=d.skin&&0<d.skin.num_nodes)?
(D=new Int32Array(b.XModelMeshUtils.MAX_ATTRIBUTE),n=b.XModelMeshUtils.getVerticesSize(d,!1,l[a.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,0,0,0,2,4,D,0),n=new ArrayBuffer(n),f=new Float32Array(n,D[b.XModelMeshUtils.ATTRIBUTE_POSITION]),k=new Float32Array(n,D[b.XModelMeshUtils.ATTRIBUTE_NORMAL]),z=new Uint16Array(n,D[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),E=new Float32Array(n,D[b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]),b.XModelMeshUtils.getVertices(d,b.XModelMeshUtils.TYPE_FLOAT,b.XModelMeshUtils.TYPE_FLOAT,
b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_VOID,b.XModelMeshUtils.TYPE_UNSIGNED_SHORT,b.XModelMeshUtils.TYPE_FLOAT,D,0,n,0),G=new ArrayBuffer(D[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),B=new Float32Array(G,D[b.XModelMeshUtils.ATTRIBUTE_POSITION]),D=new Float32Array(G,D[b.XModelMeshUtils.ATTRIBUTE_NORMAL])):D=B=G=E=z=k=f=n=null;var H=new Int32Array(d.num_materials+1),F=new Uint32Array(d.num_materials+1),K=b.XModelMeshUtils.getNumAllTriangledFaceIndices(d,H,0,F,
0),K=new Uint32Array(K);b.XModelMeshUtils.getAllTriangledFaceIndices(d,!0,H,0,K,0);d.vertex_buffer=b.GLUtils.createBuffer(g,g.ARRAY_BUFFER,e,h?g.STREAM_DRAW:g.STATIC_DRAW);d.element_buffer=b.GLUtils.createBuffer(g,g.ELEMENT_ARRAY_BUFFER,K.buffer,g.STATIC_DRAW);d.user_object={vertices_offsets:p,src_vertices:n,src_positions:f,src_normals:k,src_bone_indices:z,src_bone_weights:E,dest_vertices:G,dest_positions:B,dest_normals:D,elements_offsets:H,elements_sizes:F}},null);0<m&&(this.__matrix_pallet=new Float32Array(b.Geometry.SIZE_MATRIX_4X4*
m),this.resetPose());var e=b.XModelContainerUtils.getTextures(this._container,null,0,0);d=Array(e);b.XModelContainerUtils.getTextures(this._container,d,0,e);d=b.ArrayUtils.convertToSet(d,0,d.length,function(a,b){return a.name==b.name});this.__remain_textures=d.length;for(e=0;e<d.length;++e)c(this,g,d[e],f,l);0>=this.__remain_textures&&this._complete()}else this.cancel();else this.cancel()}.bind(d);k.send()},c=function(d,c,e,f,l){var k=new XMLHttpRequest;null!=l[a.CONFIG_PATH_ALIAS]&&null!=l[a.CONFIG_PATH_ALIAS][e.ref]?
k.open("GET",l[a.CONFIG_PATH_ALIAS][e.ref],!0):k.open("GET",f+e.ref,!0);k.responseType="blob";k.onload=function(f){if(!d.isCanceled){if(200==f.target.status){f=f.target.response;var h=new Image;h.onload=function(){e.texture=b.GLUtils.createTexture2DFromImage(c,c.RGBA,c.UNSIGNED_BYTE,h);c.bindTexture(c.TEXTURE_2D,e.texture);l[a.CONFIG_USE_MIPMAP_TEXTURE]&&c.generateMipmap(c.TEXTURE_2D);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.MIRRORED_REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.MIRRORED_REPEAT);
c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR)};h.src=URL.createObjectURL(f)}this.__remain_textures--;0>=this.__remain_textures&&this._complete()}}.bind(d);k.send()};b.XModelWrapperGL.prototype.initializeWithUrl=function(a,c,e,h){this.__white_texture=b.GLUtils.createTexture2D(a,a.RGBA,a.UNSIGNED_BYTE,1,1,new Uint8Array([255,255,255,255]),!1,null,0);this.__config=b.XModelWrapperGL.copyConfig(h);f(this,a,c,e,this.__config)};b.XModelWrapperGL.prototype.setAnimation=
function(a,c,e,f){b.XModelWrapper.prototype.setAnimation.call(this,a,c,e,f);this.__is_update_anim=!0};b.XModelWrapperGL.prototype._complete=function(){b.XModelWrapper.prototype._complete.call(this);b.XModelContainerUtils.releaseShapes(this._container)};b.XModelWrapperGL.prototype.draw=function(c,f,e){b.XModelContainerUtils.forEachMesh(this._container,function(h,l){c.bindBuffer(c.ARRAY_BUFFER,h.vertex_buffer);var k=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE],m=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_POSITION];
-1!=e.a_position&&-1!=m&&(c.enableVertexAttribArray(e.a_position),c.vertexAttribPointer(e.a_position,h.position_size,c.FLOAT,!1,k,m));m=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_NORMAL];-1!=e.a_normal&&-1!=m&&(c.enableVertexAttribArray(e.a_normal),c.vertexAttribPointer(e.a_normal,h.normal_size,c.FLOAT,!1,k,m));m=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_COLOR];-1!=e.a_color&&-1!=m&&(c.enableVertexAttribArray(e.a_color),c.vertexAttribPointer(e.a_color,h.color_size,
c.UNSIGNED_BYTE,!1,k,m));m=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_TEXCOORD];-1!=e.a_tex_coord&&-1!=m&&(c.enableVertexAttribArray(e.a_tex_coord),c.vertexAttribPointer(e.a_tex_coord,h.tex_coord_size,c.FLOAT,!1,k,m));null!=h.skin&&this.__config[a.CONFIG_USE_SKINNING]&&(m=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_BONEINDICES],-1!=e.a_bone_indices&&-1!=m&&(c.enableVertexAttribArray(e.a_bone_indices),c.vertexAttribPointer(e.a_bone_indices,h.skin.weighted_index_stride,
c.UNSIGNED_SHORT,!1,k,m)),m=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS],-1!=e.a_bone_weights&&-1!=m&&(c.enableVertexAttribArray(e.a_bone_weights),c.vertexAttribPointer(e.a_bone_weights,h.skin.weighted_index_stride,c.FLOAT,!1,k,m)));if(null!=h.skin&&this.__config[a.CONFIG_USE_SKINNING])if(null!=h.user_object.src_vertices&&this.__is_update_anim){b.XModelSkinUtils.updateMatrixPallet(h.skin,h.skin.num_nodes,this.__matrix_pallet,0);-1!=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_POSITION]&&
b.XModelSkinUtils.updatePositions(this.__matrix_pallet,0,h.num_vertices,h.user_object.src_positions,0,0,h.user_object.dest_positions,0,0,h.skin.weighted_index_stride,h.user_object.src_bone_indices,0,0,h.user_object.src_bone_weights,0,0);if(-1!=h.user_object.vertices_offsets[b.XModelMeshUtils.ATTRIBUTE_NORMAL]){for(k=0;k<h.skin.num_nodes;++k)m=b.Geometry.SIZE_MATRIX_4X4*k,b.Matrix4x4.loadAxisv(this.__matrix_pallet,m,this.__matrix_pallet,m,!1),b.Matrix4x4.normalizeAxisv(this.__matrix_pallet,m,this.__matrix_pallet,
m,!0);b.XModelSkinUtils.updateNormals(this.__matrix_pallet,0,h.num_vertices,h.user_object.src_normals,0,0,h.user_object.dest_normals,0,0,h.skin.weighted_index_stride,h.user_object.src_bone_indices,0,0,h.user_object.src_bone_weights,0,0)}c.bufferSubData(c.ARRAY_BUFFER,0,h.user_object.dest_vertices);this.__is_update_anim=!1}else b.XModelSkinUtils.updateMatrixPallet(h.skin,h.skin.num_nodes,this.__matrix_pallet,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.element_buffer);for(k=0;k<h.num_materials;++k)m=h.materials[k],
null!=f.u_diffuse_map?(c.activeTexture(c.TEXTURE0),c.uniform1i(f.u_diffuse_map,0),null!=m.diffuse_map&&null!=m.diffuse_map.texture?(c.uniform4fv(f.u_diffuse_color,m.diffuse),c.bindTexture(c.TEXTURE_2D,m.diffuse_map.texture)):(c.uniform4f(f.u_diffuse_color,1,1,1,1),c.bindTexture(c.TEXTURE_2D,this.__white_texture))):null!=f.u_diffuse_color&&c.uniform4f(f.u_diffuse_color,1,1,1,1),c.drawElements(c.TRIANGLES,h.user_object.elements_sizes[k],c.UNSIGNED_INT,4*h.user_object.elements_offsets[k]);-1!=e.a_position&&
c.disableVertexAttribArray(e.a_position);-1!=e.a_normal&&c.disableVertexAttribArray(e.a_normal);-1!=e.a_color&&c.disableVertexAttribArray(e.a_color);-1!=e.a_tex_coord&&c.disableVertexAttribArray(e.a_tex_coord);-1!=e.a_bone_indices&&c.disableVertexAttribArray(e.a_bone_indices);-1!=e.a_bone_weights&&c.disableVertexAttribArray(e.a_bone_weights)}.bind(this),null)};b.XModelWrapperGL.prototype.dispose=function(a){b.XModelWrapper.prototype.dispose.call(this);b.XModelContainerUtils.forEachMesh(this._container,
function(b,c){null!=b.vertex_buffer&&(a.deleteBuffer(b.vertex_buffer),b.vertex_buffer=null);null!=b.element_buffer&&(a.deleteBuffer(b.element_buffer),b.element_buffer=null)},null);a.deleteTexture(this.__white_texture);for(var c=b.XModelContainerUtils.getTextures(this._container,null,0,0),e=Array(c),f=0;f<c;++f){var l=e[f];null!=l&&(a.deleteTexture(l.texture),l.texture=null)}}})(xpl);
