/*


 Copyright (c) 2016, Syuuhei Kuno
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this
 list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice,
 this list of conditions and the following disclaimer in the documentation
 and/or other materials provided with the distribution.

 3. Neither the name of xplain_for_js nor the names of its
 contributors may be used to endorse or promote products derived from
 this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];if(b)return b.call(a);var g=0;return{next:function(){return g<a.length?{done:!1,value:a[g++]}:{done:!0}}}};
$jscomp.arrayFromIterator=function(a){for(var b,g=[];!(b=a.next()).done;)g.push(b.value);return g};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.inherits=function(a,b){function g(){}g.prototype=b.prototype;a.prototype=new g;a.prototype.constructor=a;for(var c in b)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c]};$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var g=0,c={next:function(){if(g<a.length){var d=g++;return{value:b(d,a[d]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};$jscomp.initSymbol();$jscomp.initSymbolIterator();c[Symbol.iterator]=function(){return c};return c};
$jscomp.findInternal=function(a,b,g){a instanceof String&&(a=String(a));for(var c=a.length,d=0;d<c;d++){var e=a[d];if(b.call(g,e,d,a))return{i:d,v:e}}return{i:-1,v:void 0}};
$jscomp.array.from=function(a,b,g){$jscomp.initSymbolIterator();b=null!=b?b:function(b){return b};var c=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=a[Symbol.iterator];"function"==typeof d&&(a=d.call(a));if("function"==typeof a.next)for(;!(d=a.next()).done;)c.push(b.call(g,d.value));else for(var d=a.length,e=0;e<d;e++)c.push(b.call(g,a[e]));return c};$jscomp.array.of=function(a){return $jscomp.array.from(arguments)};
$jscomp.array.entries=function(){return $jscomp.iteratorFromArray(this,function(a,b){return[a,b]})};$jscomp.array.installHelper_=function(a,b){!Array.prototype[a]&&Object.defineProperties&&Object.defineProperty&&Object.defineProperty(Array.prototype,a,{configurable:!0,enumerable:!1,writable:!0,value:b})};$jscomp.array.entries$install=function(){$jscomp.array.installHelper_("entries",$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.iteratorFromArray(this,function(a){return a})};
$jscomp.array.keys$install=function(){$jscomp.array.installHelper_("keys",$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.iteratorFromArray(this,function(a,b){return b})};$jscomp.array.values$install=function(){$jscomp.array.installHelper_("values",$jscomp.array.values)};
$jscomp.array.copyWithin=function(a,b,g){var c=this.length;a=Number(a);b=Number(b);g=Number(null!=g?g:c);if(a<b)for(g=Math.min(g,c);b<g;)b in this?this[a++]=this[b++]:(delete this[a++],b++);else for(g=Math.min(g,c+b-a),a+=g-b;g>b;)--g in this?this[--a]=this[g]:delete this[a];return this};$jscomp.array.copyWithin$install=function(){$jscomp.array.installHelper_("copyWithin",$jscomp.array.copyWithin)};
$jscomp.array.fill=function(a,b,g){var c=this.length||0;0>b&&(b=Math.max(0,c+b));if(null==g||g>c)g=c;g=Number(g);0>g&&(g=Math.max(0,c+g));for(b=Number(b||0);b<g;b++)this[b]=a;return this};$jscomp.array.fill$install=function(){$jscomp.array.installHelper_("fill",$jscomp.array.fill)};$jscomp.array.find=function(a,b){return $jscomp.findInternal(this,a,b).v};$jscomp.array.find$install=function(){$jscomp.array.installHelper_("find",$jscomp.array.find)};
$jscomp.array.findIndex=function(a,b){return $jscomp.findInternal(this,a,b).i};$jscomp.array.findIndex$install=function(){$jscomp.array.installHelper_("findIndex",$jscomp.array.findIndex)};$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.Map$isConformant=function(){if($jscomp.ASSUME_NO_NATIVE_MAP)return!1;var a=$jscomp.global.Map;if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),g=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=g.get(b)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var c=g.entries(),d=c.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=c.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!c.next().done?!1:!0}catch(e){return!1}};
$jscomp.Map=function(a){this.data_={};this.head_=$jscomp.Map.createHead();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};
$jscomp.Map.prototype.set=function(a,b){var g=$jscomp.Map.maybeGetEntry(this,a);g.list||(g.list=this.data_[g.id]=[]);g.entry?g.entry.value=b:(g.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},g.list.push(g.entry),this.head_.previous.next=g.entry,this.head_.previous=g.entry,this.size++);return this};
$jscomp.Map.prototype.delete=function(a){a=$jscomp.Map.maybeGetEntry(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead();this.size=0};$jscomp.Map.prototype.has=function(a){return!!$jscomp.Map.maybeGetEntry(this,a).entry};
$jscomp.Map.prototype.get=function(a){return(a=$jscomp.Map.maybeGetEntry(this,a).entry)&&a.value};$jscomp.Map.prototype.entries=function(){return $jscomp.Map.makeIterator_(this,function(a){return[a.key,a.value]})};$jscomp.Map.prototype.keys=function(){return $jscomp.Map.makeIterator_(this,function(a){return a.key})};$jscomp.Map.prototype.values=function(){return $jscomp.Map.makeIterator_(this,function(a){return a.value})};
$jscomp.Map.prototype.forEach=function(a,b){for(var g=this.entries(),c;!(c=g.next()).done;)c=c.value,a.call(b,c[1],c[0],this)};$jscomp.Map.maybeGetEntry=function(a,b){var g=$jscomp.Map.getId(b),c=a.data_[g];if(c&&Object.prototype.hasOwnProperty.call(a.data_,g))for(a=0;a<c.length;a++){var d=c[a];if(b!==b&&d.key!==d.key||b===d.key)return{id:g,list:c,index:a,entry:d}}return{id:g,list:c,index:-1,entry:void 0}};
$jscomp.Map.makeIterator_=function(a,b){var g=a.head_,c={next:function(){if(g){for(;g.head!=a.head_;)g=g.previous;for(;g.next!=g.head;)return g=g.next,{done:!1,value:b(g)};g=null}return{done:!0,value:void 0}}};$jscomp.initSymbol();$jscomp.initSymbolIterator();c[Symbol.iterator]=function(){return c};return c};$jscomp.Map.mapIndex_=0;$jscomp.Map.createHead=function(){var a={};return a.previous=a.next=a.head=a};
$jscomp.Map.getId=function(a){if(!(a instanceof Object))return"p_"+a;if(!($jscomp.Map.idKey in a))try{$jscomp.Map.defineProperty(a,$jscomp.Map.idKey,{value:++$jscomp.Map.mapIndex_})}catch(b){}return $jscomp.Map.idKey in a?a[$jscomp.Map.idKey]:"o_ "+a};$jscomp.Map.defineProperty=Object.defineProperty?function(a,b,g){Object.defineProperty(a,b,{value:String(g)})}:function(a,b,g){a[b]=String(g)};$jscomp.Map.Entry=function(){};
$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();$jscomp.Map$isConformant()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.idKey=Symbol("map-id-key"),$jscomp.Map$install=function(){})};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(a){a=Number(a)>>>0;if(0===a)return 32;var b=0;0===(a&4294901760)&&(a<<=16,b+=16);0===(a&4278190080)&&(a<<=8,b+=8);0===(a&4026531840)&&(a<<=4,b+=4);0===(a&3221225472)&&(a<<=2,b+=2);0===(a&2147483648)&&b++;return b};$jscomp.math.imul=function(a,b){a=Number(a);b=Number(b);var g=a&65535,c=b&65535;return g*c+((a>>>16&65535)*c+g*(b>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1};
$jscomp.math.log10=function(a){return Math.log(a)/Math.LN10};$jscomp.math.log2=function(a){return Math.log(a)/Math.LN2};$jscomp.math.log1p=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,g=1,c=a,d=0,e=1;d!=c;)b*=a,e*=-1,c=(d=c)+e*b/++g;return c}return Math.log(1+a)};$jscomp.math.expm1=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,g=1,c=a,d=0;d!=c;)b*=a/++g,c=(d=c)+b;return c}return Math.exp(a)-1};$jscomp.math.cosh=function(a){a=Number(a);return(Math.exp(a)+Math.exp(-a))/2};
$jscomp.math.sinh=function(a){a=Number(a);return 0===a?a:(Math.exp(a)-Math.exp(-a))/2};$jscomp.math.tanh=function(a){a=Number(a);if(0===a)return a;var b=Math.exp(-2*Math.abs(a)),b=(1-b)/(1+b);return 0>a?-b:b};$jscomp.math.acosh=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};$jscomp.math.asinh=function(a){a=Number(a);if(0===a)return a;var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return 0>a?-b:b};
$jscomp.math.atanh=function(a){a=Number(a);return($jscomp.math.log1p(a)-$jscomp.math.log1p(-a))/2};$jscomp.math.hypot=function(a,b,g){a=Number(a);b=Number(b);var c,d,e,f=Math.max(Math.abs(a),Math.abs(b));for(c=2;c<arguments.length;c++)f=Math.max(f,Math.abs(arguments[c]));if(1E100<f||1E-100>f){a/=f;b/=f;e=a*a+b*b;for(c=2;c<arguments.length;c++)d=Number(arguments[c])/f,e+=d*d;return Math.sqrt(e)*f}e=a*a+b*b;for(c=2;c<arguments.length;c++)d=Number(arguments[c]),e+=d*d;return Math.sqrt(e)};
$jscomp.math.trunc=function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b};$jscomp.math.cbrt=function(a){if(0===a)return a;a=Number(a);var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a};$jscomp.number.isInteger=function(a){return $jscomp.number.isFinite(a)?a===Math.floor(a):!1};
$jscomp.number.isNaN=function(a){return"number"===typeof a&&isNaN(a)};$jscomp.number.isSafeInteger=function(a){return $jscomp.number.isInteger(a)&&Math.abs(a)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=function(){return Math.pow(2,-52)}();$jscomp.number.MAX_SAFE_INTEGER=function(){return 9007199254740991}();$jscomp.number.MIN_SAFE_INTEGER=function(){return-9007199254740991}();$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(a,b){for(var g=1;g<arguments.length;g++){var c=arguments[g];if(c)for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};$jscomp.object.is=function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.Set$isConformant=function(){if($jscomp.ASSUME_NO_NATIVE_SET)return!1;var a=$jscomp.global.Set;if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),g=new a($jscomp.makeIterator([b]));if(!g.has(b)||1!=g.size||g.add(b)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var c=g.entries(),d=c.next();if(d.done||d.value[0]!=b||d.value[1]!=b)return!1;d=c.next();return d.done||d.value[0]==b||4!=d.value[0].x||d.value[1]!=d.value[0]?!1:c.next().done}catch(e){return!1}};
$jscomp.Set=function(a){this.map_=new $jscomp.Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};$jscomp.Set.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};$jscomp.Set.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(a){return this.map_.has(a)};
$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};$jscomp.Set.prototype.forEach=function(a,b){var g=this;this.map_.forEach(function(c){return a.call(b,c,c,g)})};$jscomp.Set$install=function(){$jscomp.Map$install();$jscomp.Set$isConformant()?$jscomp.Set=$jscomp.global.Set:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values,$jscomp.Set$install=function(){})};
$jscomp.string=$jscomp.string||{};$jscomp.checkStringArgs=function(a,b,g){if(null==a)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return a+""};
$jscomp.string.fromCodePoint=function(a){for(var b="",g=0;g<arguments.length;g++){var c=Number(arguments[g]);if(0>c||1114111<c||c!==Math.floor(c))throw new RangeError("invalid_code_point "+c);65535>=c?b+=String.fromCharCode(c):(c-=65536,b+=String.fromCharCode(c>>>10&1023|55296),b+=String.fromCharCode(c&1023|56320))}return b};
$jscomp.string.repeat=function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var g="";a;)if(a&1&&(g+=b),a>>>=1)b+=b;return g};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(a){var b=$jscomp.checkStringArgs(this,null,"codePointAt"),g=b.length;a=Number(a)||0;if(0<=a&&a<g){a|=0;var c=b.charCodeAt(a);if(55296>c||56319<c||a+1===g)return c;a=b.charCodeAt(a+1);return 56320>a||57343<a?c:1024*(c-55296)+a+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};$jscomp.string.startsWith=function(a,b){var g=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var c=g.length,d=a.length;b=Math.max(0,Math.min(b|0,g.length));for(var e=0;e<d&&b<c;)if(g[b++]!=a[e++])return!1;return e>=d};
$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};$jscomp.string.endsWith=function(a,b){var g=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===b&&(b=g.length);b=Math.max(0,Math.min(b|0,g.length));for(var c=a.length;0<c&&0<b;)if(g[--b]!=a[--c])return!1;return 0>=c};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};var xpl=null;
"object"==typeof module?(xpl=module.exports,xpl.running_type="Node.js"):"object"==typeof exports?(xpl=exports,xpl.running_type="CommonJS"):xpl={running_type:"Direct Link"};function xplDefVal(a,b){return void 0===a?b:a}
(function(a){Object.defineProperties(a,{RUNTYPE_NODE_JS:{value:"Node.js"},RUNTYPE_COMMON_JS:{value:"CommonJS"},RUNTYPE_DIRECT_LINK:{value:"Direct Link"}});a.about={};Object.defineProperties(a.about,{NAME:{value:"xPlain for JavaScript"},CODE_NAME:{value:"ORBIS"},VERSION_CODE:{value:1},VERSION_NAME:{value:"0.9.0"},AUTHOR:{value:["Syuuhei Kuno"]},COPYRIGHT:{value:"Copyright (c) 2016, xPlain All rights reserved."},LICENSE:{value:"http://opensource.org/licenses/BSD-3-Clause"},REPOSITORY:{value:"git@github.com:redlily/xplain_for_js.git"}});
a.getAbout=function(){return a.about.NAME+"\nVersion code: "+a.about.VERSION_CODE+"\nVersion name: "+a.about.VERSION_NAME+"\nAuthor: "+a.about.AUTHOR+"\nCopyright: "+a.about.COPYRIGHT+"\nLicense: "+a.about.LICENSE+"\nRepository: "+a.about.REPOSITORY};a.putAboutToStdout=function(){console.log(a.getAbout)};var b=new DataView(new ArrayBuffer(8));a.size_t=function(b){return Number.parseInt.apply(null,arguments)};a.ptrdiff_t=function(b){return Number.parseInt.apply(null,arguments)};a.int8_t=function(b){return Number.parseInt.apply(null,
arguments)<<24>>24};Object.defineProperties(a.int8_t,{MIN_VALUE:{value:-Math.pow(2,7)},MAX_VALUE:{value:Math.pow(2,7)-1}});a.uint8_t=function(b){return Number.parseInt.apply(null,arguments)<<24>>>24};Object.defineProperties(a.uint8_t,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,8)-1}});a.int16_t=function(b){return Number.parseInt.apply(null,arguments)<<16>>16};Object.defineProperties(a.int16_t,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,8)-1}});a.uint16_t=function(b){return Number.parseInt.apply(null,
arguments)<<16>>>16};Object.defineProperties(a.uint16_t,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,16)-1}});a.int32_t=function(b){return Number.parseInt.apply(null,arguments)<<0>>0};Object.defineProperties(a.int32_t,{MIN_VALUE:{value:-Math.pow(2,31)},MAX_VALUE:{value:Math.pow(2,31)-1}});a.uint32_t=function(b){return Number.parseInt.apply(null,arguments)<<0>>>0};Object.defineProperties(a.uint32_t,{MIN_VALUE:{value:0},MAX_VALUE:{value:Math.pow(2,32)-1}});a.float32_t=function(b){return Number.parseFloat.apply(null,
arguments)};a.float32_t.hashCode=function(a){b.setFloat64(a);return b.getUint32(0).toString(16)};a.float64_t=function(b){return Number.parseFloat.apply(null,arguments)};a.float64_t.hashCode=function(a){b.setFloat64(a);return b.getUint32(0).toString(16)+b.getUint32(1).toString(16)};a.enum_t=function(b){return Number.parseInt.apply(null,arguments)}})(xpl);(function(a){a.SystemUtils=function(){throw Error("Unsupported operation!");};if("object"==typeof window){var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,g=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;a.SystemUtils.requestAnimationFrame=function(a){return b(a)};a.SystemUtils.cancelAnimationFrame=function(b){g(b)}}if("object"==typeof document){var c=
document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;a.SystemUtils.isSupportedFullScreen=function(b){return null!=(b.requestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullscreen||b.msRequestFullscreen)};a.SystemUtils.requestFullScreen=function(b){if("function"==typeof b.requestFullscreen)b.requestFullscreen();else if("function"==typeof b.mozRequestFullScreen)b.mozRequestFullScreen();else if("function"==typeof b.webkitRequestFullscreen)b.webkitRequestFullscreen();
else if("function"==typeof b.msRequestFullscreen)b.msRequestFullscreen();else return!1;return!0};a.SystemUtils.isFullScreen=function(){return window.innerWidth==screen.width&&window.innerHeight==screen.height};a.SystemUtils.cancelFullScreen=function(){null!=c&&c()}}})(xpl);(function(a){a.MathUtils=function(){throw Error("Unsupported operation!");};a.MathUtils.min=function(b,a,c){return b<a?b<c?b:c:a<c?a:c};a.MathUtils.mid=function(b,a,c){return b<a?a<c?a:c<b?b:c:b<c?b:c<a?a:c};a.MathUtils.max=function(b,a,c){return b<a?a<c?c:a:b<c?c:b};a.MathUtils.log=function(b,a){return Math.log(a)/Math.log(b)};a.MathUtils.cqrt=function(b){return 0<=b?Math.pow(b,1/3):-Math.pow(-b,1/3)};a.MathUtils.floorPow2=function(b){b=Math.floor(b);b|=b>>1;b|=b>>2;b|=b>>4;b|=b>>8;b|=b>>16;b|=b>>
32;return b^b>>1};a.MathUtils.ceilPow2=function(b){b=Math.floor(b);--b;b|=b>>1;b|=b>>2;b|=b>>4;b|=b>>8;b|=b>>16;return(b|b>>32)+1}})(xpl);(function(a){a.ArrayUtils=function(){throw Error("Unsupported operation!");};a.ArrayUtils.copy=function(b,a,c,d,e){for(var f=0;f<e;++f)c[d+f]=b[a+f]};a.ArrayUtils.fill=function(b,a,c,d){for(;a<c;++a)b[a]=d};a.ArrayUtils.binarySearch=function(b,a,c,d,e){for(c--;a<=c;){var f=a+c>>1,h=b[f],h=null!=e?e(h,d):h-d;if(0>h)a=f+1;else if(0<h)c=f-1;else return f}return-(a+1)};a.ArrayUtils.convertToSet=function(b,a,c,d){var e=[];a:for(;a<c;++a){for(var f=b[a],h=0;h<e.length;++h)if(null!=d?d(e[h],f):e[h]==f)continue a;
e.push(f)}return e};a.ArrayUtils.isContained=function(b,a,c,d,e,f,h){if(f-e<=c-a){a:for(;e<f;++e){for(var k=d[e],l=a;l<c;++l)if(null!=h?h(b[l],k):b[l]==k)continue a;return!1}return!0}return!1}})(xpl);(function(a){a.StringUtils=function(){throw Error("Unsupported operation!");};a.StringUtils.encodeUTF8=function(b){for(var a=[],c=0;c<b.length;++c){var d=b.charCodeAt(c);55296<=d&&57343>=d&&c<b.length-1&&(d=(d&1023)<<10|(b.charCodeAt(++c)&1023)+65536);128>d?a.push(d):2048>d?a.push(d>>6&31|192,d>>0&63|128):65536>d?a.push(d>>12&15|224,d>>6&63|128,d>>0&63|128):2097152>d?a.push(d>>18&7|240,d>>12&63|128,d>>6&63|128,d>>0&63|128):67108864>d?a.push(d>>24&3|248,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|
128):2147483648>d&&a.push(d>>30&1|252,d>>24&63|128,d>>18&63|128,d>>12&63|128,d>>6&63|128,d>>0&63|128)}return a};a.StringUtils.decodeUTF8=function(b){for(var a="",c=0;c<b.length;){var d=255&b[c],e=0;128>d?e=0:223>d?(d=(31&d)<<6,e=1):239>d?(d=(15&d)<<12,e=2):247>d?(d=(7&d)<<18,e=3):251>d?(d=(3&d)<<24,e=4):253>d&&(d=(1&d)<<30,e=5);for(c++;0<e&&c<b.length;){var f=b[c];if(128>f)break;d|=(63&f)<<6*--e;c++}a=55295>d||57344<=d&&65535>=d?a+String.fromCharCode(d):a+String.fromCharCode(55296|d-65536>>10&1023,
56320|d&1023)}return a}})(xpl);(function(a){a.Geometry=function(){throw Error("Unsupported operation!");};Object.defineProperties(a.Geometry,{VX:{value:0},VY:{value:1},VZ:{value:2},VW:{value:3},SIZE_VECTOR_3:{value:3},CR:{value:0},CI:{value:1},CJ:{value:2},CK:{value:3},SIZE_QUATERNION:{value:4},M4X4_00:{value:0},M4X4_10:{value:1},M4X4_20:{value:2},M4X4_30:{value:3},M4X4_01:{value:4},M4X4_11:{value:5},M4X4_21:{value:6},M4X4_31:{value:7},M4X4_02:{value:8},M4X4_12:{value:9},M4X4_22:{value:10},M4X4_32:{value:11},M4X4_03:{value:12},
M4X4_13:{value:13},M4X4_23:{value:14},M4X4_33:{value:15},SIZE_MATRIX_4X4:{value:16}})})(xpl);(function(a){a.Matrix4x4=function(){throw Error("Unsupported operation!");};a.Matrix4x4.load=function(b,a,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w){(w=xplDefVal(w,!1))?(b[a+0]=c,b[a+4]=h,b[a+8]=n,b[a+12]=t,b[a+1]=d,b[a+5]=k,b[a+9]=p,b[a+13]=v,b[a+2]=e,b[a+6]=l,b[a+10]=q,b[a+14]=u,b[a+3]=f,b[a+7]=m,b[a+11]=r):(b[a+0]=c,b[a+4]=d,b[a+8]=e,b[a+12]=f,b[a+1]=h,b[a+5]=k,b[a+9]=l,b[a+13]=m,b[a+2]=n,b[a+6]=p,b[a+10]=q,b[a+14]=r,b[a+3]=t,b[a+7]=v,b[a+11]=u);b[a+15]=y};a.Matrix4x4.loadv=function(b,g,c,d,e){a.Matrix4x4.load(b,
g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e)};a.Matrix4x4.loadZero=function(b,g){a.Matrix4x4.load(b,g,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!1)};a.Matrix4x4.loadIdentity=function(b,g){a.Matrix4x4.load(b,g,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,!1)};a.Matrix4x4.lrepv=function(b,g,c,d,e,f,h){var k=1-h;a.Matrix4x4.load(b,g,c[d+0]*k+e[f+0]*h,c[d+4]*k+e[f+4]*h,c[d+8]*k+e[f+8]*h,c[d+12]*k+e[f+12]*h,c[d+1]*k+e[f+1]*h,c[d+5]*k+e[f+5]*h,c[d+
9]*k+e[f+9]*h,c[d+13]*k+e[f+13]*h,c[d+2]*k+e[f+2]*h,c[d+6]*k+e[f+6]*h,c[d+10]*k+e[f+10]*h,c[d+14]*k+e[f+14]*h,c[d+3]*k+e[f+3]*h,c[d+7]*k+e[f+7]*h,c[d+11]*k+e[f+11]*h,c[d+15]*k+e[f+15]*h,!1)};a.Matrix4x4.transposev=function(b,a,c,d){var e=c[d+4],f=c[d+8],h=c[d+12],k=c[d+1],l=c[d+5],m=c[d+9],n=c[d+13],p=c[d+2],q=c[d+6],r=c[d+10],t=c[d+14],v=c[d+3],u=c[d+7],y=c[d+11],w=c[d+15];b[a+0]=c[d+0];b[a+4]=k;b[a+8]=p;b[a+12]=v;b[a+1]=e;b[a+5]=l;b[a+9]=q;b[a+13]=u;b[a+2]=f;b[a+6]=m;b[a+10]=r;b[a+14]=y;b[a+3]=
h;b[a+7]=n;b[a+11]=t;b[a+15]=w};a.Matrix4x4.determinant=function(b,a){var c=b[a+1],d=b[a+5],e=b[a+9],f=b[a+13],h=b[a+2],k=b[a+6],l=b[a+10],m=b[a+14],n=b[a+3],p=b[a+7],q=b[a+11],r=b[a+15];return b[a+0]*(d*(l*r-m*q)+e*(m*p-k*r)+f*(k*q-l*p))+b[a+4]*(c*(m*q-l*r)+e*(h*r-m*n)+f*(l*n-h*q))+b[a+8]*(c*(k*r-m*p)+d*(m*n-h*r)+f*(h*p-k*n))+b[a+12]*(c*(l*p-k*q)+d*(h*q-l*n)+e*(k*n-h*p))};a.Matrix4x4.inversev=function(b,g,c,d){var e=c[d+0],f=c[d+4],h=c[d+8],k=c[d+12],l=c[d+1],m=c[d+5],n=c[d+9],p=c[d+13],q=c[d+2],
r=c[d+6],t=c[d+10],v=c[d+14],u=c[d+3],y=c[d+7],w=c[d+11],B=c[d+15];c=l*r;d=l*t;var D=l*v,E=l*y,G=l*w,C=l*B,J=m*q,F=m*t,x=m*v,I=m*u,K=m*w,A=m*B,M=n*q,H=n*r,L=n*v,z=n*u,R=n*y,U=n*B,N=p*q,W=p*r,P=p*t,S=p*u,O=p*y,T=p*w,Q=q*y,V=q*w,q=q*B,X=r*u,Y=r*w,r=r*B,Z=t*u,aa=t*y,t=t*B,u=v*u,y=v*y,v=v*w,w=m*(t-v)+n*(y-r)+p*(Y-aa),B=l*(v-t)+n*(q-u)+p*(Z-V),p=l*(r-y)+m*(u-q)+p*(Q-X),l=l*(aa-Y)+m*(V-Z)+n*(X-Q),m=e*w+f*B+h*p+k*l;a.Matrix4x4.load(b,g,w/m,(f*(v-t)+h*(r-y)+k*(aa-Y))/m,(f*(U-T)+h*(O-A)+k*(K-R))/m,(f*(P-L)+
h*(x-W)+k*(H-F))/m,B/m,(e*(t-v)+h*(u-q)+k*(V-Z))/m,(e*(T-U)+h*(C-S)+k*(z-G))/m,(e*(L-P)+h*(N-D)+k*(d-M))/m,p/m,(e*(y-r)+f*(q-u)+k*(X-Q))/m,(e*(A-O)+f*(S-C)+k*(E-I))/m,(e*(W-x)+f*(D-N)+k*(J-c))/m,l/m,(e*(Y-aa)+f*(Z-V)+h*(Q-X))/m,(e*(R-K)+f*(G-z)+h*(I-E))/m,(e*(F-H)+f*(M-d)+h*(c-J))/m,!1)};a.Matrix4x4.add=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B,D,E,G,C,J,F,x,I,K,A,M,H,L,z){a.Matrix4x4.load(b,g,c+w,d+B,e+D,f+E,h+G,k+C,l+J,m+F,n+x,p+I,q+K,r+A,t+M,v+H,u+L,y+z,!1)};a.Matrix4x4.addv=function(b,
g,c,d,e,f){a.Matrix4x4.add(b,g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e[f+0],e[f+4],e[f+8],e[f+12],e[f+1],e[f+5],e[f+9],e[f+13],e[f+2],e[f+6],e[f+10],e[f+14],e[f+3],e[f+7],e[f+11],e[f+15])};a.Matrix4x4.sub=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B,D,E,G,C,J,F,x,I,K,A,M,H,L,z){a.Matrix4x4.load(b,g,c-w,d-B,e-D,f-E,h-G,k-C,l-J,m-F,n-x,p-I,q-K,r-A,t-M,v-H,u-L,y-z,!1)};a.Matrix4x4.subv=function(b,g,c,d,e,f){a.Matrix4x4.sub(b,
g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e[f+0],e[f+4],e[f+8],e[f+12],e[f+1],e[f+5],e[f+9],e[f+13],e[f+2],e[f+6],e[f+10],e[f+14],e[f+3],e[f+7],e[f+11],e[f+15])};a.Matrix4x4.mul=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B,D,E,G,C,J,F,x,I,K,A,M,H,L,z){a.Matrix4x4.load(b,g,c*w+d*G+e*x+f*M,c*B+d*C+e*I+f*H,c*D+d*J+e*K+f*L,c*E+d*F+e*A+f*z,h*w+k*G+l*x+m*M,h*B+k*C+l*I+m*H,h*D+k*J+l*K+m*L,h*E+k*F+l*A+m*z,n*w+p*G+q*x+r*M,n*
B+p*C+q*I+r*H,n*D+p*J+q*K+r*L,n*E+p*F+q*A+r*z,t*w+v*G+u*x+y*M,t*B+v*C+u*I+y*H,t*D+v*J+u*K+y*L,t*E+v*F+u*A+y*z,!1)};a.Matrix4x4.mulv=function(b,g,c,d,e,f){a.Matrix4x4.mul(b,g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e[f+0],e[f+4],e[f+8],e[f+12],e[f+1],e[f+5],e[f+9],e[f+13],e[f+2],e[f+6],e[f+10],e[f+14],e[f+3],e[f+7],e[f+11],e[f+15])};a.Matrix4x4.mulScalar=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w){a.Matrix4x4.load(b,
g,c*w,d*w,e*w,f*w,h*w,k*w,l*w,m*w,n*w,p*w,q*w,r*w,t*w,v*w,u*w,y*w,!1)};a.Matrix4x4.mulScalarv=function(b,g,c,d,e){a.Matrix4x4.mulScalar(b,g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e)};a.Matrix4x4.div=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B,D,E,G,C,J,F,x,I,K,A,M,H,L,z){var R=G*I,U=G*K,N=G*A,W=G*H,P=G*L,S=G*z,O=C*x,T=C*K,Q=C*A,V=C*M,X=C*L,Y=C*z,Z=J*x,aa=J*I,ha=J*A,ia=J*M,ja=J*H,ka=J*z,la=F*x,ma=F*I,na=F*K,oa=F*M,
pa=F*H,qa=F*L,ba=x*H,ca=x*L;x*=z;var da=I*M,ea=I*L;I*=z;var fa=K*M,ga=K*H;K*=z;M*=A;H*=A;A*=L;L=C*(K-A)+J*(H-I)+F*(ea-ga);z=G*(A-K)+J*(x-M)+F*(fa-ca);F=G*(I-H)+C*(M-x)+F*(ba-da);G=G*(ga-ea)+C*(ca-fa)+J*(da-ba);C=w*L+B*z+D*F+E*G;a.Matrix4x4.mul(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,L/C,(B*(A-K)+D*(I-H)+E*(ga-ea))/C,(B*(ka-qa)+D*(pa-Y)+E*(X-ja))/C,(B*(na-ha)+D*(Q-ma)+E*(aa-T))/C,z/C,(w*(K-A)+D*(M-x)+E*(ca-fa))/C,(w*(qa-ka)+D*(S-oa)+E*(ia-P))/C,(w*(ha-na)+D*(la-N)+E*(U-Z))/C,F/C,(w*(H-I)+B*(x-M)+E*(da-
ba))/C,(w*(Y-pa)+B*(oa-S)+E*(W-V))/C,(w*(ma-Q)+B*(N-la)+E*(O-R))/C,G/C,(w*(ea-ga)+B*(fa-ca)+D*(ba-da))/C,(w*(ja-X)+B*(P-ia)+D*(V-W))/C,(w*(T-aa)+B*(Z-U)+D*(R-O))/C)};a.Matrix4x4.divv=function(b,g,c,d,e,f){a.Matrix4x4.div(b,g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e[f+0],e[f+4],e[f+8],e[f+12],e[f+1],e[f+5],e[f+9],e[f+13],e[f+2],e[f+6],e[f+10],e[f+14],e[f+3],e[f+7],e[f+11],e[f+15])};a.Matrix4x4.divScalar=function(b,g,c,d,
e,f,h,k,l,m,n,p,q,r,t,v,u,y,w){a.Matrix4x4.load(b,g,c/w,d/w,e/w,f/w,h/w,k/w,l/w,m/w,n/w,p/w,q/w,r/w,t/w,v/w,u/w,y/w,!1)};a.Matrix4x4.divScalarv=function(b,g,c,d,e){a.Matrix4x4.divScalar(b,g,c[d+0],c[d+4],c[d+8],c[d+12],c[d+1],c[d+5],c[d+9],c[d+13],c[d+2],c[d+6],c[d+10],c[d+14],c[d+3],c[d+7],c[d+11],c[d+15],e)};a.Matrix4x4.convertToString=function(b,a){return"Matrix4x4(\n    "+b[a+0]+", "+b[a+4]+", "+b[a+8]+", "+b[a+12]+",\n    "+b[a+1]+", "+b[a+5]+", "+b[a+9]+", "+b[a+13]+",\n    "+b[a+2]+", "+b[a+
6]+", "+b[a+10]+", "+b[a+14]+",\n    "+b[a+3]+", "+b[a+7]+", "+b[a+11]+", "+b[a+15]+")"}})(xpl);(function(a){null!=a.Matrix4x4&&(a.Matrix4x4.loadScale=function(b,g,c,d,e){a.Matrix4x4.load(b,g,c,0,0,0,0,d,0,0,0,0,e,0,0,0,0,1,!1)},a.Matrix4x4.loadTranslate=function(b,g,c,d,e,f){f=xplDefVal(f,!0);a.Matrix4x4.load(b,g,1,0,0,c,0,1,0,d,0,0,1,e,0,0,0,1,!f)},a.Matrix4x4.loadRotateXAxis=function(b,g,c,d){d=xplDefVal(d,!0);var e=Math.cos(c);c=Math.sin(c);a.Matrix4x4.load(b,g,1,0,0,0,0,e,-c,0,0,c,e,0,0,0,0,1,!d)},a.Matrix4x4.loadRotateYAxis=function(b,g,c,d){d=xplDefVal(d,!0);var e=Math.cos(c);c=Math.sin(c);
a.Matrix4x4.load(b,g,e,0,c,0,0,1,0,0,-c,0,e,0,0,0,0,1,!d)},a.Matrix4x4.loadRotateZAxis=function(b,g,c,d){d=xplDefVal(d,!0);var e=Math.cos(c);c=Math.sin(c);a.Matrix4x4.load(b,g,e,-c,0,0,c,e,0,0,0,0,1,0,0,0,0,1,!d)},a.Matrix4x4.loadRotate=function(b,g,c,d,e,f,h,k){h=xplDefVal(h,!0);k=xplDefVal(k,!0);var l=Math.cos(f);f=Math.sin(f);h&&(h=c*c+d*d+e*e,0<h&&(h=Math.sqrt(h),c/=h,d/=h,e/=h));h=1-l;var m=c*h,n=d*h,p=d*m,q=e*m,r=e*n,t=c*f,v=d*f;f*=e;a.Matrix4x4.load(b,g,l+c*m,p-f,q+v,0,p+f,l+d*n,r-t,0,q-v,
r+t,l+e*e*h,0,0,0,0,1,!k)},a.Matrix4x4.loadLookAt=function(b,g,c,d,e,f,h,k,l,m,n,p){l=xplDefVal(l,0);m=xplDefVal(m,1);n=xplDefVal(n,0);p=xplDefVal(p,!0);f-=c;h-=d;k-=e;var q=f*f+h*h+k*k;0<q&&(q=Math.sqrt(q),f/=q,h/=q,k/=q);q=h*n-k*m;n=k*l-f*n;l=f*m-h*l;m=q*q+n*n+l*l;0<m&&(m=Math.sqrt(m),q/=m,n/=m,l/=m);m=h*l-k*n;var r=k*q-f*l,t=f*n-h*q;a.Matrix4x4.load(b,g,q,n,l,-(q*c+n*d+l*e),m,r,t,-(m*c+r*d+t*e),f,h,k,-(f*c+h*d+k*e),0,0,0,1,!p)},a.Matrix4x4.loadPerspective=function(b,g,c,d,e,f,h,k,l,m,n){h=xplDefVal(h,
2);k=xplDefVal(k,2);l=xplDefVal(l,-1);m=xplDefVal(m,1);n=xplDefVal(n,!0);var p=f-e;f*=m-l;a.Matrix4x4.load(b,g,e*h/c,0,0,0,0,e*k/d,0,0,0,0,f/p+l,e*f/-p,0,0,1,0,!n)},a.Matrix4x4.loadAxisv=function(b,g,c,d,e){a.Matrix4x4.load(b,g,c[d+0],c[d+4],c[d+8],0,c[d+1],c[d+5],c[d+9],0,c[d+2],c[d+6],c[d+10],0,0,0,0,1,e)},a.Matrix4x4.mulScale=function(b,a,c,d,e){b[a+0]*=c;b[a+4]*=d;b[a+8]*=e;b[a+1]*=c;b[a+5]*=d;b[a+9]*=e;b[a+2]*=c;b[a+6]*=d;b[a+10]*=e;b[a+3]*=c;b[a+7]*=d;b[a+11]*=e},a.Matrix4x4.mulTranslate=function(b,
a,c,d,e,f){if(f=xplDefVal(f,!0))b[a+12]+=b[a+0]*c+b[a+4]*d+b[a+8]*e,b[a+13]+=b[a+1]*c+b[a+5]*d+b[a+9]*e,b[a+14]+=b[a+2]*c+b[a+6]*d+b[a+10]*e,b[a+15]+=b[a+3]*c+b[a+7]*d+b[a+11]*e;else{f=b[a+12];var h=b[a+13],k=b[a+14],l=b[a+15];b[a+0]+=f*c;b[a+4]+=f*d;b[a+8]+=f*e;b[a+1]+=h*c;b[a+5]+=h*d;b[a+9]+=h*e;b[a+2]+=k*c;b[a+6]+=k*d;b[a+10]+=k*e;b[a+3]+=l*c;b[a+7]+=l*d;b[a+11]+=l*e}},a.Matrix4x4.mulRotateXAxis=function(b,a,c,d){(d=xplDefVal(d,!0))?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));
var e=b[a+4],f=b[a+8],h=b[a+5],k=b[a+9],l=b[a+6],m=b[a+10],n=b[a+7],p=b[a+11];b[a+4]=e*d+f*c;b[a+8]=e*-c+f*d;b[a+5]=h*d+k*c;b[a+9]=h*-c+k*d;b[a+6]=l*d+m*c;b[a+10]=l*-c+m*d;b[a+7]=n*d+p*c;b[a+11]=n*-c+p*d},a.Matrix4x4.mulRotateYAxis=function(b,a,c,d){(d=xplDefVal(d,!0))?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var e=b[a+0],f=b[a+8],h=b[a+1],k=b[a+9],l=b[a+2],m=b[a+10],n=b[a+3],p=b[a+11];b[a+0]=e*d+f*-c;b[a+8]=e*c+f*d;b[a+1]=h*d+k*-c;b[a+9]=h*c+k*d;b[a+2]=l*d+m*-c;b[a+10]=l*c+m*
d;b[a+3]=n*d+p*-c;b[a+11]=n*c+p*d},a.Matrix4x4.mulRotateZAxis=function(b,a,c,d){(d=xplDefVal(d,!0))?(d=Math.cos(c),c=Math.sin(c)):(d=Math.cos(c),c=-Math.sin(c));var e=b[a+0],f=b[a+4],h=b[a+1],k=b[a+5],l=b[a+2],m=b[a+6],n=b[a+3],p=b[a+7];b[a+0]=e*d+f*c;b[a+4]=e*-c+f*d;b[a+1]=h*d+k*c;b[a+5]=h*-c+k*d;b[a+2]=l*d+m*c;b[a+6]=l*-c+m*d;b[a+3]=n*d+p*c;b[a+7]=n*-c+p*d},a.Matrix4x4.mulRotate=function(b,a,c,d,e,f,h,k){h=xplDefVal(h,!0);(k=xplDefVal(k,!0))?(k=Math.cos(f),f=Math.sin(f)):(k=Math.cos(f),f=-Math.sin(f));
h&&(h=c*c+d*d+e*e,0<h&&(h=Math.sqrt(h),c/=h,d/=h,e/=h));h=1-k;var l=c*h,m=d*h,n=d*l,p=e*l,q=e*m,r=c*f,t=d*f,v=e*f;f=b[a+0];var u=b[a+4],y=b[a+8],w=b[a+1],B=b[a+5],D=b[a+9],E=b[a+2],G=b[a+6],C=b[a+10],J=b[a+3],F=b[a+7],x=b[a+11];c=k+c*l;var l=n-v,I=p+t,n=n+v;d=k+d*m;m=q-r;p-=t;q+=r;e=k+e*e*h;b[a+0]=f*c+u*n+y*p;b[a+4]=f*l+u*d+y*q;b[a+8]=f*I+u*m+y*e;b[a+1]=w*c+B*n+D*p;b[a+5]=w*l+B*d+D*q;b[a+9]=w*I+B*m+D*e;b[a+2]=E*c+G*n+C*p;b[a+6]=E*l+G*d+C*q;b[a+10]=E*I+G*m+C*e;b[a+3]=J*c+F*n+x*p;b[a+7]=J*l+F*d+x*q;
b[a+11]=J*I+F*m+x*e},a.Matrix4x4.mulLookAt=function(b,a,c,d,e,f,h,k,l,m,n,p){p=xplDefVal(p,!0);f-=c;h-=d;k-=e;var q=f*f+h*h+k*k;0<q&&(q=Math.sqrt(q),f/=q,h/=q,k/=q);q=h*n-k*m;n=k*l-f*n;l=f*m-h*l;m=q*q+n*n+l*l;0<m&&(m=Math.sqrt(m),q/=m,n/=m,l/=m);m=h*l-k*n;var r=k*q-f*l,t=f*n-h*q,v=-(q*c+n*d+l*e),u=-(m*c+r*d+t*e);c=-(f*c+h*d+k*e);d=b[a+0];e=b[a+4];var y=b[a+8],w=b[a+1],B=b[a+5],D=b[a+9],E=b[a+2],G=b[a+6],C=b[a+10],J=b[a+3],F=b[a+7],x=b[a+11];if(p)b[a+0]=d*q+e*m+y*f,b[a+4]=d*n+e*r+y*h,b[a+8]=d*l+e*
t+y*k,b[a+12]+=d*v+e*u+y*c,b[a+1]=w*q+B*m+D*f,b[a+5]=w*n+B*r+D*h,b[a+9]=w*l+B*t+D*k,b[a+13]+=w*v+B*u+D*c,b[a+2]=E*q+G*m+C*f,b[a+6]=E*n+G*r+C*h,b[a+10]=E*l+G*t+C*k,b[a+14]+=E*v+G*u+C*c,b[a+3]=J*q+F*m+x*f,b[a+7]=J*n+F*r+x*h,b[a+11]=J*l+F*t+x*k,b[a+15]+=J*v+F*u+x*c;else{p=b[a+12];var I=b[a+13],K=b[a+14],A=b[a+15];b[a+0]=d*q+e*n+y*l+p*v;b[a+4]=d*m+e*r+y*t+p*u;b[a+8]=d*f+e*h+y*k+p*c;b[a+1]=w*q+B*n+D*l+I*v;b[a+5]=w*m+B*r+D*t+I*u;b[a+9]=w*f+B*h+D*k+I*c;b[a+2]=E*q+G*n+C*l+K*v;b[a+6]=E*m+G*r+C*t+K*u;b[a+10]=
E*f+G*h+C*k+K*c;b[a+3]=J*q+F*n+x*l+A*v;b[a+7]=J*m+F*r+x*t+A*u;b[a+11]=J*f+F*h+x*k+A*c}},a.Matrix4x4.mulPerspective=function(b,a,c,d,e,f,h,k,l,m,n){h=xplDefVal(h,2);k=xplDefVal(k,2);l=xplDefVal(l,-1);m=xplDefVal(m,1);n=xplDefVal(n,!0);var p=f-e,q=f*(m-l);f=b[a+8];m=b[a+9];var r=b[a+10],t=b[a+11];c=e*h/c;d=e*k/d;l=q/p+l;n?(e=e*q/-p,b[a+0]*=c,b[a+4]*=d,b[a+8]=f*l+b[a+12],b[a+12]=f*e,b[a+1]*=c,b[a+5]*=d,b[a+9]=m*l+b[a+13],b[a+13]=m*e,b[a+2]*=c,b[a+6]*=d,b[a+10]=r*l+b[a+14],b[a+14]=r*e,b[a+3]*=c,b[a+7]*=
d,b[a+11]=t*l+b[a+15],b[a+15]=t*e):(e=e*q/-p,b[a+0]*=c,b[a+4]*=d,b[a+8]=f*l+b[a+12]*e,b[a+12]=f,b[a+1]*=c,b[a+5]*=d,b[a+9]=m*l+b[a+13]*e,b[a+13]=m,b[a+2]*=c,b[a+6]*=d,b[a+10]=r*l+b[a+14]*e,b[a+14]=r,b[a+3]*=c,b[a+7]*=d,b[a+11]=t*l+b[a+15]*e,b[a+15]=t)},a.Matrix4x4.normalizeAxisv=function(b,a,c,d,e){e=xplDefVal(e,!0);var f,h,k,l,m,n,p,q;f=c[d+0];m=c[d+5];q=c[d+10];e?(h=c[d+1],k=c[d+2],l=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]):(h=c[d+4],k=c[d+8],l=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]);d=f*f+h*h+k*k;0<d&&(d=
Math.sqrt(d),f/=d,h/=d,k/=d);d=l*l+m*m+n*n;0<d&&(d=Math.sqrt(d),l/=d,m/=d,n/=d);d=p*p+c*c+q*q;0<d&&(d=Math.sqrt(d),p/=d,c/=d,q/=d);b[a+0]=f;b[a+5]=m;b[a+10]=q;e?(b[a+1]=h,b[a+2]=k,b[a+4]=l,b[a+6]=n,b[a+8]=p,b[a+9]=c):(b[a+4]=h,b[a+8]=k,b[a+1]=l,b[a+9]=n,b[a+2]=p,b[a+6]=c)},a.Matrix4x4.slrepAxisAndLrepOtherv=function(b,g,c,d,e,f,h,k){k=xplDefVal(k,!0);var l=1-h,m,n,p,q,r,t,v,u,y,w,B,D,E,G,C;m=c[d+0];r=c[d+5];y=c[d+10];C=c[d+15];k?(n=c[d+1],p=c[d+2],w=c[d+3],q=c[d+4],t=c[d+6],B=c[d+7],v=c[d+8],u=c[d+
9],D=c[d+11],E=c[d+12],G=c[d+13],c=c[d+14]):(n=c[d+4],p=c[d+8],w=c[d+12],q=c[d+1],t=c[d+9],B=c[d+13],v=c[d+2],u=c[d+6],D=c[d+14],E=c[d+3],G=c[d+7],c=c[d+11]);var J,F,x,I,K,A,M,H,L,z,R,U,N,W;J=e[f+0];K=e[f+5];z=e[f+10];W=e[f+15];k?(F=e[f+1],x=e[f+2],d=e[f+3],I=e[f+4],A=e[f+6],M=e[f+7],H=e[f+8],L=e[f+9],R=e[f+11],U=e[f+12],N=e[f+13],e=e[f+14]):(F=e[f+4],x=e[f+8],d=e[f+12],I=e[f+1],A=e[f+9],M=e[f+13],H=e[f+2],L=e[f+6],R=e[f+14],U=e[f+3],N=e[f+7],e=e[f+11]);var P=m*m+n*n+p*p;0<P&&(P=Math.sqrt(P),m/=P,
n/=P,p/=P);var S=q*q+r*r+t*t;0<S&&(S=Math.sqrt(S),q/=S,r/=S,t/=S);f=v*v+u*u+y*y;0<f&&(f=Math.sqrt(f),v/=f,u/=f,y/=f);var O=J*J+F*F+x*x;0<O&&(O=Math.sqrt(O),J/=O,F/=O,x/=O);var T=I*I+K*K+A*A;0<T&&(T=Math.sqrt(T),I/=T,K/=T,A/=T);var Q=H*H+L*L+z*z;0<Q&&(Q=Math.sqrt(Q),H/=Q,L/=Q,z/=Q);var V=m*J+n*F+p*x;if(1<=V)x=P*l+O*h,m*=x,n*=x,p*=x;else if(-1>=V)x=P*l-O*h,m*=x,n*=x,p*=x;else{var P=P*l+O*h,O=Math.acos(V),X=Math.sin(O),V=Math.sin(O*l)/X,O=Math.sin(O*h)/X;m=(m*V+J*O)*P;n=(n*V+F*O)*P;p=(p*V+x*O)*P}x=q*
I+r*K+t*A;1<=x?(A=S*l+T*h,q*=A,r*=A,t*=A):-1>=x?(A=S*l-T*h,q*=A,r*=A,t*=A):(S=S*l+T*h,x=Math.acos(x),F=Math.sin(x),T=Math.sin(x*l)/F,x=Math.sin(x*h)/F,q=(q*T+I*x)*S,r=(r*T+K*x)*S,t=(t*T+A*x)*S);A=v*H+u*L+y*z;1<=A?(z=f*l+Q*h,v*=z,u*=z,y*=z):-1>=A?(z=f*l-Q*h,v*=z,u*=z,y*=z):(f=f*l+Q*h,A=Math.acos(A),K=Math.sin(A),Q=Math.sin(A*l)/K,A=Math.sin(A*h)/K,v=(v*Q+H*A)*f,u=(u*Q+L*A)*f,y=(y*Q+z*A)*f);a.Matrix4x4.load(b,g,m,q,v,E*l+U*h,n,r,u,G*l+N*h,p,t,y,c*l+e*h,w*l+d*h,B*l+M*h,D*l+R*h,C*l+W*h,!k)},a.Matrix4x4.fromQuaternionv=
function(b,g,c,d,e){e=xplDefVal(e,!0);var f=c[d+0],h=c[d+1],k=c[d+2],l=c[d+3];c=f*f;d=h*h;var m=k*k,n=l*l,p=h*k*2,q=h*l*2,r=k*l*2,h=f*h*2,k=f*k*2,f=f*l*2;a.Matrix4x4.load(b,g,d+c-n-m,p-f,q+k,0,p+f,m+c-d-n,r-h,0,q-k,r+h,n+c-m-d,0,0,0,0,1,!e)},a.Matrix4x4.mulQuaternionv=function(b,a,c,d,e){e=xplDefVal(e,!0);var f=c[d+0],h=c[d+1],k=c[d+2],l=c[d+3],m=f*f,n=h*h,p=k*k,q=l*l,r=h*k*2;d=h*l*2;c=k*l*2;var h=f*h*2,k=f*k*2,t=f*l*2,f=b[a+0],l=b[a+4],v=b[a+8],u=b[a+1],y=b[a+5],w=b[a+9],B=b[a+2],D=b[a+6],E=b[a+
10],G=b[a+3],C=b[a+7],J=b[a+11],F=n+m-q-p,x=p+m-n-q,m=q+m-p-n;e?(e=r-t,n=d+k,r+=t,p=c-h,d-=k,c+=h):(e=r+t,n=d-k,r-=t,p=c+h,d+=k,c-=h);b[a+0]=f*F+l*r+v*d;b[a+4]=f*e+l*x+v*c;b[a+8]=f*n+l*p+v*m;b[a+1]=u*F+y*r+w*d;b[a+5]=u*e+y*x+w*c;b[a+9]=u*n+y*p+w*m;b[a+2]=B*F+D*r+E*d;b[a+6]=B*e+D*x+E*c;b[a+10]=B*n+D*p+E*m;b[a+3]=G*F+C*r+J*d;b[a+7]=G*e+C*x+J*c;b[a+11]=G*n+C*p+J*m},a.Matrix4x4.mulQuaternionAxisv=function(b,a,c,d,e){e=xplDefVal(e,!0);var f=c[d+0],h=c[d+1],k=c[d+2],l=c[d+3],m=f*f,n=h*h,p=k*k,q=l*l,r=h*
k*2;d=h*l*2;c=k*l*2;var h=f*h*2,k=f*k*2,t=f*l*2,f=b[a+0],l=b[a+4],v=b[a+8],u=b[a+1],y=b[a+5],w=b[a+9],B=b[a+2],D=b[a+6],E=b[a+10],G=n+m-q-p,C=p+m-n-q,m=q+m-p-n;e?(e=r-t,n=d+k,r+=t,p=c-h,d-=k,c+=h):(e=r+t,n=d-k,r-=t,p=c+h,d+=k,c-=h);b[a+0]=f*G+l*r+v*d;b[a+4]=f*e+l*C+v*c;b[a+8]=f*n+l*p+v*m;b[a+1]=u*G+y*r+w*d;b[a+5]=u*e+y*C+w*c;b[a+9]=u*n+y*p+w*m;b[a+2]=B*G+D*r+E*d;b[a+6]=B*e+D*C+E*c;b[a+10]=B*n+D*p+E*m},a.Matrix4x4.toQuaternionv=function(b,g,c,d,e,f){e=xplDefVal(e,!1);f=xplDefVal(f,!0);var h=c[d+0],
k=c[d+5],l=c[d+10],m,n,p,q,r;f?(f=c[d+4],m=c[d+8],n=c[d+1],p=c[d+9],q=c[d+2],r=c[d+6]):(f=c[d+1],m=c[d+2],n=c[d+4],p=c[d+6],q=c[d+8],r=c[d+9]);c=(n*r-q*k)*m+(q*f-h*r)*p+(h*k-n*f)*l;d=0>c;0!=c&&(c=Math.pow(Math.abs(c),1/3),h/=c,n/=c,q/=c,f/=c,k/=c,r/=c,m/=c,p/=c,l/=c,c=Math.sqrt(c));p=.5*(r-p);m=.5*(m-q);f=.5*(n-f);n=p*p+m*m+f*f;0<n&&(n=Math.sqrt(n),d?(p/=-n,m/=-n,f/=-n):(p/=n,m/=n,f/=n));a.MathUtils.mid(.5*(h+k+l-1),1,-1);h=d?-a.MathUtils.mid(.5*(h+k+l+1),1,-1):a.MathUtils.mid(.5*(h+k+l-1),1,-1);
k=.5*Math.acos(h);h=Math.cos(k);n=Math.sin(k);e?(b[g+0]=c*h,b[g+1]=c*n*p,b[g+2]=c*n*m,b[g+3]=c*n*f):(b[g+0]=c*-h,b[g+1]=c*-n*p,b[g+2]=c*-n*m,b[g+3]=c*-n*f)},a.Matrix4x4.toRotateAxisv=function(b,a,c,d,e){e=xplDefVal(e,!0);var f=c[d+0],h=c[d+5],k=c[d+10],l,m,n,p;e?(e=c[d+4],l=c[d+8],m=c[d+1],n=c[d+9],p=c[d+2],c=c[d+6]):(e=c[d+1],l=c[d+2],m=c[d+4],n=c[d+6],p=c[d+8],c=c[d+9]);d=.5*(e+m);var q=.5*(p+l),r=.5*(n+c),f=Math.min(f-(0!=r?Math.abs(d*q/r):0),h-(0!=q?Math.abs(d*r/q):0),k-(0!=d?Math.abs(q*r/d):
0)),h=.5*(n-c);l=.5*(p-l);e=.5*(e-m);m=h*h+l*l+e*e;p=f*f+m;0<p&&(f/=Math.sqrt(p));if(1<=f)return b[a+0]=0,b[a+1]=0,b[a+2]=0;0<m?(m=Math.sqrt(m),b[a+0]=-h/m,b[a+1]=-l/m,b[a+2]=-e/m):(b[a+0]=0,b[a+1]=0,b[a+2]=0);return Math.acos(f)})})(xpl);(function(a){a.Quaternion=function(){throw Error("Unsupported operation!");};a.Quaternion.load=function(b,a,c,d,e,f){b[a+0]=c;b[a+1]=d;b[a+2]=e;b[a+3]=f};a.Quaternion.loadv=function(b,g,c,d){a.Quaternion.load(b,g,c[d+0],c[d+1],c[d+2],c[d+3])};a.Quaternion.loadZero=function(b,g){a.Quaternion.load(b,g,0,0,0,0)};a.Quaternion.loadIdentity=function(b,g){a.Quaternion.load(b,g,1,0,0,0)};a.Quaternion.absSq=function(b,a){var c=b[a+0],d=b[a+1],e=b[a+2];b=b[a+3];return c*c+d*d+e*e+b*b};a.Quaternion.abs=function(b,
g){return Math.sqrt(a.Quaternion.absSq(b,g))};a.Quaternion.normalizev=function(b,g,c,d){var e=c[d+0],f=c[d+1],h=c[d+2];c=c[d+3];d=e*e+f*f+h*h+c*c;0<d?(d=Math.sqrt(d),a.Quaternion.load(b,g,e/d,f/d,h/d,c/d)):a.Quaternion.loadZero(b,g)};a.Quaternion.exp=function(b,g,c,d,e,f){c=Math.exp(c);var h=Math.sqrt(d*d+e*e+f*f),k=c*Math.sin(h)/h;a.Quaternion.load(b,g,c*Math.cos(h),d*k,e*k,f*k)};a.Quaternion.expv=function(b,g,c,d){a.Quaternion.exp(b,g,c[d+0],c[d+1],c[d+2],c[d+3])};a.Quaternion.cis=function(b,g,
c,d,e){var f=Math.sqrt(c*c+d*d+e*e),h=Math.sin(f)/f;a.Quaternion.load(b,g,Math.cos(f),c*h,d*h,e*h)};a.Quaternion.cisv=function(b,g,c,d){a.Quaternion.cis(b,g,c[d+0],c[d+1],c[d+2])};a.Quaternion.log=function(b,g,c,d,e,f){var h=Math.sqrt(c*c+d*d+e*e+f*f);c=Math.acos(c/h)/Math.sqrt(d*d+e*e+f*f);a.Quaternion.load(b,g,Math.log(h),d*c,e*c,f*c)};a.Quaternion.logv=function(b,g,c,d){a.Quaternion.log(b,g,c[d+0],c[d+1],c[d+2],c[d+3])};a.Quaternion.lerp=function(b,g,c,d,e,f,h,k,l,m,n){var p=1-n;a.Quaternion.load(b,
g,c*p+h*n,d*p+k*n,e*p+l*n,f*p+m*n)};a.Quaternion.lerpv=function(b,g,c,d,e,f,h){a.Quaternion.lerp(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e[f+0],e[f+1],e[f+2],e[f+3],h)};a.Quaternion.slerp=function(b,g,c,d,e,f,h,k,l,m,n){var p=c*c+d*d+e*e+f*f;0<p&&(p=Math.sqrt(p),c/=p,d/=p,e/=p,f/=p);var q=h*h+k*k+l*l+m*m;0<q&&(q=Math.sqrt(q),h/=q,k/=q,l/=q,m/=q);var r=c*h+d*k+e*l+f*m;if(1<=r)h=p*(1-n)+q*n,a.Quaternion.load(b,g,c*h,d*h,e*h,f*h);else if(-1>=r)h=p*(1-n)-q*n,a.Quaternion.load(b,g,c*h,d*h,e*h,f*h);else{var p=
p*(1-n)+q*n,q=Math.acos(r),t=Math.sin(q),r=Math.sin(q*(1-n))/t;n=Math.sin(q*n)/t;a.Quaternion.load(b,g,(c*r+h*n)*p,(d*r+k*n)*p,(e*r+l*n)*p,(f*r+m*n)*p)}};a.Quaternion.slerpv=function(b,g,c,d,e,f,h){a.Quaternion.slerp(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e[f+0],e[f+1],e[f+2],e[f+3],h)};a.Quaternion.dot=function(b,a,c,d,e,f,h,k){return b*e+a*f+c*h+d*k};a.Quaternion.dotv=function(b,a,c,d){return b[a+0]*c[d+0]+b[a+1]*c[d+1]+b[a+2]*c[d+2]+b[a+3]*c[d+3]};a.Quaternion.conjugatev=function(b,g,c,d){a.Quaternion.load(b,
g,c[d+0],-c[d+1],-c[d+2],-c[d+3])};a.Quaternion.reversev=function(b,g,c,d){a.Quaternion.load(b,g,-c[d+0],-c[d+1],-c[d+2],-c[d+3])};a.Quaternion.inversev=function(b,g,c,d){var e=c[d+0],f=c[d+1],h=c[d+2];c=c[d+3];d=e*e+f*f+h*h+c*c;0<d&&(d=Math.sqrt(d),e/=d,f/=-d,h/=-d,c/=-d);a.Quaternion.load(b,g,e,f,h,c)};a.Quaternion.add=function(b,g,c,d,e,f,h,k,l,m){a.Quaternion.load(b,g,c+h,d+k,e+l,f+m)};a.Quaternion.addv=function(b,g,c,d,e,f){a.Quaternion.add(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e[f+0],e[f+1],e[f+2],
e[f+3])};a.Quaternion.sub=function(b,g,c,d,e,f,h,k,l,m){a.Quaternion.load(b,g,c-h,d-k,e-l,f-m)};a.Quaternion.subv=function(b,g,c,d,e,f){a.Quaternion.sub(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e[f+0],e[f+1],e[f+2],e[f+3])};a.Quaternion.mul=function(b,g,c,d,e,f,h,k,l,m){a.Quaternion.load(b,g,c*h-(d*k+e*l+f*m),c*k+d*h+(e*m-f*l),c*l+e*h+(f*k-d*m),c*m+f*h+(d*l-e*k))};a.Quaternion.mulv=function(b,g,c,d,e,f){a.Quaternion.mul(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e[f+0],e[f+1],e[f+2],e[f+3])};a.Quaternion.mulScalar=function(b,
g,c,d,e,f,h){a.Quaternion.load(b,g,c*h,d*h,e*h,f*h)};a.Quaternion.mulScalarv=function(b,g,c,d,e){a.Quaternion.mulScalar(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e)};a.Quaternion.div=function(b,g,c,d,e,f,h,k,l,m){var n=h*h+k*k+l*l+m*m;a.Quaternion.load(b,g,(c*h+(d*k+e*l+f*m))/n,(-c*k+d*h-(e*m-f*l))/n,(-c*l+e*h-(f*k-d*m))/n,(-c*m+f*h-(d*l-e*k))/n)};a.Quaternion.divv=function(b,g,c,d,e,f){a.Quaternion.div(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e[f+0],e[f+1],e[f+2],e[f+3])};a.Quaternion.divScalar=function(b,g,c,d,e,
f,h){a.Quaternion.load(b,g,c/h,d/h,e/h,f/h)};a.Quaternion.divScalarv=function(b,g,c,d,e){a.Quaternion.divScalar(b,g,c[d+0],c[d+1],c[d+2],c[d+3],e)};a.Quaternion.convertToString=function(b,a){return"Quaternion("+b[a+0]+", "+b[a+1]+", "+b[a+2]+", "+b[a+3]+")"}})(xpl);(function(a){null!=a.Quaternion&&(a.Quaternion.loadIAxisRotate=function(b,g,c){c*=.5;a.Quaternion.load(b,g,Math.cos(c),Math.sin(c),0,0)},a.Quaternion.loadJAxisRotate=function(b,g,c){c*=.5;a.Quaternion.load(b,g,Math.cos(c),0,Math.sin(c),0)},a.Quaternion.loadKAxisRotate=function(b,g,c){c*=.5;a.Quaternion.load(b,g,Math.cos(c),0,0,Math.sin(c))},a.Quaternion.loadRotate=function(b,g,c,d,e,f,h){if(h=xplDefVal(h,!0))h=c*c+d*d+e*e,0<h&&(h=Math.sqrt(h),c/=h,d/=h,e/=h);f*=.5;h=Math.sin(f);a.Quaternion.load(b,
g,Math.cos(f),c*h,d*h,e*h)},a.Quaternion.loadRotateVector3=function(b,g,c,d,e,f,h,k,l,m,n){n=xplDefVal(n,1);if(f)if(f=c*c+d*d+e*e,0<f)f=Math.sqrt(f),c/=f,d/=f,e/=f;else{a.Quaternion.loadIdentity(b,g);return}if(m)if(m=h*h+k*k+l*l,0<m)m=Math.sqrt(m),h/=m,k/=m,l/=m;else{a.Quaternion.loadIdentity(b,g);return}f=c*h+d*k+e*l;1<=f?a.Quaternion.loadIdentity(b,g):(m=d*l-e*k,e=e*h-c*l,c=c*k-d*h,d=m*m+e*e+c*c,0<d?(d=Math.sqrt(d),n*=.5*Math.acos(f),h=Math.sin(n),a.Quaternion.load(b,g,Math.cos(n),m/d*h,e/d*h,c/
d*h)):a.Quaternion.loadIdentity(b,g))},a.Quaternion.loadRotateVector3v=function(b,g,c,d,e,f,h,k,l){a.Quaternion.loadRotateVector3(b,g,c[d+0],c[d+1],c[d+2],e,f[h+0],f[h+1],f[h+2],k,l)},a.Quaternion.mulIAxisRotate=function(b,g,c){c*=.5;var d=Math.cos(c);c=Math.sin(c);var e=b[g+0],f=b[g+1],h=b[g+2],k=b[g+3];a.Quaternion.load(b,g,e*d-f*c,e*c+f*d,h*d+k*c,k*d-h*c)},a.Quaternion.mulJAxisRotate=function(b,g,c){c*=.5;var d=Math.cos(c);c=Math.sin(c);var e=b[g+0],f=b[g+1],h=b[g+2],k=b[g+3];a.Quaternion.load(b,
g,e*d-h*c,f*d-k*c,e*c+h*d,k*d+f*c)},a.Quaternion.mulKAxisRotate=function(b,g,c){c*=.5;var d=Math.cos(c);c=Math.sin(c);var e=b[g+0],f=b[g+1],h=b[g+2],k=b[g+3];a.Quaternion.load(b,g,e*d-k*c,f*d+h*c,h*d-f*c,e*c+k*d)},a.Quaternion.mulRotate=function(b,g,c,d,e,f,h){if(h=xplDefVal(h,!0))h=c*c+d*d+e*e,0<h&&(h=Math.sqrt(h),c/=h,d/=h,e/=h);f*=.5;h=Math.cos(f);f=Math.sin(f);c*=f;d*=f;e*=f;f=b[g+0];var k=b[g+1],l=b[g+2],m=b[g+3];a.Quaternion.load(b,g,f*h-(k*c+l*d+m*e),f*c+k*h+(l*e-m*d),f*d+l*h+(m*c-k*e),f*e+
m*h+(k*d-l*c))})})(xpl);(function(a){a.Vector3=function(){throw Error("Unsupported operation!");};a.Vector3.load=function(b,a,c,d,e){b[a+0]=c;b[a+1]=d;b[a+2]=e};a.Vector3.loadv=function(b,g,c,d){a.Vector3.load(b,g,c[d+0],c[d+1],c[d+2])};a.Vector3.loadZero=function(b,g){a.Vector3.load(b,g,0,0,0)};a.Vector3.lenSq=function(b,a){var c=b[a+0],d=b[a+1];b=b[a+2];return c*c+d*d+b*b};a.Vector3.len=function(b,g){return Math.sqrt(a.Vector3.lenSq(b,g))};a.Vector3.normalizev=function(b,g,c,d){var e=c[d+0],f=c[d+1];c=c[d+2];d=e*e+f*f+
c*c;0<d?(d=Math.sqrt(d),a.Vector3.load(b,g,e/d,f/d,c/d)):a.Vector3.loadZero(b,g)};a.Vector3.lerp=function(b,g,c,d,e,f,h,k,l){var m=1-l;a.Vector3.load(b,g,c*m+f*l,d*m+h*l,e*m+k*l)};a.Vector3.lerpv=function(b,g,c,d,e,f,h){a.Vector3.lerp(b,g,c[d+0],c[d+1],c[d+2],e[f+0],e[f+1],e[f+2],h)};a.Vector3.slerp=function(b,g,c,d,e,f,h,k,l){var m=c*c+d*d+e*e;0<m&&(m=Math.sqrt(m),c/=m,d/=m,e/=m);var n=f*f+h*h+k*k;0<n&&(n=Math.sqrt(n),f/=n,h/=n,k/=n);var p=c*f+d*h+e*k;if(1<=p)f=m*(1-l)+n*l,a.Vector3.load(b,g,c*f,
d*f,e*f);else if(-1>=p)f=m*(1-l)-n*l,a.Vector3.load(b,g,c*f,d*f,e*f);else{var m=m*(1-l)+n*l,n=Math.acos(p),q=Math.sin(n),p=Math.sin(n*(1-l))/q;l=Math.sin(n*l)/q;a.Vector3.load(b,g,(c*p+f*l)*m,(d*p+h*l)*m,(e*p+k*l)*m)}};a.Vector3.slerpv=function(b,g,c,d,e,f,h){a.Vector3.slerp(b,g,c[d+0],c[d+1],c[d+2],e[f+0],e[f+1],e[f+2],h)};a.Vector3.dot=function(a,g,c,d,e,f){return a*d+g*e+c*f};a.Vector3.dotv=function(a,g,c,d){return a[g+0]*c[d+0]+a[g+1]*c[d+1]+a[g+2]*c[d+2]};a.Vector3.cross=function(b,g,c,d,e,f,
h,k){a.Vector3.load(b,g,d*k-e*h,e*f-c*k,c*h-d*f)};a.Vector3.crossv=function(b,g,c,d,e,f){a.Vector3.cross(b,g,c[d+0],c[d+1],c[d+2],e[f+0],e[f+1],e[f+2])};a.Vector3.cos=function(a,g,c,d,e,f){var h=a*a+g*g+c*c;0<h&&(h=Math.sqrt(h),a/=h,g/=h,c/=h);h=d*d+e*e+f*f;0<h&&(h=Math.sqrt(h),d/=h,e/=h,f/=h);return a*d+g*e+c*f};a.Vector3.cosv=function(b,g,c,d){return a.Vector3.cos(b[g+0],b[g+1],b[g+2],c[d+0],c[d+1],c[d+2])};a.Vector3.reversev=function(b,g,c,d){a.Vector3.load(b,g,-c[d+0],-c[d+1],-c[d+2])};a.Vector3.add=
function(b,g,c,d,e,f,h,k){a.Vector3.load(b,g,c+f,d+h,e+k)};a.Vector3.addv=function(b,g,c,d,e,f){a.Vector3.add(b,g,c[d+0],c[d+1],c[d+2],e[f+0],e[f+1],e[f+2])};a.Vector3.sub=function(b,g,c,d,e,f,h,k){a.Vector3.load(b,g,c-f,d-h,e-k)};a.Vector3.subv=function(b,g,c,d,e,f){a.Vector3.sub(b,g,c[d+0],c[d+1],c[d+2],e[f+0],e[f+1],e[f+2])};a.Vector3.mul=function(b,g,c,d,e,f){a.Vector3.load(b,g,c*f,d*f,e*f)};a.Vector3.mulv=function(b,g,c,d,e){a.Vector3.mul(b,g,c[d+0],c[d+1],c[d+2],e)};a.Vector3.mulQuaternionv=
function(b,g,c,d,e,f){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=e[f+0];var m=e[f+1],n=e[f+2];e=-(k*d+l*m+c*n);f=h*d+(l*n-c*m);var p=h*m+(c*d-k*n);d=h*n+(k*m-l*d);a.Vector3.load(b,g,-e*k+f*h-(p*c-d*l),-e*l+p*h-(d*k-f*c),-e*c+d*h-(f*l-p*k))};a.Vector3.mulMatrix4x4v=function(b,g,c,d,e,f,h){if(h=xplDefVal(h,!0)){h=e[f+0];var k=e[f+1];e=e[f+2];f=c[d+3]*h+c[d+7]*k+c[d+11]*e+c[d+15];a.Vector3.load(b,g,(c[d+0]*h+c[d+4]*k+c[d+8]*e+c[d+12])/f,(c[d+1]*h+c[d+5]*k+c[d+9]*e+c[d+13])/f,(c[d+2]*h+c[d+6]*k+c[d+10]*
e+c[d+14])/f)}else h=c[d+0],k=c[d+1],c=c[d+2],d=h*e[f+12]+k*e[f+13]+c*e[f+14]+e[f+15],a.Vector3.load(b,g,(h*e[f+0]+k*e[f+1]+c*e[f+2]+e[f+3])/d,(h*e[f+4]+k*e[f+5]+c*e[f+6]+e[f+7])/d,(h*e[f+8]+k*e[f+9]+c*e[f+10]+e[f+11])/d)};a.Vector3.mulMatrix4x4Axisv=function(b,g,c,d,e,f,h){if(h=xplDefVal(h,!0)){h=e[f+0];var k=e[f+1];e=e[f+2];a.Vector3.load(b,g,c[d+0]*h+c[d+4]*k+c[d+8]*e,c[d+1]*h+c[d+5]*k+c[d+9]*e,c[d+2]*h+c[d+6]*k+c[d+10]*e)}else h=c[d+0],k=c[d+1],c=c[d+2],a.Vector3.load(b,g,h*e[f+0]+k*e[f+1]+c*
e[f+2],h*e[f+4]+k*e[f+5]+c*e[f+6],h*e[f+8]+k*e[f+9]+c*e[f+10])};a.Vector3.div=function(b,g,c,d,e,f){a.Vector3.load(b,g,c*f,d*f,e*f)};a.Vector3.divv=function(b,g,c,d,e){a.Vector3.div(b,g,c[d+0],c[d+1],c[d+2],e)};a.Vector3.convertToString=function(a,g){return"Vector3("+a[g+0]+", "+a[g+1]+", "+a[g+2]+")"}})(xpl);(function(a){a.GLUtils=function(){throw Error("Unsupported operation!");};Object.defineProperties(a.GLUtils,{TYPE_VERTEX_SHADER:{value:"OpenGL Vertex Shader"},TYPE_FRAGMENT_SHADER:{value:"OpenGL Fragment Shader"},TYPE_PROGRAM:{value:"OpenGL Program"}});a.GLUtils.createBuffer=function(a,g,c,d){if(g==a.ARRAY_BUFFER||g==a.ELEMENT_ARRAY_BUFFER){var e=a.createBuffer();null!=e&&(a.bindBuffer(g,e),a.bufferData(g,c,d));return e}return null};a.GLUtils.createTexture2D=function(b,g,c,d,e,f,h,k,l){f=xplDefVal(f,
null);h=xplDefVal(h,!1);k=xplDefVal(k,null);l=xplDefVal(l,0);var m=b.createTexture();if(null!=m){b.bindTexture(b.TEXTURE_2D,m);var n=a.MathUtils.ceilPow2(d),p=a.MathUtils.ceilPow2(e);d==n&&e==p?(b.pixelStorei(b.UNPACK_ALIGNMENT,1),b.texImage2D(b.TEXTURE_2D,0,g,n,p,0,g,c,f)):(b.pixelStorei(b.UNPACK_ALIGNMENT,1),b.texImage2D(b.TEXTURE_2D,0,g,texWidth,texHeight,0,g,c,null),null!=f&&b.texSubImage2D(b.TEXTURE_2D,0,0,0,d,e,g,c,f));h&&b.generateMipmap(b.TEXTURE_2D);null!=k&&(k[l+0]=n,k[l+1]=p)}return m};
a.GLUtils.createTexture2DFromImage=function(a,g,c,d){var e=a.createTexture();null!=e&&(a.bindTexture(a.TEXTURE_2D,e),a.texImage2D(a.TEXTURE_2D,0,g,g,c,d));return e};a.GLUtils.createShader=function(b,g,c,d){d=xplDefVal(d,null);if(g==b.VERTEX_SHADER||g==b.FRAGMENT_SHADER){var e=b.createShader(g);return null==e||(b.shaderSource(e,c),b.compileShader(e),b.getShaderParameter(e,b.COMPILE_STATUS))?e:(c=b.getShaderInfoLog(e),console.error("Shader compile error:\n"+c),null!=d&&(g==b.VERTEX_SHADER?d(a.GLUtils.TYPE_VERTEX_SHADER,
c):g==b.FRAGMENT_SHADER&&d(a.GLUtils.TYPE_FRAGMENT_SHADER,+c)),b.deleteShader(e),null)}return null};a.GLUtils.createProgram=function(b,g,c,d,e){if(null!=g&&null!=c){var f=b.createProgram();if(null!=f){b.attachShader(f,g);b.attachShader(f,c);if(null!=d)for(var h in d)b.bindAttribLocation(f,d[h],h);b.linkProgram(f);if(!b.getProgramParameter(f,b.LINK_STATUS))return g=b.getProgramInfoLog(f),console.error("Program linkage error:\n"+g),null!=e&&e(a.GLUtils.TYPE_PROGRAM,g),b.deleteProgram(f),null}return f}return null};
a.GLUtils.createShaderProgram=function(b,g,c,d,e){g=a.GLUtils.createShader(b,b.VERTEX_SHADER,g,e);if(null==g)return null;c=a.GLUtils.createShader(b,b.FRAGMENT_SHADER,c,e);if(null==c)return b.deleteShader(g),null;d=a.GLUtils.createProgram(b,g,c,d,e);b.deleteShader(g);b.deleteShader(c);return d}})(xpl);(function(a){var b=1;a.XModelStructure=function(a){this.structure_type=a;var c=b++;this.valueOf=function(){return c};this.hashCode=function(){return c}};a.XModelStructure.prototype.equals=function(a){return this==a};Object.defineProperties(a.XModelStructure,{TYPE_UNDEFINED:{value:-1},TYPE_NULL:{value:0},TYPE_AXIS_ROTATE:{value:1},TYPE_QUATERNION:{value:2},TYPE_SCALE:{value:3},TYPE_TRANSLATE:{value:4},TYPE_MATRIX:{value:5},TYPE_CONTAINER:{value:6},TYPE_TEXTURE:{value:7},TYPE_MATERIAL:{value:8},TYPE_MESH:{value:9},
TYPE_MESH_SUBSET:{value:15},TYPE_NODE:{value:10},TYPE_IK:{value:11},TYPE_ANIMATION:{value:12},TYPE_ANIMATION_KEY:{value:13},TYPE_ANIMATION_SET:{value:14},SIZE_RGBA:{value:4},SIZE_VECTOR_3:{value:3},SIZE_AXIS_ROTATE:{value:4},SIZE_QUATERNION:{value:4},SIZE_SCALE:{value:3},SIZE_TRANSLATE:{value:3},SIZE_MATRIX:{value:16},NUM_BLEND_SLOT:{value:2}})})(xpl);(function(a){a.XModelUserData=function(){this.data_size=0;this.data=null}})(xpl);
(function(a){a.XModelExtensible=function(b){a.XModelStructure.call(this,b);this.user_object=this.user_data=null};Object.setPrototypeOf(a.XModelExtensible.prototype,a.XModelStructure.prototype)})(xpl);(function(a){a.XModelParameter=function(b){a.XModelStructure.call(this,b)};Object.setPrototypeOf(a.XModelParameter.prototype,a.XModelStructure.prototype)})(xpl);(function(a){a.XModelTransform=function(b){a.XModelStructure.call(this,b)};Object.setPrototypeOf(a.XModelTransform.prototype,a.XModelParameter.prototype)})(xpl);
(function(a){a.XModelAxisRotate=function(){a.XModelTransform.call(this,a.XModelStructure.TYPE_AXIS_ROTATE);this.initial=new Float32Array([0,0,0,1]);this.value=new Float32Array([0,0,0,1,0,0,0,1])};Object.setPrototypeOf(a.XModelAxisRotate.prototype,a.XModelTransform.prototype);Object.defineProperties(a.XModelStructure,{ANGLE:{value:0},X:{value:1},Y:{value:2},Z:{value:3},SIZE:{value:4}})})(xpl);
(function(a){a.XModelQuaternion=function(){a.XModelTransform.call(this,a.XModelStructure.TYPE_QUATERNION);this.initial=new Float32Array([1,0,0,0]);this.value=new Float32Array([1,0,0,0,1,0,0,0])};Object.setPrototypeOf(a.XModelQuaternion.prototype,a.XModelTransform.prototype)})(xpl);
(function(a){a.XModelScale=function(){a.XModelTransform.call(this,a.XModelStructure.TYPE_SCALE);this.initial=new Float32Array([1,1,1]);this.value=new Float32Array([1,1,1,1,1,1])};Object.setPrototypeOf(a.XModelScale.prototype,a.XModelTransform.prototype)})(xpl);(function(a){a.XModelTranslate=function(){a.XModelTransform.call(this,a.XModelStructure.TYPE_TRANSLATE);this.initial=new Float32Array([0,0,0]);this.value=new Float32Array([0,0,0,0,0,0])};Object.setPrototypeOf(a.XModelTranslate.prototype,a.XModelTransform.prototype)})(xpl);
(function(a){a.XModelMatrix=function(){a.XModelTransform.call(this,a.XModelStructure.TYPE_MATRIX);this.initial=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Object.setPrototypeOf(a.XModelMatrix.prototype,a.XModelTransform.prototype)})(xpl);(function(a){a.XModelContainer=function(){a.XModelExtensible.call(this,a.XModelStructure.TYPE_CONTAINER);this.name=null;this.num_textures=0;this.textures=null;this.num_materials=0;this.materials=null;this.num_meshes=0;this.meshes=null;this.num_nodes=0;this.nodes=null;this.time_rate=1;this.num_animation_sets=0;this.animation_sets=null};Object.setPrototypeOf(a.XModelContainer.prototype,a.XModelExtensible.prototype);a.XModelContainer.prototype.toString=function(){return this.name}})(xpl);
(function(a){a.XModelNode=function(){a.XModelExtensible.call(this,a.XModelStructure.TYPE_NODE);this.name=null;this.connected=!0;this.lock_axises=new Uint8Array([!1,!1,!1]);this.limit_angles=new Uint8Array([!1,!1,!1]);this.min_angles=new Float32Array([-Math.PI,-Math.PI,-Math.PI]);this.max_angles=new Float32Array([Math.PI,Math.PI,Math.PI]);this.bone_tail=new Float32Array([0,0,0]);this.transforms=[null,null,null,null];this.num_iks=0;this.iks=null;this.num_meshes=0;this.meshes=null;this.num_children=
0;this.parent=this.children=null;this.offset_matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.combined_matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Object.setPrototypeOf(a.XModelNode.prototype,a.XModelExtensible.prototype);Object.defineProperties(a.XModelNode,{TRANSFORM_MATRIX:{value:0},TRANSFORM_TRANSLATE:{value:1},TRANSFORM_SCALE:{value:2},TRANSFORM_ROTATE:{value:3},NUM_TRANSFORMS:{value:4}});a.XModelNode.prototype.toString=function(){return this.name}})(xpl);(function(a){a.XModelIK=function(){a.XModelStructure.call(this,a.XModelStructure.TYPE_IK);this.target=null;this.max_iterations=500;this.influence=this.chain_length=1};Object.setPrototypeOf(a.XModelIK.prototype,a.XModelStructure.prototype);a.XModelIK.prototype.toString=function(){return this.name}})(xpl);(function(a){a.XModelTexture=function(){a.XModelExtensible.call(this,a.XModelStructure.TYPE_TEXTURE);this.ref=this.name=null;this.data_size=0;this.texture=this.data=null;this.z_size=this.y_size=this.x_size=0};Object.setPrototypeOf(a.XModelTexture.prototype,a.XModelExtensible.prototype);a.XModelTexture.prototype.toString=function(){return this.name}})(xpl);
(function(a){a.XModelMaterial=function(){a.XModelExtensible.call(this,a.XModelStructure.TYPE_MATERIAL);this.name=null;this.emissive=[0,0,0,1];this.ambient=[.1,.1,.1,1];this.diffuse=[1,1,1,1];this.specular=[.4,.4,.4,1];this.shininess=5;this.bump=1;this.bump_map=this.shininess_map=this.specular_map=this.diffuse_map=this.ambient_map=this.emissive_map=null;this.draw_mode=a.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS};Object.setPrototypeOf(a.XModelMaterial.prototype,a.XModelExtensible.prototype);Object.defineProperties(a.XModelMaterial,
{DRAW_MODE_FACE_NONE_BITS:{value:0},DRAW_MODE_FACE_FRONT_BITS:{value:1},DRAW_MODE_FACE_BACK_BITS:{value:2},DRAW_MODE_FACE_FRONT_AND_BACK_BITS:{value:a.XModelMaterial.DRAW_MODE_FACE_FRONT_BITS|a.XModelMaterial.DRAW_MODE_FACE_BACK_BITS}});a.XModelMaterial.prototype.toString=function(){return this.name}})(xpl);(function(a){a.XModelMeshBase=function(b){a.XModelExtensible.call(this,b);this.element_buffer=this.vertex_array=this.vertex_buffer=null};Object.setPrototypeOf(a.XModelMeshBase.prototype,a.XModelExtensible.prototype)})(xpl);
(function(a){a.XModelMesh=function(){a.XModelMeshBase.call(this,a.XModelStructure.TYPE_MESH);this.name=null;this.position_size=this.num_positions=0;this.positions=null;this.normal_size=this.num_normals=0;this.normals=null;this.color_size=this.num_colors=0;this.colors=null;this.tex_coord_size=this.num_tex_coords=0;this.skin=this.tex_coords=null;this.num_vertices=0;this.vertices=null;this.num_materials=0;this.materials=null;this.num_elements=0;this.elements=null;this.num_subsets=0;this.parent=this.subsets=
null};Object.setPrototypeOf(a.XModelMesh.prototype,a.XModelMeshBase.prototype);Object.defineProperties(a.XModelMesh,{TYPE_POSITION:{value:0},TYPE_NORMAL:{value:1}});a.XModelMesh.prototype.toString=function(){return this.name}})(xpl);(function(a){a.XModelMeshSubset=function(){a.XModelMeshBase.call(this,a.XModelStructure.TYPE_MESH_SUBSET);this.num_bones=0;this.bones=null;this.num_vertices=0;this.vertices=null;this.num_elements=0;this.elements=null};Object.setPrototypeOf(a.XModelMesh.prototype,a.XModelMeshBase.prototype)})(xpl);
(function(a){a.XModelSkin=function(){this.weighted_index_stride=this.num_weighted_indices=0;this.weights=this.indices=this.weighted_index_sizes=null;this.num_nodes=0;this.offset_quaternions=this.offset_matrices=this.nodes=null}})(xpl);
(function(a){a.XModelVertex=function(){this.skinning=this.tex_coord=this.color=this.normal=this.position=-1};a.XModelVertex.prototype.hashCode=function(){return this.position^this.normal^this.color^this.tex_coord^this.skinning};a.XModelVertex.prototype.equals=function(b){return this===b?!0:null!=b&&b instanceof a.XModelVertex?this.position==b.position&&this.normal==b.normal&&this.color==b.color&&this.tex_coord==b.tex_coord&&this.skinning==b.skinning:!1}})(xpl);
(function(a){a.XModelElement=function(){this.material=-1;this.num_vertices=0;this.vertices=null};a.XModelElement.prototype.hashCode=function(){for(var a=0,g=0;g<this.num_vertices;++g)a^=this.vertices[g];return this.material^this.num_vertices^a};a.XModelElement.prototype.equals=function(b){if(this===b)return!0;if(b&&b instanceof a.XModelElement){for(var g=0;g<this.num_vertices&&g<b.num_vertices;++g)if(this.vertices[g]!=b.vertices[g])return!1;return this.material==b.material&&this.num_vertices==b.num_vertices}return!1}})(xpl);(function(a){a.XModelAnimation=function(){a.XModelExtensible.call(this,a.XModelStructure.TYPE_ANIMATION);this.target=this.name=null;this.index=-1;this.num_keys=0;this.keys=null;this.num_children=0;this.children=null};Object.setPrototypeOf(a.XModelAnimation.prototype,a.XModelExtensible.prototype);a.XModelAnimation.prototype.toString=function(){return this.name}})(xpl);
(function(a){a.XModelAnimationKey=function(){a.XModelStructure.call(this,a.XModelStructure.TYPE_ANIMATION_KEY);this.interpolate=a.XModelAnimationKey.INTERPOLATE_UNKNOWN;this.value_size=this.after_time=this.before_time=this.time=0;this.after_value=this.before_value=this.value=null};Object.setPrototypeOf(a.XModelAnimationKey.prototype,a.XModelStructure.prototype);Object.defineProperties(a.XModelAnimationKey,{INTERPOLATE_UNKNOWN:{value:-1},INTERPOLATE_LINER:{value:0},INTERPOLATE_BEZIER:{value:1}})})(xpl);
(function(a){a.XModelAnimationSet=function(){a.XModelExtensible.call(this,a.XModelStructure.TYPE_ANIMATION_SET);this.name=null;this.num_animations=0;this.animations=null};Object.setPrototypeOf(a.XModelAnimationSet.prototype,a.XModelExtensible.prototype);a.XModelAnimationSet.prototype.toString=function(){return this.name}})(xpl);(function(a){a.XModelCodec=function(){};Object.defineProperties(a.XModelCodec,{CODE_NAME:{value:"EX-MACHINA"},MAGIC_NUMBER:{value:1633971576},END_OF_DATA:{value:1685614437},VERSION:{value:35},COMPATIBILITY_VERSION:{value:35},VERSION_NAME:{value:"0.9.90"},COMPATIBILITY_VERSION_NAME:{value:"0.9.90"}})})(xpl);(function(a){a.XModelDecoder=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};Object.setPrototypeOf(a.XModelDecoder.prototype,a.XModelCodec.prototype);a.XModelDecoder.prototype.decode=function(b){this.__data_view=new DataView(b);this.__data_offset=0;this.__inst_map={};this.__weak_inst_map={};if(this._getInt32()!=a.XModelCodec.MAGIC_NUMBER||this._getInt32()<a.XModelCodec.COMPATIBILITY_VERSION)return this._recycle(),null;b=this._getInt32();b=this._createStructureProcedure(b);
this._getStructureProcedure(b);this._getInt32()!=a.XModelCodec.END_OF_DATA&&console.error("Warning! This data doesn't has a terminator in the binary!");this._recycle();return b};a.XModelDecoder.prototype._recycle=function(){this.__data_view=null;this.__data_offset=0;this.__weak_inst_map=this.__inst_map=null};a.XModelDecoder.prototype._getInt8=function(){var a=this.__data_view.getInt8(this.__data_offset);this.__data_offset+=1;return a};a.XModelDecoder.prototype._getUint8=function(){var a=this.__data_view.getUint8(this.__data_offset);
this.__data_offset+=1;return a};a.XModelDecoder.prototype._getInt16=function(){var a=this.__data_view.getInt16(this.__data_offset,!0);this.__data_offset+=2;return a};a.XModelDecoder.prototype._getInt32=function(){var a=this.__data_view.getInt32(this.__data_offset,!0);this.__data_offset+=4;return a};a.XModelDecoder.prototype._getFloat32=function(){var a=this.__data_view.getFloat32(this.__data_offset,!0);this.__data_offset+=4;return a};a.XModelDecoder.prototype._getFloat64=function(){var a=this.__data_view.getFloat64(this.__data_offset,
!0);this.__data_offset+=8;return a};a.XModelDecoder.prototype._getInt8Array=function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getInt8()};a.XModelDecoder.prototype._getUint8Array=function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getUint8()};a.XModelDecoder.prototype._getInt16Array=function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getInt16()};a.XModelDecoder.prototype._getInt32Array=function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getInt32()};a.XModelDecoder.prototype._getFloat32Array=function(a,g,c){for(var d=
0;d<c;++d)a[g+d]=this._getFloat32()};a.XModelDecoder.prototype._getFloat64Array=function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getFloat64()};a.XModelDecoder.prototype._getBool=function(){return 0!=this._getInt8()};a.XModelDecoder.prototype._getBoolArray=function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getBool()};a.XModelDecoder.prototype._getString=function(){var b=this._getInt16();if(0<b){var g=Array(b);this._getUint8Array(g,0,b);return a.StringUtils.decodeUTF8(g)}return null};a.XModelDecoder.prototype._getStringArray=
function(a,g,c){for(var d=0;d<c;++d)a[g+d]=this._getString()};a.XModelDecoder.prototype._getStructure=function(){var a=this._getInt32();if(0==a)return null;var g=this._getInt32(),c=this.__inst_map[a];if(null!=c)return c;c=this.__weak_inst_map[a];null!=c?delete this.__weak_inst_map[a]:c=this._createStructureProcedure(g);this.__inst_map[a]=c;this._getStructureProcedure(c);return c};a.XModelDecoder.prototype._getStructureArray=function(a,g,c){for(var d=0;d<c;++d)a[g++]=this._getStructure()};a.XModelDecoder.prototype._getStructureRef=
function(){var a=this._getInt32();if(0==a)return null;var g=this._getInt32(),c=this.__inst_map[a]|this.__weak_inst_map[a];if(null!=c)return c;c=this._createStructureProcedure(g);this.__weak_inst_map[a]=c};a.XModelDecoder.prototype._getStructureRefArray=function(a,g,c){for(var d=0;d<c;++d)a[g++]=this._getStructRef()};a.XModelDecoder.prototype._createStructureProcedure=function(b){switch(b){case a.XModelStructure.TYPE_AXIS_ROTATE:return new a.XModelAxisRotate;case a.XModelStructure.TYPE_QUATERNION:return new a.XModelQuaternion;
case a.XModelStructure.TYPE_SCALE:return new a.XModelScale;case a.XModelStructure.TYPE_TRANSLATE:return new a.XModelTranslate;case a.XModelStructure.TYPE_MATRIX:return new a.XModelMatrix;case a.XModelStructure.TYPE_CONTAINER:return new a.XModelContainer;case a.XModelStructure.TYPE_TEXTURE:return new a.XModelTexture;case a.XModelStructure.TYPE_MATERIAL:return new a.XModelMaterial;case a.XModelStructure.TYPE_MESH:return new a.XModelMesh;case a.XModelStructure.TYPE_NODE:return new a.XModelNode;case a.XModelStructure.TYPE_IK:return new a.XModelIK;
case a.XModelStructure.TYPE_ANIMATION:return new a.XModelAnimation;case a.XModelStructure.TYPE_ANIMATION_KEY:return new a.XModelAnimationKey;case a.XModelStructure.TYPE_ANIMATION_SET:return new a.XModelAnimationSet}return null};a.XModelDecoder.prototype._getStructureProcedure=function(b){switch(b.structure_type){case a.XModelStructure.TYPE_AXIS_ROTATE:return this._getAxisRotate(b),!0;case a.XModelStructure.TYPE_QUATERNION:return this._getQuaternion(b),!0;case a.XModelStructure.TYPE_SCALE:return this._getScale(b),
!0;case a.XModelStructure.TYPE_TRANSLATE:return this._getTranslate(b),!0;case a.XModelStructure.TYPE_MATRIX:return this._getMatrix(b),!0;case a.XModelStructure.TYPE_CONTAINER:return this._getContainer(b),!0;case a.XModelStructure.TYPE_TEXTURE:return this._getTexture(b),!0;case a.XModelStructure.TYPE_MATERIAL:return this._getMaterial(b),!0;case a.XModelStructure.TYPE_MESH:return this._getMesh(b),!0;case a.XModelStructure.TYPE_NODE:return this._getNode(b),!0;case a.XModelStructure.TYPE_IK:return this._getIK(b),
!0;case a.XModelStructure.TYPE_ANIMATION:return this._getAnimation(b),!0;case a.XModelStructure.TYPE_ANIMATION_KEY:return this._getAnimationKey(b),!0;case a.XModelStructure.TYPE_ANIMATION_SET:return this._getAnimationSet(b),!0}return!1};a.XModelDecoder.prototype._getUserData=function(){this._getInt32();return null};a.XModelDecoder.prototype._getAxisRotate=function(b){this._getFloat32Array(b.initial,0,a.XModelStructure.SIZE_AXIS_ROTATE);ArrayUtils.copy(b.initial,0,b.value,0,a.XModelStructure.SIZE_AXIS_ROTATE)};
a.XModelDecoder.prototype._getQuaternion=function(b){this._getFloat32Array(b.initial,0,a.XModelStructure.SIZE_QUATERNION);a.ArrayUtils.copy(b.initial,0,b.value,0,a.XModelStructure.SIZE_QUATERNION)};a.XModelDecoder.prototype._getScale=function(b){this._getFloat32Array(b.initial,0,a.XModelStructure.SIZE_SCALE);a.ArrayUtils.copy(b.initial,0,b.value,0,a.XModelStructure.SIZE_SCALE)};a.XModelDecoder.prototype._getTranslate=function(b){this._getFloat32Array(b.initial,0,a.XModelStructure.SIZE_TRANSLATE);
a.ArrayUtils.copy(b.initial,0,b.value,0,a.XModelStructure.SIZE_TRANSLATE)};a.XModelDecoder.prototype._getMatrix=function(b){this._getFloat32Array(b.initial,0,a.XModelStructure.SIZE_MATRIX);a.ArrayUtils.copy(b.initial,0,b.value,0,a.XModelStructure.SIZE_MATRIX)};a.XModelDecoder.prototype._getContainer=function(a){a.name=this._getString();a.num_textures=this._getInt16();0<a.num_textures&&(a.textures=Array(a.num_textures),this._getStructureArray(a.textures,0,a.num_textures));a.num_materials=this._getInt16();
0<a.num_materials&&(a.materials=Array(a.num_materials),this._getStructureArray(a.materials,0,a.num_materials));a.num_meshes=this._getInt16();0<a.num_meshes&&(a.meshes=Array(a.num_meshes),this._getStructureArray(a.meshes,0,a.num_meshes));a.num_nodes=this._getInt16();0<a.num_nodes&&(a.nodes=Array(a.num_nodes),this._getStructureArray(a.nodes,0,a.num_nodes));a.time_rate=this._getFloat64();a.num_animation_sets=this._getInt16();0<a.num_animation_sets&&(a.animation_sets=Array(a.num_animation_sets),this._getStructureArray(a.animation_sets,
0,a.num_animation_sets));a.userData=this._getUserData()};a.XModelDecoder.prototype._getTexture=function(a){a.name=this._getString();a.ref=this._getString();a.data_size=this._getInt32();0<a.data_size&&(a.data=new Int8Array(a.data_size),this._getInt8Array(a.data,0,a.data_size));a.user_data=this._getUserData()};a.XModelDecoder.prototype._getMaterial=function(b){b.name=this._getString();this._getFloat32Array(b.emissive,0,a.XModelStructure.SIZE_RGBA);this._getFloat32Array(b.ambient,0,a.XModelStructure.SIZE_RGBA);
this._getFloat32Array(b.diffuse,0,a.XModelStructure.SIZE_RGBA);this._getFloat32Array(b.specular,0,a.XModelStructure.SIZE_RGBA);b.shininess=this._getFloat32();b.bump=this._getFloat32();b.emissive_map=this._getStructure();b.ambient_map=this._getStructure();b.diffuse_map=this._getStructure();b.specular_map=this._getStructure();b.shininess_map=this._getStructure();b.bump_map=this._getStructure();b.draw_mode=this._getInt32();b.user_data=this._getUserData()};a.XModelDecoder.prototype._getMesh=function(b){b.name=
this._getString();b.num_positions=this._getInt32();if(0<b.num_positions){b.position_size=this._getInt8();var g=b.position_size*b.num_positions;b.positions=new Float32Array(g);this._getFloat32Array(b.positions,0,g)}b.num_normals=this._getInt32();0<b.num_normals&&(b.normal_size=this._getInt8(),g=b.normal_size*b.num_normals,b.normals=new Float32Array(g),this._getFloat32Array(b.normals,0,g));b.num_colors=this._getInt32();0<b.num_colors&&(b.color_size=this._getInt8(),g=b.color_size*b.num_colors,b.colors=
new Float32Array(g),this._getFloat32Array(b.colors,0,g));b.num_tex_coords=this._getInt32();0<b.num_tex_coords&&(b.tex_coord_size=this._getInt8(),g=b.tex_coord_size*b.num_tex_coords,b.tex_coords=new Float32Array(g),this._getFloat32Array(b.tex_coords,0,g));if(g=this._getBool())b.skin=new a.XModelSkin,this._getSkin(b.skin);b.num_vertices=this._getInt32();if(0<b.num_vertices){b.vertices=Array(b.num_vertices);for(var c=0;c<b.num_vertices;++c){var d=new a.XModelVertex;this._getVertex(d,b.num_positions,
b.num_normals,b.num_colors,b.num_tex_coords,g);b.vertices[c]=d}}b.num_materials=this._getInt16();0<b.num_materials&&(b.materials=Array(b.num_materials),this._getStructureArray(b.materials,0,b.num_materials));b.num_elements=this._getInt32();if(0<b.num_elements)for(b.elements=Array(b.num_elements),g=0;g<b.num_elements;++g)c=new a.XModelElement,this._getElement(c),b.elements[g]=c;b.user_data=this._getUserData()};a.XModelDecoder.prototype._getSkin=function(b){b.num_weighted_indices=this._getInt32();b.weighted_index_stride=
this._getInt8();if(0<b.num_weighted_indices){b.weighted_index_sizes=new Uint8Array(b.num_weighted_indices);var g=b.weighted_index_stride*b.num_weighted_indices;b.indices=new Int16Array(g);b.weights=new Float32Array(g);for(var c=0;c<g;++c)b.indices[c]=-1,b.weights[c]=0;a.ArrayUtils.fill(b.indices,0,g,-1);a.ArrayUtils.fill(b.weights,0,g,0);for(c=g=0;g<b.num_weighted_indices;++g,c+=b.weighted_index_stride){var d=this._getInt8();b.weighted_index_sizes[g]=d;for(var e=0;e<d;++e){var f=c+e;b.indices[f]=
this._getInt16();b.weights[f]=this._getFloat32()}}}b.num_nodes=this._getInt16();0<b.num_nodes&&(b.nodes=Array(b.num_nodes),this._getStructureArray(b.nodes,0,b.num_nodes),g=a.XModelStructure.SIZE_MATRIX*b.num_nodes,b.offset_matrices=new Float32Array(g),this._getFloat32Array(b.offset_matrices,0,g),g=a.XModelStructure.SIZE_QUATERNION*b.num_nodes,b.offset_quaternions=new Float32Array(g),this._getFloat32Array(b.offset_quaternions,0,g))};a.XModelDecoder.prototype._getVertex=function(a,g,c,d,e,f){0<g&&(a.position=
this._getInt32());0<c&&(a.normal=this._getInt32());0<d&&(a.color=this._getInt32());0<e&&(a.tex_coord=this._getInt32());f&&(a.skinning=this._getInt32())};a.XModelDecoder.prototype._getElement=function(a){a.material=this._getInt16();a.num_vertices=this._getInt8();0<a.num_vertices&&(a.vertices=new Uint32Array(a.num_vertices),this._getInt32Array(a.vertices,0,a.num_vertices))};a.XModelDecoder.prototype._getNode=function(b){b.name=this._getString();b.connected=this._getBool();this._getBoolArray(b.lock_axises,
0,a.XModelStructure.SIZE_VECTOR_3);this._getBoolArray(b.limit_angles,0,a.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(b.min_angles,0,a.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(b.max_angles,0,a.XModelStructure.SIZE_VECTOR_3);this._getFloat32Array(b.bone_tail,0,a.XModelStructure.SIZE_VECTOR_3);this._getStructureArray(b.transforms,0,a.XModelNode.NUM_TRANSFORMS);b.num_iks=this._getInt16();0<b.num_iks&&(b.iks=Array(b.num_iks),this._getStructureArray(b.iks,0,b.num_iks));b.num_meshes=
this._getInt16();if(0<b.num_meshes){b.meshes=Array(b.num_meshes);this._getStructureArray(b.meshes,0,b.num_meshes);for(var g=0;g<b.num_meshes;++g){var c=b.meshes[g];null!=c&&(c.parent=b)}}b.num_children=this._getInt16();if(0<b.num_children)for(b.children=Array(b.num_children),this._getStructureArray(b.children,0,b.num_children),g=0;g<b.num_children;++g)c=b.children[g],null!=c&&(c.parent=b);b.user_data=this._getUserData()};a.XModelDecoder.prototype._getIK=function(a){a.target=this._getStructure();a.max_iterations=
this._getInt16();a.chain_length=this._getInt16();a.influence=this._getFloat32()};a.XModelDecoder.prototype._getAnimation=function(a){a.name=this._getString();a.target=this._getStructure();a.index=this._getInt16();a.num_keys=this._getInt16();0<a.num_keys&&(a.keys=Array(a.num_keys),this._getStructureArray(a.keys,0,a.num_keys));a.num_children=this._getInt16();0<a.num_children&&(a.children=Array(a.num_children),this._getStructureArray(a.children,0,a.num_children));a.user_data=this._getUserData()};a.XModelDecoder.prototype._getAnimationKey=
function(a){a.interpolate=this._getInt8();a.time=this._getFloat64();a.value_size=this._getInt16();0<a.value_size&&(a.value=new Float32Array(a.value_size),this._getFloat32Array(a.value,0,a.value_size))};a.XModelDecoder.prototype._getAnimationSet=function(a){a.name=this._getString();a.num_animations=this._getInt16();0<a.num_animations&&(a.animations=Array(a.num_animations),this._getStructureArray(a.animations,0,a.num_animations));a.user_data=this._getUserData()}})(xpl);(function(a){a.XModelMaterialUtils=function(){throw Error("Unsupported operation");};a.XModelMaterialUtils.getTextures=function(a,g,c,d){var e=0;null!=a&&(a.emissive_map&&(g&&0<d&&(g[c++]=a.emissive_map,d--),e++),a.ambient_map&&(g&&0<d&&(g[c++]=a.ambient_map,d--),e++),a.diffuse_map&&(g&&0<d&&(g[c++]=a.diffuse_map,d--),e++),a.specular_map&&(g&&0<d&&(g[c++]=a.specular_map,d--),e++),a.shininess_map&&(g&&0<d&&(g[c++]=a.shininess_map,d--),e++),a.bump_map&&(g&&0<d&&(g[c++]=a.bump_map),e++));return e};a.XModelMaterialUtils.releaseTexture=
function(a){null!=a&&(a.emissive_map&&(a.emissive_map.data=null,a.emissive_map.data_size=0),a.ambient_map&&(a.ambient_map.data=null,a.ambient_map.data_size=0),a.diffuse_map&&(a.diffuse_map.data=null,a.diffuse_map.data_size=0),a.specular_map&&(a.specular_map.data=null,a.specular_map.data_size=0),a.shininess_map&&(a.shininess_map.data=null,a.shininess_map.data_size=0),a.bump_map&&(a.bump_map.data=null,a.bump_map.data_size=0))}})(xpl);(function(a){a.XModelMeshUtils=function(){throw Error("Unsupported operation");};Object.defineProperties(a.XModelMeshUtils,{ATTRIBUTE_STRUCTURE_SIZE:{value:0},ATTRIBUTE_POSITION:{value:1},ATTRIBUTE_NORMAL:{value:2},ATTRIBUTE_COLOR:{value:3},ATTRIBUTE_TEXCOORD:{value:4},ATTRIBUTE_BONELENGTH:{value:5},ATTRIBUTE_BONEINDICES:{value:6},ATTRIBUTE_BONEWEIGHTS:{value:7},MAX_ATTRIBUTE:{value:8},TYPE_VOID:{value:0},TYPE_UNSIGNED_BYTE:{value:1},TYPE_UNSIGNED_SHORT:{value:2},TYPE_UNSIGNED_INT:{value:3},TYPE_FLOAT:{value:4}});
a.XModelMeshUtils.getPositions=function(a,g,c,d,e,f){var h=0;if(null!=a&&null!=a.positions&&0<a.position_size){void 0===f&&(f=-1);c<g&&(c=g);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?l:f.vertices[l]];if(-1!=m.position)for(var m=a.position_size*m.position,n=0;n<g&&n<a.position_size;++n)d[e+n]=a.positions[m++],h++;else n=0;for(;n<g;++n)d[e+n]=0,h++;e+=c}}return h};a.XModelMeshUtils.getNormals=function(a,g,c,d,e,f){var h=0;if(null!=
a&&null!=a.normals&&0<a.normal_size){void 0===f&&(f=-1);c<g&&(c=g);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?l:f.vertices[l]];if(-1!=m.normal)for(var m=a.normal_size*m.normal,n=0;n<g&&n<a.normal_size;++n)d[e+n]=a.normals[m++],h++;else n=0;for(;n<g;++n)d[e+n]=0,h++;e+=c}}return h};a.XModelMeshUtils.getColors=function(a,g,c,d,e,f){var h=0;if(null!=a&&null!=a.colors&&0<a.color_size){void 0===f&&(f=-1);c<g&&(c=g);var k;-1==f?
(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=d instanceof Uint8Array||d instanceof Int8Array?255:1,m=0;m<k;++m){var n=a.vertices[null==f?m:f.vertices[m]];if(-1!=n.color)for(var n=a.color_size*n.color,p=0;p<g&&p<a.color_size;++p)d[e+p]=a.colors[n++]*l,h++;else p=0;for(;p<g;++p)d[e+p]=0,h++;e+=c}}return h};a.XModelMeshUtils.getTexCoords=function(a,g,c,d,e,f){var h=0;if(null!=a&&null!=a.tex_coords&&0<a.tex_coord_size){void 0===f&&(f=-1);c<g&&(c=g);var k;-1==f?(f=null,k=a.num_vertices):
(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?l:f.vertices[l]];if(-1!=m.tex_coord)for(var m=a.tex_coord_size*m.tex_coord,n=0;n<g&&n<a.tex_coord_size;++n)d[e+n]=a.tex_coords[m++],h++;else n=0;for(;n<g;++n)d[e+n]=0,h++;e+=c}}return h};a.XModelMeshUtils.getSkinBoneLengths=function(a,g,c,d,e){if(null!=a&&null!=a.skin&&1<a.skin.weighted_index_stride){void 0===e&&(e=-1);-1==e?(g=null,e=a.num_vertices):(g=a.subsets[e],e=g.num_vertices);for(var f=0;f<e;++f){var h=a.vertices[null==
g?f:g.vertices[f]];c[d]=-1!=h.skinning?a.skin.weighted_index_sizes[h.skinning]:0}}return 0};a.XModelMeshUtils.getSkinBoneIndices=function(b,g,c,d,e,f){var h=0;if(null!=b&&null!=b.skin&&0<b.skin.weighted_index_stride){void 0===f&&(f=-1);c<g&&(c=g);var k;-1==f?(f=null,k=b.num_vertices):(f=b.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=b.vertices[null==f?l:f.vertices[l]];if(-1!=m.skinning)for(var n=b.skin.weighted_index_sizes[m.skinning],m=b.skin.weighted_index_stride*m.skinning,p=0;p<g&&
p<n&&b.skin.weighted_index_stride;++p){if(null==f)d[e+p]=b.skin.indices[m++];else{var q=a.ArrayUtils.binarySearch(f.bones,0,f.num_bones,b.skin.indices[m++]);d[e+p]=0<=q?q:0}h++}else p=0;for(;p<g;++p)d[e+p]=0,h++;e+=c}}return h};a.XModelMeshUtils.getSkinBoneWeights=function(a,g,c,d,e,f){var h=0;if(null!=a&&null!=a.skin&&0<a.skin.weighted_index_stride){void 0===f&&(f=-1);c<g&&(c=g);var k;-1==f?(f=null,k=a.num_vertices):(f=a.subsets[f],k=f.num_vertices);for(var l=0;l<k;++l){var m=a.vertices[null==f?
l:f.vertices[l]];if(-1!=m.skinning)for(var n=a.skin.weighted_index_sizes[m.skinning],m=a.skin.weighted_index_stride*m.skinning,p=0;p<g&&p<n&&a.skin.weighted_index_stride;++p)d[e+p]=a.skin.weights[m++],h++;else p=0;for(;p<g;++p)d[e+p]=0,h++;e+=c}}return h};a.XModelMeshUtils.getVerticesSize=function(b,g,c,d,e,f,h,k,l,m,n,p,q){if(null!=b&&null!=b.vertices&&0<b.num_vertices){void 0===q&&(q=-1);null!=n&&a.ArrayUtils.fill(n,p,p+a.XModelMeshUtils.MAX_ATTRIBUTE,-1);var r=0,t=g?1:-1==q?b.num_vertices:b.subsets[q].num_vertices;
0<d&&0<b.position_size&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_POSITION]=r),r+=t*b.position_size*d,r=c*Math.floor((r+c-1)/c));0<e&&0<b.normal_size&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_NORMAL]=r),r+=t*b.normal_size*e,r=c*Math.floor((r+c-1)/c));0<f&&0<b.color_size&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_COLOR]=r),r+=t*b.color_size*f,r=c*Math.floor((r+c-1)/c));0<h&&0<b.tex_coord_size&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_TEXCOORD]=r),r+=t*b.tex_coord_size*h,r=c*Math.floor((r+c-1)/
c));null!=b.skin&&0<b.skin.weighted_index_stride&&(0<k&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_BONELENGTH]=r),r=c*Math.floor((r+t*k+c-1)/c)),0<l&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_BONEINDICES]=r),r+=t*b.skin.weighted_index_stride*l,r=c*Math.floor((r+c-1)/c)),0<m&&(null!=n&&(n[p+a.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]=r),r+=t*b.skin.weighted_index_stride*m,r=c*Math.floor((r+c-1)/c)));if(g)return n[a.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=r,(-1==q?b.num_vertices:b.subsets[q].num_vertices)*
r;n[a.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE]=0;return r}return 0};a.XModelMeshUtils.getVertices=function(b,g,c,d,e,f,h,k,l,m,n,p,q){if(null!=b&&null!=b.vertices&&0<b.num_vertices){var r=l[m+a.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE],t;if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_POSITION])switch(t=p+l[m+a.XModelMeshUtils.ATTRIBUTE_POSITION],g){case a.XModelMeshUtils.TYPE_FLOAT:a.XModelMeshUtils.getPositions(b,b.position_size,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_NORMAL])switch(t=
p+l[m+a.XModelMeshUtils.ATTRIBUTE_NORMAL],c){case a.XModelMeshUtils.TYPE_FLOAT:a.XModelMeshUtils.getNormals(b,b.normal_size,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_COLOR])switch(t=p+l[m+a.XModelMeshUtils.ATTRIBUTE_COLOR],d){case a.XModelMeshUtils.TYPE_UNSIGNED_BYTE:a.XModelMeshUtils.getColors(b,b.color_size,r,new Uint8Array(n,t),0,q);break;case a.XModelMeshUtils.TYPE_FLOAT:a.XModelMeshUtils.getColors(b,b.color_size,r/4,new Float32Array(n,
t,Math.floor((n.byteLength-t)/4)),0,q)}if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_TEXCOORD])switch(t=p+l[m+a.XModelMeshUtils.ATTRIBUTE_TEXCOORD],e){case a.XModelMeshUtils.TYPE_FLOAT:a.XModelMeshUtils.getTexCoords(b,b.tex_coord_size,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}if(null!=b.skin&&0<b.skin.weighted_index_stride){if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_BONELENGTH])switch(t=p+l[m+a.XModelMeshUtils.ATTRIBUTE_BONELENGTH],f){case a.XModelMeshUtils.TYPE_UNSIGNED_BYTE:a.XModelMeshUtils.getSkinBoneLengths(b,
r,new Uint8Array(n,t),0,q)}if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_BONEINDICES])switch(t=p+l[m+a.XModelMeshUtils.ATTRIBUTE_BONEINDICES],h){case a.XModelMeshUtils.TYPE_UNSIGNED_BYTE:a.XModelMeshUtils.getSkinBoneIndices(b,b.skin.weighted_index_stride,r,new Uint8Array(n,t),0,q);break;case a.XModelMeshUtils.TYPE_UNSIGNED_SHORT:a.XModelMeshUtils.getSkinBoneIndices(b,b.skin.weighted_index_stride,r/2,new Uint16Array(n,t,Math.floor((n.byteLength-t)/2)),0,q)}if(0<=l[m+a.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS])switch(t=
p+l[m+a.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS],k){case a.XModelMeshUtils.TYPE_FLOAT:a.XModelMeshUtils.getSkinBoneWeights(b,b.skin.weighted_index_stride,r/4,new Float32Array(n,t,Math.floor((n.byteLength-t)/4)),0,q)}}}};a.XModelMeshUtils.getNumTriangledFaceIndices=function(a,g,c){var d=0;if(null!=a){void 0===c&&(c=-1);-1!=c&&(a=a.subsets[c]);c=a.num_elements;a=a.elements;for(var e=0;e<c;++e){var f=a[e];f.material==g&&3<=f.num_vertices&&(d+=3*(f.num_vertices-2))}}return d};a.XModelMeshUtils.getNumAllTriangledFaceIndices=
function(b,g,c,d,e,f){var h=0;if(null!=b){for(var k=0;k<b.num_materials;++k){null!=g&&(g[c+k]=h);var l=a.XModelMeshUtils.getNumTriangledFaceIndices(b,k,f);null!=d&&(d[e+k]=l);h+=l}null!=g&&(g[c+b.num_materials]=h);l=a.XModelMeshUtils.getNumTriangledFaceIndices(b,-1,f);null!=d&&(d[e+b.num_materials]=l);h+=l}return h};a.XModelMeshUtils.getTriangledFaceIndices=function(a,g,c,d,e,f){var h=0;if(null!=a){void 0===f&&(f=-1);-1!=f&&(a=a.subsets[f]);f=a.num_elements;a=a.elements;var k,l;c?(c=0,k=2,l=1):(c=
0,k=1,l=2);for(var m=0;m<f;++m){var n=a[m];if(n.material==g)for(var p=0,q=n.num_vertices-2;p<q;++p)d[e+c]=n.vertices[0],d[e+k]=n.vertices[p+1],d[e+l]=n.vertices[p+2],e+=3,h+=3}}return h};a.XModelMeshUtils.getAllTriangledFaceIndices=function(b,g,c,d,e,f,h){var k=0;if(null!=b)for(var l=0;l<b.num_materials;++l)k+=a.XModelMeshUtils.getTriangledFaceIndices(b,l,g,e,f+c[d+l],h);return k};a.XModelMeshUtils.releaseShape=function(a){if(null!=a&&(a.positions=null,a.normals=null,a.colors=null,a.tex_coords=null,
a.vertices=null,null!=a.skin&&(a.skin.weighted_index_sizes=null,a.skin.indices=null,a.skin.weights=null),a.elements=null,null!=a.subsets))for(var g=0;g<a.num_subsets;++g){var c=a.subsets[g];c.vertices=null;c.elements=null}};a.XModelMeshUtils.getTextures=function(b,g,c,d){var e=0;if(null!=b)for(var f=0;f<b.num_materials;++f){var h=a.XModelMaterialUtils.getTextures(b.materials[f],g,c,d);c+=h;d-=h;e+=h}return e};a.XModelMeshUtils.releaseTextures=function(b){if(null!=b)for(var g=0;g<b.num_materials;++g)a.XModelMaterialUtils.releaseTexture(b.materials[g])}})(xpl);(function(a){var b=a.Geometry.SIZE_VECTOR_3,g=a.Geometry.SIZE_MATRIX_4X4;a.XModelSkinUtils=function(){throw Error("Unsupported operation");};a.XModelSkinUtils.updateMatrixPallet=function(b,d,e,f){if(null!=b){for(var h=0;h<b.num_nodes&&h<d;++h){var k=g*h,l=b.nodes[h];null!=l?a.Matrix4x4.mulv(e,f+k,l.combined_matrix,0,b.offset_matrices,k):a.Matrix4x4.loadIdentity(e,f+k)}return Math.min(b.num_nodes,d)}return 0};a.XModelSkinUtils.updateVertices=function(c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w){k<b&&(k=b);n<
b&&(n=b);y<p&&(y=p);t<p&&(t=p);switch(w){case a.XModelMesh.TYPE_POSITION:w=a.Vector3.mulMatrix4x4v;break;case a.XModelMesh.TYPE_NORMAL:w=a.Vector3.mulMatrix4x4Axisv;break;default:throw Error("Unsupported the type of NaN");}if(1==p)for(p=0;p<e;++p)w(l,m,c,d+g*q[r],f,h,!0),h+=k,m+=n,r+=t;else if(1<p)for(var B=new Float32Array(b),D=0;D<e;++D){a.Vector3.loadZero(l,m);for(var E=0;E<p;++E){var G=v[u+E];0<G&&(w(B,0,c,d+g*q[r+E],f,h,!0),a.Vector3.mulv(B,0,B,0,G),a.Vector3.addv(l,m,l,m,B,0))}h+=k;m+=n;r+=
t;u+=y}}})(xpl);(function(a){a.XModeParameterUtils=function(){throw Error("Unsupported operation");};a.XModeParameterUtils.applyTransform=function(b,g,c,d){d=xplDefVal(d,0);if(null!=b){var e,f;switch(b.structure_type){case a.XModelStructure.TYPE_AXIS_ROTATE:0>=d?(e=b.value,f=0*a.XModelStructure.SIZE_AXIS_ROTATE):1<=d?(e=b.value,f=1*a.XModelStructure.SIZE_AXIS_ROTATE):(e=new Float32Array(a.XModelStructure.SIZE_AXIS_ROTATE),f=0,a.Vector3.slerpv(e,0,b.value,0*a.XModelStructure.SIZE_AXIS_ROTATE,b.value,1*a.XModelStructure.SIZE_AXIS_ROTATE,
d),a.Vector3.normalizev(e,0,e,0),e[a.XModelAxisRotate.ANGLE]=b.value[0*a.XModelStructure.SIZE_AXIS_ROTATE+a.XModelAxisRotate.ANGLE]*(1-d)+b.value[1*a.XModelStructure.SIZE_AXIS_ROTATE+a.XModelAxisRotate.ANGLE]*d);a.Matrix4x4.mulRotate(g,c,e[f+a.XModelAxisRotate.X],e[f+a.XModelAxisRotate.Y],e[f+a.XModelAxisRotate.Z],e[f+a.XModelAxisRotate.ANGLE],!0,!0);break;case a.XModelStructure.TYPE_QUATERNION:0>=d?(e=b.value,f=0*a.XModelStructure.SIZE_QUATERNION):1<=d?(e=b.value,f=1*a.XModelStructure.SIZE_QUATERNION):
(e=new Float32Array(a.XModelStructure.SIZE_QUATERNION),f=0,a.Quaternion.slerpv(e,0,b.value,0*a.XModelStructure.SIZE_QUATERNION,b.value,1*a.XModelStructure.SIZE_QUATERNION,d),a.Quaternion.normalizev(e,0,e,0));a.Matrix4x4.mulQuaternionv(g,c,e,f,!0);break;case a.XModelStructure.TYPE_SCALE:0>=d?(e=b.value,f=0*a.XModelStructure.SIZE_SCALE):1<=d?(e=b.value,f=1*a.XModelStructure.SIZE_SCALE):(e=new Float32Array(a.XModelStructure.SIZE_SCALE),f=0,a.Vector3.lerpv(e,0,b.value,0*a.XModelStructure.SIZE_SCALE,b.value,
1*a.XModelStructure.SIZE_SCALE,d));a.Matrix4x4.mulScale(g,c,e[f+a.Geometry.VX],e[f+a.Geometry.VY],e[f+a.Geometry.VZ]);break;case a.XModelStructure.TYPE_TRANSLATE:0>=d?(e=b.value,f=0*a.XModelStructure.SIZE_TRANSLATE):1<=d?(e=b.value,f=1*a.XModelStructure.SIZE_TRANSLATE):(e=new Float32Array(a.XModelStructure.SIZE_TRANSLATE),f=0,a.Vector3.lerpv(e,0,b.value,0*a.XModelStructure.SIZE_TRANSLATE,b.value,1*a.XModelStructure.SIZE_TRANSLATE,d));a.Matrix4x4.mulTranslate(g,c,e[f+a.Geometry.VX],e[f+a.Geometry.VY],
e[f+a.Geometry.VZ],!0);break;case a.XModelStructure.TYPE_MATRIX:0>=d?(e=b.value,f=0*a.XModelStructure.SIZE_MATRIX):1<=d?(e=b.value,f=1*a.XModelStructure.SIZE_MATRIX):(e=new Float32Array(a.XModelStructure.SIZE_MATRIX),f=0,a.Matrix4x4.slrepAxisAndLrepOtherv(e,0,b.value,0*a.XModelStructure.SIZE_MATRIX,b.value,1*a.XModelStructure.SIZE_MATRIX,d,!0)),a.Matrix4x4.mulv(g,c,g,c,e,f)}}};a.XModeParameterUtils.resetParameter=function(b,g){g=xplDefVal(g,0);if(null!=b)switch(b.structure_type){case a.XModelStructure.TYPE_AXIS_ROTATE:a.ArrayUtils.copy(b.initial,
0,b.value,a.XModelStructure.SIZE_AXIS_ROTATE*g,a.XModelStructure.SIZE_AXIS_ROTATE);break;case a.XModelStructure.TYPE_QUATERNION:a.ArrayUtils.copy(b.initial,0,b.value,a.XModelStructure.SIZE_QUATERNION*g,a.XModelStructure.SIZE_QUATERNION);break;case a.XModelStructure.TYPE_SCALE:a.ArrayUtils.copy(b.initial,0,b.value,a.XModelStructure.SIZE_SCALE*g,a.XModelStructure.SIZE_SCALE);break;case a.XModelStructure.TYPE_TRANSLATE:a.ArrayUtils.copy(b.initial,0,b.value,a.XModelStructure.SIZE_TRANSLATE*g,a.XModelStructure.SIZE_TRANSLATE);
break;case a.XModelStructure.TYPE_MATRIX:a.ArrayUtils.copy(b.initial,0,b.value,a.XModelStructure.SIZE_MATRIX*g,a.XModelStructure.SIZE_MATRIX)}}})(xpl);(function(a){var b=a.Geometry.VX,g=a.Geometry.VY,c=a.Geometry.VZ,d=a.Geometry.CI,e=a.Geometry.CJ,f=a.Geometry.CK,h=a.Geometry.M4X4_00,k=a.Geometry.M4X4_01,l=a.Geometry.M4X4_02,m=a.Geometry.M4X4_03,n=a.Geometry.M4X4_10,p=a.Geometry.M4X4_11,q=a.Geometry.M4X4_12,r=a.Geometry.M4X4_13,t=a.Geometry.M4X4_20,v=a.Geometry.M4X4_21,u=a.Geometry.M4X4_22,y=a.Geometry.M4X4_23;a.XModelKinematicsUtils=function(){throw Error("Unsupported operation");};var w=function(b){this.node=b;this.local_transform=new Float32Array(a.XModelStructure.SIZE_MATRIX);
this.transform=new Float32Array(a.XModelStructure.SIZE_MATRIX);this.offset_transform=new Float32Array(a.XModelStructure.SIZE_MATRIX);this.rotate=new Float32Array(a.XModelStructure.SIZE_QUATERNION);this.min_sins=new Float32Array(a.XModelStructure.SIZE_VECTOR_3);this.max_sins=new Float32Array(a.XModelStructure.SIZE_VECTOR_3);a.Matrix4x4.loadIdentity(this.local_transform,0);for(b=0;b<a.XModelNode.TRANSFORM_ROTATE;++b)a.XModeParameterUtils.applyTransform(this.node.transforms[b],this.local_transform,0);
a.Matrix4x4.normalizeAxisv(this.local_transform,0,this.local_transform,0,!0);b=this.local_transform[h];var c=this.local_transform[k],d=this.local_transform[n],e=this.local_transform[p],f=this.local_transform[t],g=this.local_transform[v];0>(d*g-f*e)*this.local_transform[l]+(f*c-b*g)*this.local_transform[q]+(b*e-d*c)*this.local_transform[u]&&(this.local_transform[h]=-this.local_transform[h],this.local_transform[k]=-this.local_transform[k],this.local_transform[l]=-this.local_transform[l],this.local_transform[n]=
-this.local_transform[n],this.local_transform[p]=-this.local_transform[p],this.local_transform[q]=-this.local_transform[q],this.local_transform[t]=-this.local_transform[t],this.local_transform[v]=-this.local_transform[v],this.local_transform[u]=-this.local_transform[u]);b=this.node.transforms[a.XModelNode.TRANSFORM_ROTATE];b.structure_type==a.XModelStructure.TYPE_AXIS_ROTATE?a.Quaternion.loadRotate(this.rotate,0,b.value[a.XModelAxisRotate.X],b.value[a.XModelAxisRotate.Y],b.value[a.XModelAxisRotate.Z],
b.value[a.XModelAxisRotate.ANGLE],!0):b.structure_type==a.XModelStructure.TYPE_QUATERNION?(a.Quaternion.loadv(this.rotate,0,b.value,0),a.Quaternion.normalizev(this.rotate,0,this.rotate,0)):a.Quaternion.loadIdentity(this.rotate,0);for(b=0;b<a.XModelStructure.SIZE_VECTOR_3;++b)this.min_sins[b]=Math.sin(.5*this.node.min_angles[b]),this.max_sins[b]=Math.sin(.5*this.node.max_angles[b])};w.prototype.updateOffsetTransform=function(){var b=this.transform[h],c=this.transform[n],d=this.transform[t],e=this.transform[k],
f=this.transform[p],g=this.transform[v],w=this.transform[l],x=this.transform[q],I=this.transform[u],K=-this.transform[m],A=-this.transform[r],M=-this.transform[y];a.Matrix4x4.load(this.offset_transform,0,b,c,d,K*b+A*c+M*d,e,f,g,K*e+A*f+M*g,w,x,I,K*w+A*x+M*I,0,0,0,1,!1)};a.XModelKinematicsUtils.applyInverseKinematicesLocation=function(h,k,l,n,p){if(null!=h&&1<=n){for(var q=h,t=1;t<n&&null!=q.parent;)q=q.parent,t++;if(1==n||1>=t)l=1;n=Array(t);var x=h;for(h=0;h<t;++h)n[h]=new w(x),x=x.parent;var u=
new Float32Array(a.XModelStructure.SIZE_VECTOR_3),v=new Float32Array(a.XModelStructure.SIZE_QUATERNION),A=new Float32Array(a.XModelStructure.SIZE_QUATERNION),M=new Float32Array(a.XModelStructure.SIZE_QUATERNION),H;for(h=0;h<l;++h){var x=n[0],L=t;H=n;var z=H[L-1];null!=z.node.parent?a.Matrix4x4.mulv(z.transform,0,z.node.parent.combined_matrix,0,z.local_transform,0):a.Matrix4x4.loadv(z.transform,0,z.local_transform,0,!1);a.Matrix4x4.mulQuaternionv(z.transform,0,z.rotate,0,!0);z.updateOffsetTransform();
for(L-=2;0<=L;--L){var R=z,z=H[L];a.Matrix4x4.mulv(z.transform,0,R.transform,0,z.local_transform,0);a.Matrix4x4.mulQuaternionv(z.transform,0,z.rotate,0,!0);z.updateOffsetTransform()}a.Vector3.mulMatrix4x4v(u,0,x.transform,0,x.node.bone_tail,0,!0);x=u[b]-k[b];H=u[g]-k[g];z=u[c]-k[c];if(x*x+H*H+z*z<=p)break;H=!1;for(z=0;z<t;++z){var x=n[z],L=x.transform[m],R=x.transform[r],U=x.transform[y];a.Quaternion.loadRotateVector3(v,0,u[b]-L,u[g]-R,u[c]-U,!0,k[b]-L,k[g]-R,k[c]-U,!0,(z+1)/t*(h==l-1?1:.5));H&&(a.Quaternion.mulv(v,
0,v,0,M,0),H=!1);a.Quaternion.loadv(M,0,v,0);a.Vector3.mulMatrix4x4Axisv(v,d,x.offset_transform,0,v,d,!0);a.Quaternion.conjugatev(v,0,v,0);a.Quaternion.loadv(A,0,x.rotate,0);a.Quaternion.mulv(x.rotate,0,v,0,x.rotate,0);for(var N=0;N<a.XModelStructure.SIZE_VECTOR_3;++N)if(x.node.lock_axises[N])x.rotate[d+N]=0,H=!0;else{var W=x.rotate[d+N],P=a.MathUtils.mid(W,x.min_sins[N],x.max_sins[N]);W!=P&&(x.rotate[d+N]=P,H=!0)}H&&(a.Quaternion.normalizev(x.rotate,0,x.rotate,0),a.Quaternion.divv(v,0,x.rotate,0,
A,0));a.Quaternion.conjugatev(v,0,v,0);a.Vector3.sub(u,0,u[b],u[g],u[c],L,R,U);a.Vector3.mulMatrix4x4Axisv(v,d,x.transform,0,v,d,!0);a.Vector3.mulQuaternionv(u,0,v,0,u,0);a.Vector3.add(u,0,u[b],u[g],u[c],L,R,U);H&&a.Quaternion.divv(M,0,M,0,v,0)}}for(h=0;h<t;++h)x=n[h],k=x.node.transforms[a.XModelNode.TRANSFORM_ROTATE],k.structure_type==a.XModelStructure.TYPE_AXIS_ROTATE?(l=x.rotate[d],p=x.rotate[e],u=x.rotate[f],v=l*l+p*p+u*u,0<v&&(v=Math.sqrt(v),l/=v,p/=v,u/=v),k.value[a.XModelAxisRotate.ANGLE]=
Math.acos(x.rotation[a.Geometry.CR]),k.value[a.XModelAxisRotate.X]=l,k.value[a.XModelAxisRotate.Y]=p,k.value[a.XModelAxisRotate.Z]=u):k.structure_type==a.XModelStructure.TYPE_QUATERNION&&a.Quaternion.loadv(k.value,0,x.rotate,0);null!=q.parent?a.XModelNodeUtils.updateCombinationv(q,q.num_children,q.children,0,q.parent.combined_matrix,0):a.XModelNodeUtils.updateCombination(q)}};a.XModelKinematicsUtils.applyInverseKinematices=function(b,c,d,e,f){null!=b&&null!=c&&(f=new Float32Array(a.XModelStructure.SIZE_VECTOR_3),
a.Vector3.loadZero(f,0),a.Vector3.mulMatrix4x4v(f,0,c.combined_matrix,0,f,0,!0),a.XModelKinematicsUtils.applyInverseKinematicesLocation(b,f,d,e,1E-4))};a.XModelKinematicsUtils.applyCopyTransform=function(a,b){}})(xpl);(function(a){a.XModelAnimationUtils=function(){throw Error("Unsupported operation");};a.XModelAnimationUtils.setAnimation=function(b,g){if(null!=b){if(0<b.num_keys){var c,d,e;if(1==b.num_keys)c=b.keys[0],d=b.keys[0],e=0;else{a:{e=0;d=b.num_keys;for(d--;e<=d;){c=e+d>>1;var f=b.keys[c].time;if(f<g)e=c+1;else if(f>g)d=c-1;else{e=c;break a}}e=-(e+1)}0<=e?(c=b.keys[e],d=b.keys[e],e=0):-1!=e?(e=-(e+2),e<b.num_keys-1?(c=b.keys[e+0],d=b.keys[e+1],e=(g-c.time)/(d.time-c.time)):(c=b.keys[e],d=b.keys[e],e=0)):
(c=b.keys[0],d=b.keys[0],e=0)}switch(b.target.structure_type){case a.XModelStructure.TYPE_AXIS_ROTATE:f=b.target;0>=e?-1==b.index?(a.Vector3.loadv(f.value,0,c.value,0),f.value[a.XModelAxisRotate.ANGLE]=c.value[a.XModelAxisRotate.ANGLE]):f.value[b.index]=c.value[0]:-1==b.index?(a.Vector3.slerpv(f.value,0,c.value,0,d.value,0,e),f.value[a.XModelAxisRotate.ANGLE]=c.value[a.XModelAxisRotate.ANGLE]*(1-e)+d.value[a.XModelAxisRotate.ANGLE]*e):f.value[b.index]=c.value[0]*(1-e)+d.value[0]*e;break;case a.XModelStructure.TYPE_QUATERNION:f=
b.target;0>=e?-1==b.index?a.Quaternion.loadv(f.value,0,c.value,0):f.value[b.index]=c.value[0]:-1==b.index?a.Quaternion.slerpv(f.value,0,c.value,0,d.value,0,e):f.value[b.index]=c.value[0]*(1-e)+d.value[0]*e;break;case a.XModelStructure.TYPE_SCALE:f=b.target;0>=e?-1==b.index?a.Vector3.loadv(f.value,0,c.value,0):f.value[b.index]=c.value[0]:-1==b.index?a.Vector3.lerpv(f.value,0,c.value,0,d.value,0,e):f.value[b.index]=c.value[0]*(1-e)+d.value[0]*e;break;case a.XModelStructure.TYPE_TRANSLATE:f=b.target;
0>=e?-1==b.index?a.Vector3.loadv(f.value,0,c.value,0):f.value[b.index]=c.value[0]:-1==b.index?a.Vector3.lerpv(f.value,0,c.value,0,d.value,0,e):f.value[b.index]=c.value[0]*(1-e)+d.value[0]*e;break;case a.XModelStructure.TYPE_MATRIX:f=b.target,0>=e?-1==b.index?a.Matrix4x4.loadv(f.value,0,c.value,0):f.value[b.index]=c.value[0]:-1==b.index?a.Matrix4x4.slrepAxisAndLrepOtherv(f.value,0,c.value,0,d.value,0,e,!0):f.value[b.index]=c.value[0]*(1-e)+d.value[0]*e}}for(e=0;e<b.num_children;++e)a.XModelAnimation.setAnimation(b.children[e],
g)}};a.XModelAnimationUtils.setAnimationSet=function(b,g){if(null!=b)for(var c=0;c<b.num_animations;++c)a.XModelAnimationUtils.setAnimation(b.animations[c],g)};a.XModelAnimationUtils.getAnimationTotalTime=function(b){var g=0;if(null!=b){for(var c=0;c<b.num_keys;++c){var d=b.keys[b.num_keys-1].time;g<d&&(g=d)}for(c=0;c<b.num_children;++c)d=a.XModelAnimationUtils.getAnimationTotalTime(b.children[c]),g<d&&(g=d)}return g};a.XModelAnimationUtils.getAnimationSetTotalTime=function(b){var g=0;if(null!=b)for(var c=
0;c<b.num_animations;++c){var d=a.XModelAnimationUtils.getAnimationTotalTime(b.animations[c]);g<d&&(g=d)}return g}})(xpl);(function(a){a.XModelNodeUtils=function(){throw Error("Unsupported operation");};a.XModelNodeUtils.getTextures=function(b,g,c,d){var e=0;if(null!=b){for(var f=0;f<b.num_meshes;++f){var h=a.XModelMeshUtils.getTextures(b.meshes[f],g,c,d);c+=h;d-=h;e+=h}for(f=0;f<b.num_children;++f)h=a.XModelNodeUtils.getTextures(b.children[f],g,c,d),c+=h,d-=h,e+=h}return e};a.XModelNodeUtils.releaseTextures=function(b){if(null!=b){for(var g=0;g<b.num_meshes;++g)a.XModelMeshUtils.releaseTextures(b.meshes[g]);for(g=0;g<
b.num_children;++g)a.XModelNodeUtils.releaseTextures(b.children[g])}};a.XModelNodeUtils.getMeshes=function(b,g,c,d){var e=0;if(null!=b){for(var f=0;f<b.num_meshes;++f){var h=b.meshes[f];null!=h&&(null!=g&&0<d&&(g[c++]=h,d--),e++)}for(f=0;f<b.num_children;++f)h=a.XModelNodeUtils.getMeshes(b.children[f],g,c,d),c+=h,d-=h,e+=h}return e};a.XModelNodeUtils.releaseShapes=function(b){if(null!=b){for(var g=0;g<b.num_meshes;++g)a.XModelMeshUtils.releaseShape(b.meshes[g]);for(g=0;g<b.num_children;++g)a.XModelNodeUtils.releaseShapes(b.children[g])}};
a.XModelNodeUtils.getNodes=function(b,g,c,d){var e=0;if(null!=b){null!=g&&0<d&&(g[c++]=b,d--);e++;for(var f=0;f<b.num_children;++f){var h=a.XModelNodeUtils.getNodes(b.children[f],g,c,d);c+=h;d-=h;e+=h}}return e};a.XModelNodeUtils.updateParent=function(b,g){if(null!=b){b.parent=g;for(g=0;g<b.num_meshes;++g)b.meshes[g].parent=b;for(g=0;g<b.num_children;++g)a.XModelNodeUtils.updateParent(b.children[g],b)}};a.XModelNodeUtils.updateCombinationp=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B){if(null!=
b){a.Matrix4x4.load(b.combined_matrix,0,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B);for(var D=0;D<a.XModelNode.NUM_TRANSFORMS;++D)a.XModeParameterUtils.applyTransform(b.transforms[D],b.combined_matrix,0);e=b.combined_matrix[a.Geometry.M4X4_00];f=b.combined_matrix[a.Geometry.M4X4_01];h=b.combined_matrix[a.Geometry.M4X4_02];k=b.combined_matrix[a.Geometry.M4X4_03];l=b.combined_matrix[a.Geometry.M4X4_10];m=b.combined_matrix[a.Geometry.M4X4_11];n=b.combined_matrix[a.Geometry.M4X4_12];p=b.combined_matrix[a.Geometry.M4X4_13];
q=b.combined_matrix[a.Geometry.M4X4_20];r=b.combined_matrix[a.Geometry.M4X4_21];t=b.combined_matrix[a.Geometry.M4X4_22];v=b.combined_matrix[a.Geometry.M4X4_23];u=b.combined_matrix[a.Geometry.M4X4_30];y=b.combined_matrix[a.Geometry.M4X4_31];w=b.combined_matrix[a.Geometry.M4X4_32];B=b.combined_matrix[a.Geometry.M4X4_33];for(D=0;D<g;++D)b=c[d+D],a.XModelNodeUtils.updateCombinationp(b,b.num_children,b.children,0,e,f,h,k,l,m,n,p,q,r,t,v,u,y,w,B)}};a.XModelNodeUtils.updateCombinationv=function(b,g,c,d,
e,f){a.XModelNodeUtils.updateCombinationp(b,g,c,d,e[f+a.Geometry.M4X4_00],e[f+a.Geometry.M4X4_01],e[f+a.Geometry.M4X4_02],e[f+a.Geometry.M4X4_03],e[f+a.Geometry.M4X4_10],e[f+a.Geometry.M4X4_11],e[f+a.Geometry.M4X4_12],e[f+a.Geometry.M4X4_13],e[f+a.Geometry.M4X4_20],e[f+a.Geometry.M4X4_21],e[f+a.Geometry.M4X4_22],e[f+a.Geometry.M4X4_23],e[f+a.Geometry.M4X4_30],e[f+a.Geometry.M4X4_31],e[f+a.Geometry.M4X4_32],e[f+a.Geometry.M4X4_33])};a.XModelNodeUtils.updateCombination=function(b,g,c,d){a.XModelNodeUtils.updateCombinationp(b,
g,c,d,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};a.XModelNodeUtils.updateCombinationAllp=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u){null!=b&&a.XModelNodeUtils.updateCombinationp(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u)};a.XModelNodeUtils.updateCombinationAllv=function(b,g,c){null!=b&&a.XModelNodeUtils.updateCombinationp(b,b.num_children,b.children,0,g[c+a.Geometry.M4X4_00],g[c+a.Geometry.M4X4_01],g[c+a.Geometry.M4X4_02],g[c+a.Geometry.M4X4_03],g[c+a.Geometry.M4X4_10],g[c+a.Geometry.M4X4_11],g[c+a.Geometry.M4X4_12],
g[c+a.Geometry.M4X4_13],g[c+a.Geometry.M4X4_20],g[c+a.Geometry.M4X4_21],g[c+a.Geometry.M4X4_22],g[c+a.Geometry.M4X4_23],g[c+a.Geometry.M4X4_30],g[c+a.Geometry.M4X4_31],g[c+a.Geometry.M4X4_32],g[c+a.Geometry.M4X4_33])};a.XModelNodeUtils.updateCombinationAll=function(b){null!=b&&a.XModelNodeUtils.updateCombinationp(b,b.num_children,b.children,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};a.XModelNodeUtils.updateOffset=function(b){if(null!=b){a.Matrix4x4.inversev(b.offset_matrix,0,b.combined_matrix,0);for(var g=
0;g<b.num_children;++g)a.XModelNodeUtils.updateOffset(b.children[g])}};a.XModelNodeUtils.applyKinematics=function(b){if(null!=b){for(var g=0;g<b.num_iks;++g){var c=b.iks[g];null!=c&&a.XModelKinematicsUtils.applyInverseKinematices(b,c.target,c.max_iterations,c.chain_length,1E-4*Math.PI)}for(g=0;g<b.num_children;++g)a.XModelNodeUtils.applyKinematics(b.children[g])}};a.XModelNodeUtils.resetTransforms=function(b){if(null!=b){for(var g=0;g<a.XModelNode.NUM_TRANSFORMS;++g)a.XModeParameterUtils.resetParameter(b.transforms[g]);
for(g=0;g<b.num_children;++g)a.XModelNodeUtils.resetTransforms(b.children[g])}};a.XModelNodeUtils.forEachMesh=function(b,g,c){if(null!=b){for(var d=0;d<b.num_meshes;++d){var e=b.meshes[d];null!=e&&g(e,c)}for(d=0;d<b.num_children;++d)a.XModelNodeUtils.forEachMesh(b.children[d],g,c)}};a.XModelNodeUtils.forEachNode=function(b,g,c,d){if(null!=b){g(b,c,d);c+=1;for(var e=0;e<b.num_children;++e)a.XModelNodeUtils.forEachNode(b.children[e],g,c,d)}}})(xpl);(function(a){a.XModelContainerUtils=function(){throw Error("Unsupported operation");};a.XModelContainerUtils.getTextures=function(b,g,c,d){var e=0;if(null!=b){for(var f=0;f<b.num_textures;++f){var h=b.textures[f];null!=h&&(null!=g&&0<d&&(g[c++]=h,d--),e++)}for(f=0;f<b.num_materials;++f)h=a.XModelMaterialUtils.getTextures(b.materials[f],g,c,d),c+=h,d-=h,e+=h;for(f=0;f<b.num_meshes;++f)h=a.XModelMeshUtils.getTextures(b.meshes[f],g,c,d),c+=h,d-=h,e+=h;for(f=0;f<b.num_nodes;++f)h=a.XModelNodeUtils.getTextures(b.nodes[f],
g,c,d),c+=h,d-=h,e+=h}return e};a.XModelContainerUtils.releaseTextures=function(b){if(null!=b){for(var g=0;g<b.num_textures;++g){var c=b.textures[g];null!=c&&(c.data=null,c.data_size=0)}for(g=0;g<b.num_materials;++g)a.XModelMaterialUtils.releaseTexture(b.materials[g]);for(g=0;g<b.num_meshes;++g)a.XModelMeshUtils.releaseTextures(b.meshes[g]);for(g=0;g<b.num_nodes;++g)a.XModelNodeUtils.releaseTextures(b.nodes[g])}};a.XModelContainerUtils.getMeshes=function(b,g,c,d){var e=0;if(null!=b){for(var f=0;f<
b.num_meshes;++f){var h=b.meshes[f];null!=h&&(null!=g&&0<d&&(g[c++]=h,d--),e++)}for(f=0;f<b.num_nodes;++f)h=a.XModelNodeUtils.getMeshes(node,g,c,d),c+=h,d-=h,e+=h}return e};a.XModelContainerUtils.releaseShapes=function(b){if(null!=b){for(var g=0;g<b.num_meshes;++g)a.XModelMeshUtils.releaseShape(b.meshes[g]);for(g=0;g<b.num_nodes;++g)a.XModelNodeUtils.releaseShapes(b.nodes[g])}};a.XModelContainerUtils.getNodes=function(b,g,c,d){var e=0;if(null!=b)for(var f=0;f<b.num_nodes;++f){var h=a.XModelNodeUtils.getNodes(b.nodes[f],
g,c,d);c+=h;d-=h;e+=h}return e};a.XModelContainerUtils.updateParent=function(b){if(null!=b){for(var g=0;g<b.num_meshes;++g){var c=b.meshes[g];null!=c&&(c.parent=null)}for(g=0;g<b.num_nodes;++g)a.XModelNodeUtils.updateParent(b.nodes[g],null)}};a.XModelContainerUtils.updateCombinationp=function(b,g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u){if(null!=b)for(var y=0;y<b.num_nodes;++y)a.XModelNodeUtils.updateCombinationAllp(b.nodes[y],g,c,d,e,f,h,k,l,m,n,p,q,r,t,v,u)};a.XModelContainerUtils.updateCombinationv=function(b,
g,c){if(null!=b)for(var d=0;d<b.num_nodes;++d)a.XModelNodeUtils.updateCombinationAllv(b.nodes[d],g,c)};a.XModelContainerUtils.updateCombination=function(b){if(null!=b)for(var g=0;g<b.num_nodes;++g)a.XModelNodeUtils.updateCombinationAll(b.nodes[g])};a.XModelContainerUtils.updateOffset=function(b){if(null!=b)for(var g=0;g<b.num_nodes;++g)a.XModelNodeUtils.updateOffset(b.nodes[g])};a.XModelContainerUtils.setAnimation=function(b,g,c,d){if(null!=b&&0<=g&&g<b.num_animation_sets){g=b.animation_sets[g];var e=
a.XModelAnimationUtils.getAnimationSetTotalTime(g);c*=b.time_rate;0<e&&d?c%=e:a.MathUtils.mid(0,e,c);a.XModelAnimationUtils.setAnimationSet(g,c)}};a.XModelContainerUtils.getAnimationTotalTime=function(b,g){return null!=b&&0<=g&&g<b.num_animation_sets?a.XModelAnimationUtils.getAnimationSetTotalTime(b.animation_sets[g])/b.time_rate:0};a.XModelContainerUtils.applyKinematics=function(b){if(null!=b)for(var g=0;g<b.num_nodes;++g)a.XModelNodeUtils.applyKinematics(b.nodes[g])};a.XModelContainerUtils.resetTransforms=
function(b){if(null!=b)for(var g=0;g<b.num_nodes;++g)a.XModelNodeUtils.resetTransforms(b.nodes[g])};a.XModelContainerUtils.resetOffset=function(b){a.XModelContainerUtils.resetTransforms(b);a.XModelContainerUtils.updateCombination(b);a.XModelContainerUtils.updateOffset(b)};a.XModelContainerUtils.forEachMesh=function(b,g,c){if(null!=b){for(var d=0;d<b.num_meshes;++d){var e=b.meshes[d];null!=e&&g(e,c)}for(d=0;d<b.num_nodes;++d)a.XModelNodeUtils.forEachMesh(b.nodes[d],g,c)}};a.XModelContainerUtils.forEachNode=
function(b,g,c){if(null!=b)for(var d=0;d<b.num_nodes;++d)a.XModelNodeUtils.forEachNode(b.nodes[d],g,0,c)}})(xpl);(function(a){a.XModelOptimizeUtils=function(){throw Error("Unsupported operation");};a.XModelOptimizeUtils.optimizeMeshVertices=function(a){null!=a&&console.log("it doesn't implement yet.")};a.XModelOptimizeUtils.optimizeMeshElements=function(a){null!=a&&console.log("it doesn't implement yet.")};var b=function(){this.bones=[];this.vertices=[];this.elements=[]};b.prototype.addBone=function(b){var c=a.ArrayUtils.binarySearch(this.bones,0,this.bones.length,b);0>c&&this.bones.splice(-c-1,0,b)};b.prototype.addVertex=
function(b){var c=a.ArrayUtils.binarySearch(this.vertices,0,this.vertices.length,b);0>c&&this.vertices.splice(-c-1,0,b)};b.prototype.addElement=function(b){var c=a.ArrayUtils.binarySearch(this.elements,0,this.elements.length,b);0>c&&this.elements.splice(-c-1,0,b)};b.prototype.merge=function(a,b,d,e){if(b)for(b=0;b<a.bones.length;++b)this.addBone(a.bones[b]);if(d)for(d=0;d<a.vertices.length;++d)this.addVertex(a.vertices[d]);if(e)for(e=0;e<a.elements.length;++e)this.addElement(a.elements[e])};a.XModelOptimizeUtils.optimizeMeshSkinForMatrixPallet=
function(g,c){if(null!=g&&null!=g.skin&&c<g.skin.num_nodes){if(void 0===c||16>c)c=16;for(var d={},e=0;e<g.num_elements;++e){var f=new b;f.addElement(e);for(var h=g.elements[e],k=0;k<h.num_vertices;++k){var l=h.vertices[k];f.addVertex(l);for(var m=g.vertices[l],l=g.skin.weighted_index_stride*m.skinning,m=g.skin.weighted_index_sizes[m.skinning],n=0;n<m;++n)f.addBone(g.skin.indices[l+n])}h="["+f.bones.toString()+"]";void 0!==d[h]?d[h].merge(f,!1,!0,!0):d[h]=f}var e=[],p;for(p in d)e.push(d[p]);e.sort(function(a,
b){return b.bones.length-a.bones.length});for(d=e.length-1;0<=d;--d)for(p=e[d],f=0;f<d;++f)if(h=e[f],a.ArrayUtils.isContained(h.bones,0,h.bones.length,p.bones,0,p.bones.length)){h.merge(p,!1,!0,!0);delete e[d];break}e=e.filter(function(a){return void 0!==a});console.log(e.length);for(d=0;d<e.length-1;++d)if(p=e[d],void 0!==p&&p.bones.length<=c)for(f=d+1;f<e.length&&p.bones.length<c;++f)h=e[f],void 0!==h&&p.bones.length+h.bones.length<=c&&(p.merge(h,!0,!0,!0),delete e[f]);e=e.filter(function(a){return void 0!==
a});console.log(e.length);g.num_subsets=e.length;g.subsets=Array(g.num_subsets);for(c=0;c<g.num_subsets;++c)for(d=e[c],p=new a.XModelMeshSubset,g.subsets[c]=p,p.num_bones=d.bones.length,p.bones=new Uint16Array(d.bones),p.num_vertices=d.vertices.length,p.vertices=new Uint32Array(d.vertices),p.num_elements=d.elements.length,p.elements=Array(p.num_elements),f=0;f<d.elements.length;++f)for(h=g.elements[d.elements[f]],k=new a.XModelElement,p.elements[f]=k,k.material=h.material,k.num_vertices=h.num_vertices,
k.vertices=new Uint32Array(k.num_vertices),l=0;l<k.num_vertices;++l)m=a.ArrayUtils.binarySearch(p.vertices,0,p.num_vertices,h.vertices[l]),k.vertices[l]=0<=m?m:0}};a.XModelOptimizeUtils.optimizeMeshSkinForWeightedIndices=function(a,b){}})(xpl);(function(a){a.XModelWrapper=function(){this._container=null;this.__prev_anim_index=-1;this.__min_bounds=new Float32Array([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]);this.__max_bounds=new Float32Array([-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]);this.__is_canseled=this.__is_completed=!1};Object.defineProperties(a.XModelWrapper.prototype,{container:{get:function(){return this._container}},isCompleted:{get:function(){return this.__is_completed}},isCanceled:{get:function(){return this.__is_canseled}},
numAnimationSets:{get:function(){return null!=this._container?this._container.num_animation_sets:0}}});a.XModelWrapper.prototype._complete=function(){this.__is_completed=!0;a.XModelContainerUtils.forEachMesh(this._container,function(a,g){for(g=0;g<a.num_positions;++g)for(var c=0;c<a.position_size;++c){var d=a.positions[a.position_size*g+c];this.__min_bounds[c]=Math.min(this.__min_bounds[c],d);this.__max_bounds[c]=Math.max(this.__max_bounds[c],d)}}.bind(this),null)};a.XModelWrapper.prototype.cancel=
function(){this.__is_canseled=!0};a.XModelWrapper.prototype.getMinBound=function(a){return this.__min_bounds[a]};a.XModelWrapper.prototype.getMaxBound=function(a){return this.__max_bounds[a]};a.XModelWrapper.prototype.getSize=function(a){return this.__max_bounds[a]-this.__min_bounds[a]};a.XModelWrapper.prototype.getCenter=function(a){return.5*(this.__min_bounds[a]+this.__max_bounds[a])};a.XModelWrapper.prototype.resetPose=function(){a.XModelContainerUtils.resetTransforms(this._container);a.XModelContainerUtils.updateCombination(this._container)};
a.XModelWrapper.prototype.setAnimation=function(b,g,c,d){void 0==c&&(c=!1);void 0==d&&(d=!1);this.__prev_anim_index!=b?(this.__prev_anim_index=b,this.resetPose()):a.XModelContainerUtils.resetTransforms(this._container);a.XModelContainerUtils.setAnimation(this._container,b,g,c);d&&a.XModelContainerUtils.applyKinematics(this._container);a.XModelContainerUtils.updateCombination(this._container)};a.XModelWrapper.prototype.dispose=function(){this.cancel();this.__is_completed=!1}})(xpl);
(function(a){a.XModelWrapperGL=function(){a.XModelWrapper.call(this);this.__white_texture=this.__config=null;this.__remain_textures=0;this.__is_update_anim=!1;this.__subset_matrix_pallet=this.__matrix_pallet=null};Object.setPrototypeOf(a.XModelWrapperGL.prototype,a.XModelWrapper.prototype);Object.defineProperties(a.XModelWrapperGL,{CONFIG_MEMORY_ALIGNMENT_SIZE:{value:"memory_alignment_size"},CONFIG_USE_VERTEX_ARRAY_OBJECT:{value:"use_vertex_array_object"},CONFIG_USE_MIPMAP_TEXTURE:{value:"use_mipmap_texture"},
CONFIG_USE_SKINNING:{value:"use_skinning"},CONFIG_GPU_SKINNING:{value:"gpu_skinning"},CONFIG_MAX_BONE_WEIGHTED_INDICES:{value:"max_bone_weighted_indices"},CONFIG_MAX_BONE_MATRICES:{value:"max_bone_matrices"},CONFIG_PATH_ALIAS:{value:"path_alias"},CONFIG_USE_MORFING:{value:"use_mofing"},CONFIG_GPU_MORFING:{value:"gpu_morfing"},UNIFORM_DIFFUSE:{value:"u_diffuse"},UNIFORM_DIFFUSE_MAP:{value:"u_diffuse_map"},UNIFORM_SPECULAR:{value:"u_specular"},UNIFORM_SPECULAR_MAP:{value:"u_specular_map"},UNIFORM_BONE_MATRICES:{value:"u_bone_matrices"},
UNIFORM_MAX_BONES:{value:"u_max_bones"},ATTRIBUTE_POSITION:{value:"a_position"},ATTRIBUTE_NORMAL:{value:"a_normal"},ATTRIBUTE_COLOR:{value:"a_color"},ATTRIBUTE_TEXCOORD:{value:"a_tex_coord"},ATTRIBUTE_BONEINDICES:{value:"a_bone_indices"},ATTRIBUTE_BONEWEIGHTS:{value:"a_bone_weights"}});var b=a.XModelWrapperGL;a.XModelWrapperGL.defaultConfig=function(){var a={};a[b.CONFIG_MEMORY_ALIGNMENT_SIZE]=4;a[b.CONFIG_USE_VERTEX_ARRAY_OBJECT]=!1;a[b.CONFIG_USE_MIPMAP_TEXTURE]=!1;a[b.CONFIG_USE_SKINNING]=!0;a[b.CONFIG_GPU_SKINNING]=
!0;a[b.CONFIG_MAX_BONE_MATRICES]=16;a[b.CONFIG_MAX_BONE_WEIGHTED_INDICES]=4;a[b.CONFIG_USE_MORFING]=!1;a[b.CONFIG_GPU_MORFING]=!1;a[b.CONFIG_PATH_ALIAS]=null;return a};a.XModelWrapperGL.copyConfig=function(a){for(var c={},f=$jscomp.makeIterator([b.CONFIG_MEMORY_ALIGNMENT_SIZE,b.CONFIG_USE_VERTEX_ARRAY_OBJECT,b.CONFIG_USE_MIPMAP_TEXTURE,b.CONFIG_USE_SKINNING,b.CONFIG_GPU_SKINNING,b.CONFIG_MAX_BONE_MATRICES,b.CONFIG_MAX_BONE_WEIGHTED_INDICES,b.CONFIG_USE_MORFING,b.CONFIG_GPU_MORFING,b.CONFIG_PATH_ALIAS]),
g=f.next();!g.done;g=f.next())g=g.value,c[g]=a[g];return c};a.XModelWrapperGL.defaultUniforms=function(){var a={};a[b.UNIFORM_DIFFUSE]=null;a[b.UNIFORM_DIFFUSE_MAP]=null;a[b.UNIFORM_BONE_MATRICES]=null;a[b.UNIFORM_MAX_BONES]=null;return a};a.XModelWrapperGL.defaultAttributes=function(){var a={};a[b.ATTRIBUTE_POSITION]=-1;a[b.ATTRIBUTE_NORMAL]=-1;a[b.ATTRIBUTE_COLOR]=-1;a[b.ATTRIBUTE_TEXCOORD]=-1;a[b.ATTRIBUTE_BONEINDICES]=-1;a[b.ATTRIBUTE_BONEWEIGHTS]=-1;return a};var g=function(d,e,f,g,k){if(null==
e.getExtension("OES_element_index_uint"))throw Error("Required the OES_element_index_uint");null==g&&(g="");var l=0,m=new XMLHttpRequest;m.open("GET",g+f,!0);m.responseType="arraybuffer";m.onload=function(d){if(!this.isCanceled)if(200==d.target.status)if(this._container=(new a.XModelDecoder).decode(d.target.response),null!=this._container){a.XModelContainerUtils.forEachMesh(this._container,function(c,d){var e=k[b.CONFIG_USE_SKINNING]&&null!=c.skin&&0<c.skin.num_nodes,f=!k[b.CONFIG_GPU_SKINNING]&&
e,g=k[b.CONFIG_GPU_SKINNING]&&e,h=!e||g,m,n,p,E;g?(m=2,n=4,p=a.XModelMeshUtils.TYPE_UNSIGNED_SHORT,E=a.XModelMeshUtils.TYPE_FLOAT):(n=m=0,E=p=a.XModelMeshUtils.TYPE_VOID);g&&a.XModelOptimizeUtils.optimizeMeshSkinForMatrixPallet(c,k[b.CONFIG_MAX_BONE_MATRICES]);e=function(e){var g=-1==e?c:c.subsets[e],l=new Int32Array(a.XModelMeshUtils.MAX_ATTRIBUTE),t=a.XModelMeshUtils.getVerticesSize(c,h,k[b.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,1,4,0,m,n,l,0,e),t=new ArrayBuffer(t);a.XModelMeshUtils.getVertices(c,a.XModelMeshUtils.TYPE_FLOAT,
a.XModelMeshUtils.TYPE_FLOAT,a.XModelMeshUtils.TYPE_UNSIGNED_BYTE,a.XModelMeshUtils.TYPE_FLOAT,a.XModelMeshUtils.TYPE_VOID,p,E,l,0,t,0,e);var u,I,K,A,M,H,L,z;f?(z=new Int32Array(a.XModelMeshUtils.MAX_ATTRIBUTE),u=a.XModelMeshUtils.getVerticesSize(c,!1,k[b.CONFIG_MEMORY_ALIGNMENT_SIZE],4,4,0,0,0,2,4,z,0,e),u=new ArrayBuffer(u),I=new Float32Array(u,z[a.XModelMeshUtils.ATTRIBUTE_POSITION]),K=new Float32Array(u,z[a.XModelMeshUtils.ATTRIBUTE_NORMAL]),A=new Uint16Array(u,z[a.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),
M=new Float32Array(u,z[a.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS]),a.XModelMeshUtils.getVertices(c,a.XModelMeshUtils.TYPE_FLOAT,a.XModelMeshUtils.TYPE_FLOAT,a.XModelMeshUtils.TYPE_VOID,a.XModelMeshUtils.TYPE_VOID,a.XModelMeshUtils.TYPE_VOID,a.XModelMeshUtils.TYPE_UNSIGNED_SHORT,a.XModelMeshUtils.TYPE_FLOAT,z,0,u,0,e),H=new ArrayBuffer(z[a.XModelMeshUtils.ATTRIBUTE_BONEINDICES]),L=new Float32Array(H,z[a.XModelMeshUtils.ATTRIBUTE_POSITION]),z=new Float32Array(H,z[a.XModelMeshUtils.ATTRIBUTE_NORMAL])):
z=L=H=M=A=K=I=u=null;var R=new Int32Array(c.num_materials+1),U=new Uint32Array(c.num_materials+1),N=a.XModelMeshUtils.getNumAllTriangledFaceIndices(c,R,0,U,0,e),N=new Uint32Array(N);a.XModelMeshUtils.getAllTriangledFaceIndices(c,!0,R,0,N,0,e);g.vertex_buffer=a.GLUtils.createBuffer(d,d.ARRAY_BUFFER,t,f?d.STREAM_DRAW:d.STATIC_DRAW);g.element_buffer=a.GLUtils.createBuffer(d,d.ELEMENT_ARRAY_BUFFER,N.buffer,d.STATIC_DRAW);g.user_object={vertices_offsets:l,src_vertices:u,src_positions:I,src_normals:K,src_bone_indices:A,
src_bone_weights:M,dest_vertices:H,dest_positions:L,dest_normals:z,elements_offsets:R,elements_sizes:U}};if(null!=c.subsets&&0<c.num_subsets)for(g=0;g<c.num_subsets;++g)e(g);else e(-1);null!=c.skin&&(l=Math.max(c.skin.num_nodes,l))},e);0<l&&(this.__matrix_pallet=new Float32Array(a.Geometry.SIZE_MATRIX_4X4*l),this.__subset_matrix_pallet=new Float32Array(Math.max(a.Geometry.SIZE_MATRIX_4X4*l,a.Geometry.SIZE_MATRIX_4X4*k[b.CONFIG_MAX_BONE_MATRICES])),this.resetPose());var f=a.XModelContainerUtils.getTextures(this._container,
null,0,0);d=Array(f);a.XModelContainerUtils.getTextures(this._container,d,0,f);d=a.ArrayUtils.convertToSet(d,0,d.length,function(a,b){return a.name==b.name});this.__remain_textures=d.length;for(f=0;f<d.length;++f)c(this,e,d[f],g,k);0>=this.__remain_textures&&this._complete()}else this.cancel();else this.cancel()}.bind(d);m.send()},c=function(c,e,f,g,k){var l=new XMLHttpRequest;null!=k[b.CONFIG_PATH_ALIAS]&&null!=k[b.CONFIG_PATH_ALIAS][f.ref]?l.open("GET",k[b.CONFIG_PATH_ALIAS][f.ref],!0):l.open("GET",
g+f.ref,!0);l.responseType="blob";l.onload=function(g){if(!c.isCanceled){if(200==g.target.status){g=g.target.response;var h=new Image;h.onload=function(){f.texture=a.GLUtils.createTexture2DFromImage(e,e.RGBA,e.UNSIGNED_BYTE,h);e.bindTexture(e.TEXTURE_2D,f.texture);k[b.CONFIG_USE_MIPMAP_TEXTURE]&&e.generateMipmap(e.TEXTURE_2D);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,
e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)};h.src=URL.createObjectURL(g)}this.__remain_textures--;0>=this.__remain_textures&&this._complete()}}.bind(c);l.send()};a.XModelWrapperGL.prototype.initializeWithUrl=function(b,c,f,h){this.__white_texture=a.GLUtils.createTexture2D(b,b.RGBA,b.UNSIGNED_BYTE,1,1,new Uint8Array([255,255,255,255]),!1,null,0);this.__config=a.XModelWrapperGL.copyConfig(h);g(this,b,c,f,this.__config)};a.XModelWrapperGL.prototype.setAnimation=function(b,
c,f,g){a.XModelWrapper.prototype.setAnimation.call(this,b,c,f,g);this.__is_update_anim=!0};a.XModelWrapperGL.prototype._complete=function(){a.XModelWrapper.prototype._complete.call(this);a.XModelContainerUtils.releaseShapes(this._container)};a.XModelWrapperGL.prototype.draw=function(c,e,f){a.XModelContainerUtils.forEachMesh(this._container,function(c,d){var g=this.__config[b.CONFIG_USE_SKINNING],m=this.__config[b.CONFIG_GPU_SKINNING];null!=c.skin&&g&&a.XModelSkinUtils.updateMatrixPallet(c.skin,c.skin.num_nodes,
this.__matrix_pallet,0);var n=function(n){var p,t;-1==n?(p=null,t=c):t=p=c.subsets[n];var v=-1==n?c:c.subsets[n];d.bindBuffer(d.ARRAY_BUFFER,v.vertex_buffer);var u=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_STRUCTURE_SIZE],y=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_POSITION];-1!=f.a_position&&-1!=y&&(d.enableVertexAttribArray(f.a_position),d.vertexAttribPointer(f.a_position,c.position_size,d.FLOAT,!1,u,y));y=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_NORMAL];
-1!=f.a_normal&&-1!=y&&(d.enableVertexAttribArray(f.a_normal),d.vertexAttribPointer(f.a_normal,c.normal_size,d.FLOAT,!1,u,y));y=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_COLOR];-1!=f.a_color&&-1!=y&&(d.enableVertexAttribArray(f.a_color),d.vertexAttribPointer(f.a_color,c.color_size,d.UNSIGNED_BYTE,!1,u,y));y=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_TEXCOORD];-1!=f.a_tex_coord&&-1!=y&&(d.enableVertexAttribArray(f.a_tex_coord),d.vertexAttribPointer(f.a_tex_coord,c.tex_coord_size,
d.FLOAT,!1,u,y));null!=c.skin&&this.__config[b.CONFIG_USE_SKINNING]&&(y=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_BONEINDICES],-1!=f.a_bone_indices&&-1!=y&&(d.enableVertexAttribArray(f.a_bone_indices),d.vertexAttribPointer(f.a_bone_indices,c.skin.weighted_index_stride,d.UNSIGNED_SHORT,!1,u,y)),v=v.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_BONEWEIGHTS],-1!=f.a_bone_weights&&-1!=v&&(d.enableVertexAttribArray(f.a_bone_weights),d.vertexAttribPointer(f.a_bone_weights,c.skin.weighted_index_stride,
d.FLOAT,!1,u,v)));if(g&&null!=c.skin)if(m){if(null!=e.u_bone_matrices)if(null!=e.u_max_bones&&d.uniform1i(e.u_max_bones,c.skin.weighted_index_stride),-1==n)d.uniformMatrix4fv(e.u_bone_matrices,!1,this.__matrix_pallet);else{for(u=0;u<p.num_bones;++u)a.Matrix4x4.loadv(this.__subset_matrix_pallet,a.Geometry.SIZE_MATRIX_4X4*u,this.__matrix_pallet,a.Geometry.SIZE_MATRIX_4X4*p.bones[u],!1);d.uniformMatrix4fv(e.u_bone_matrices,!1,this.__subset_matrix_pallet)}}else{if(this.__is_update_anim){null!=e.u_max_bones&&
d.uniform1i(e.u_max_bones,0);-1!=c.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_POSITION]&&a.XModelSkinUtils.updateVertices(this.__matrix_pallet,0,t.num_vertices,t.user_object.src_positions,0,0,t.user_object.dest_positions,0,0,t.skin.weighted_index_stride,t.user_object.src_bone_indices,0,0,t.user_object.src_bone_weights,0,0,a.XModelMesh.TYPE_POSITION);if(-1!=t.user_object.vertices_offsets[a.XModelMeshUtils.ATTRIBUTE_NORMAL]){for(u=0;u<c.skin.num_nodes;++u)p=a.Geometry.SIZE_MATRIX_4X4*
u,a.Matrix4x4.loadAxisv(this.__matrix_pallet,p,this.__matrix_pallet,p,!1),a.Matrix4x4.normalizeAxisv(this.__matrix_pallet,p,this.__matrix_pallet,p,!0);a.XModelSkinUtils.updateVertices(this.__matrix_pallet,0,t.num_vertices,t.user_object.src_normals,0,0,t.user_object.dest_normals,0,0,t.skin.weighted_index_stride,t.user_object.src_bone_indices,0,0,t.user_object.src_bone_weights,0,0,xpl.XModelMesh.TYPE_NORMAL)}d.bufferSubData(d.ARRAY_BUFFER,0,t.user_object.dest_vertices);this.__is_update_anim=!1}}else null!=
e.u_max_bones&&d.uniform1i(e.u_max_bones,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,t.element_buffer);for(u=0;u<c.num_materials;++u)p=c.materials[u],v=t.user_object.elements_sizes[u],0<v&&(null!=e.u_ambient_map?(d.activeTexture(d.TEXTURE1),d.uniform1i(e.u_ambient_map,1),null!=p.ambient_map&&null!=p.ambient_map.texture?(d.uniform4fv(e.u_ambient_map,p.ambient),d.bindTexture(d.TEXTURE_2D,p.ambient_map.texture)):(d.uniform4f(e.u_ambient_color,1,1,1,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=
e.u_ambient_color&&d.uniform4f(e.u_ambient_color,1,1,1,1),null!=e.u_diffuse_map?(d.activeTexture(d.TEXTURE0),d.uniform1i(e.u_diffuse_map,0),null!=p.diffuse_map&&null!=p.diffuse_map.texture?(d.uniform4fv(e.u_diffuse_color,p.diffuse),d.bindTexture(d.TEXTURE_2D,p.diffuse_map.texture)):(d.uniform4f(e.u_diffuse_color,1,1,1,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=e.u_diffuse_color&&d.uniform4f(e.u_diffuse_color,1,1,1,1),null!=e.u_specular_map?(d.activeTexture(d.TEXTURE1),d.uniform1i(e.u_specular_map,
2),null!=p.specular_map&&null!=p.specular_map.texture?(d.uniform4fv(e.u_specular_map,p.specular),d.bindTexture(d.TEXTURE_2D,p.specular_map.texture)):(d.uniform4f(e.u_specular_color,1,1,1,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=e.u_specular_color&&d.uniform4f(e.u_specular_color,1,1,1,1),null!=e.u_bump_map?(d.activeTexture(d.TEXTURE1),d.uniform1i(e.u_bump_map,3),null!=p.bump_map&&null!=p.bump_map.texture?(d.uniform4fv(e.u_bump_map,p.bump),d.bindTexture(d.TEXTURE_2D,p.bump_map.texture)):
(d.uniform4f(e.u_bump_color,.5,.5,.5,1),d.bindTexture(d.TEXTURE_2D,this.__white_texture))):null!=e.u_bump_color&&d.uniform4f(e.u_bump_color,1,1,1,1),d.drawElements(d.TRIANGLES,v,d.UNSIGNED_INT,4*t.user_object.elements_offsets[u]));d.bindBuffer(d.ARRAY_BUFFER,(-1==n?c:c.subsets[n]).vertex_buffer);-1!=f.a_position&&d.disableVertexAttribArray(f.a_position);-1!=f.a_normal&&d.disableVertexAttribArray(f.a_normal);-1!=f.a_color&&d.disableVertexAttribArray(f.a_color);-1!=f.a_tex_coord&&d.disableVertexAttribArray(f.a_tex_coord);
-1!=f.a_bone_indices&&d.disableVertexAttribArray(f.a_bone_indices);-1!=f.a_bone_weights&&d.disableVertexAttribArray(f.a_bone_weights)}.bind(this);if(null!=c.subsets&&0<c.num_subsets)for(var p=0;p<c.num_subsets;++p)n(p);else n(-1)}.bind(this),c)};a.XModelWrapperGL.prototype.dispose=function(b){a.XModelWrapper.prototype.dispose.call(this);a.XModelContainerUtils.forEachMesh(this._container,function(a,b){null!=a.vertex_buffer&&(b.deleteBuffer(a.vertex_buffer),a.vertex_buffer=null);null!=a.element_buffer&&
(b.deleteBuffer(a.element_buffer),a.element_buffer=null)},b);b.deleteTexture(this.__white_texture);for(var c=a.XModelContainerUtils.getTextures(this._container,null,0,0),f=Array(c),g=0;g<c;++g){var k=f[g];null!=k&&(b.deleteTexture(k.texture),k.texture=null)}}})(xpl);
